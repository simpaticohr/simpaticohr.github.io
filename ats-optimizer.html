<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ATS Optimizer | Simpatico HR</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>if(window.pdfjsLib)pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  :root {
    --accent: #6366f1;
    --accent-soft: rgba(99,102,241,.12);
    --bg: #020617;
    --card: rgba(15,23,42,.65);
    --border: rgba(255,255,255,.08);
    --text: #f8fafc;
    --muted: #94a3b8;
    --green: #10b981;
    --red: #ef4444;
    --yellow: #f59e0b;
    --blue: #3b82f6;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
    background:
      radial-gradient(circle at 10% 20%, rgba(99,102,241,.15), transparent 40%),
      radial-gradient(circle at 90% 80%, rgba(79,70,229,.1), transparent 40%),
      var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  .nav {
    backdrop-filter: blur(16px);
    background: rgba(2,6,23,.85);
    padding: 1.2rem 6%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .logo { font-weight: 800; font-size: 1.1rem; color: #fff; text-decoration: none; }
  .logo span { color: var(--accent); }
  .nav-links { display: flex; gap: 16px; }
  .link { color: var(--muted); text-decoration: none; font-size: 13px; font-weight: 500; }
  .link:hover { color: #fff; }

  .container { max-width: 800px; margin: 0 auto; padding: 50px 20px; }

  .header { text-align: center; margin-bottom: 40px; }
  .header h1 {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    background: linear-gradient(#fff, #94a3b8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 12px;
  }
  .header p { color: var(--muted); font-size: 1rem; line-height: 1.6; }

  .card {
    background: var(--card);
    backdrop-filter: blur(22px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 32px;
    margin-bottom: 20px;
  }
  .card h2 { font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }

  label { display: block; font-size: 0.8rem; color: var(--muted); margin: 14px 0 6px; font-weight: 600; }
  textarea, input[type="text"] {
    width: 100%;
    padding: 12px 14px;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-size: 0.9rem;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
  }
  textarea { min-height: 140px; resize: vertical; }
  textarea:focus, input:focus { border-color: rgba(99,102,241,0.4); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }

  .upload-area {
    border: 2px dashed var(--border);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 8px;
  }
  .upload-area:hover { border-color: rgba(99,102,241,0.4); background: rgba(99,102,241,0.03); }
  .upload-area.ok { border-color: var(--green); background: rgba(16,185,129,0.05); }
  .upload-area p { color: var(--muted); font-size: 0.85rem; }
  .upload-area strong { color: var(--accent); }
  .file-name { font-size: 0.78rem; color: var(--muted); margin-top: 6px; }

  .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 16px;
    border-radius: 16px;
    font-weight: 700;
    font-size: 0.95rem;
    border: none;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
    margin-top: 20px;
  }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { transform: scale(1.02); box-shadow: 0 8px 30px rgba(99,102,241,0.3); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
  .btn-secondary { background: transparent; border: 1px solid var(--border); color: #fff; margin-top: 10px; }
  .btn-secondary:hover { border-color: rgba(99,102,241,0.4); }

  /* Results */
  .score-circle {
    width: 140px; height: 140px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 20px;
  }
  .score-num { font-size: 2.2rem; font-weight: 800; }
  .score-label { font-size: 0.85rem; color: var(--muted); }

  .result-section { margin-bottom: 20px; }
  .result-section h3 { font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }

  .tag-list { display: flex; flex-wrap: wrap; gap: 6px; }
  .tag-match { background: rgba(16,185,129,0.12); color: #34d399; padding: 4px 12px; border-radius: 8px; font-size: 0.78rem; font-weight: 600; }
  .tag-miss { background: rgba(239,68,68,0.12); color: #f87171; padding: 4px 12px; border-radius: 8px; font-size: 0.78rem; font-weight: 600; }
  .tag-tip { background: rgba(99,102,241,0.12); color: #a5b4fc; padding: 4px 12px; border-radius: 8px; font-size: 0.78rem; font-weight: 600; }

  .tip-item {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 16px;
    margin-bottom: 8px;
    font-size: 0.85rem;
    color: var(--muted);
    line-height: 1.6;
  }

  .hidden { display: none !important; }

  .toast-box { position: fixed; top: 16px; right: 16px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
  .toast { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 10px 18px; border-radius: 10px; font-size: 0.85rem; box-shadow: 0 8px 24px rgba(0,0,0,0.4); animation: tIn 0.3s ease, tOut 0.3s ease 2.7s forwards; }
  @keyframes tIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  @keyframes tOut { to { transform: translateX(120%); opacity: 0; } }

  @media (max-width: 600px) {
    .container { padding: 30px 14px; }
    .card { padding: 24px 18px; border-radius: 18px; }
    .nav { padding: 1rem 4%; }
  }
</style>
</head>

<body>

<div class="toast-box" id="toasts"></div>

<nav class="nav">
  <a class="logo" href="index.html">SIMPATICO <span>HR</span></a>
  <div class="nav-links">
    <a class="link" href="career-lab.html">‚Üê Career Lab</a>
    <a class="link" href="index.html">Home</a>
  </div>
</nav>

<div class="container">

  <div class="header">
    <h1>üìä ATS Optimizer</h1>
    <p>Upload your resume, paste the job description, and get instant ATS compatibility score with fix suggestions.</p>
  </div>

  <!-- INPUT -->
  <div id="inputSection">
    <div class="card">
      <h2>üìÑ Your Resume</h2>
      <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
        <p>üìÇ Click to upload <strong>PDF or TXT</strong></p>
        <p class="file-name" id="fileName">No file selected</p>
        <input type="file" id="fileInput" accept=".pdf,.txt,.doc,.docx" hidden>
      </div>
    </div>

    <div class="card">
      <h2>üìã Job Description</h2>
      <label>Paste the full job description below</label>
      <textarea id="jdInput" placeholder="Paste the job description here...&#10;&#10;Example:&#10;We are looking for a Senior Frontend Developer with 5+ years experience in React, TypeScript, and Next.js..."></textarea>

      <label>Job Title (optional)</label>
      <input type="text" id="titleInput" placeholder="e.g. Senior Frontend Developer">
    </div>

    <button class="btn btn-primary" id="analyzeBtn" onclick="analyze()">üìä Analyze ATS Compatibility</button>
    <button class="btn btn-secondary" onclick="window.location.href='career-lab.html'">‚Üê Back to Career Lab</button>
  </div>

  <!-- RESULTS -->
  <div id="resultSection" class="hidden">
    <div class="card" style="text-align:center;">
      <h2 style="justify-content:center;">üìä ATS Compatibility Score</h2>
      <div class="score-circle" id="scoreCircle">
        <div>
          <div class="score-num" id="scoreNum">0</div>
          <div class="score-label">/ 100</div>
        </div>
      </div>
      <p id="scoreSummary" style="color:var(--muted);line-height:1.6;"></p>
    </div>

    <div class="card">
      <div class="result-section">
        <h3>‚úÖ Matched Keywords</h3>
        <div class="tag-list" id="matchedTags"></div>
      </div>

      <div class="result-section">
        <h3>‚ùå Missing Keywords</h3>
        <div class="tag-list" id="missingTags"></div>
      </div>

      <div class="result-section">
        <h3>üí° Improvement Tips</h3>
        <div id="tipsList"></div>
      </div>
    </div>

    <button class="btn btn-primary" onclick="resetForm()">üîÑ Analyze Another</button>
    <button class="btn btn-secondary" onclick="window.location.href='career-lab.html'">‚Üê Career Lab</button>
  </div>

</div>

<script>
  const W = "https://evalis-ai.simpaticohrconsultancy.workers.dev";
  let resumeText = "";

  function toast(m) {
    const c = document.getElementById("toasts");
    const t = document.createElement("div");
    t.className = "toast"; t.textContent = m;
    c.appendChild(t);
    setTimeout(() => t.remove(), 3200);
  }

  // File upload
  document.getElementById('fileInput').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;
    document.getElementById('fileName').textContent = '‚è≥ Processing...';
    try {
      const ext = file.name.split('.').pop().toLowerCase();
      if (ext === 'txt') resumeText = await file.text();
      else if (ext === 'pdf') resumeText = await extractPDF(file);
      else resumeText = await file.text();
      resumeText = resumeText.replace(/\s+/g, ' ').replace(/[^\x20-\x7E\n]/g, '').trim().substring(0, 5000);
      if (resumeText.length < 30) {
        document.getElementById('fileName').textContent = '‚ö†Ô∏è Could not read. Try TXT.';
        resumeText = '';
        return;
      }
      document.getElementById('fileName').textContent = '‚úÖ ' + file.name + ' (' + resumeText.length + ' chars)';
      document.getElementById('uploadArea').classList.add('ok');
      toast('‚úÖ Resume loaded!');
    } catch (err) {
      document.getElementById('fileName').textContent = '‚ùå Error';
      resumeText = '';
    }
  });

  async function extractPDF(f) {
    if (!window.pdfjsLib) return await f.text();
    try {
      const b = await f.arrayBuffer();
      const p = await pdfjsLib.getDocument({ data: b }).promise;
      let t = '';
      for (let i = 1; i <= p.numPages; i++) {
        const pg = await p.getPage(i);
        const c = await pg.getTextContent();
        t += c.items.map(x => x.str).join(' ') + '\n';
      }
      return t;
    } catch (e) {
      return await f.text();
    }
  }

  // Analyze
  async function analyze() {
    const jd = document.getElementById('jdInput').value.trim();
    const title = document.getElementById('titleInput').value.trim();

    if (!resumeText) { toast('‚ùå Upload your resume first'); return; }
    if (!jd) { toast('‚ùå Paste job description'); return; }

    const btn = document.getElementById('analyzeBtn');
    btn.disabled = true;
    btn.textContent = '‚è≥ AI is analyzing...';

    try {
      const res = await fetch(W, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          messages: [
            {
              role: "system",
              content: "You are an expert ATS (Applicant Tracking System) analyzer. Return ONLY valid JSON. No markdown."
            },
            {
              role: "user",
              content: `Analyze this resume against the job description for ATS compatibility.

Job Title: ${title || 'Not specified'}

Job Description:
${jd.substring(0, 3000)}

Resume:
${resumeText.substring(0, 4000)}

Return ONLY this JSON:
{
  "score": 72,
  "summary": "Brief 2-sentence assessment",
  "matchedKeywords": ["keyword1", "keyword2", "keyword3"],
  "missingKeywords": ["keyword1", "keyword2"],
  "tips": ["Tip 1 for improvement", "Tip 2", "Tip 3", "Tip 4", "Tip 5"],
  "experienceMatch": "good",
  "formatScore": 8
}

Be specific. Match actual keywords from the JD. Keep tips actionable and under 100 chars each. Return ONLY JSON.`
            }
          ]
        })
      });

      const data = await res.json();
      if (!data.response) throw new Error("Empty response");

      const result = parseJSON(data.response);
      showResults(result);
      toast('‚úÖ Analysis complete!');

    } catch (err) {
      console.error(err);
      toast('‚ùå Error: ' + err.message);
    }

    btn.disabled = false;
    btn.textContent = 'üìä Analyze ATS Compatibility';
  }

  function parseJSON(raw) {
    let c = raw.replace(/```json\s*/gi, '').replace(/```\s*/g, '').trim();
    const m = c.match(/\{[\s\S]*\}/);
    if (!m) throw new Error('No JSON');
    c = m[0].replace(/,\s*([}\]])/g, '$1');
    try { return JSON.parse(c); } catch (e) {
      c = c.replace(/[\x00-\x1F\x7F]/g, ' ');
      return JSON.parse(c);
    }
  }

  function showResults(r) {
    document.getElementById('inputSection').classList.add('hidden');
    document.getElementById('resultSection').classList.remove('hidden');

    const score = Math.min(100, Math.max(0, r.score || 50));
    const isGood = score >= 75;
    const isOk = score >= 50;
    const color = isGood ? '#10b981' : isOk ? '#f59e0b' : '#ef4444';
    const bg = isGood ? 'rgba(16,185,129,0.15)' : isOk ? 'rgba(245,158,11,0.15)' : 'rgba(239,68,68,0.15)';

    document.getElementById('scoreCircle').style.background = `conic-gradient(${color} ${score * 3.6}deg, rgba(255,255,255,0.05) 0deg)`;
    document.getElementById('scoreSummary').textContent = r.summary || '';

    // Animated score
    let cur = 0;
    const el = document.getElementById('scoreNum');
    const iv = setInterval(() => {
      cur += Math.ceil(score / 25);
      if (cur >= score) { cur = score; clearInterval(iv); }
      el.textContent = cur;
      el.style.color = color;
    }, 30);

    // Matched
    const mt = document.getElementById('matchedTags');
    mt.innerHTML = (r.matchedKeywords || []).map(k => `<span class="tag-match">‚úÖ ${k}</span>`).join('');

    // Missing
    const ms = document.getElementById('missingTags');
    ms.innerHTML = (r.missingKeywords || []).map(k => `<span class="tag-miss">‚ùå ${k}</span>`).join('');

    // Tips
    const tips = document.getElementById('tipsList');
    tips.innerHTML = (r.tips || []).map(t => `<div class="tip-item">üí° ${t}</div>`).join('');
  }

  function resetForm() {
    document.getElementById('inputSection').classList.remove('hidden');
    document.getElementById('resultSection').classList.add('hidden');
    document.getElementById('jdInput').value = '';
    document.getElementById('titleInput').value = '';
    document.getElementById('fileName').textContent = 'No file selected';
    document.getElementById('uploadArea').classList.remove('ok');
    resumeText = '';
  }
</script>

</body>
</html>
