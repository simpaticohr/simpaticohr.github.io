<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>English Coach | Career Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { margin: 0; height: 100vh; background: radial-gradient(circle at top, #0b1d3a, #020617); display: flex; align-items: center; justify-content: center; font-family: system-ui, sans-serif; color: #fff; }
  .card { width: 90%; max-width: 350px; background: rgba(255,255,255,0.08); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 30px; text-align: center; }
  button { width: 100%; padding: 14px; border: none; border-radius: 12px; margin-top: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; }
  .start { background: #6366f1; color: #fff; }
  .stop { background: #ef4444; color: #fff; }
  pre { text-align: left; white-space: pre-wrap; font-size: 13px; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.1); }
  .score { font-size: 42px; font-weight: 800; color: #818cf8; margin: 15px 0; }
  #status { color: #94a3b8; font-size: 14px; margin-bottom: 15px; display: block; }
</style>
</head>
<body>
<div class="card">
  <h3>English Practice</h3>
  <span id="status">Ready to record</span>
  <button class="start" id="start">ðŸŽ¤ Start (6s Max)</button>
  <button class="stop" id="stop" style="display:none">Stop Now</button>
  <div id="results" style="display:none;">
    <div class="score" id="score"></div>
    <pre id="said"></pre>
    <pre id="feedback"></pre>
    <button onclick="location.reload()" style="background:#334155; color:white">Try Again</button>
  </div>
</div>

<script>
const API = "https://spoken-english-coach.simpaticohrconsultancy.workers.dev"; // ðŸŸ¢ Update to your new URL
let recorder, chunks = [], timer;

const startBtn = document.getElementById("start");
const stopBtn = document.getElementById("stop");
const status = document.getElementById("status");

startBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  recorder = new MediaRecorder(stream);
  chunks = [];
  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = () => { stream.getTracks().forEach(t => t.stop()); sendAudio(); };
  
  recorder.start();
  startBtn.style.display = "none";
  stopBtn.style.display = "block";
  status.textContent = "Recording...";
  timer = setTimeout(() => { if(recorder.state === "recording") recorder.stop(); }, 6000);
};

stopBtn.onclick = () => { clearTimeout(timer); recorder.stop(); };

async function sendAudio() {
  status.textContent = "Analyzing speech...";
  stopBtn.style.display = "none";
  const blob = new Blob(chunks, { type: "audio/webm" });
  const form = new FormData();
  form.append("audio", blob);

  const res = await fetch(API, { method: "POST", body: form });
  const data = await res.json();
  
  document.getElementById("results").style.display = "block";
  document.getElementById("said").textContent = "You: " + data.transcript;
  document.getElementById("feedback").textContent = data.feedback;
  document.getElementById("score").textContent = data.score + "/10";
  status.textContent = "Analysis Complete";
}
</script>
</body>
</html>
