<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Spoken English Practice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(135deg,#020b2d,#061a4f);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: system-ui;
  color: #fff;
}
.card {
  background: rgba(255,255,255,0.08);
  padding: 20px;
  border-radius: 14px;
  width: 320px;
  text-align: center;
}
button {
  width: 100%;
  padding: 12px;
  margin: 6px 0;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}
.start { background:#2563eb;color:#fff }
.stop { background:#374151;color:#ccc }
.small { font-size:13px;opacity:.85 }
.score { font-size:26px;margin-top:8px }
</style>
</head>
<body>

<div class="card">
  <h3>Spoken English Practice</h3>
  <div id="status" class="small">Tap start and speak</div>

  <button class="start" onclick="start()">ðŸŽ¤ Start Speaking</button>
  <button class="stop" onclick="stop()">Stop</button>

  <div class="small">You said:</div>
  <div id="text" class="small"></div>

  <div class="small">Feedback:</div>
  <div id="feedback" class="small"></div>

  <div id="score" class="score"></div>
</div>

<script>
let recognition;
let finalText = "";

function start() {
  finalText = "";
  document.getElementById("text").innerText = "";
  document.getElementById("feedback").innerText = "";
  document.getElementById("score").innerText = "";
  document.getElementById("status").innerText = "Listeningâ€¦";

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.continuous = true;
  recognition.interimResults = false;

  recognition.onresult = e => {
    for (let i = e.resultIndex; i < e.results.length; i++) {
      if (e.results[i].isFinal) {
        finalText += e.results[i][0].transcript + " ";
      }
    }
    document.getElementById("text").innerText = finalText.trim();
  };

  recognition.start();
}

async function stop() {
  if (!recognition) return;
  recognition.stop();
  document.getElementById("status").innerText = "Evaluatingâ€¦";

  if (!finalText.trim()) {
    document.getElementById("status").innerText = "No speech detected";
    return;
  }

  const res = await fetch(
    "https://evalis-ai.simpaticohhrconsultancy.workers.dev/",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ transcript: finalText })
    }
  );

  const data = await res.json();

  document.getElementById("feedback").innerText = data.feedback || "";
  document.getElementById("score").innerText =
    data.score !== undefined ? `${data.score}/10` : "";
  document.getElementById("status").innerText = "Completed";
}
</script>

</body>
</html>
