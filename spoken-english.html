<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Spoken English Practice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(135deg,#020b2d,#061a4f);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: system-ui;
  color: #fff;
}
.card {
  background: rgba(255,255,255,0.08);
  padding: 20px;
  border-radius: 14px;
  width: 320px;
  text-align: center;
}
button {
  width: 100%;
  padding: 12px;
  margin: 6px 0;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}
.start { background:#2563eb;color:#fff }
.stop { background:#374151;color:#ccc }
.small { font-size:13px;opacity:.85 }
.score { font-size:26px;margin-top:8px }
</style>
</head>
<body>

<div class="card">
  <h3>Spoken English Practice</h3>
  <div id="status" class="small">Tap start and speak</div>

  <button class="start" onclick="start()">ðŸŽ¤ Start Speaking</button>
  <button class="stop" onclick="stop()">Stop</button>

  <div class="small">You said:</div>
  <div id="text" class="small"></div>

  <div class="small">Feedback:</div>
  <div id="feedback" class="small"></div>

  <div id="score" class="score"></div>
</div>

<script>
let recognition;
let transcriptText = "";

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const saidBox = document.getElementById("said");
const feedbackBox = document.getElementById("feedback");
const scoreBox = document.getElementById("score");
const statusBox = document.getElementById("status");

if ("webkitSpeechRecognition" in window) {
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "en-US";

  recognition.onstart = () => {
    statusBox.innerText = "Listening...";
    transcriptText = "";
  };

  recognition.onresult = (event) => {
    transcriptText = event.results[0][0].transcript;
    saidBox.innerText = transcriptText;
  };

  recognition.onerror = () => {
    statusBox.innerText = "Speech error";
  };

  recognition.onend = async () => {
    if (!transcriptText) {
      statusBox.innerText = "No speech detected";
      return;
    }

    statusBox.innerText = "Evaluating...";

    try {
      const res = await fetch(
        "https://evalis-ai.simpaticohhrconsultancy.workers.dev/",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            transcript: transcriptText
          })
        }
      );

      const data = await res.json();

      feedbackBox.innerText = data.feedback || "No feedback";
      scoreBox.innerText = `${data.score}/10`;
      statusBox.innerText = "Completed";

    } catch (e) {
      statusBox.innerText = "Server error";
      feedbackBox.innerText = "Evaluation failed";
      scoreBox.innerText = "0/10";
    }
  };
}

startBtn.onclick = () => {
  feedbackBox.innerText = "";
  scoreBox.innerText = "";
  recognition.start();
};

stopBtn.onclick = () => {
  recognition.stop();
};
</script>
</body>
</html>
