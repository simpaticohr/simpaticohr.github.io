<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Spoken English Practice | Simpatico HR</title>

<style>
body {
  margin: 0;
  height: 100vh;
  background: radial-gradient(circle at top, #0f172a, #020617);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: #fff;
}

.card {
  background: rgba(15, 23, 42, 0.9);
  padding: 22px;
  border-radius: 14px;
  width: 320px;
  box-shadow: 0 20px 50px rgba(0,0,0,.5);
  text-align: center;
}

h2 {
  margin: 0 0 6px;
  font-size: 20px;
}

.status {
  font-size: 13px;
  margin-bottom: 14px;
  color: #94a3b8;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 10px;
  border: none;
  font-size: 15px;
  cursor: pointer;
}

.start {
  background: #2563eb;
  color: #fff;
}

.stop {
  background: #334155;
  color: #cbd5f5;
}

.output {
  margin-top: 14px;
  text-align: left;
  font-size: 13px;
  color: #cbd5f5;
}

.score {
  margin-top: 10px;
  font-size: 22px;
  font-weight: bold;
  text-align: center;
}
</style>
</head>

<body>

<div class="card">
  <h2>Spoken English Practice</h2>
  <div class="status" id="status">Idle</div>

  <button class="start" id="startBtn">ðŸŽ¤ Start Speaking</button>
  <button class="stop" id="stopBtn" disabled>Stop</button>

  <div class="output">
    <strong>You said:</strong>
    <div id="transcript"></div>

    <strong>Feedback:</strong>
    <div id="feedback"></div>
  </div>

  <div class="score" id="score"></div>
</div>

<script>
const API_URL =
  "https://evalis-ai.simpaticohrconsultancy.workers.dev/";

let recognition;
let finalText = "";

const statusEl = document.getElementById("status");
const transcriptEl = document.getElementById("transcript");
const feedbackEl = document.getElementById("feedback");
const scoreEl = document.getElementById("score");

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");

startBtn.onclick = () => {
  finalText = "";
  transcriptEl.textContent = "";
  feedbackEl.textContent = "";
  scoreEl.textContent = "";

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = "en-US";

  recognition.onresult = e => {
    let temp = "";
    for (let i = e.resultIndex; i < e.results.length; i++) {
      temp += e.results[i][0].transcript + " ";
      if (e.results[i].isFinal) finalText += temp;
    }
    transcriptEl.textContent = finalText || temp;
  };

  recognition.onerror = () => {
    statusEl.textContent = "Mic error.";
  };

  recognition.start();
  statusEl.textContent = "Listeningâ€¦ Speak clearly (5â€“10 sec)";
  startBtn.disabled = true;
  stopBtn.disabled = false;
};

stopBtn.onclick = async () => {
  recognition.stop();
  startBtn.disabled = false;
  stopBtn.disabled = true;

  statusEl.textContent = "Processingâ€¦";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ transcript: finalText.trim() })
    });

    if (!res.ok) throw new Error("Server error");

    const data = await res.json();

    feedbackEl.textContent = data.feedback || "â€”";
    scoreEl.textContent = data.score + " / 10";
    statusEl.textContent = "Completed";

  } catch (e) {
    statusEl.textContent = "Server unavailable.";
  }
};
</script>

</body>
</html>
