<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Dashboard - SimpaticoHR</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script>
        // Company admin has same features as HR plus team management
        // Redirect to HR dashboard with elevated permissions
        const user = JSON.parse(localStorage.getItem('simpatico_user') || '{}');
        if (!localStorage.getItem('simpatico_token')) {
            window.location.href = '../auth/login.html';
        }
    </script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:#F3F4F6; }
        .sidebar { position:fixed; left:0; top:0; bottom:0; width:260px; background:linear-gradient(180deg,#1E1B4B,#312E81); color:#fff; z-index:100; overflow-y:auto; }
        .sidebar-header { padding:24px 20px 16px; border-bottom:1px solid rgba(255,255,255,.1); }
        .sidebar-logo { font-size:22px; font-weight:800; }
        .sidebar-logo span { color:#FCD34D; }
        .sidebar-role { font-size:11px; color:rgba(255,255,255,.5); text-transform:uppercase; letter-spacing:1px; margin-top:4px; }
        .sidebar-nav { padding:16px 12px; }
        .nav-label { font-size:10px; color:rgba(255,255,255,.4); text-transform:uppercase; letter-spacing:1.2px; padding:12px 12px 6px; }
        .nav-item { display:flex; align-items:center; gap:12px; padding:11px 14px; border-radius:10px; color:rgba(255,255,255,.7); text-decoration:none; font-size:14px; font-weight:500; margin-bottom:2px; cursor:pointer; transition:all .2s; }
        .nav-item:hover { background:rgba(255,255,255,.1); color:#fff; }
        .nav-item.active { background:rgba(79,70,229,.4); color:#fff; }
        .nav-item i { width:20px; text-align:center; }
        .main { margin-left:260px; }
        .topbar { background:#fff; padding:16px 30px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #E5E7EB; position:sticky; top:0; z-index:50; }
        .page-title { font-size:20px; font-weight:700; }
        .content { padding:24px 30px; }
        .stat-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:24px; }
        .stat-card { background:#fff; border-radius:14px; padding:20px; box-shadow:0 1px 3px rgba(0,0,0,.06); display:flex; align-items:center; gap:16px; }
        .stat-icon { width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px; }
        .stat-icon.blue { background:#DBEAFE; color:#2563EB; }
        .stat-icon.green { background:#D1FAE5; color:#059669; }
        .stat-icon.purple { background:#EDE9FE; color:#7C3AED; }
        .stat-icon.orange { background:#FEF3C7; color:#D97706; }
        .stat-value { font-size:26px; font-weight:800; }
        .stat-label { font-size:13px; color:#6B7280; }
        .panel { background:#fff; border-radius:14px; padding:24px; box-shadow:0 1px 3px rgba(0,0,0,.06); margin-bottom:24px; }
        .panel-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:18px; padding-bottom:14px; border-bottom:1px solid #F3F4F6; }
        .panel-title { font-size:16px; font-weight:700; }
        .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
        .company-info-item { padding:12px 0; border-bottom:1px solid #F3F4F6; }
        .company-info-item label { font-size:12px; color:#6B7280; font-weight:600; text-transform:uppercase; }
        .company-info-item .val { font-size:15px; color:#1F2937; margin-top:4px; font-weight:500; }
        .sub-badge { display:inline-block; padding:4px 14px; border-radius:20px; font-size:13px; font-weight:600; }
        .sub-trial { background:#FEF3C7; color:#92400E; }
        .sub-professional { background:#D1FAE5; color:#065F46; }
        .sub-enterprise { background:#EDE9FE; color:#5B21B6; }
        .user-avatar { width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#4F46E5,#7C3AED); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; font-size:14px; }
        .loader { text-align:center; padding:40px; color:#6B7280; }
        .loader .spin { width:30px; height:30px; border:3px solid #E5E7EB; border-top-color:#4F46E5; border-radius:50%; animation:spin .7s linear infinite; margin:0 auto 12px; }
        @keyframes spin { to { transform:rotate(360deg); } }
        @media(max-width:768px) { .sidebar { display:none; } .main { margin-left:0; } .grid-2 { grid-template-columns:1fr; } .content { padding:16px; } }
    </style>
</head>
<body>
<aside class="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">Simpatico<span>HR</span></div>
        <div class="sidebar-role">Company Admin</div>
    </div>
    <nav class="sidebar-nav">
        <div class="nav-label">Main</div>
        <a class="nav-item active" href="company.html"><i class="fas fa-home"></i> Overview</a>
        <a class="nav-item" href="hr.html"><i class="fas fa-tachometer-alt"></i> HR Dashboard</a>
        <div class="nav-label">Recruitment</div>
        <a class="nav-item" href="hr.html#jobs"><i class="fas fa-briefcase"></i> Job Posts</a>
        <a class="nav-item" href="hr.html#pipeline"><i class="fas fa-stream"></i> Pipeline</a>
        <a class="nav-item" href="hr.html#interviews"><i class="fas fa-video"></i> Interviews</a>
        <div class="nav-label">Settings</div>
        <a class="nav-item" onclick="alert('Team management coming soon')"><i class="fas fa-users-cog"></i> Team Members</a>
        <a class="nav-item" onclick="alert('Billing settings coming soon')"><i class="fas fa-credit-card"></i> Billing</a>
        <a class="nav-item" onclick="alert('Company settings coming soon')"><i class="fas fa-cog"></i> Settings</a>
        <a class="nav-item" onclick="localStorage.clear(); window.location.href='../auth/login.html'" style="color:rgba(255,100,100,.8)"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
    </nav>
</aside>
<div class="main">
    <div class="topbar">
        <div class="page-title">Company Overview</div>
        <div style="display:flex; align-items:center; gap:10px;">
            <div class="user-avatar" id="userAvatar">C</div>
            <div><div style="font-size:13px;font-weight:600" id="userName">Admin</div><div style="font-size:11px;color:#9CA3AF">Company Admin</div></div>
        </div>
    </div>
    <div class="content">
        <div class="stat-grid">
            <div class="stat-card"><div class="stat-icon blue"><i class="fas fa-briefcase"></i></div><div><div class="stat-value" id="sJobs">-</div><div class="stat-label">Active Jobs</div></div></div>
            <div class="stat-card"><div class="stat-icon green"><i class="fas fa-users"></i></div><div><div class="stat-value" id="sApps">-</div><div class="stat-label">Total Applications</div></div></div>
            <div class="stat-card"><div class="stat-icon purple"><i class="fas fa-video"></i></div><div><div class="stat-value" id="sInts">-</div><div class="stat-label">Interviews</div></div></div>
            <div class="stat-card"><div class="stat-icon orange"><i class="fas fa-trophy"></i></div><div><div class="stat-value" id="sHired">-</div><div class="stat-label">Hired</div></div></div>
        </div>
        <div class="grid-2">
            <div class="panel">
                <div class="panel-header"><div class="panel-title"><i class="fas fa-building" style="color:#4F46E5; margin-right:8px"></i> Company Details</div></div>
                <div id="companyInfo"><div class="loader"><div class="spin"></div>Loading...</div></div>
            </div>
            <div class="panel">
                <div class="panel-header"><div class="panel-title"><i class="fas fa-box" style="color:#F59E0B; margin-right:8px"></i> Subscription</div></div>
                <div id="subscriptionInfo"><div class="loader"><div class="spin"></div>Loading...</div></div>
            </div>
        </div>
    </div>
</div>
<script>
    const API = 'https://evalis-ai.simpaticohrconsultancy.workers.dev';
    const token = localStorage.getItem('simpatico_token');
    let user;
    try { user = JSON.parse(localStorage.getItem('simpatico_user')); } catch(e) {}
    if (!token || !user) window.location.href = '../auth/login.html';

    document.getElementById('userName').textContent = user?.full_name || 'Admin';
    document.getElementById('userAvatar').textContent = (user?.full_name || 'A')[0];

    async function load() {
        try {
            const headers = { 'Content-Type':'application/json', 'Authorization':Bearer ${token} };
            const [stats, me] = await Promise.all([
                fetch(${API}/api/analytics/dashboard, { headers }).then(r => r.json()),
                fetch(${API}/api/auth/me, { headers }).then(r => r.json())
            ]);
            if (stats.stats) {
                document.getElementById('sJobs').textContent = stats.stats.active_jobs || 0;
                document.getElementById('sApps').textContent = stats.stats.total_applications || 0;
                document.getElementById('sInts').textContent = stats.stats.total_interviews || 0;
                document.getElementById('sHired').textContent = stats.stats.total_hired || 0;
            }
            const co = me.user?.companies;
            if (co) {
                document.getElementById('companyInfo').innerHTML = `
                    <div class="company-info-item"><label>Company Name</label><div class="val">${co.name}</div></div>
                    <div class="company-info-item"><label>Industry</label><div class="val">${co.industry || '-'}</div></div>
                    <div class="company-info-item"><label>Size</label><div class="val">${co.company_size || '-'}</div></div>
                    <div class="company-info-item"><label>Website</label><div class="val">${co.website || '-'}</div></div>
                    <div class="company-info-item"><label>Contact</label><div class="val">${co.contact_email || '-'}</div></div>`;
                const plan = co.subscription_plan || 'trial';
                document.getElementById('subscriptionInfo').innerHTML = `
                    <div class="company-info-item"><label>Plan</label><div class="val"><span class="sub-badge sub-${plan}">${plan.charAt(0).toUpperCase()+plan.slice(1)}</span></div></div>
                    <div class="company-info-item"><label>Valid Until</label><div class="val">${co.subscription_end || '-'}</div></div>
                    <div class="company-info-item"><label>Max Jobs</label><div class="val">${co.max_jobs || 5}</div></div>
                    <div class="company-info-item"><label>Max Users</label><div class="val">${co.max_users || 5}</div></div>
                    <div class="company-info-item"><label>Max Candidates</label><div class="val">${co.max_candidates || 200}</div></div>`;
            }
        } catch(e) { console.error(e); }
    }
    load();
</script>
</body>
</html>
