<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evalis AI â€“ Interview Intelligence Platform</title>
<meta name="description" content="AI-powered interview analytics and reporting platform">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS RESET & VARIABLES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  --bg-primary: #0a0e1a;
  --bg-secondary: #111827;
  --bg-card: #1a2035;
  --bg-card-hover: #1f2847;
  --bg-glass: rgba(26, 32, 53, 0.8);
  --text-primary: #f0f4ff;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --accent-blue: #3b82f6;
  --accent-purple: #8b5cf6;
  --accent-emerald: #10b981;
  --accent-amber: #f59e0b;
  --accent-rose: #f43f5e;
  --accent-cyan: #06b6d4;
  --gradient-primary: linear-gradient(135deg, #3b82f6, #8b5cf6);
  --gradient-success: linear-gradient(135deg, #10b981, #06b6d4);
  --gradient-warning: linear-gradient(135deg, #f59e0b, #f43f5e);
  --gradient-hero: linear-gradient(135deg, #0a0e1a 0%, #1a1040 50%, #0a0e1a 100%);
  --border-color: rgba(148, 163, 184, 0.1);
  --border-glow: rgba(59, 130, 246, 0.3);
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.3);
  --shadow-md: 0 8px 32px rgba(0,0,0,0.4);
  --shadow-lg: 0 16px 64px rgba(0,0,0,0.5);
  --shadow-glow: 0 0 40px rgba(59, 130, 246, 0.15);
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  overflow-x: hidden;
  min-height: 100vh;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATED BACKGROUND
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bg-animation {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  overflow: hidden;
  pointer-events: none;
}

.bg-orb {
  position: absolute;
  border-radius: 50%;
  filter: blur(80px);
  opacity: 0.15;
  animation: orbFloat 20s infinite ease-in-out;
}

.bg-orb:nth-child(1) {
  width: 600px;
  height: 600px;
  background: var(--accent-blue);
  top: -200px;
  right: -200px;
  animation-delay: 0s;
}

.bg-orb:nth-child(2) {
  width: 400px;
  height: 400px;
  background: var(--accent-purple);
  bottom: -100px;
  left: -100px;
  animation-delay: -7s;
}

.bg-orb:nth-child(3) {
  width: 300px;
  height: 300px;
  background: var(--accent-emerald);
  top: 50%;
  left: 50%;
  animation-delay: -14s;
}

@keyframes orbFloat {
  0%, 100% { transform: translate(0, 0) scale(1); }
  25% { transform: translate(50px, -80px) scale(1.1); }
  50% { transform: translate(-30px, 50px) scale(0.9); }
  75% { transform: translate(80px, 30px) scale(1.05); }
}

/* Grid pattern overlay */
.bg-grid {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image:
    linear-gradient(rgba(148, 163, 184, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(148, 163, 184, 0.03) 1px, transparent 1px);
  background-size: 60px 60px;
  z-index: 0;
  pointer-events: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-container {
  position: relative;
  z-index: 1;
  min-height: 100vh;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  padding: 16px 32px;
  background: rgba(10, 14, 26, 0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-color);
  transition: var(--transition);
}

.navbar.scrolled {
  padding: 10px 32px;
  box-shadow: var(--shadow-md);
}

.nav-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.nav-brand {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
}

.nav-logo {
  width: 40px;
  height: 40px;
  background: var(--gradient-primary);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: 18px;
  color: white;
}

.nav-title {
  font-size: 20px;
  font-weight: 800;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.nav-links {
  display: flex;
  align-items: center;
  gap: 8px;
}

.nav-link {
  padding: 8px 16px;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: var(--transition);
  cursor: pointer;
  border: none;
  background: none;
}

.nav-link:hover, .nav-link.active {
  color: var(--text-primary);
  background: rgba(59, 130, 246, 0.1);
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.nav-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--gradient-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid transparent;
}

.nav-avatar:hover {
  border-color: var(--accent-blue);
  box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
}

.mobile-menu-btn {
  display: none;
  background: none;
  border: none;
  color: var(--text-primary);
  font-size: 24px;
  cursor: pointer;
  padding: 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 20px;
  border-radius: var(--radius-sm);
  font-family: inherit;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  text-decoration: none;
  white-space: nowrap;
}

.btn-primary {
  background: var(--gradient-primary);
  color: white;
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.btn-secondary {
  background: rgba(148, 163, 184, 0.1);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.btn-secondary:hover {
  background: rgba(148, 163, 184, 0.15);
  border-color: var(--border-glow);
}

.btn-ghost {
  background: transparent;
  color: var(--text-secondary);
}

.btn-ghost:hover {
  color: var(--text-primary);
  background: rgba(148, 163, 184, 0.08);
}

.btn-success {
  background: var(--gradient-success);
  color: white;
}

.btn-danger {
  background: var(--accent-rose);
  color: white;
}

.btn-sm { padding: 6px 12px; font-size: 12px; }
.btn-lg { padding: 14px 28px; font-size: 16px; }
.btn-xl { padding: 18px 36px; font-size: 18px; }

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.loading-screen {
  position: fixed;
  inset: 0;
  z-index: 9999;
  background: var(--bg-primary);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 24px;
  transition: opacity 0.5s ease, visibility 0.5s ease;
}

.loading-screen.hidden {
  opacity: 0;
  visibility: hidden;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 3px solid var(--border-color);
  border-top-color: var(--accent-blue);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  font-size: 14px;
  color: var(--text-secondary);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH SCREENS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.auth-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.auth-card {
  width: 100%;
  max-width: 440px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  padding: 48px 40px;
  box-shadow: var(--shadow-lg);
}

.auth-header {
  text-align: center;
  margin-bottom: 36px;
}

.auth-header .nav-logo {
  width: 56px;
  height: 56px;
  font-size: 24px;
  margin: 0 auto 16px;
}

.auth-header h1 {
  font-size: 24px;
  font-weight: 800;
  margin-bottom: 8px;
}

.auth-header p {
  color: var(--text-secondary);
  font-size: 14px;
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  background: rgba(148, 163, 184, 0.05);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: inherit;
  font-size: 15px;
  transition: var(--transition);
  outline: none;
}

.form-input:focus {
  border-color: var(--accent-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

.form-input::placeholder {
  color: var(--text-muted);
}

.form-input.error {
  border-color: var(--accent-rose);
}

.form-error {
  color: var(--accent-rose);
  font-size: 12px;
  margin-top: 4px;
  display: none;
}

.form-error.visible { display: block; }

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.auth-divider {
  display: flex;
  align-items: center;
  gap: 16px;
  margin: 24px 0;
  color: var(--text-muted);
  font-size: 12px;
}

.auth-divider::before,
.auth-divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border-color);
}

.social-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 24px;
}

.btn-social {
  padding: 10px;
  background: rgba(148, 163, 184, 0.05);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: inherit;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-social:hover {
  background: rgba(148, 163, 184, 0.1);
  border-color: var(--border-glow);
}

.auth-footer {
  text-align: center;
  margin-top: 24px;
  font-size: 14px;
  color: var(--text-secondary);
}

.auth-footer a {
  color: var(--accent-blue);
  text-decoration: none;
  font-weight: 600;
  cursor: pointer;
}

.auth-footer a:hover {
  text-decoration: underline;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dashboard {
  padding-top: 80px;
  min-height: 100vh;
}

.dashboard-content {
  max-width: 1400px;
  margin: 0 auto;
  padding: 32px;
}

.dashboard-header {
  margin-bottom: 32px;
}

.dashboard-header h1 {
  font-size: 32px;
  font-weight: 800;
  margin-bottom: 8px;
}

.dashboard-header p {
  color: var(--text-secondary);
  font-size: 16px;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 24px;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  border-radius: 3px 3px 0 0;
}

.stat-card:nth-child(1)::before { background: var(--gradient-primary); }
.stat-card:nth-child(2)::before { background: var(--gradient-success); }
.stat-card:nth-child(3)::before { background: linear-gradient(135deg, var(--accent-amber), var(--accent-rose)); }
.stat-card:nth-child(4)::before { background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan)); }

.stat-card:hover {
  background: var(--bg-card-hover);
  transform: translateY(-4px);
  box-shadow: var(--shadow-glow);
}

.stat-icon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  margin-bottom: 16px;
}

.stat-card:nth-child(1) .stat-icon { background: rgba(59, 130, 246, 0.15); }
.stat-card:nth-child(2) .stat-icon { background: rgba(16, 185, 129, 0.15); }
.stat-card:nth-child(3) .stat-icon { background: rgba(245, 158, 11, 0.15); }
.stat-card:nth-child(4) .stat-icon { background: rgba(139, 92, 246, 0.15); }

.stat-value {
  font-size: 36px;
  font-weight: 800;
  line-height: 1;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 500;
}

.stat-change {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  font-weight: 600;
  margin-top: 8px;
  padding: 2px 8px;
  border-radius: 20px;
}

.stat-change.positive {
  color: var(--accent-emerald);
  background: rgba(16, 185, 129, 0.1);
}

.stat-change.negative {
  color: var(--accent-rose);
  background: rgba(244, 63, 94, 0.1);
}

/* Main Dashboard Grid */
.dashboard-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
  margin-bottom: 32px;
}

/* Cards */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: var(--transition);
}

.card:hover {
  border-color: var(--border-glow);
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
}

.card-title {
  font-size: 16px;
  font-weight: 700;
}

.card-body {
  padding: 24px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCORE RING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.score-ring-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 32px;
}

.score-ring {
  position: relative;
  width: 200px;
  height: 200px;
  margin-bottom: 24px;
}

.score-ring svg {
  width: 200px;
  height: 200px;
  transform: rotate(-90deg);
}

.score-ring-bg {
  fill: none;
  stroke: var(--border-color);
  stroke-width: 8;
}

.score-ring-fill {
  fill: none;
  stroke: url(#scoreGradient);
  stroke-width: 8;
  stroke-linecap: round;
  stroke-dasharray: 565;
  stroke-dashoffset: 565;
  transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-ring-text {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.score-ring-value {
  font-size: 48px;
  font-weight: 900;
  line-height: 1;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.score-ring-label {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 4px;
}

.score-grade {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 20px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 14px;
}

.grade-excellent {
  background: rgba(16, 185, 129, 0.15);
  color: var(--accent-emerald);
}

.grade-good {
  background: rgba(59, 130, 246, 0.15);
  color: var(--accent-blue);
}

.grade-average {
  background: rgba(245, 158, 11, 0.15);
  color: var(--accent-amber);
}

.grade-poor {
  background: rgba(244, 63, 94, 0.15);
  color: var(--accent-rose);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKILLS RADAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.skills-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.skill-item {
  display: flex;
  align-items: center;
  gap: 16px;
}

.skill-info {
  flex: 0 0 120px;
}

.skill-name {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 2px;
}

.skill-score {
  font-size: 11px;
  color: var(--text-muted);
}

.skill-bar-container {
  flex: 1;
  height: 8px;
  background: rgba(148, 163, 184, 0.1);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.skill-bar {
  height: 100%;
  border-radius: 4px;
  transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
  width: 0;
}

.skill-bar.blue { background: var(--gradient-primary); }
.skill-bar.green { background: var(--gradient-success); }
.skill-bar.purple { background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue)); }
.skill-bar.amber { background: linear-gradient(135deg, var(--accent-amber), var(--accent-rose)); }
.skill-bar.cyan { background: linear-gradient(135deg, var(--accent-cyan), var(--accent-emerald)); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERVIEW TIMELINE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.timeline {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.timeline-item {
  display: flex;
  gap: 16px;
  padding: 16px 0;
  position: relative;
}

.timeline-item:not(:last-child) {
  border-bottom: 1px solid var(--border-color);
}

.timeline-marker {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.timeline-marker.success { background: rgba(16, 185, 129, 0.15); }
.timeline-marker.warning { background: rgba(245, 158, 11, 0.15); }
.timeline-marker.info { background: rgba(59, 130, 246, 0.15); }

.timeline-content { flex: 1; }

.timeline-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 4px;
}

.timeline-desc {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.5;
}

.timeline-time {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERVIEW SESSION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.interview-container {
  padding-top: 80px;
  min-height: 100vh;
}

.interview-content {
  max-width: 900px;
  margin: 0 auto;
  padding: 32px;
}

.interview-progress {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 32px;
}

.progress-step {
  flex: 1;
  height: 4px;
  background: var(--border-color);
  border-radius: 2px;
  transition: var(--transition);
}

.progress-step.completed { background: var(--accent-blue); }
.progress-step.active { background: var(--gradient-primary); }

.question-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  padding: 40px;
  margin-bottom: 24px;
}

.question-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.question-badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.badge-technical { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
.badge-behavioral { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
.badge-situational { background: rgba(16, 185, 129, 0.15); color: var(--accent-emerald); }

.question-difficulty {
  font-size: 12px;
  color: var(--text-muted);
}

.question-text {
  font-size: 22px;
  font-weight: 700;
  line-height: 1.4;
  margin-bottom: 8px;
}

.question-hint {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}

.answer-area {
  position: relative;
}

.answer-textarea {
  width: 100%;
  min-height: 180px;
  padding: 20px;
  background: rgba(148, 163, 184, 0.05);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-family: inherit;
  font-size: 15px;
  line-height: 1.7;
  resize: vertical;
  outline: none;
  transition: var(--transition);
}

.answer-textarea:focus {
  border-color: var(--accent-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

.answer-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 12px;
}

.char-count {
  font-size: 12px;
  color: var(--text-muted);
}

.answer-actions {
  display: flex;
  gap: 12px;
}

/* Voice Recording */
.voice-recorder {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: rgba(148, 163, 184, 0.05);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  margin-top: 16px;
}

.record-btn {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  transition: var(--transition);
  background: var(--accent-rose);
  color: white;
}

.record-btn:hover {
  transform: scale(1.1);
}

.record-btn.recording {
  animation: recordPulse 1.5s infinite;
}

@keyframes recordPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.4); }
  50% { box-shadow: 0 0 0 16px rgba(244, 63, 94, 0); }
}

.waveform {
  flex: 1;
  height: 40px;
  display: flex;
  align-items: center;
  gap: 2px;
}

.waveform-bar {
  width: 3px;
  background: var(--accent-blue);
  border-radius: 2px;
  transition: height 0.1s ease;
}

.record-timer {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
  font-variant-numeric: tabular-nums;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERVIEW HISTORY TABLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.table-container {
  overflow-x: auto;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
}

.data-table th {
  padding: 12px 16px;
  text-align: left;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--border-color);
}

.data-table td {
  padding: 16px;
  font-size: 14px;
  border-bottom: 1px solid var(--border-color);
}

.data-table tr:hover td {
  background: rgba(148, 163, 184, 0.03);
}

.table-score {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  font-weight: 700;
  font-size: 14px;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-completed {
  background: rgba(16, 185, 129, 0.15);
  color: var(--accent-emerald);
}

.status-pending {
  background: rgba(245, 158, 11, 0.15);
  color: var(--accent-amber);
}

.status-failed {
  background: rgba(244, 63, 94, 0.15);
  color: var(--accent-rose);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI FEEDBACK PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ai-feedback {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  overflow: hidden;
}

.ai-feedback-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  gap: 12px;
}

.ai-avatar {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  background: var(--gradient-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.ai-feedback-body {
  padding: 24px;
}

.feedback-section {
  margin-bottom: 24px;
}

.feedback-section:last-child { margin-bottom: 0; }

.feedback-section h4 {
  font-size: 14px;
  font-weight: 700;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.feedback-section p {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.7;
}

.improvement-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.improvement-list li {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.5;
}

.improvement-list li::before {
  content: 'â†’';
  color: var(--accent-blue);
  font-weight: 700;
  flex-shrink: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS PAGE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-grid {
  display: grid;
  grid-template-columns: 250px 1fr;
  gap: 24px;
}

.settings-nav {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.settings-nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  border: none;
  background: none;
  text-align: left;
  width: 100%;
}

.settings-nav-item:hover,
.settings-nav-item.active {
  color: var(--text-primary);
  background: rgba(59, 130, 246, 0.1);
}

.settings-nav-item.active {
  color: var(--accent-blue);
}

.settings-panel {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 32px;
}

.settings-section {
  margin-bottom: 32px;
  padding-bottom: 32px;
  border-bottom: 1px solid var(--border-color);
}

.settings-section:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.settings-section h3 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 4px;
}

.settings-section p {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 20px;
}

.toggle-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0;
}

.toggle-row:not(:last-child) {
  border-bottom: 1px solid var(--border-color);
}

.toggle-info h4 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 2px;
}

.toggle-info p {
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 0;
}

.toggle-switch {
  position: relative;
  width: 48px;
  height: 26px;
  cursor: pointer;
}

.toggle-switch input {
  display: none;
}

.toggle-slider {
  position: absolute;
  inset: 0;
  background: var(--border-color);
  border-radius: 26px;
  transition: var(--transition);
}

.toggle-slider::before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  top: 3px;
  left: 3px;
  transition: var(--transition);
}

.toggle-switch input:checked + .toggle-slider {
  background: var(--accent-blue);
}

.toggle-switch input:checked + .toggle-slider::before {
  transform: translateX(22px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHARTS (CSS-based)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chart-container {
  padding: 24px;
}

.bar-chart {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  height: 200px;
  padding-top: 20px;
}

.bar-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  justify-content: flex-end;
}

.bar {
  width: 100%;
  max-width: 40px;
  border-radius: 6px 6px 0 0;
  transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  cursor: pointer;
}

.bar:hover {
  opacity: 0.8;
}

.bar-tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  padding: 4px 10px;
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 700;
  white-space: nowrap;
  opacity: 0;
  transition: var(--transition);
  pointer-events: none;
}

.bar:hover .bar-tooltip { opacity: 1; }

.bar-label {
  margin-top: 8px;
  font-size: 11px;
  color: var(--text-muted);
  text-align: center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  width: 100%;
  max-width: 540px;
  max-height: 90vh;
  overflow-y: auto;
  transform: scale(0.95) translateY(20px);
  transition: var(--transition);
}

.modal-overlay.active .modal {
  transform: scale(1) translateY(0);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 24px;
  border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
  font-size: 18px;
  font-weight: 700;
}

.modal-close {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: rgba(148, 163, 184, 0.1);
  color: var(--text-secondary);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.modal-close:hover {
  background: rgba(244, 63, 94, 0.15);
  color: var(--accent-rose);
}

.modal-body { padding: 24px; }
.modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST NOTIFICATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast-container {
  position: fixed;
  top: 90px;
  right: 20px;
  z-index: 3000;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.toast {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 20px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  min-width: 300px;
  max-width: 420px;
  animation: slideIn 0.3s ease;
  transition: var(--transition);
}

.toast.removing {
  animation: slideOut 0.3s ease forwards;
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

.toast-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.toast-content { flex: 1; }

.toast-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 2px;
}

.toast-message {
  font-size: 13px;
  color: var(--text-secondary);
}

.toast-dismiss {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 16px;
  padding: 4px;
}

.toast.success { border-left: 3px solid var(--accent-emerald); }
.toast.error { border-left: 3px solid var(--accent-rose); }
.toast.warning { border-left: 3px solid var(--accent-amber); }
.toast.info { border-left: 3px solid var(--accent-blue); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 64px 32px;
  text-align: center;
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-state h3 {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 8px;
}

.empty-state p {
  color: var(--text-secondary);
  font-size: 14px;
  max-width: 360px;
  margin-bottom: 24px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAGS & BADGES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
}

.tag-blue { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
.tag-green { background: rgba(16, 185, 129, 0.15); color: var(--accent-emerald); }
.tag-purple { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
.tag-amber { background: rgba(245, 158, 11, 0.15); color: var(--accent-amber); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs {
  display: flex;
  gap: 4px;
  padding: 4px;
  background: rgba(148, 163, 184, 0.05);
  border-radius: var(--radius-sm);
  margin-bottom: 24px;
}

.tab {
  padding: 8px 20px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  border: none;
  background: none;
}

.tab:hover { color: var(--text-primary); }

.tab.active {
  background: var(--bg-card);
  color: var(--text-primary);
  box-shadow: var(--shadow-sm);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 1024px) {
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .dashboard-grid { grid-template-columns: 1fr; }
  .settings-grid { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
  .navbar { padding: 12px 16px; }
  .nav-links { display: none; }
  .mobile-menu-btn { display: block; }
  .dashboard-content { padding: 16px; }
  .stats-grid { grid-template-columns: 1fr; }
  .stat-card { padding: 16px; }
  .stat-value { font-size: 28px; }
  .question-card { padding: 24px; }
  .question-text { font-size: 18px; }
  .auth-card { padding: 32px 24px; }
  .form-row { grid-template-columns: 1fr; }
  .social-buttons { grid-template-columns: 1fr; }
  .settings-panel { padding: 20px; }

  .mobile-nav {
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    padding: 16px;
    gap: 4px;
    transform: translateY(-100%);
    opacity: 0;
    transition: var(--transition);
    z-index: 999;
  }

  .mobile-nav.open {
    transform: translateY(0);
    opacity: 1;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT STYLES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media print {
  .navbar, .bg-animation, .bg-grid, .toast-container { display: none; }
  body { background: white; color: black; }
  .card { border: 1px solid #ddd; box-shadow: none; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACCESSIBILITY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:focus-visible {
  outline: 2px solid var(--accent-blue);
  outline-offset: 2px;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border: 0;
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}

/* Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: rgba(148, 163, 184, 0.3);
}
</style>
</head>
<body>

<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-spinner"></div>
  <div class="loading-text">Initializing Evalis AI...</div>
</div>

<!-- Background Animation -->
<div class="bg-animation">
  <div class="bg-orb"></div>
  <div class="bg-orb"></div>
  <div class="bg-orb"></div>
</div>
<div class="bg-grid"></div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- App Container -->
<div class="app-container" id="appContainer">

  <!-- â•â•â•â•â•â•â•â•â•â•â• AUTH: LOGIN â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="loginPage" class="page auth-container" style="display:none;">
    <div class="auth-card">
      <div class="auth-header">
        <div class="nav-logo">E</div>
        <h1>Welcome back</h1>
        <p>Sign in to your Evalis AI account</p>
      </div>

      <div class="social-buttons">
        <button class="btn-social" onclick="handleSocialAuth('google')">
          ğŸ” Google
        </button>
        <button class="btn-social" onclick="handleSocialAuth('github')">
          ğŸ™ GitHub
        </button>
      </div>

      <div class="auth-divider">or continue with email</div>

      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label" for="loginEmail">Email</label>
          <input class="form-input" type="email" id="loginEmail"
                 placeholder="you@company.com" required autocomplete="email">
          <div class="form-error" id="loginEmailError">Please enter a valid email</div>
        </div>
        <div class="form-group">
          <label class="form-label" for="loginPassword">Password</label>
          <input class="form-input" type="password" id="loginPassword"
                 placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="current-password" minlength="8">
          <div class="form-error" id="loginPasswordError">Password must be at least 8 characters</div>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-bottom:20px;">
          <a style="font-size:13px;color:var(--accent-blue);cursor:pointer;text-decoration:none;"
             onclick="showPage('forgotPassword')">Forgot password?</a>
        </div>
        <button type="submit" class="btn btn-primary btn-lg" style="width:100%;" id="loginBtn">
          Sign In
        </button>
      </form>

      <div class="auth-footer">
        Don't have an account? <a onclick="showPage('register')">Create one</a>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• AUTH: REGISTER â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="registerPage" class="page auth-container" style="display:none;">
    <div class="auth-card">
      <div class="auth-header">
        <div class="nav-logo">E</div>
        <h1>Create account</h1>
        <p>Start your AI-powered interview journey</p>
      </div>

      <div class="social-buttons">
        <button class="btn-social" onclick="handleSocialAuth('google')">
          ğŸ” Google
        </button>
        <button class="btn-social" onclick="handleSocialAuth('github')">
          ğŸ™ GitHub
        </button>
      </div>

      <div class="auth-divider">or register with email</div>

      <form id="registerForm" onsubmit="handleRegister(event)">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="regFirstName">First Name</label>
            <input class="form-input" type="text" id="regFirstName"
                   placeholder="John" required autocomplete="given-name">
          </div>
          <div class="form-group">
            <label class="form-label" for="regLastName">Last Name</label>
            <input class="form-input" type="text" id="regLastName"
                   placeholder="Doe" required autocomplete="family-name">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="regEmail">Email</label>
          <input class="form-input" type="email" id="regEmail"
                 placeholder="you@company.com" required autocomplete="email">
        </div>
        <div class="form-group">
          <label class="form-label" for="regPassword">Password</label>
          <input class="form-input" type="password" id="regPassword"
                 placeholder="Min 8 characters" required minlength="8" autocomplete="new-password">
        </div>
        <div class="form-group">
          <label class="form-label" for="regRole">Role</label>
          <select class="form-input" id="regRole" required>
            <option value="">Select your role</option>
            <option value="candidate">Job Candidate</option>
            <option value="interviewer">Interviewer</option>
            <option value="recruiter">Recruiter / HR</option>
            <option value="manager">Hiring Manager</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary btn-lg" style="width:100%;" id="registerBtn">
          Create Account
        </button>
      </form>

      <div class="auth-footer">
        Already have an account? <a onclick="showPage('login')">Sign in</a>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• NAVBAR â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="navbar" id="mainNavbar" style="display:none;">
    <div class="nav-content">
      <a class="nav-brand" href="#" onclick="showPage('dashboard')">
        <div class="nav-logo">E</div>
        <span class="nav-title">Evalis AI</span>
      </a>

      <div class="nav-links" id="navLinks">
        <button class="nav-link active" data-page="dashboard" onclick="showPage('dashboard')">
          ğŸ“Š Dashboard
        </button>
        <button class="nav-link" data-page="interview" onclick="showPage('interview')">
          ğŸ¯ Interview
        </button>
        <button class="nav-link" data-page="history" onclick="showPage('history')">
          ğŸ“‹ History
        </button>
        <button class="nav-link" data-page="analytics" onclick="showPage('analytics')">
          ğŸ“ˆ Analytics
        </button>
        <button class="nav-link" data-page="settings" onclick="showPage('settings')">
          âš™ï¸ Settings
        </button>
      </div>

      <div class="nav-actions">
        <button class="btn btn-primary btn-sm" onclick="startNewInterview()">
          + New Interview
        </button>
        <div class="nav-avatar" id="navAvatar" onclick="toggleUserMenu()" title="Account">
          JD
        </div>
      </div>

      <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
        â˜°
      </button>
    </div>
  </nav>

  <!-- Mobile Nav -->
  <div class="mobile-nav" id="mobileNav">
    <button class="nav-link" onclick="showPage('dashboard');closeMobileMenu()">ğŸ“Š Dashboard</button>
    <button class="nav-link" onclick="showPage('interview');closeMobileMenu()">ğŸ¯ Interview</button>
    <button class="nav-link" onclick="showPage('history');closeMobileMenu()">ğŸ“‹ History</button>
    <button class="nav-link" onclick="showPage('analytics');closeMobileMenu()">ğŸ“ˆ Analytics</button>
    <button class="nav-link" onclick="showPage('settings');closeMobileMenu()">âš™ï¸ Settings</button>
    <button class="nav-link" onclick="handleLogout();closeMobileMenu()">ğŸšª Sign Out</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• DASHBOARD PAGE â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="dashboardPage" class="page dashboard" style="display:none;">
    <div class="dashboard-content">
      <div class="dashboard-header">
        <h1>ğŸ‘‹ Welcome back, <span id="dashboardName">John</span></h1>
        <p>Here's your interview performance overview</p>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-value" id="statScore">87</div>
          <div class="stat-label">Overall Score</div>
          <span class="stat-change positive">â†‘ 12% from last</span>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“</div>
          <div class="stat-value" id="statInterviews">24</div>
          <div class="stat-label">Total Interviews</div>
          <span class="stat-change positive">â†‘ 3 this week</span>
        </div>
        <div class="stat-card">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-value" id="statTime">18m</div>
          <div class="stat-label">Avg. Duration</div>
          <span class="stat-change negative">â†“ 2m slower</span>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ†</div>
          <div class="stat-value" id="statStreak">7</div>
          <div class="stat-label">Day Streak</div>
          <span class="stat-change positive">ğŸ”¥ Keep going!</span>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="dashboard-grid">
        <!-- Score Chart -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“Š Score Trends</span>
            <div class="tabs" style="margin-bottom:0;">
              <button class="tab active" onclick="setChartRange(this,'week')">Week</button>
              <button class="tab" onclick="setChartRange(this,'month')">Month</button>
              <button class="tab" onclick="setChartRange(this,'year')">Year</button>
            </div>
          </div>
          <div class="chart-container">
            <div class="bar-chart" id="scoreChart"></div>
          </div>
        </div>

        <!-- Score Ring -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ¯ Latest Score</span>
          </div>
          <div class="score-ring-container">
            <div class="score-ring">
              <svg viewBox="0 0 200 200">
                <defs>
                  <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#3b82f6" />
                    <stop offset="100%" style="stop-color:#8b5cf6" />
                  </linearGradient>
                </defs>
                <circle class="score-ring-bg" cx="100" cy="100" r="90" />
                <circle class="score-ring-fill" id="scoreRingFill" cx="100" cy="100" r="90" />
              </svg>
              <div class="score-ring-text">
                <div class="score-ring-value" id="scoreRingValue">0</div>
                <div class="score-ring-label">out of 100</div>
              </div>
            </div>
            <div class="score-grade" id="scoreGrade">
              â­ Excellent
            </div>
          </div>
        </div>
      </div>

      <!-- Skills & Timeline Grid -->
      <div class="dashboard-grid">
        <!-- Skills -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’ª Skill Breakdown</span>
            <button class="btn btn-ghost btn-sm">View All</button>
          </div>
          <div class="card-body">
            <div class="skills-list" id="skillsList"></div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">â° Recent Activity</span>
          </div>
          <div class="card-body">
            <div class="timeline" id="activityTimeline"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• INTERVIEW PAGE â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="interviewPage" class="page interview-container" style="display:none;">
    <div class="interview-content">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <h2>ğŸ¯ Interview Session</h2>
        <div style="display:flex;align-items:center;gap:12px;">
          <span class="tag tag-blue" id="interviewTimer">â± 00:00</span>
          <button class="btn btn-secondary btn-sm" onclick="endInterview()">End Session</button>
        </div>
      </div>

      <!-- Progress -->
      <div class="interview-progress" id="interviewProgress"></div>

      <!-- Question -->
      <div class="question-card" id="questionCard">
        <div class="question-meta">
          <span class="question-badge badge-technical" id="questionBadge">Technical</span>
          <span class="question-difficulty" id="questionDifficulty">Medium</span>
          <span style="margin-left:auto;font-size:13px;color:var(--text-muted);" id="questionNumber">
            Q1 of 10
          </span>
        </div>
        <h3 class="question-text" id="questionText">Loading question...</h3>
        <p class="question-hint" id="questionHint">Think about specific examples from your experience.</p>

        <div class="answer-area">
          <textarea class="answer-textarea" id="answerTextarea"
                    placeholder="Type your answer here... Be specific and use examples."
                    oninput="updateCharCount()"></textarea>
          <div class="answer-footer">
            <span class="char-count" id="charCount">0 characters</span>
            <div class="answer-actions">
              <button class="btn btn-ghost btn-sm" onclick="skipQuestion()">Skip</button>
              <button class="btn btn-primary btn-sm" onclick="submitAnswer()" id="submitAnswerBtn">
                Submit Answer â†’
              </button>
            </div>
          </div>
        </div>

        <!-- Voice Recorder -->
        <div class="voice-recorder">
          <button class="record-btn" id="recordBtn" onclick="toggleRecording()" aria-label="Toggle recording">
            ğŸ¤
          </button>
          <div class="waveform" id="waveform"></div>
          <span class="record-timer" id="recordTimer">0:00</span>
        </div>
      </div>

      <!-- AI Feedback (shown after submit) -->
      <div class="ai-feedback" id="aiFeedback" style="display:none;">
        <div class="ai-feedback-header">
          <div class="ai-avatar">ğŸ¤–</div>
          <div>
            <h3 style="font-size:16px;font-weight:700;">AI Analysis</h3>
            <p style="font-size:13px;color:var(--text-secondary);">Real-time feedback on your answer</p>
          </div>
          <span class="tag tag-green" id="answerScore" style="margin-left:auto;">Score: --</span>
        </div>
        <div class="ai-feedback-body">
          <div class="feedback-section">
            <h4>âœ… Strengths</h4>
            <p id="feedbackStrengths">Loading analysis...</p>
          </div>
          <div class="feedback-section">
            <h4>ğŸ”§ Improvements</h4>
            <ul class="improvement-list" id="feedbackImprovements"></ul>
          </div>
          <div class="feedback-section">
            <h4>ğŸ’¡ Ideal Answer Approach</h4>
            <p id="feedbackIdeal">Loading...</p>
          </div>
          <div style="margin-top:20px;display:flex;gap:12px;">
            <button class="btn btn-primary" onclick="nextQuestion()">Next Question â†’</button>
            <button class="btn btn-secondary" onclick="retryQuestion()">Retry</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• HISTORY PAGE â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="historyPage" class="page dashboard" style="display:none;">
    <div class="dashboard-content">
      <div class="dashboard-header">
        <h1>ğŸ“‹ Interview History</h1>
        <p>Review past interviews and track your progress</p>
      </div>

      <div style="display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap;">
        <div class="tabs" style="margin-bottom:0;">
          <button class="tab active">All</button>
          <button class="tab">Completed</button>
          <button class="tab">In Progress</button>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px;">
          <select class="form-input" style="width:auto;padding:8px 12px;font-size:13px;">
            <option>All Types</option>
            <option>Technical</option>
            <option>Behavioral</option>
            <option>System Design</option>
          </select>
          <button class="btn btn-secondary btn-sm" onclick="exportHistory()">ğŸ“¥ Export</button>
        </div>
      </div>

      <div class="card">
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Role</th>
                <th>Score</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="historyTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• ANALYTICS PAGE â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="analyticsPage" class="page dashboard" style="display:none;">
    <div class="dashboard-content">
      <div class="dashboard-header">
        <h1>ğŸ“ˆ Analytics & Insights</h1>
        <p>Deep dive into your interview performance metrics</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-value">92</div>
          <div class="stat-label">Best Score</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-value">78</div>
          <div class="stat-label">Avg Score</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-value">85%</div>
          <div class="stat-label">Completion Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸš€</div>
          <div class="stat-value">+15</div>
          <div class="stat-label">Score Improvement</div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“Š Performance Over Time</span>
          </div>
          <div class="chart-container">
            <div class="bar-chart" id="analyticsChart"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ·ï¸ Category Performance</span>
          </div>
          <div class="card-body">
            <div class="skills-list" id="categorySkills"></div>
          </div>
        </div>
      </div>

      <!-- AI Recommendations -->
      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <span class="card-title">ğŸ¤– AI Recommendations</span>
        </div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;" id="recommendationsList">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• SETTINGS PAGE â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="settingsPage" class="page dashboard" style="display:none;">
    <div class="dashboard-content">
      <div class="dashboard-header">
        <h1>âš™ï¸ Settings</h1>
        <p>Manage your account and preferences</p>
      </div>

      <div class="settings-grid">
        <div class="settings-nav">
          <button class="settings-nav-item active" onclick="showSettingsTab(this,'profile')">
            ğŸ‘¤ Profile
          </button>
          <button class="settings-nav-item" onclick="showSettingsTab(this,'preferences')">
            ğŸ¨ Preferences
          </button>
          <button class="settings-nav-item" onclick="showSettingsTab(this,'notifications')">
            ğŸ”” Notifications
          </button>
          <button class="settings-nav-item" onclick="showSettingsTab(this,'security')">
            ğŸ”’ Security
          </button>
          <button class="settings-nav-item" onclick="showSettingsTab(this,'billing')">
            ğŸ’³ Billing
          </button>
          <button class="settings-nav-item" onclick="showSettingsTab(this,'api')">
            ğŸ”Œ API & Integrations
          </button>
          <button class="settings-nav-item" style="color:var(--accent-rose);" onclick="handleLogout()">
            ğŸšª Sign Out
          </button>
        </div>

        <div class="settings-panel" id="settingsContent">
          <!-- Profile Tab -->
          <div id="settingsProfile">
            <div class="settings-section">
              <h3>Profile Information</h3>
              <p>Update your personal details and preferences</p>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">First Name</label>
                  <input class="form-input" type="text" id="settingsFirstName" value="John">
                </div>
                <div class="form-group">
                  <label class="form-label">Last Name</label>
                  <input class="form-input" type="text" id="settingsLastName" value="Doe">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Email</label>
                <input class="form-input" type="email" id="settingsEmail" value="john@company.com">
              </div>
              <div class="form-group">
                <label class="form-label">Role</label>
                <select class="form-input" id="settingsRole">
                  <option value="candidate" selected>Job Candidate</option>
                  <option value="interviewer">Interviewer</option>
                  <option value="recruiter">Recruiter / HR</option>
                  <option value="manager">Hiring Manager</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Bio</label>
                <textarea class="form-input" rows="3" placeholder="Tell us about yourself..."
                          style="resize:vertical;font-family:inherit;"></textarea>
              </div>
              <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• NEW INTERVIEW MODAL â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="newInterviewModal">
  <div class="modal">
    <div class="modal-header">
      <h3>ğŸ¯ New Interview Session</h3>
      <button class="modal-close" onclick="closeModal('newInterviewModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Interview Type</label>
        <select class="form-input" id="interviewType">
          <option value="technical">Technical Interview</option>
          <option value="behavioral">Behavioral Interview</option>
          <option value="system-design">System Design</option>
          <option value="coding">Coding Challenge</option>
          <option value="culture-fit">Culture Fit</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Target Role</label>
        <input class="form-input" type="text" id="targetRole"
               placeholder="e.g., Senior Frontend Developer">
      </div>
      <div class="form-group">
        <label class="form-label">Difficulty</label>
        <select class="form-input" id="interviewDifficulty">
          <option value="easy">Easy</option>
          <option value="medium" selected>Medium</option>
          <option value="hard">Hard</option>
          <option value="expert">Expert</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Number of Questions</label>
        <select class="form-input" id="questionCount">
          <option value="5">5 Questions (~15 min)</option>
          <option value="10" selected>10 Questions (~30 min)</option>
          <option value="15">15 Questions (~45 min)</option>
          <option value="20">20 Questions (~60 min)</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Focus Areas (optional)</label>
        <input class="form-input" type="text" id="focusAreas"
               placeholder="e.g., React, Node.js, SQL">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('newInterviewModal')">Cancel</button>
      <button class="btn btn-primary" onclick="launchInterview()">ğŸš€ Start Interview</button>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVALIS AI - COMPLETE APPLICATION ENGINE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Supabase Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUPABASE_URL = 'https://your-project.supabase.co';
const SUPABASE_ANON_KEY = 'your-anon-key';
const CLOUDFLARE_API = 'https://your-worker.your-domain.workers.dev';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Application State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AppState = {
  user: null,
  session: null,
  currentPage: 'login',
  interview: {
    active: false,
    type: 'technical',
    difficulty: 'medium',
    questions: [],
    currentIndex: 0,
    answers: [],
    scores: [],
    startTime: null,
    timerInterval: null
  },
  settings: {
    theme: 'dark',
    voiceEnabled: true,
    aiHints: true,
    notifications: true,
    autoSave: true
  },
  cache: new Map(),
  history: []
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Supabase Client (Lightweight) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class SupabaseClient {
  constructor(url, key) {
    this.url = url;
    this.key = key;
    this.accessToken = null;
  }

  get headers() {
    const h = {
      'Content-Type': 'application/json',
      'apikey': this.key,
      'Authorization': `Bearer ${this.accessToken || this.key}`
    };
    return h;
  }

  async request(endpoint, options = {}) {
    try {
      const response = await fetch(`${this.url}${endpoint}`, {
        ...options,
        headers: { ...this.headers, ...options.headers }
      });
      if (!response.ok) {
        const error = await response.json().catch(() => ({}));
        throw new Error(error.message || error.msg || `HTTP ${response.status}`);
      }
      return response.json();
    } catch (err) {
      console.error('Supabase request error:', err);
      throw err;
    }
  }

  // Auth Methods
  async signUp(email, password, metadata = {}) {
    const data = await this.request('/auth/v1/signup', {
      method: 'POST',
      body: JSON.stringify({ email, password, data: metadata })
    });
    if (data.access_token) {
      this.accessToken = data.access_token;
      AppState.session = data;
    }
    return data;
  }

  async signIn(email, password) {
    const data = await this.request('/auth/v1/token?grant_type=password', {
      method: 'POST',
      body: JSON.stringify({ email, password })
    });
    if (data.access_token) {
      this.accessToken = data.access_token;
      AppState.session = data;
    }
    return data;
  }

  async signInWithOAuth(provider) {
    const redirectUrl = window.location.origin + window.location.pathname;
    window.location.href =
      `${this.url}/auth/v1/authorize?provider=${provider}&redirect_to=${encodeURIComponent(redirectUrl)}`;
  }

  async signOut() {
    try {
      await this.request('/auth/v1/logout', { method: 'POST' });
    } catch (e) { /* ignore */ }
    this.accessToken = null;
    AppState.session = null;
    AppState.user = null;
  }

  async getUser() {
    return this.request('/auth/v1/user');
  }

  async refreshSession() {
    if (!AppState.session?.refresh_token) return null;
    const data = await this.request('/auth/v1/token?grant_type=refresh_token', {
      method: 'POST',
      body: JSON.stringify({ refresh_token: AppState.session.refresh_token })
    });
    if (data.access_token) {
      this.accessToken = data.access_token;
      AppState.session = data;
    }
    return data;
  }

  // Database Methods (PostgREST)
  from(table) {
    return new QueryBuilder(this, table);
  }
}

class QueryBuilder {
  constructor(client, table) {
    this.client = client;
    this.table = table;
    this.filters = [];
    this._order = null;
    this._limit = null;
    this._single = false;
  }

  select(columns = '*') {
    this._select = columns;
    return this;
  }

  eq(column, value) {
    this.filters.push(`${column}=eq.${value}`);
    return this;
  }

  gte(column, value) {
    this.filters.push(`${column}=gte.${value}`);
    return this;
  }

  lte(column, value) {
    this.filters.push(`${column}=lte.${value}`);
    return this;
  }

  order(column, { ascending = true } = {}) {
    this._order = `${column}.${ascending ? 'asc' : 'desc'}`;
    return this;
  }

  limit(count) {
    this._limit = count;
    return this;
  }

  single() {
    this._single = true;
    return this;
  }

  async execute() {
    let endpoint = `/rest/v1/${this.table}`;
    const params = [];
    if (this._select) params.push(`select=${this._select}`);
    this.filters.forEach(f => params.push(f));
    if (this._order) params.push(`order=${this._order}`);
    if (this._limit) params.push(`limit=${this._limit}`);
    if (params.length) endpoint += `?${params.join('&')}`;

    const headers = {};
    if (this._single) headers['Accept'] = 'application/vnd.pgrst.object+json';

    const data = await this.client.request(endpoint, { headers });
    return { data, error: null };
  }

  async insert(rows) {
    const endpoint = `/rest/v1/${this.table}`;
    const data = await this.client.request(endpoint, {
      method: 'POST',
      headers: { 'Prefer': 'return=representation' },
      body: JSON.stringify(rows)
    });
    return { data, error: null };
  }

  async update(values) {
    let endpoint = `/rest/v1/${this.table}`;
    if (this.filters.length) endpoint += `?${this.filters.join('&')}`;
    const data = await this.client.request(endpoint, {
      method: 'PATCH',
      headers: { 'Prefer': 'return=representation' },
      body: JSON.stringify(values)
    });
    return { data, error: null };
  }

  async delete() {
    let endpoint = `/rest/v1/${this.table}`;
    if (this.filters.length) endpoint += `?${this.filters.join('&')}`;
    const data = await this.client.request(endpoint, { method: 'DELETE' });
    return { data, error: null };
  }
}

// Initialize Supabase
const supabase = new SupabaseClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cloudflare Workers API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class CloudflareAPI {
  static async request(endpoint, data = {}) {
    try {
      const response = await fetch(`${CLOUDFLARE_API}${endpoint}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${AppState.session?.access_token || ''}`
        },
        body: JSON.stringify(data)
      });
      if (!response.ok) throw new Error(`CF Worker Error: ${response.status}`);
      return response.json();
    } catch (err) {
      console.error('Cloudflare API error:', err);
      // Return fallback data for demo
      return CloudflareAPI.getFallbackData(endpoint, data);
    }
  }

  static async generateQuestions(config) {
    return this.request('/api/generate-questions', config);
  }

  static async analyzeAnswer(question, answer) {
    return this.request('/api/analyze-answer', { question, answer });
  }

  static async getRecommendations(userId) {
    return this.request('/api/recommendations', { userId });
  }

  static async transcribeAudio(audioBlob) {
    const formData = new FormData();
    formData.append('audio', audioBlob);
    try {
      const response = await fetch(`${CLOUDFLARE_API}/api/transcribe`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${AppState.session?.access_token || ''}` },
        body: formData
      });
      return response.json();
    } catch (err) {
      return { text: '[Transcription unavailable in demo mode]' };
    }
  }

  // Fallback data for demo/offline mode
  static getFallbackData(endpoint, data) {
    const fallbacks = {
      '/api/generate-questions': {
        questions: getDefaultQuestions(data.type || 'technical', data.count || 10)
      },
      '/api/analyze-answer': {
        score: Math.floor(Math.random() * 30) + 65,
        strengths: 'Good structure and clear communication. Demonstrated relevant knowledge.',
        improvements: [
          'Add more specific examples with measurable outcomes',
          'Consider edge cases and scalability concerns',
          'Strengthen your conclusion with a summary'
        ],
        idealApproach: 'Start with context, describe your specific actions, quantify results, and reflect on learnings.'
      },
      '/api/recommendations': {
        recommendations: [
          { icon: 'ğŸ¯', title: 'Practice System Design', desc: 'Your system design scores are 15% below your average. Focus on scalability patterns.' },
          { icon: 'ğŸ’¬', title: 'Improve STAR Method', desc: 'Structure behavioral answers using Situation, Task, Action, Result format.' },
          { icon: 'âš¡', title: 'Speed Up Responses', desc: 'Your average response time is higher than optimal. Practice concise communication.' },
          { icon: 'ğŸ“š', title: 'Study Data Structures', desc: 'Review trees, graphs, and dynamic programming for technical rounds.' }
        ]
      }
    };
    return fallbacks[endpoint] || {};
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Default Questions Database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getDefaultQuestions(type, count) {
  const questionBank = {
    technical: [
      { text: "Explain the difference between REST and GraphQL APIs. When would you choose one over the other?", hint: "Consider data fetching efficiency, flexibility, and use cases.", badge: "Technical", difficulty: "Medium" },
      { text: "How would you optimize a slow database query that's causing performance issues in production?", hint: "Think about indexing, query planning, and caching strategies.", badge: "Technical", difficulty: "Hard" },
      { text: "Describe your approach to implementing authentication and authorization in a web application.", hint: "Cover JWT, OAuth, session management, and security best practices.", badge: "Technical", difficulty: "Medium" },
      { text: "What is the event loop in Node.js and how does it handle asynchronous operations?", hint: "Explain the call stack, callback queue, and microtask queue.", badge: "Technical", difficulty: "Medium" },
      { text: "How would you design a real-time notification system that scales to millions of users?", hint: "Consider WebSockets, message queues, and pub/sub patterns.", badge: "Technical", difficulty: "Hard" },
      { text: "Explain the concept of closures in JavaScript with practical examples.", hint: "Think about scope chains, data privacy, and factory functions.", badge: "Technical", difficulty: "Easy" },
      { text: "How do you handle state management in a large-scale React application?", hint: "Compare Redux, Context API, Zustand, and other solutions.", badge: "Technical", difficulty: "Medium" },
      { text: "Describe your experience with CI/CD pipelines. What tools and practices do you recommend?", hint: "Cover automated testing, deployment strategies, and monitoring.", badge: "Technical", difficulty: "Medium" },
      { text: "How would you implement rate limiting for an API? Discuss different algorithms.", hint: "Consider token bucket, sliding window, and distributed rate limiting.", badge: "Technical", difficulty: "Hard" },
      { text: "Explain microservices architecture. What are the trade-offs compared to monolithic applications?", hint: "Discuss scalability, complexity, data consistency, and deployment.", badge: "Technical", difficulty: "Medium" },
      { text: "How do you ensure data consistency in distributed systems?", hint: "Cover CAP theorem, eventual consistency, and saga patterns.", badge: "Technical", difficulty: "Expert" },
      { text: "What strategies do you use for error handling and logging in production systems?", hint: "Think about structured logging, error boundaries, and alerting.", badge: "Technical", difficulty: "Medium" },
      { text: "Explain the difference between SQL and NoSQL databases with use cases for each.", hint: "Consider data models, scalability, ACID properties, and query patterns.", badge: "Technical", difficulty: "Easy" },
      { text: "How would you implement a search feature with autocomplete for a large dataset?", hint: "Consider Elasticsearch, trie data structures, and debouncing.", badge: "Technical", difficulty: "Hard" },
      { text: "Describe your approach to writing testable code and your testing strategy.", hint: "Cover unit tests, integration tests, mocking, and TDD.", badge: "Technical", difficulty: "Medium" }
    ],
    behavioral: [
      { text: "Tell me about a time you had to deal with a difficult team member. How did you handle it?", hint: "Use the STAR method: Situation, Task, Action, Result.", badge: "Behavioral", difficulty: "Medium" },
      { text: "Describe a situation where you had to make a critical decision with incomplete information.", hint: "Focus on your decision-making process and risk assessment.", badge: "Behavioral", difficulty: "Medium" },
      { text: "Tell me about your biggest professional failure and what you learned from it.", hint: "Be honest, show self-awareness, and emphasize growth.", badge: "Behavioral", difficulty: "Medium" },
      { text: "How do you handle competing priorities and tight deadlines?", hint: "Discuss prioritization frameworks and communication strategies.", badge: "Behavioral", difficulty: "Easy" },
      { text: "Describe a time when you had to convince others to adopt your idea.", hint: "Show leadership, communication skills, and influence without authority.", badge: "Behavioral", difficulty: "Medium" },
      { text: "Tell me about a project you're most proud of and why.", hint: "Highlight your specific contributions and impact.", badge: "Behavioral", difficulty: "Easy" },
      { text: "How do you stay current with industry trends and new technologies?", hint: "Discuss learning habits, communities, and knowledge sharing.", badge: "Behavioral", difficulty: "Easy" },
      { text: "Describe a time when you received critical feedback. How did you respond?", hint: "Show emotional intelligence and growth mindset.", badge: "Behavioral", difficulty: "Medium" },
      { text: "Tell me about a time you had to work with a cross-functional team.", hint: "Highlight collaboration, communication, and conflict resolution.", badge: "Behavioral", difficulty: "Medium" },
      { text: "How do you mentor junior developers or share knowledge with your team?", hint: "Give specific examples of teaching and knowledge transfer.", badge: "Behavioral", difficulty: "Medium" }
    ],
    'system-design': [
      { text: "Design a URL shortening service like bit.ly. Walk me through your approach.", hint: "Consider encoding, storage, redirect performance, and analytics.", badge: "Technical", difficulty: "Hard" },
      { text: "How would you design a chat application that supports millions of concurrent users?", hint: "Think about WebSockets, message storage, presence, and delivery guarantees.", badge: "Technical", difficulty: "Expert" },
      { text: "Design a file storage service like Dropbox or Google Drive.", hint: "Consider file chunking, deduplication, syncing, and sharing.", badge: "Technical", difficulty: "Expert" },
      { text: "How would you design a recommendation engine for an e-commerce platform?", hint: "Cover collaborative filtering, content-based filtering, and ML pipelines.", badge: "Technical", difficulty: "Hard" },
      { text: "Design a distributed cache system. What would your architecture look like?", hint: "Think about consistency, eviction policies, and partitioning.", badge: "Technical", difficulty: "Expert" }
    ],
    coding: [
      { text: "Implement a function that finds the longest palindromic substring in a given string.", hint: "Consider dynamic programming or expand-around-center approaches.", badge: "Technical", difficulty: "Hard" },
      { text: "Write a function to detect a cycle in a linked list and find where it starts.", hint: "Think about Floyd's tortoise and hare algorithm.", badge: "Technical", difficulty: "Medium" },
      { text: "Implement a LRU (Least Recently Used) cache with O(1) operations.", hint: "Combine a doubly linked list with a hash map.", badge: "Technical", difficulty: "Hard" },
      { text: "Write a function to merge k sorted arrays into a single sorted array.", hint: "Consider a min-heap or divide-and-conquer approach.", badge: "Technical", difficulty: "Hard" },
      { text: "Implement a debounce function from scratch in JavaScript.", hint: "Think about closures, setTimeout, and clearing timers.", badge: "Technical", difficulty: "Medium" }
    ],
    'culture-fit': [
      { text: "What does an ideal work environment look like to you?", hint: "Be genuine and align with the company's values.", badge: "Behavioral", difficulty: "Easy" },
      { text: "How do you define success in your career?", hint: "Show ambition balanced with team orientation.", badge: "Behavioral", difficulty: "Easy" },
      { text: "What motivates you to do your best work?", hint: "Connect your motivations to the role and company mission.", badge: "Behavioral", difficulty: "Easy" },
      { text: "How do you handle disagreements about technical decisions?", hint: "Show respect for different perspectives and data-driven decision making.", badge: "Behavioral", difficulty: "Medium" },
      { text: "Where do you see yourself in 3-5 years?", hint: "Show growth mindset aligned with the company's trajectory.", badge: "Behavioral", difficulty: "Easy" }
    ]
  };

  const questions = questionBank[type] || questionBank.technical;
  // Shuffle and slice
  const shuffled = [...questions].sort(() => Math.random() - 0.5);
  return shuffled.slice(0, Math.min(count, shuffled.length));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Page Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(page) {
  // Hide all pages
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');

  // Show target page
  const pageEl = document.getElementById(page + 'Page');
  if (pageEl) pageEl.style.display = '';

  // Update nav
  const authPages = ['login', 'register', 'forgotPassword'];
  const navbar = document.getElementById('mainNavbar');
  if (navbar) {
    navbar.style.display = authPages.includes(page) ? 'none' : '';
  }

  // Update active nav link
  document.querySelectorAll('.nav-link[data-page]').forEach(link => {
    link.classList.toggle('active', link.dataset.page === page);
  });

  AppState.currentPage = page;

  // Page-specific initialization
  switch (page) {
    case 'dashboard': initDashboard(); break;
    case 'interview': initInterviewPage(); break;
    case 'history': loadHistory(); break;
    case 'analytics': initAnalytics(); break;
    case 'settings': initSettings(); break;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Auth Handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function handleLogin(e) {
  e.preventDefault();
  const btn = document.getElementById('loginBtn');
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;

  if (!validateEmail(email)) {
    showFieldError('loginEmail', 'loginEmailError', 'Please enter a valid email');
    return;
  }
  if (password.length < 8) {
    showFieldError('loginPassword', 'loginPasswordError', 'Password must be at least 8 characters');
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Signing in...';

  try {
    const data = await supabase.signIn(email, password);
    AppState.user = data.user || { email, user_metadata: { first_name: email.split('@')[0] } };
    saveSession();
    showToast('success', 'Welcome back!', `Signed in as ${email}`);
    showPage('dashboard');
  } catch (err) {
    // Demo fallback
    console.warn('Auth error (using demo mode):', err.message);
    AppState.user = {
      id: 'demo-' + Date.now(),
      email: email,
      user_metadata: { first_name: email.split('@')[0], last_name: 'User', role: 'candidate' }
    };
    saveSession();
    showToast('info', 'Demo Mode', 'Connected in demo mode. Configure Supabase for full functionality.');
    showPage('dashboard');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Sign In';
  }
}

async function handleRegister(e) {
  e.preventDefault();
  const btn = document.getElementById('registerBtn');
  const firstName = document.getElementById('regFirstName').value.trim();
  const lastName = document.getElementById('regLastName').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const password = document.getElementById('regPassword').value;
  const role = document.getElementById('regRole').value;

  if (!firstName || !lastName) {
    showToast('error', 'Missing Info', 'Please enter your full name.');
    return;
  }
  if (!validateEmail(email)) {
    showToast('error', 'Invalid Email', 'Please enter a valid email address.');
    return;
  }
  if (password.length < 8) {
    showToast('error', 'Weak Password', 'Password must be at least 8 characters.');
    return;
  }
  if (!role) {
    showToast('error', 'Select Role', 'Please select your role.');
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Creating account...';

  try {
    const data = await supabase.signUp(email, password, {
      first_name: firstName,
      last_name: lastName,
      role: role
    });
    AppState.user = data.user || { email, user_metadata: { first_name: firstName, last_name: lastName, role } };
    saveSession();
    showToast('success', 'Account Created!', 'Welcome to Evalis AI.');
    showPage('dashboard');
  } catch (err) {
    console.warn('Register error (using demo mode):', err.message);
    AppState.user = {
      id: 'demo-' + Date.now(),
      email: email,
      user_metadata: { first_name: firstName, last_name: lastName, role: role }
    };
    saveSession();
    showToast('info', 'Demo Mode', 'Account created in demo mode.');
    showPage('dashboard');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Create Account';
  }
}

async function handleSocialAuth(provider) {
  try {
    await supabase.signInWithOAuth(provider);
  } catch (err) {
    showToast('error', 'OAuth Error', `Could not connect to ${provider}. Check configuration.`);
  }
}

async function handleLogout() {
  try {
    await supabase.signOut();
  } catch (e) { /* ignore */ }

  AppState.user = null;
  AppState.session = null;
  localStorage.removeItem('evalis_session');
  localStorage.removeItem('evalis_user');

  if (AppState.interview.timerInterval) {
    clearInterval(AppState.interview.timerInterval);
  }

  showToast('info', 'Signed Out', 'You have been signed out successfully.');
  showPage('login');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Session Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveSession() {
  try {
    localStorage.setItem('evalis_session', JSON.stringify(AppState.session));
    localStorage.setItem('evalis_user', JSON.stringify(AppState.user));
  } catch (e) { /* quota exceeded */ }
}

function loadSession() {
  try {
    const session = localStorage.getItem('evalis_session');
    const user = localStorage.getItem('evalis_user');
    if (session) AppState.session = JSON.parse(session);
    if (user) AppState.user = JSON.parse(user);
    if (AppState.session?.access_token) {
      supabase.accessToken = AppState.session.access_token;
    }
    return !!AppState.user;
  } catch (e) {
    return false;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initDashboard() {
  const user = AppState.user;
  if (!user) return;

  const name = user.user_metadata?.first_name || user.email?.split('@')[0] || 'there';
  const nameEl = document.getElementById('dashboardName');
  if (nameEl) nameEl.textContent = name;

  // Set avatar
  const avatar = document.getElementById('navAvatar');
  if (avatar && user.user_metadata) {
    const initials = ((user.user_metadata.first_name || '')[0] || '') +
                     ((user.user_metadata.last_name || '')[0] || '');
    avatar.textContent = initials.toUpperCase() || 'U';
  }

  // Animate stats
  animateValue('statScore', 0, getStoredScore(), 1500);
  animateValue('statInterviews', 0, getStoredInterviewCount(), 1200);

  // Score ring
  const score = getStoredScore();
  setTimeout(() => {
    setScoreRing(score);
  }, 500);

  // Skills
  renderSkills();

  // Chart
  renderBarChart('scoreChart', getChartData('week'));

  // Timeline
  renderTimeline();
}

function getStoredScore() {
  const raw = parseInt(localStorage.getItem('finalScore'), 10);
  return isNaN(raw) ? 87 : Math.max(0, Math.min(100, raw));
}

function getStoredInterviewCount() {
  const stored = JSON.parse(localStorage.getItem('evalis_history') || '[]');
  return stored.length || 24;
}

function setScoreRing(score) {
  const ring = document.getElementById('scoreRingFill');
  const value = document.getElementById('scoreRingValue');
  const grade = document.getElementById('scoreGrade');

  if (!ring) return;

  const circumference = 2 * Math.PI * 90; // r=90
  const offset = circumference - (score / 100) * circumference;
  ring.style.strokeDashoffset = offset;

  // Animate number
  animateValue('scoreRingValue', 0, score, 2000);

  // Set grade
  let gradeText, gradeClass;
  if (score >= 90) { gradeText = 'â­ Excellent'; gradeClass = 'grade-excellent'; }
  else if (score >= 75) { gradeText = 'ğŸ‘ Good'; gradeClass = 'grade-good'; }
  else if (score >= 60) { gradeText = 'ğŸ“Š Average'; gradeClass = 'grade-average'; }
  else { gradeText = 'ğŸ“ˆ Needs Work'; gradeClass = 'grade-poor'; }

  if (grade) {
    grade.textContent = gradeText;
    grade.className = `score-grade ${gradeClass}`;
  }
}

function renderSkills() {
  const skills = [
    { name: 'Problem Solving', score: 88, color: 'blue' },
    { name: 'Communication', score: 82, color: 'green' },
    { name: 'Technical Depth', score: 75, color: 'purple' },
    { name: 'System Design', score: 70, color: 'amber' },
    { name: 'Code Quality', score: 85, color: 'cyan' }
  ];

  const list = document.getElementById('skillsList');
  if (!list) return;

  list.innerHTML = skills.map(s => `
    <div class="skill-item">
      <div class="skill-info">
        <div class="skill-name">${sanitize(s.name)}</div>
        <div class="skill-score">${s.score}/100</div>
      </div>
      <div class="skill-bar-container">
        <div class="skill-bar ${s.color}" data-width="${s.score}"></div>
      </div>
    </div>
  `).join('');

  // Animate bars
  setTimeout(() => {
    list.querySelectorAll('.skill-bar').forEach(bar => {
      bar.style.width = bar.dataset.width + '%';
    });
  }, 300);
}

function renderTimeline() {
  const activities = [
    { icon: 'âœ…', type: 'success', title: 'Completed Technical Interview', desc: 'Scored 87/100 in Senior Frontend Developer mock', time: '2 hours ago' },
    { icon: 'âš¡', type: 'info', title: 'New Achievement Unlocked', desc: '7-day streak! Keep up the great work.', time: '5 hours ago' },
    { icon: 'ğŸ“', type: 'warning', title: 'Feedback Received', desc: 'AI suggested improving system design answers', time: '1 day ago' },
    { icon: 'ğŸ¯', type: 'success', title: 'Completed Behavioral Interview', desc: 'Scored 92/100 â€“ Your best score yet!', time: '2 days ago' }
  ];

  const timeline = document.getElementById('activityTimeline');
  if (!timeline) return;

  timeline.innerHTML = activities.map(a => `
    <div class="timeline-item">
      <div class="timeline-marker ${a.type}">${a.icon}</div>
      <div class="timeline-content">
        <div class="timeline-title">${sanitize(a.title)}</div>
        <div class="timeline-desc">${sanitize(a.desc)}</div>
        <div class="timeline-time">${sanitize(a.time)}</div>
      </div>
    </div>
  `).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Charts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getChartData(range) {
  const data = {
    week: [
      { label: 'Mon', value: 72, color: 'var(--accent-blue)' },
      { label: 'Tue', value: 85, color: 'var(--accent-purple)' },
      { label: 'Wed', value: 68, color: 'var(--accent-blue)' },
      { label: 'Thu', value: 91, color: 'var(--accent-emerald)' },
      { label: 'Fri', value: 78, color: 'var(--accent-purple)' },
      { label: 'Sat', value: 87, color: 'var(--accent-blue)' },
      { label: 'Sun', value: 82, color: 'var(--accent-purple)' }
    ],
    month: [
      { label: 'W1', value: 70, color: 'var(--accent-blue)' },
      { label: 'W2', value: 76, color: 'var(--accent-purple)' },
      { label: 'W3', value: 82, color: 'var(--accent-blue)' },
      { label: 'W4', value: 87, color: 'var(--accent-emerald)' }
    ],
    year: [
      { label: 'Jan', value: 55, color: 'var(--accent-blue)' },
      { label: 'Feb', value: 60, color: 'var(--accent-blue)' },
      { label: 'Mar', value: 62, color: 'var(--accent-blue)' },
      { label: 'Apr', value: 68, color: 'var(--accent-blue)' },
      { label: 'May', value: 72, color: 'var(--accent-purple)' },
      { label: 'Jun', value: 75, color: 'var(--accent-purple)' },
      { label: 'Jul', value: 78, color: 'var(--accent-purple)' },
      { label: 'Aug', value: 80, color: 'var(--accent-purple)' },
      { label: 'Sep', value: 83, color: 'var(--accent-emerald)' },
      { label: 'Oct', value: 85, color: 'var(--accent-emerald)' },
      { label: 'Nov', value: 87, color: 'var(--accent-emerald)' },
      { label: 'Dec', value: 87, color: 'var(--accent-emerald)' }
    ]
  };
  return data[range] || data.week;
}

function renderBarChart(containerId, data) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = data.map(d => `
    <div class="bar-group">
      <div class="bar" style="height:0%;background:${d.color};" data-height="${d.value}">
        <div class="bar-tooltip">${d.value}</div>
      </div>
      <div class="bar-label">${sanitize(d.label)}</div>
    </div>
  `).join('');

  // Animate
  setTimeout(() => {
    container.querySelectorAll('.bar').forEach(bar => {
      bar.style.height = bar.dataset.height + '%';
    });
  }, 200);
}

function setChartRange(btn, range) {
  btn.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  renderBarChart('scoreChart', getChartData(range));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Interview Session â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startNewInterview() {
  openModal('newInterviewModal');
}

async function launchInterview() {
  const type = document.getElementById('interviewType').value;
  const role = document.getElementById('targetRole').value || 'Software Developer';
  const difficulty = document.getElementById('interviewDifficulty').value;
  const count = parseInt(document.getElementById('questionCount').value, 10);
  const focusAreas = document.getElementById('focusAreas').value;

  closeModal('newInterviewModal');

  // Reset interview state
  AppState.interview = {
    active: true,
    type,
    role,
    difficulty,
    questions: [],
    currentIndex: 0,
    answers: [],
    scores: [],
    startTime: Date.now(),
    timerInterval: null
  };

  showToast('info', 'Generating Questions...', 'AI is preparing your interview.');

  try {
    const result = await CloudflareAPI.generateQuestions({ type, role, difficulty, count, focusAreas });
    AppState.interview.questions = result.questions || getDefaultQuestions(type, count);
  } catch (err) {
    AppState.interview.questions = getDefaultQuestions(type, count);
  }

  showPage('interview');
}

function initInterviewPage() {
  const interview = AppState.interview;
  if (!interview.active || !interview.questions.length) {
    // Show empty state or redirect
    document.getElementById('questionCard').innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ğŸ¯</div>
        <h3>No Active Interview</h3>
        <p>Start a new interview session to begin practicing.</p>
        <button class="btn btn-primary" onclick="startNewInterview()">+ Start Interview</button>
      </div>
    `;
    return;
  }

  renderProgress();
  renderQuestion();
  startTimer();
  initWaveform();
}

function renderProgress() {
  const progress = document.getElementById('interviewProgress');
  if (!progress) return;

  const total = AppState.interview.questions.length;
  const current = AppState.interview.currentIndex;

  progress.innerHTML = Array.from({ length: total }, (_, i) => {
    let cls = 'progress-step';
    if (i < current) cls += ' completed';
    else if (i === current) cls += ' active';
    return `<div class="${cls}"></div>`;
  }).join('');
}

function renderQuestion() {
  const interview = AppState.interview;
  const q = interview.questions[interview.currentIndex];
  if (!q) return;

  const questionText = document.getElementById('questionText');
  const questionHint = document.getElementById('questionHint');
  const questionBadge = document.getElementById('questionBadge');
  const questionDifficulty = document.getElementById('questionDifficulty');
  const questionNumber = document.getElementById('questionNumber');
  const answerTextarea = document.getElementById('answerTextarea');

  if (questionText) questionText.textContent = q.text;
  if (questionHint) questionHint.textContent = q.hint || '';
  if (questionBadge) {
    questionBadge.textContent = q.badge || 'Technical';
    questionBadge.className = `question-badge badge-${(q.badge || 'technical').toLowerCase()}`;
  }
  if (questionDifficulty) questionDifficulty.textContent = `âš¡ ${q.difficulty || 'Medium'}`;
  if (questionNumber) questionNumber.textContent = `Q${interview.currentIndex + 1} of ${interview.questions.length}`;
  if (answerTextarea) {
    answerTextarea.value = interview.answers[interview.currentIndex] || '';
    answerTextarea.focus();
  }

  // Hide feedback
  const feedback = document.getElementById('aiFeedback');
  if (feedback) feedback.style.display = 'none';

  // Show question card
  const card = document.getElementById('questionCard');
  if (card) card.style.display = '';

  updateCharCount();
}

function updateCharCount() {
  const textarea = document.getElementById('answerTextarea');
  const counter = document.getElementById('charCount');
  if (textarea && counter) {
    counter.textContent = `${textarea.value.length} characters`;
  }
}

async function submitAnswer() {
  const textarea = document.getElementById('answerTextarea');
  if (!textarea) return;

  const answer = textarea.value.trim();
  if (answer.length < 10) {
    showToast('warning', 'Too Short', 'Please provide a more detailed answer.');
    return;
  }

  const interview = AppState.interview;
  const question = interview.questions[interview.currentIndex];

  interview.answers[interview.currentIndex] = answer;

  // Disable submit
  const submitBtn = document.getElementById('submitAnswerBtn');
  if (submitBtn) {
    submitBtn.disabled = true;
    submitBtn.textContent = 'Analyzing...';
  }

  showToast('info', 'Analyzing', 'AI is evaluating your answer...');

  try {
    const analysis = await CloudflareAPI.analyzeAnswer(question.text, answer);

    interview.scores[interview.currentIndex] = analysis.score;

    // Show feedback
    const feedback = document.getElementById('aiFeedback');
    if (feedback) {
      feedback.style.display = '';

      const scoreTag = document.getElementById('answerScore');
      if (scoreTag) scoreTag.textContent = `Score: ${analysis.score}/100`;

      const strengths = document.getElementById('feedbackStrengths');
      if (strengths) strengths.textContent = analysis.strengths;

      const improvements = document.getElementById('feedbackImprovements');
      if (improvements) {
        improvements.innerHTML = (analysis.improvements || []).map(i =>
          `<li>${sanitize(i)}</li>`
        ).join('');
      }

      const ideal = document.getElementById('feedbackIdeal');
      if (ideal) ideal.textContent = analysis.idealApproach;
    }

    showToast('success', 'Answer Analyzed', `Score: ${analysis.score}/100`);
  } catch (err) {
    showToast('error', 'Analysis Failed', 'Could not analyze your answer. Try again.');
  } finally {
    if (submitBtn) {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Answer â†’';
    }
  }
}

function nextQuestion() {
  const interview = AppState.interview;
  if (interview.currentIndex < interview.questions.length - 1) {
    interview.currentIndex++;
    renderProgress();
    renderQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else {
    finishInterview();
  }
}

function skipQuestion() {
  const interview = AppState.interview;
  interview.answers[interview.currentIndex] = '[Skipped]';
  interview.scores[interview.currentIndex] = 0;
  nextQuestion();
}

function retryQuestion() {
  const textarea = document.getElementById('answerTextarea');
  if (textarea) {
    textarea.value = '';
    textarea.focus();
  }
  const feedback = document.getElementById('aiFeedback');
  if (feedback) feedback.style.display = 'none';
  updateCharCount();
}

function finishInterview() {
  const interview = AppState.interview;

  // Stop timer
  if (interview.timerInterval) {
    clearInterval(interview.timerInterval);
  }

  // Calculate score
  const validScores = interview.scores.filter(s => s > 0);
  const avgScore = validScores.length
    ? Math.round(validScores.reduce((a, b) => a + b, 0) / validScores.length)
    : 0;

  // Save to localStorage
  localStorage.setItem('finalScore', avgScore.toString());

  // Save to history
  const historyItem = {
    id: Date.now(),
    date: new Date().toISOString(),
    type: interview.type,
    role: interview.role || 'General',
    score: avgScore,
    duration: Math.floor((Date.now() - interview.startTime) / 60000),
    questions: interview.questions.length,
    answered: interview.answers.filter(a => a && a !== '[Skipped]').length,
    status: 'completed'
  };

  const history = JSON.parse(localStorage.getItem('evalis_history') || '[]');
  history.unshift(historyItem);
  localStorage.setItem('evalis_history', JSON.stringify(history.slice(0, 100)));

  // Try saving to Supabase
  saveInterviewToSupabase(historyItem);

  interview.active = false;

  showToast('success', 'Interview Complete!', `Your score: ${avgScore}/100`);
  showPage('dashboard');
}

async function saveInterviewToSupabase(data) {
  if (!AppState.user?.id || AppState.user.id.startsWith('demo-')) return;

  try {
    await supabase.from('interviews').insert({
      user_id: AppState.user.id,
      type: data.type,
      role: data.role,
      score: data.score,
      duration: data.duration,
      questions_count: data.questions,
      answers_count: data.answered,
      status: data.status,
      created_at: data.date
    });
  } catch (err) {
    console.warn('Could not save to Supabase:', err);
  }
}

function endInterview() {
  if (confirm('Are you sure you want to end this interview? Your progress will be saved.')) {
    finishInterview();
  }
}

// Timer
function startTimer() {
  const timerEl = document.getElementById('interviewTimer');
  const startTime = AppState.interview.startTime || Date.now();

  if (AppState.interview.timerInterval) {
    clearInterval(AppState.interview.timerInterval);
  }

  AppState.interview.timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
    const seconds = (elapsed % 60).toString().padStart(2, '0');
    if (timerEl) timerEl.textContent = `â± ${minutes}:${seconds}`;
  }, 1000);
}

// Voice Recording
let mediaRecorder = null;
let audioChunks = [];
let recordingInterval = null;

function initWaveform() {
  const waveform = document.getElementById('waveform');
  if (!waveform) return;
  waveform.innerHTML = Array.from({ length: 40 }, () =>
    `<div class="waveform-bar" style="height:4px;"></div>`
  ).join('');
}

async function toggleRecording() {
  const btn = document.getElementById('recordBtn');

  if (mediaRecorder && mediaRecorder.state === 'recording') {
    stopRecording();
    return;
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];

    mediaRecorder.ondataavailable = (e) => {
      if (e.data.size > 0) audioChunks.push(e.data);
    };

    mediaRecorder.onstop = async () => {
      stream.getTracks().forEach(t => t.stop());
      const blob = new Blob(audioChunks, { type: 'audio/webm' });

      showToast('info', 'Transcribing...', 'Converting speech to text.');

      const result = await CloudflareAPI.transcribeAudio(blob);
      const textarea = document.getElementById('answerTextarea');
      if (textarea && result.text) {
        textarea.value += (textarea.value ? '\n' : '') + result.text;
        updateCharCount();
      }
    };

    mediaRecorder.start();
    btn.classList.add('recording');
    btn.innerHTML = 'â¹';

    // Animate waveform
    const waveform = document.getElementById('waveform');
    const bars = waveform ? waveform.querySelectorAll('.waveform-bar') : [];

    let recordStart = Date.now();
    recordingInterval = setInterval(() => {
      const elapsed = Math.floor((Date.now() - recordStart) / 1000);
      const timerEl = document.getElementById('recordTimer');
      if (timerEl) {
        timerEl.textContent = `${Math.floor(elapsed / 60)}:${(elapsed % 60).toString().padStart(2, '0')}`;
      }

      bars.forEach(bar => {
        bar.style.height = (Math.random() * 30 + 4) + 'px';
      });
    }, 100);

    showToast('info', 'Recording', 'Speak your answer clearly.');
  } catch (err) {
    showToast('error', 'Microphone Error', 'Could not access microphone. Please check permissions.');
  }
}

function stopRecording() {
  if (mediaRecorder && mediaRecorder.state === 'recording') {
    mediaRecorder.stop();
  }

  const btn = document.getElementById('recordBtn');
  if (btn) {
    btn.classList.remove('recording');
    btn.innerHTML = 'ğŸ¤';
  }

  if (recordingInterval) {
    clearInterval(recordingInterval);
    recordingInterval = null;
  }

  // Reset waveform
  const bars = document.querySelectorAll('#waveform .waveform-bar');
  bars.forEach(bar => { bar.style.height = '4px'; });

  const timerEl = document.getElementById('recordTimer');
  if (timerEl) timerEl.textContent = '0:00';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadHistory() {
  const tbody = document.getElementById('historyTableBody');
  if (!tbody) return;

  const history = JSON.parse(localStorage.getItem('evalis_history') || '[]');

  if (!history.length) {
    // Generate sample history
    const sampleHistory = generateSampleHistory();
    localStorage.setItem('evalis_history', JSON.stringify(sampleHistory));
    return loadHistory(); // Recursive call with data now present
  }

  tbody.innerHTML = history.map(item => {
    const date = new Date(item.date);
    const scoreColor = item.score >= 80 ? 'rgba(16,185,129,0.2)' :
                       item.score >= 60 ? 'rgba(59,130,246,0.2)' :
                       'rgba(244,63,94,0.2)';
    const scoreTextColor = item.score >= 80 ? 'var(--accent-emerald)' :
                           item.score >= 60 ? 'var(--accent-blue)' :
                           'var(--accent-rose)';
    const statusClass = item.status === 'completed' ? 'status-completed' :
                        item.status === 'pending' ? 'status-pending' : 'status-failed';

    return `
      <tr>
        <td>${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</td>
        <td><span class="tag tag-blue">${sanitize(item.type)}</span></td>
        <td>${sanitize(item.role)}</td>
        <td>
          <div class="table-score" style="background:${scoreColor};color:${scoreTextColor};">
            ${item.score}
          </div>
        </td>
        <td>${item.duration || 'â€“'}m</td>
        <td><span class="status-badge ${statusClass}">â— ${sanitize(item.status)}</span></td>
        <td>
          <button class="btn btn-ghost btn-sm" onclick="viewReport(${item.id})">View</button>
        </td>
      </tr>
    `;
  }).join('');
}

function generateSampleHistory() {
  const types = ['technical', 'behavioral', 'system-design', 'coding', 'culture-fit'];
  const roles = ['Frontend Developer', 'Backend Engineer', 'Full Stack Developer', 'DevOps Engineer', 'Data Engineer'];
  const statuses = ['completed', 'completed', 'completed', 'completed', 'pending'];

  return Array.from({ length: 12 }, (_, i) => ({
    id: Date.now() - i * 86400000,
    date: new Date(Date.now() - i * 86400000 * Math.ceil(Math.random() * 3)).toISOString(),
    type: types[Math.floor(Math.random() * types.length)],
    role: roles[Math.floor(Math.random() * roles.length)],
    score: Math.floor(Math.random() * 40) + 55,
    duration: Math.floor(Math.random() * 30) + 10,
    questions: 10,
    answered: Math.floor(Math.random() * 3) + 8,
    status: statuses[Math.floor(Math.random() * statuses.length)]
  }));
}

function viewReport(id) {
  showToast('info', 'Report', `Opening detailed report for interview #${id}`);
}

function exportHistory() {
  const history = JSON.parse(localStorage.getItem('evalis_history') || '[]');
  const csv = [
    'Date,Type,Role,Score,Duration,Status',
    ...history.map(h =>
      `"${new Date(h.date).toLocaleDateString()}","${h.type}","${h.role}",${h.score},${h.duration || 0},"${h.status}"`
    )
  ].join('\n');

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `evalis-history-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);

  showToast('success', 'Exported', 'Interview history downloaded as CSV.');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initAnalytics() {
  renderBarChart('analyticsChart', [
    { label: 'Technical', value: 82, color: 'var(--accent-blue)' },
    { label: 'Behavioral', value: 88, color: 'var(--accent-purple)' },
    { label: 'System Design', value: 65, color: 'var(--accent-amber)' },
    { label: 'Coding', value: 78, color: 'var(--accent-emerald)' },
    { label: 'Culture Fit', value: 92, color: 'var(--accent-cyan)' }
  ]);

  const categorySkills = document.getElementById('categorySkills');
  if (categorySkills) {
    const categories = [
      { name: 'Data Structures', score: 80, color: 'blue' },
      { name: 'Algorithms', score: 72, color: 'green' },
      { name: 'System Design', score: 65, color: 'amber' },
      { name: 'APIs & REST', score: 88, color: 'purple' },
      { name: 'Databases', score: 76, color: 'cyan' }
    ];

    categorySkills.innerHTML = categories.map(s => `
      <div class="skill-item">
        <div class="skill-info">
          <div class="skill-name">${sanitize(s.name)}</div>
          <div class="skill-score">${s.score}/100</div>
        </div>
        <div class="skill-bar-container">
          <div class="skill-bar ${s.color}" data-width="${s.score}"></div>
        </div>
      </div>
    `).join('');

    setTimeout(() => {
      categorySkills.querySelectorAll('.skill-bar').forEach(bar => {
        bar.style.width = bar.dataset.width + '%';
      });
    }, 300);
  }

  loadRecommendations();
}

async function loadRecommendations() {
  const list = document.getElementById('recommendationsList');
  if (!list) return;

  try {
    const result = await CloudflareAPI.getRecommendations(AppState.user?.id);
    const recs = result.recommendations || [];

    list.innerHTML = recs.map(r => `
      <div class="card" style="padding:20px;">
        <div style="font-size:32px;margin-bottom:12px;">${r.icon}</div>
        <h4 style="font-size:15px;font-weight:700;margin-bottom:6px;">${sanitize(r.title)}</h4>
        <p style="font-size:13px;color:var(--text-secondary);line-height:1.6;">${sanitize(r.desc)}</p>
      </div>
    `).join('');
  } catch (err) {
    list.innerHTML = '<p style="color:var(--text-muted);">Could not load recommendations.</p>';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initSettings() {
  const user = AppState.user;
  if (!user) return;

  const meta = user.user_metadata || {};
  setInputValue('settingsFirstName', meta.first_name || '');
  setInputValue('settingsLastName', meta.last_name || '');
  setInputValue('settingsEmail', user.email || '');
  if (meta.role) {
    const roleSelect = document.getElementById('settingsRole');
    if (roleSelect) roleSelect.value = meta.role;
  }
}

function showSettingsTab(btn, tab) {
  document.querySelectorAll('.settings-nav-item').forEach(i => i.classList.remove('active'));
  btn.classList.add('active');

  const content = document.getElementById('settingsContent');
  if (!content) return;

  const tabs = {
    profile: `
      <div id="settingsProfile">
        <div class="settings-section">
          <h3>Profile Information</h3>
          <p>Update your personal details</p>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">First Name</label>
              <input class="form-input" type="text" id="settingsFirstName" value="${sanitize(AppState.user?.user_metadata?.first_name || '')}">
            </div>
            <div class="form-group">
              <label class="form-label">Last Name</label>
              <input class="form-input" type="text" id="settingsLastName" value="${sanitize(AppState.user?.user_metadata?.last_name || '')}">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input class="form-input" type="email" id="settingsEmail" value="${sanitize(AppState.user?.email || '')}">
          </div>
          <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
        </div>
      </div>
    `,
    preferences: `
      <div class="settings-section">
        <h3>Interview Preferences</h3>
        <p>Customize your interview experience</p>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>AI Hints</h4>
            <p>Show AI-generated hints during interviews</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" ${AppState.settings.aiHints ? 'checked' : ''} onchange="AppState.settings.aiHints=this.checked;saveSettings()">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Voice Recording</h4>
            <p>Enable voice-to-text for answers</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" ${AppState.settings.voiceEnabled ? 'checked' : ''} onchange="AppState.settings.voiceEnabled=this.checked;saveSettings()">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Auto-Save</h4>
            <p>Automatically save answers during interviews</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" ${AppState.settings.autoSave ? 'checked' : ''} onchange="AppState.settings.autoSave=this.checked;saveSettings()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    `,
    notifications: `
      <div class="settings-section">
        <h3>Notification Settings</h3>
        <p>Control how and when you receive notifications</p>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Email Notifications</h4>
            <p>Receive interview results and tips via email</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked onchange="saveSettings()">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Weekly Report</h4>
            <p>Get a weekly summary of your progress</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked onchange="saveSettings()">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Streak Reminders</h4>
            <p>Get reminded to maintain your practice streak</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked onchange="saveSettings()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    `,
    security: `
      <div class="settings-section">
        <h3>Change Password</h3>
        <p>Update your account password</p>
        <div class="form-group">
          <label class="form-label">Current Password</label>
          <input class="form-input" type="password" placeholder="Enter current password">
        </div>
        <div class="form-group">
          <label class="form-label">New Password</label>
          <input class="form-input" type="password" placeholder="Min 8 characters" minlength="8">
        </div>
        <div class="form-group">
          <label class="form-label">Confirm New Password</label>
          <input class="form-input" type="password" placeholder="Repeat new password">
        </div>
        <button class="btn btn-primary" onclick="showToast('success','Password Updated','Your password has been changed.')">Update Password</button>
      </div>
      <div class="settings-section">
        <h3>Two-Factor Authentication</h3>
        <p>Add an extra layer of security to your account</p>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Enable 2FA</h4>
            <p>Use an authenticator app for additional security</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" onchange="showToast('info','2FA','Configure in your authenticator app.')">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <div class="settings-section">
        <h3 style="color:var(--accent-rose);">Danger Zone</h3>
        <p>Irreversible actions</p>
        <button class="btn btn-danger btn-sm" onclick="if(confirm('Delete all data?')){localStorage.clear();showToast('warning','Data Cleared','All local data has been removed.');}">
          Delete All Data
        </button>
      </div>
    `,
    billing: `
      <div class="settings-section">
        <h3>Current Plan</h3>
        <p>Manage your subscription</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-top:16px;">
          <div class="card" style="padding:24px;border-color:var(--border-color);">
            <div style="font-size:14px;font-weight:600;color:var(--text-secondary);margin-bottom:8px;">Free</div>
            <div style="font-size:32px;font-weight:900;margin-bottom:8px;">$0</div>
            <div style="font-size:13px;color:var(--text-muted);margin-bottom:16px;">5 interviews/month</div>
            <button class="btn btn-secondary btn-sm" style="width:100%;" disabled>Current Plan</button>
          </div>
          <div class="card" style="padding:24px;border-color:var(--accent-blue);">
            <div style="font-size:14px;font-weight:600;color:var(--accent-blue);margin-bottom:8px;">Pro</div>
            <div style="font-size:32px;font-weight:900;margin-bottom:8px;">$19</div>
            <div style="font-size:13px;color:var(--text-muted);margin-bottom:16px;">Unlimited interviews</div>
            <button class="btn btn-primary btn-sm" style="width:100%;" onclick="showToast('info','Upgrade','Payment integration coming soon.')">Upgrade</button>
          </div>
          <div class="card" style="padding:24px;border-color:var(--accent-purple);">
            <div style="font-size:14px;font-weight:600;color:var(--accent-purple);margin-bottom:8px;">Enterprise</div>
            <div style="font-size:32px;font-weight:900;margin-bottom:8px;">$49</div>
            <div style="font-size:13px;color:var(--text-muted);margin-bottom:16px;">Teams + API access</div>
            <button class="btn btn-secondary btn-sm" style="width:100%;" onclick="showToast('info','Contact','Reach out for enterprise pricing.')">Contact Sales</button>
          </div>
        </div>
      </div>
    `,
    api: `
      <div class="settings-section">
        <h3>API Keys</h3>
        <p>Manage API keys for integrations</p>
        <div class="form-group">
          <label class="form-label">API Key</label>
          <div style="display:flex;gap:8px;">
            <input class="form-input" type="text" value="evalis_pk_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" readonly style="flex:1;">
            <button class="btn btn-secondary btn-sm" onclick="showToast('success','Copied','API key copied to clipboard.')">Copy</button>
          </div>
        </div>
        <button class="btn btn-secondary btn-sm" onclick="showToast('info','Regenerated','New API key generated.')">Regenerate Key</button>
      </div>
      <div class="settings-section">
        <h3>Integrations</h3>
        <p>Connect with your favorite tools</p>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>ğŸ”— Slack</h4>
            <p>Get interview notifications in Slack</p>
          </div>
          <button class="btn btn-secondary btn-sm">Connect</button>
        </div>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>ğŸ“Š Notion</h4>
            <p>Sync interview reports to Notion</p>
          </div>
          <button class="btn btn-secondary btn-sm">Connect</button>
        </div>
        <div class="toggle-row">
          <div class="toggle-info">
            <h4>ğŸ“§ Zapier</h4>
            <p>Automate workflows with Zapier</p>
          </div>
          <button class="btn btn-secondary btn-sm">Connect</button>
        </div>
      </div>
    `
  };

  content.innerHTML = tabs[tab] || tabs.profile;
}

function saveProfile() {
  const firstName = document.getElementById('settingsFirstName')?.value?.trim();
  const lastName = document.getElementById('settingsLastName')?.value?.trim();
  const email = document.getElementById('settingsEmail')?.value?.trim();

  if (AppState.user) {
    if (!AppState.user.user_metadata) AppState.user.user_metadata = {};
    AppState.user.user_metadata.first_name = firstName;
    AppState.user.user_metadata.last_name = lastName;
    AppState.user.email = email;
    saveSession();
  }

  showToast('success', 'Profile Saved', 'Your profile has been updated.');
}

function saveSettings() {
  try {
    localStorage.setItem('evalis_settings', JSON.stringify(AppState.settings));
  } catch (e) { /* ignore */ }
  showToast('success', 'Settings Saved', 'Your preferences have been updated.');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Modal Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id) {
  const modal = document.getElementById(id);
  if (modal) modal.classList.add('active');
}

function closeModal(id) {
  const modal = document.getElementById(id);
  if (modal) modal.classList.remove('active');
}

// Close modal on overlay click
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal-overlay') && e.target.classList.contains('active')) {
    e.target.classList.remove('active');
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Toast Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(type, title, message) {
  const container = document.getElementById('toastContainer');
  if (!container) return;

  const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <span class="toast-icon">${icons[type] || 'â„¹ï¸'}</span>
    <div class="toast-content">
      <div class="toast-title">${sanitize(title)}</div>
      <div class="toast-message">${sanitize(message)}</div>
    </div>
    <button class="toast-dismiss" onclick="dismissToast(this)" aria-label="Dismiss">âœ•</button>
  `;

  container.appendChild(toast);

  // Auto dismiss
  setTimeout(() => {
    dismissToast(toast.querySelector('.toast-dismiss'));
  }, 5000);
}

function dismissToast(btn) {
  const toast = btn?.closest?.('.toast') || btn;
  if (!toast) return;
  toast.classList.add('removing');
  setTimeout(() => toast.remove(), 300);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Utility Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sanitize(str) {
  if (typeof str !== 'string') return '';
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function validateEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function showFieldError(inputId, errorId, message) {
  const input = document.getElementById(inputId);
  const error = document.getElementById(errorId);
  if (input) input.classList.add('error');
  if (error) {
    error.textContent = message;
    error.classList.add('visible');
  }
  setTimeout(() => {
    if (input) input.classList.remove('error');
    if (error) error.classList.remove('visible');
  }, 3000);
}

function setInputValue(id, value) {
  const el = document.getElementById(id);
  if (el) el.value = value;
}

function animateValue(elementId, start, end, duration) {
  const el = document.getElementById(elementId);
  if (!el) return;

  const startTime = performance.now();
  const diff = end - start;

  function update(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
    const current = Math.round(start + diff * eased);
    el.textContent = current;
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
}

function toggleMobileMenu() {
  const nav = document.getElementById('mobileNav');
  if (nav) nav.classList.toggle('open');
}

function closeMobileMenu() {
  const nav = document.getElementById('mobileNav');
  if (nav) nav.classList.remove('open');
}

function toggleUserMenu() {
  showToast('info', 'Account', 'User menu coming soon!');
}

// Navbar scroll effect
window.addEventListener('scroll', () => {
  const navbar = document.getElementById('mainNavbar');
  if (navbar) {
    navbar.classList.toggle('scrolled', window.scrollY > 20);
  }
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  // Escape to close modals
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
    closeMobileMenu();
  }

  // Ctrl+Enter to submit answer
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && AppState.currentPage === 'interview') {
    e.preventDefault();
    submitAnswer();
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ App Initialization â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initApp() {
  // Load saved settings
  try {
    const savedSettings = localStorage.getItem('evalis_settings');
    if (savedSettings) Object.assign(AppState.settings, JSON.parse(savedSettings));
  } catch (e) { /* ignore */ }

  // Check for OAuth redirect
  const hash = window.location.hash;
  if (hash && hash.includes('access_token')) {
    const params = new URLSearchParams(hash.substring(1));
    const accessToken = params.get('access_token');
    const refreshToken = params.get('refresh_token');
    if (accessToken) {
      supabase.accessToken = accessToken;
      AppState.session = { access_token: accessToken, refresh_token: refreshToken };
      try {
        AppState.user = await supabase.getUser();
      } catch (e) {
        AppState.user = { email: 'user@oauth.com', user_metadata: { first_name: 'User' } };
      }
      saveSession();
      window.history.replaceState(null, '', window.location.pathname);
    }
  }

  // Check existing session
  const hasSession = loadSession();

  // Hide loading screen
  setTimeout(() => {
    const loading = document.getElementById('loadingScreen');
    if (loading) loading.classList.add('hidden');

    if (hasSession && AppState.user) {
      showPage('dashboard');
    } else {
      showPage('login');
    }
  }, 1200);
}

// Start the app
initApp();
</script>

</body>
</html>
