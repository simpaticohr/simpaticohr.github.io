<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employer Portal | Simpatico HR</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: sans-serif; background: #f4f7f9; padding: 20px; }
    .dash-container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
    th { background: #007bff; color: white; }
    .btn-view { background: #28a745; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 13px; }
    .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; background: #e0e0e0; }
  </style>
</head>
<body>
  <div class="dash-container">
    <h2>Employer Dashboard</h2>
    <p id="jobName">Loading candidates...</p>
    <table id="candidateTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Resume</th>
        </tr>
      </thead>
      <tbody id="candidateList"></tbody>
    </table>
  </div>

  <script>
    const SUPABASE_URL = "https://cvkxtsvgnynxexmemfuy.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_DGT-x86M-BwI4zA7S_97CA_3v3O3b0A";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadDashboard() {
      const urlParams = new URLSearchParams(window.location.search);
      const jobId = urlParams.get('job_id');

      if (!jobId) {
        document.getElementById('jobName').textContent = "Error: No Job ID provided.";
        return;
      }

      // 1. Fetch Job Title
      const { data: job } = await supabase.from('jobs').select('title').eq('id', jobId).single();
      if(job) document.getElementById('jobName').textContent = "Candidates for: " + job.title;

      // 2. Fetch Candidates
      const { data: candidates, error } = await supabase
        .from('candidates')
        .select('*')
        .eq('job_id', jobId)
        .order('created_at', { ascending: false });

      const list = document.getElementById('candidateList');
      candidates.forEach(c => {
        list.innerHTML += `
          <tr>
            <td>${c.full_name}</td>
            <td>${c.email}</td>
            <td>${c.phone}</td>
            <td><a href="${c.resume_url}" target="_blank" class="btn-view">View PDF</a></td>
          </tr>`;
      });
    }
    loadDashboard();
  </script>
</body>
</html>
