<script>
document.addEventListener("DOMContentLoaded", () => {

  const questions = [
    "Tell me about yourself.",
    "What skills did you use in your last role?",
    "What was your personal contribution?",
    "What challenges did you face?",
    "What was the outcome?"
  ];

  let index = 0;
  let recognition;
  let isListening = false;

  const questionEl = document.getElementById("question");
  const statusEl = document.getElementById("status");
  const startBtn = document.getElementById("startBtn");

  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  function speak(text) {
    speechSynthesis.cancel();
    questionEl.textContent = text;
    statusEl.textContent = "Speaking…";

    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "en-US";

    utter.onend = () => {
      startListening();
    };

    speechSynthesis.speak(utter);
  }

  function startListening() {
    if (!SpeechRecognition) {
      statusEl.textContent = "Speech not supported";
      return;
    }

    recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.continuous = false;
    recognition.interimResults = false;

    statusEl.textContent = "Listening…";
    isListening = true;

    recognition.onresult = (event) => {
      isListening = false;
      recognition.stop();

      const answer = event.results[0][0].transcript;
      console.log("User:", answer);

      index++;

      if (index < questions.length) {
        speak(questions[index]);
      } else {
        speak("Interview completed. Thank you.");
        statusEl.textContent = "Done";
      }
    };

    recognition.onerror = () => {
      isListening = false;
      statusEl.textContent = "Listening failed, retrying…";
      setTimeout(startListening, 800);
    };

    recognition.start();
  }

  startBtn.onclick = () => {
    startBtn.style.display = "none";
    index = 0;
    speak(questions[0]);
  };

});
</script>
