<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Evalis AI Interview</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
body{
  margin:0;
  background:#020617;
  font-family:system-ui;
  color:#e5e7eb;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  width:380px;
  background:#0f172a;
  border-radius:18px;
  padding:26px;
  border:1px solid #1e293b;
}
h2{text-align:center;margin-top:0}
#status{
  font-size:12px;
  color:#38bdf8;
  text-align:center;
  margin-bottom:8px;
}
#question{
  min-height:60px;
  font-size:15px;
  margin:12px 0;
}
textarea{
  width:100%;
  min-height:90px;
  border-radius:10px;
  border:none;
  padding:10px;
}
button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:#2563eb;
  color:white;
  font-weight:600;
  margin-top:8px;
}
button.secondary{
  background:#1e293b;
}
</style>
</head>

<body>
<div class="card">

<h2>Evalis AI Interview</h2>

<input type="file" id="resumeInput" accept=".pdf,.txt">
<div id="status">Upload resume to begin</div>

<div id="question"></div>

<textarea id="answer" placeholder="Speak or type your answerâ€¦" disabled></textarea>

<button id="micBtn" class="secondary" disabled>ðŸŽ¤ Speak</button>
<button id="nextBtn" disabled>Next</button>

</div>

<script>
/* ---------- PDF SETUP ---------- */
const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc =
 "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

/* ---------- RESUME PARSER (NON-AI) ---------- */
async function parseResume(file){
 let text="";
 if(file.type.includes("pdf")){
   const buf=await file.arrayBuffer();
   const pdf=await pdfjsLib.getDocument(buf).promise;
   for(let i=1;i<=pdf.numPages;i++){
     const page=await pdf.getPage(i);
     const c=await page.getTextContent();
     text+=c.items.map(x=>x.str).join(" ");
   }
 }else{
   text=await file.text();
 }
 text=text.toLowerCase();
 return{
   role:text.match(/(recruiter|hr|developer|engineer|analyst)/)?.[0]||"professional",
   skills:[...text.matchAll(/(python|java|javascript|ai|recruitment|seo|nlp)/g)].map(m=>m[0])
 };
}

/* ---------- INTERVIEW LOGIC ---------- */
function buildQuestions(p){
 return[
  `You worked as a ${p.role}. What were your main responsibilities?`,
  `How did you use ${p.skills[0]||"your skills"} in your work?`,
  `Tell me about a challenge you faced in this role.`,
  `What impact did your work create?`
 ];
}

let questions=[],index=0;

/* ---------- SPEECH ---------- */
const synth=window.speechSynthesis;
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
let recog;

function speak(t){
 synth.cancel();
 const u=new SpeechSynthesisUtterance(t);
 u.onend=()=>status.innerText="Listeningâ€¦";
 status.innerText="Evalis AI Speaking";
 synth.speak(u);
 question.innerText=t;
}

/* ---------- ELEMENTS ---------- */
const resumeInput=document.getElementById("resumeInput");
const status=document.getElementById("status");
const question=document.getElementById("question");
const answer=document.getElementById("answer");
const micBtn=document.getElementById("micBtn");
const nextBtn=document.getElementById("nextBtn");

/* ---------- FLOW ---------- */
resumeInput.onchange=async()=>{
 status.innerText="Parsing resumeâ€¦";
 const profile=await parseResume(resumeInput.files[0]);
 questions=buildQuestions(profile);
 index=0;
 answer.disabled=false;
 micBtn.disabled=false;
 nextBtn.disabled=false;
 speak(questions[0]);
};

/* ---------- MIC ---------- */
micBtn.onclick=()=>{
 if(!SR){
   alert("Use Chrome for voice input");
   return;
 }
 recog=new SR();
 recog.lang="en-US";
 recog.onresult=e=>{
   answer.value=e.results[0][0].transcript;
 };
 recog.start();
};

/* ---------- NEXT ---------- */
nextBtn.onclick=()=>{
 if(answer.value.trim().length<30){
   speak("Can you explain that in more detail?");
   return;
 }
 index++;
 if(index>=questions.length){
   question.innerText="Interview completed âœ…";
   status.innerText="Thank you";
   micBtn.disabled=true;
   nextBtn.disabled=true;
   return;
 }
 speak(questions[index]);
 answer.value="";
};
</script>
</body>
</html>
