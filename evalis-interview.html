<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Evalis AI Interview</title>

<script src="https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.7/dist/bundle.standard.js"></script>

<style>
body {
  margin: 0;
  background: #0f172a;
  font-family: system-ui;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #e5e7eb;
}

.card {
  background: #020617;
  padding: 28px;
  width: 90%;
  max-width: 420px;
  border-radius: 16px;
  text-align: center;
}

#question { font-size: 18px; margin: 16px 0; }
#status { font-size: 14px; color: #22c55e; }

button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #2563eb;
  color: white;
  font-size: 16px;
}
</style>
</head>

<body>
<div class="card">
  <h3>Evalis AI Interview</h3>
  <div id="question">Ready to begin</div>
  <div id="status">Tap Start</div>
  <button id="startBtn">Start Interview</button>
</div>

<script>
const startBtn = document.getElementById("startBtn");
const statusEl = document.getElementById("status");
const questionEl = document.getElementById("question");

startBtn.onclick = async () => {
  startBtn.disabled = true;
  startBtn.innerText = "Startingâ€¦";

  try {
    // ðŸ”¥ THIS MUST BE FIRST
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

    // Now SAFE to create audio APIs
    const synth = window.speechSynthesis;

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "en-US";
    recognition.onresult = (e) => {
      questionEl.innerText = "Thanks. Can you explain more?";
      synth.speak(new SpeechSynthesisUtterance("Thanks. Can you explain more?"));
    };

    const myvad = await vad.MicVAD.new({
      stream,
      onSpeechEnd: () => recognition.start()
    });
    myvad.start();

    startBtn.style.display = "none";
    statusEl.innerText = "Listeningâ€¦";

    const intro = new SpeechSynthesisUtterance("Tell me about yourself.");
    synth.speak(intro);
    questionEl.innerText = "Tell me about yourself.";

  } catch (err) {
    console.error(err);
    statusEl.innerText = "Microphone permission required";
    startBtn.disabled = false;
    startBtn.innerText = "Start Interview";
  }
};
</script>
</body>
</html>
