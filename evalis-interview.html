<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Evalis AI Interview</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background: #0f1115;
  color: white;
  font-family: system-ui;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}
.card {
  background: #181b22;
  padding: 30px;
  border-radius: 16px;
  width: 90%;
  max-width: 400px;
  text-align: center;
}
button {
  padding: 12px 20px;
  border-radius: 12px;
  border: none;
  background: #4f8cff;
  color: white;
  font-size: 16px;
}
#status {
  margin-top: 12px;
  opacity: 0.7;
}
</style>
</head>

<body>
<div class="card">
  <h2 id="question">Tap Start to begin</h2>
  <button id="startBtn">Start Interview</button>
  <div id="status"></div>
</div>

<script>
const WORKER_URL = "https://evalis-ai.simpaticohrrconsultancy.workers.dev";

let recognition;
let listening = false;

function speak(text, done) {
  const msg = new SpeechSynthesisUtterance(text);
  msg.onend = () => done && done();
  speechSynthesis.cancel();
  speechSynthesis.speak(msg);
}

function startListening() {
  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onresult = async (e) => {
    recognition.stop();
    document.getElementById("status").innerText = "Thinking...";

    const answer = e.results[0][0].transcript;

    try {
      const res = await fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ answer })
      });

      const data = await res.json();
      document.getElementById("question").innerText = data.followUp;
      document.getElementById("status").innerText = "";

      speak(data.followUp, startListening);

    } catch (err) {
      document.getElementById("status").innerText = "Network error. Tap Start again.";
    }
  };

  recognition.onerror = () => {
    document.getElementById("status").innerText = "Mic error. Tap Start again.";
  };

  recognition.start();
}

document.getElementById("startBtn").onclick = () => {
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("question").innerText = "Tell me about yourself.";
  speak("Tell me about yourself.", startListening);
};
</script>
</body>
</html>
