<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simpatico HR | AI Interview</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>if(window.pdfjsLib)pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#06090f;--card:#0d1117;--card2:#161b22;--border:#21262d;--accent:#6366f1;--accent2:#bc8cff;--green:#3fb950;--red:#f85149;--yellow:#d29922;--text:#e6edf3;--text2:#8b949e;--glow:rgba(99,102,241,0.15);--tech:#6366f1}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.5}
    body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 20% 0%,rgba(99,102,241,0.06) 0%,transparent 60%),radial-gradient(ellipse at 80% 100%,rgba(188,140,255,0.06) 0%,transparent 60%);z-index:0;pointer-events:none}
    .container{max-width:780px;margin:0 auto;padding:16px;position:relative;z-index:1}

    /* Top Nav */
    .top-nav{backdrop-filter:blur(16px);background:rgba(10,15,30,0.9);padding:14px 6%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.06);position:sticky;top:0;z-index:100}
    .logo-box{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff;font-weight:800;font-size:1.1rem}
    .logo-box img{height:36px;width:36px;border-radius:8px}
    .top-nav-links{display:flex;gap:12px;align-items:center}
    .top-nav-link{color:#94a3b8;text-decoration:none;font-size:13px;font-weight:500;padding:6px 14px;border-radius:8px;transition:all 0.2s}
    .top-nav-link:hover{color:#fff;background:rgba(255,255,255,0.05)}
    .top-nav-link.active{color:#fff;background:rgba(99,102,241,0.15)}

    .header{text-align:center;padding:30px 0 20px}
    .header h1{font-size:2rem;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .header p{color:var(--text2);font-size:0.9rem;margin-top:4px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:14px}
    .card h2{font-size:1rem;font-weight:600;margin-bottom:14px;display:flex;align-items:center;gap:8px}
    label{display:block;font-size:0.8rem;color:var(--text2);margin:12px 0 4px;font-weight:500}
    select,input[type="text"],input[type="email"],input[type="tel"],textarea{width:100%;padding:10px 12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.9rem;outline:none;transition:border-color 0.2s;font-family:inherit}
    select:focus,input:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--glow)}
    textarea{resize:vertical;min-height:80px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .upload-area{border:2px dashed var(--border);border-radius:12px;padding:20px;text-align:center;cursor:pointer;transition:all 0.3s;margin-top:8px}
    .upload-area:hover{border-color:var(--accent);background:rgba(99,102,241,0.03)}
    .upload-area.ok{border-color:var(--green);background:rgba(63,185,80,0.05)}
    .upload-area p{font-size:0.85rem;color:var(--text2)}
    .upload-area strong{color:var(--accent)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 20px;border:none;border-radius:8px;font-size:0.9rem;font-weight:600;cursor:pointer;transition:all 0.2s;color:#fff;font-family:inherit}
    .btn-go{width:100%;padding:14px;font-size:1rem;background:linear-gradient(135deg,var(--accent),var(--accent2));margin-top:16px}
    .btn-go:hover{transform:translateY(-1px);box-shadow:0 6px 20px var(--glow)}
    .btn-go:disabled{opacity:0.4;cursor:not-allowed;transform:none}
    .btn-secondary{background:var(--card2);border:1px solid var(--border);color:var(--text);width:100%;margin-top:8px;padding:12px}
    .btn-secondary:hover{border-color:var(--accent)}
    .btn-end{background:rgba(248,81,73,0.15);color:var(--red);width:100%;margin-top:16px;padding:12px;border-radius:10px;border:none;cursor:pointer;font-family:inherit;font-weight:600}

    /* Interview states */
    .progress-wrap{background:rgba(255,255,255,0.05);border-radius:20px;height:8px;overflow:hidden;margin-bottom:8px}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:20px;transition:width 0.5s;width:0%}
    .progress-info{display:flex;justify-content:space-between;font-size:0.8rem;color:var(--text2);margin-bottom:16px}
    .q-tag{background:rgba(99,102,241,0.15);color:var(--accent);padding:2px 10px;border-radius:12px;font-weight:600}
    .followup-tag{background:rgba(188,140,255,0.15);color:var(--accent2);padding:2px 10px;border-radius:12px;font-weight:600;font-size:0.75rem}
    .orb-container{display:flex;justify-content:center;margin:24px 0 16px}
    .orb{width:110px;height:110px;border-radius:50%;background:radial-gradient(circle at 35% 35%,rgba(99,102,241,0.8),rgba(188,140,255,0.6),rgba(99,102,241,0.3));position:relative;animation:orbFloat 4s ease-in-out infinite;box-shadow:0 0 30px rgba(99,102,241,0.3),0 0 60px rgba(188,140,255,0.15),inset 0 0 30px rgba(255,255,255,0.1);margin:0 auto}
    .orb::before{content:'';position:absolute;inset:-8px;border-radius:50%;border:2px solid transparent;border-top-color:var(--accent);border-right-color:var(--accent2);animation:orbSpin 3s linear infinite}
    .orb::after{content:'';position:absolute;inset:10px;border-radius:50%;background:radial-gradient(circle,rgba(255,255,255,0.2),transparent 70%);animation:orbPulse 2s ease-in-out infinite}
    @keyframes orbFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    @keyframes orbSpin{to{transform:rotate(360deg)}}
    @keyframes orbPulse{0%,100%{opacity:0.5;transform:scale(0.9)}50%{opacity:1;transform:scale(1.1)}}
    .orb.speaking{background:radial-gradient(circle at 35% 35%,rgba(63,185,80,0.9),rgba(99,102,241,0.6),rgba(63,185,80,0.3));box-shadow:0 0 40px rgba(63,185,80,0.4);animation:orbFloat 2s ease-in-out infinite,orbSpeak 0.5s ease-in-out infinite}
    @keyframes orbSpeak{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-4px) scale(1.06)}}
    .orb.listening{background:radial-gradient(circle at 35% 35%,rgba(99,102,241,0.9),rgba(188,140,255,0.8),rgba(99,102,241,0.3));box-shadow:0 0 40px rgba(99,102,241,0.5);animation:orbFloat 2s ease-in-out infinite,orbListen 1s ease-in-out infinite}
    @keyframes orbListen{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-3px) scale(1.04)}}
    .orb.thinking{opacity:0.6;animation:orbFloat 1.5s ease-in-out infinite}
    .orb.processing{background:radial-gradient(circle at 35% 35%,rgba(210,153,34,0.9),rgba(188,140,255,0.6),rgba(210,153,34,0.3));box-shadow:0 0 40px rgba(210,153,34,0.4);animation:orbFloat 1.5s ease-in-out infinite}
    .orb-label{margin-top:12px;font-size:0.8rem;color:var(--text2);letter-spacing:1px;text-align:center}
    .question-box{background:linear-gradient(135deg,rgba(99,102,241,0.08),rgba(188,140,255,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:14px;padding:20px;margin-bottom:16px;font-size:1.05rem;line-height:1.7;min-height:70px;text-align:center}
    .error-box{background:rgba(248,81,73,0.1);border:1px solid rgba(248,81,73,0.3);border-radius:10px;padding:12px;margin-bottom:12px;font-size:0.85rem;color:var(--red);display:none}
    .error-box.show{display:block}
    .thinking{display:flex;align-items:center;justify-content:center;gap:8px;color:var(--text2);font-size:0.85rem;margin:12px 0}
    .thinking-dots span{display:inline-block;width:6px;height:6px;background:var(--accent);border-radius:50%;animation:dot 1.2s infinite}
    .thinking-dots span:nth-child(2){animation-delay:0.2s}
    .thinking-dots span:nth-child(3){animation-delay:0.4s}
    @keyframes dot{0%,100%{opacity:0.2;transform:scale(0.8)}50%{opacity:1;transform:scale(1.3)}}
    .silence-bar-wrap{width:80%;max-width:300px;margin:12px auto;text-align:center;display:none}
    .silence-bar-wrap.show{display:block}
    .silence-bar{height:4px;background:var(--card2);border-radius:2px;overflow:hidden}
    .silence-fill{height:100%;background:var(--accent);border-radius:2px;transition:width 0.3s linear;width:100%}
    .silence-text{font-size:0.75rem;color:var(--text2);margin-top:4px}
    .wave-wrap{display:flex;justify-content:center;align-items:center;gap:3px;height:40px;margin:12px 0}
    .wave-bar{width:4px;height:8px;background:var(--accent);border-radius:4px}
    .wave-wrap.active .wave-bar{animation:wave 0.8s ease-in-out infinite alternate}
    .wave-bar:nth-child(1){animation-delay:0s}.wave-bar:nth-child(2){animation-delay:0.1s}.wave-bar:nth-child(3){animation-delay:0.2s}.wave-bar:nth-child(4){animation-delay:0.3s}.wave-bar:nth-child(5){animation-delay:0.4s}.wave-bar:nth-child(6){animation-delay:0.3s}.wave-bar:nth-child(7){animation-delay:0.2s}.wave-bar:nth-child(8){animation-delay:0.1s}.wave-bar:nth-child(9){animation-delay:0s}
    @keyframes wave{from{height:8px}to{height:36px}}
    .timer{text-align:center;font-size:1.4rem;font-weight:700;font-variant-numeric:tabular-nums;margin:8px 0}
    .hf-info{text-align:center;font-size:0.8rem;color:var(--text2);padding:8px;background:rgba(99,102,241,0.05);border-radius:8px;margin-bottom:12px}
    .status-bar{display:flex;align-items:center;justify-content:center;gap:6px;font-size:0.8rem;color:var(--text2);margin-bottom:12px}
    .status-dot{width:8px;height:8px;border-radius:50%;background:var(--green);animation:blink 2s infinite}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}

    /* Results */
    .score-ring{width:150px;height:150px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}
    .score-num{font-size:2.2rem;font-weight:800}
    .score-max{font-size:0.9rem;color:var(--text2)}
    .grade-badge{display:inline-block;padding:4px 16px;border-radius:16px;font-weight:700;font-size:0.85rem;margin-bottom:12px}
    .hire-badge{display:inline-block;padding:6px 20px;border-radius:20px;font-weight:700;font-size:0.9rem;margin-bottom:16px}
    .summary-section{margin-bottom:16px}
    .summary-section h3{font-size:0.9rem;margin-bottom:8px;display:flex;align-items:center;gap:6px}
    .summary-list{list-style:none;padding:0}
    .summary-list li{padding:6px 0;font-size:0.85rem;color:var(--text2);border-bottom:1px solid var(--border);display:flex;align-items:flex-start;gap:8px}
    .summary-list li:last-child{border-bottom:none}
    .fb-item{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px}
    .fb-item .fb-q{font-weight:600;color:var(--accent);margin-bottom:4px;font-size:0.9rem}
    .fb-item .fb-a{font-size:0.8rem;color:var(--text2);margin-bottom:6px;font-style:italic;opacity:0.8}
    .fb-item .fb-score{font-size:0.75rem;padding:2px 8px;border-radius:8px;display:inline-block;margin-bottom:6px}
    .fb-item .fb-text{font-size:0.85rem;color:var(--text2);line-height:1.5}
    .fb-item .fb-type{font-size:0.7rem;padding:1px 6px;border-radius:4px;display:inline-block;margin-left:6px}

    /* Proctoring */
    .proctor-bar{background:rgba(248,81,73,0.1);border:1px solid rgba(248,81,73,0.2);border-radius:10px;padding:10px 16px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;font-size:0.8rem}
    .proctor-cam{width:120px;height:90px;border-radius:8px;border:2px solid var(--border);overflow:hidden;position:fixed;bottom:16px;right:16px;z-index:100;background:#000}
    .proctor-cam video{width:100%;height:100%;object-fit:cover}
    .proctor-cam .cam-label{position:absolute;bottom:2px;left:4px;font-size:0.6rem;color:rgba(255,255,255,0.7);background:rgba(0,0,0,0.5);padding:1px 4px;border-radius:3px}
    .violation-item{display:flex;align-items:center;gap:8px;padding:6px 10px;background:rgba(248,81,73,0.08);border-radius:6px;margin-bottom:4px;font-size:0.78rem;color:var(--red)}
    .screen-share-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;padding:20px}
    .screen-share-overlay h2{color:var(--text)}
    .screen-share-overlay p{color:var(--text2);font-size:0.9rem;max-width:400px;text-align:center;line-height:1.6}

    /* Locked state */
    .locked-card{background:var(--card);border:2px solid var(--border);border-radius:16px;padding:40px 24px;text-align:center}
    .locked-card .lock-icon{font-size:3rem;margin-bottom:16px;opacity:0.5}
    .locked-card h2{font-size:1.3rem;margin-bottom:8px}
    .locked-card p{color:var(--text2);font-size:0.9rem;line-height:1.6;max-width:400px;margin:0 auto}
    .token-input-wrap{max-width:400px;margin:20px auto 0;display:flex;gap:8px}
    .token-input-wrap input{flex:1}
    .token-input-wrap button{padding:10px 20px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-family:inherit}

    .toast-box{position:fixed;top:16px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px}
    .toast{background:var(--card);border:1px solid var(--border);color:var(--text);padding:10px 18px;border-radius:10px;font-size:0.85rem;box-shadow:0 8px 24px rgba(0,0,0,0.4);animation:tIn 0.3s ease,tOut 0.3s ease 2.7s forwards}
    @keyframes tIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes tOut{to{transform:translateX(120%);opacity:0}}
    .hidden{display:none!important}
    .loading{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .footer{text-align:center;padding:30px 0;margin-top:40px;border-top:1px solid rgba(255,255,255,0.04);font-size:12px;color:#475569;position:relative;z-index:1}
    .footer a{color:var(--tech);text-decoration:none}

    @media(max-width:600px){
      .container{padding:10px}.header h1{font-size:1.5rem}
      .row2{grid-template-columns:1fr}
      .orb{width:90px;height:90px}
      .proctor-cam{width:80px;height:60px}
      .top-nav{padding:10px 4%;flex-wrap:wrap;gap:8px}
      .logo-box{font-size:0.95rem}
      .logo-box img{height:28px;width:28px}
      .top-nav-links{gap:6px}
      .top-nav-link{font-size:11px;padding:4px 8px}
      .token-input-wrap{flex-direction:column}
    }
  </style>
</head>
<body>

<!-- TOP NAV -->
<nav class="top-nav">
  <a href="index.html" class="logo-box">
    <img src="favicon-96x96.png" height="36" alt="Simpatico HR">
    <span>SIMPATICO <span style="color:var(--tech)">HR</span></span>
  </a>
  <div class="top-nav-links">
    <a class="top-nav-link" href="jobs.html">ğŸ’¼ Jobs</a>
    <a class="top-nav-link" href="career-lab.html">ğŸ§  Career Lab</a>
    <a class="top-nav-link active" href="evalis-interview.html">ğŸ¤ Interview</a>
    <a class="top-nav-link" href="index.html">Home</a>
  </div>
</nav>

<div class="toast-box" id="toasts"></div>
<div class="container">
  <div class="header">
    <h1>ğŸ¤ AI Interview Platform</h1>
    <p>Proctored â€¢ AI-Powered â€¢ by Simpatico HR</p>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- LANDING: TOKEN REQUIRED -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="page-landing">
    <div class="locked-card">
      <div class="lock-icon">ğŸ”’</div>
      <h2>Interview Access Required</h2>
      <p>This interview platform is available only to <strong>shortlisted candidates</strong>. If you've been invited, paste your interview token below.</p>
      <div class="token-input-wrap">
        <input type="text" id="tokenInput" placeholder="Paste your interview token...">
        <button onclick="validateToken()">Enter â†’</button>
      </div>
      <p style="margin-top:20px;font-size:0.82rem;color:var(--text2);">
        Don't have a token? <a href="jobs.html" style="color:var(--accent);text-decoration:none;font-weight:600;">Browse jobs & apply first â†’</a>
      </p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- INTERVIEW SETUP (shown after valid token) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="page-setup" class="hidden">
    <div class="card">
      <h2>âš™ï¸ Interview Setup</h2>
      <div style="text-align:center;margin-bottom:14px;">
        <span style="background:rgba(248,81,73,0.15);color:var(--red);padding:6px 16px;border-radius:12px;font-weight:700;font-size:0.85rem;">ğŸ”’ PROCTORED INTERVIEW</span>
      </div>
      <div id="interviewInfo" style="background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;"></div>
      <label>ğŸŒ Language</label>
      <select id="langSel">
        <option value="en">English</option>
        <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€ (Hindi)</option>
        <option value="ml">à´®à´²à´¯à´¾à´³à´‚ (Malayalam)</option>
        <option value="ta">à®¤à®®à®¿à®´à¯ (Tamil)</option>
        <option value="te">à°¤à±†à°²à±à°—à± (Telugu)</option>
        <option value="kn">à²•à²¨à³à²¨à²¡ (Kannada)</option>
        <option value="bn">à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)</option>
        <option value="es">EspaÃ±ol (Spanish)</option>
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</option>
        <option value="fr">FranÃ§ais (French)</option>
        <option value="de">Deutsch (German)</option>
        <option value="ur">Ø§Ø±Ø¯Ùˆ (Urdu)</option>
      </select>
    </div>
    <div class="card">
      <h2>ğŸ“„ Resume (Optional)</h2>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Upload for personalized questions based on your experience.</p>
      <div class="upload-area" id="cvUpArea" onclick="document.getElementById('cvFile').click()">
        <p>ğŸ“‚ Upload <strong>PDF, DOC, TXT</strong></p>
        <p id="cvFileName" style="font-size:0.78rem;color:var(--text2);margin-top:4px;">No file</p>
        <input type="file" id="cvFile" accept=".pdf,.doc,.docx,.txt" hidden>
      </div>
    </div>
    <div class="card">
      <h2>ğŸ”’ Proctoring Requirements</h2>
      <div style="font-size:0.85rem;color:var(--text2);line-height:1.8;">
        <p>âœ… Screen sharing â€” entire screen monitored</p>
        <p>âœ… Camera â€” face must be visible</p>
        <p>âœ… Tab switching â€” flagged as violation</p>
        <p>âœ… Copy/Paste â€” disabled</p>
        <p>âœ… Single attempt â€” cannot restart</p>
        <p style="margin-top:8px;color:var(--yellow);">âš ï¸ 3+ violations = auto-termination</p>
      </div>
    </div>
    <button class="btn btn-go" id="startBtn" onclick="startInterview()">ğŸš€ Start Proctored Interview</button>
  </div>

  <!-- SCREEN SHARE OVERLAY -->
  <div id="screenShareOverlay" class="screen-share-overlay hidden">
    <h2>ğŸ–¥ï¸ Screen Share Required</h2>
    <p>Share your <strong>entire screen</strong> to begin your proctored interview.</p>
    <button class="btn btn-go" style="width:auto;padding:14px 40px;" onclick="requestScreenShare()">ğŸ“º Share Screen</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- LIVE INTERVIEW -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="page-live" class="hidden">
    <div class="card">
      <div class="proctor-bar" id="proctorBar"><div style="display:flex;align-items:center;gap:4px;color:var(--green);"><div class="status-dot"></div>Proctored</div><div>âš ï¸ Violations: <span id="violationCount" style="color:var(--red);font-weight:700;">0</span>/3</div></div>
      <div class="progress-wrap"><div class="progress-fill" id="progBar"></div></div>
      <div class="progress-info"><span id="progText">Question 1 of 10</span><span class="q-tag" id="qTag">Q1</span></div>
      <div class="status-bar"><div class="status-dot"></div><span>Interview Active</span></div>
      <div class="orb-container"><div><div class="orb" id="orb"></div><div class="orb-label" id="orbLabel">Preparing...</div></div></div>
      <div class="error-box" id="errorBox"></div>
      <div class="question-box" id="questionBox">Preparing your first question...</div>
      <div class="thinking hidden" id="thinkBox"><div class="thinking-dots"><span></span><span></span><span></span></div><span>Analyzing...</span></div>
      <div class="hf-info" id="hfInfo">ğŸ¤ Hands-free â€” Speak naturally. Auto-submits after pause.</div>
      <div class="wave-wrap" id="waveWrap"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>
      <div class="silence-bar-wrap" id="silenceWrap"><div class="silence-bar"><div class="silence-fill" id="silenceFill"></div></div><div class="silence-text" id="silenceText"></div></div>
      <div class="timer" id="timer">00:00</div>
      <button class="btn-end" onclick="endEarly()">â¹ End Interview Early</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="page-results" class="hidden">
    <div class="card" style="text-align:center;">
      <h2 style="justify-content:center;">ğŸ† Interview Complete!</h2>
      <div class="score-ring" id="scoreRing"><div style="text-align:center"><div class="score-num" id="scoreNum">0</div><div class="score-max">/ 100</div></div></div>
      <div id="gradeBadge" class="grade-badge">â€”</div><br>
      <div id="hireBadge" class="hire-badge" style="display:none;"></div>
      <p id="scoreSummary" style="color:var(--text2);margin-bottom:20px;line-height:1.6;"></p>
      <div id="retryWrap" style="display:none;"><button class="btn btn-secondary" onclick="retryEvaluation()">ğŸ”„ Retry Evaluation</button></div>
    </div>
    <div class="card" id="violationsCard" style="display:none;"><h2>ğŸ” Proctoring Report</h2><div id="violationsList"></div></div>
    <div class="card" id="strengthsCard" style="display:none;">
      <div class="summary-section"><h3>ğŸ’ª Strengths</h3><ul class="summary-list" id="strengthsList"></ul></div>
      <div class="summary-section"><h3>ğŸ“ˆ Improvements</h3><ul class="summary-list" id="improveList"></ul></div>
    </div>
    <div class="card"><h2>ğŸ“ Detailed Feedback</h2><div id="fbList"></div></div>
    <button class="btn btn-go" onclick="window.location.href='jobs.html'">ğŸ’¼ Back to Jobs</button>
  </div>
</div>

<!-- Proctor Cam -->
<div class="proctor-cam hidden" id="proctorCam"><video id="proctorVideo" autoplay muted playsinline></video><div class="cam-label">ğŸ”´ REC</div></div>

<!-- Footer -->
<div class="footer">Â© 2025 <a href="index.html">Simpatico HR Consultancy</a> â€¢ AI Interview Platform</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const W="https://api.simpaticohr.in";
const SILENCE_TIMEOUT=3.0,MIN_ANS=10,MAX_RETRIES=3,MAX_VIOLATIONS=3;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let cv="",lang="en",role="",level="",totalQ=10;
let mainQ=0,isFollowUp=false,chat=[],answers=[];
let rec=null,transcript="",timerInt=null,secs=0;
let listening=false,silTimer=null,lastSpeech=0;
let speaking=false,processing=false,ansStart=0;
let evalRetry=0,violations=[],screenStr=null,camStr=null;
let curJobId=null,curAppId=null,curToken=null,curInterview=null;

const L={en:{s:"en-US",t:"en-US",n:"English"},hi:{s:"hi-IN",t:"hi-IN",n:"Hindi"},ml:{s:"ml-IN",t:"ml-IN",n:"Malayalam"},ta:{s:"ta-IN",t:"ta-IN",n:"Tamil"},te:{s:"te-IN",t:"te-IN",n:"Telugu"},kn:{s:"kn-IN",t:"kn-IN",n:"Kannada"},bn:{s:"bn-IN",t:"bn-IN",n:"Bengali"},es:{s:"es-ES",t:"es-ES",n:"Spanish"},ar:{s:"ar-SA",t:"ar-SA",n:"Arabic"},fr:{s:"fr-FR",t:"fr-FR",n:"French"},de:{s:"de-DE",t:"de-DE",n:"German"},ur:{s:"ur-PK",t:"ur-PK",n:"Urdu"}};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 1: The API helper needs to handle worker response format
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function api(method, path, body = null, auth = false) {
  const opts = { method, headers: { 'Content-Type': 'application/json' } };
  if (auth && HR_TOKEN) opts.headers['Authorization'] = 'Bearer ' + HR_TOKEN;
  if (body) opts.body = JSON.stringify(body);
  const r = await fetch(W + path, opts);
  const d = await r.json();
  if (d.error) throw new Error(d.error);
  return d;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 2: HR Login â€” worker returns {token, user} not {success, token}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function hrLogin() {
  const email = document.getElementById('hrLoginEmail').value.trim();
  const pass = document.getElementById('hrLoginPass').value.trim();
  if (!email || !pass) { toast('âŒ Enter credentials'); return; }

  const btn = document.getElementById('hrLoginBtn');
  btn.disabled = true; btn.textContent = 'â³ Logging in...';
  document.getElementById('hrLoginError').style.display = 'none';

  try {
    const data = await api('POST', '/auth/login', { email, password: pass });

    // â˜… FIX: Worker returns {token, user, client} â€” check for token
    if (!data.token) throw new Error(data.error || 'Login failed');

    // Must be client_admin or hr
    if (!['client_admin', 'hr'].includes(data.user.role)) {
      throw new Error('HR or Admin role required');
    }

    HR_TOKEN = data.token;
    HR_USER = data.user;
    localStorage.setItem('hr_token', HR_TOKEN);
    localStorage.setItem('hr_user', JSON.stringify(HR_USER));

    showHRDashboard();
    toast('âœ… Welcome, ' + (data.user.name || 'HR') + '!');
  } catch (e) {
    document.getElementById('hrLoginError').textContent = 'âŒ ' + e.message;
    document.getElementById('hrLoginError').style.display = 'block';
  }
  btn.disabled = false; btn.textContent = 'ğŸ”“ Login';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3: HR Stats â€” worker returns nested object, not flat
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadHRStats() {
  try {
    const data = await api('GET', '/client/stats', null, true);
    // â˜… FIX: Match the actual worker response structure
    const stats = data.stats || {};
    document.getElementById('statJobs').textContent = stats.jobs?.total || 0;
    document.getElementById('statApps').textContent = stats.applications?.total || 0;
    document.getElementById('statShort').textContent = stats.applications?.byStatus?.shortlisted || 0;
    document.getElementById('statInt').textContent = stats.applications?.byStatus?.hired || 0;
  } catch (e) { console.error('[Stats]', e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 4: loadHRJobs â€” response is {jobs: [...]}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadHRJobs() {
  const el = document.getElementById('hrJobsList');
  el.innerHTML = '<span class="loading"></span>';
  try {
    const data = await api('GET', '/client/jobs', null, true);
    const jobs = data.jobs || [];
    if (!jobs.length) {
      el.innerHTML = '<p style="color:var(--muted);text-align:center;">No jobs posted yet.</p>';
      return;
    }
    el.innerHTML = jobs.map(j => `<div class="job-card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3>${j.title}</h3>
        <span class="status-pill" style="background:${j.is_active ? 'rgba(16,185,129,.15)' : 'rgba(239,68,68,.15)'};color:${j.is_active ? '#10b981' : '#ef4444'};">${j.is_active ? 'Active' : 'Inactive'}</span>
      </div>
      <div class="job-meta">
        <span>ğŸ“ ${j.location || 'Remote'}</span>
        <span>ğŸ’¼ ${j.job_type || ''}</span>
        <span>ğŸ“ ${j.app_count || 0} applications</span>
        ${j.new_count ? '<span style="color:var(--yellow);">ğŸ†• ' + j.new_count + ' new</span>' : ''}
      </div>
      <div style="display:flex;gap:6px;margin-top:8px;">
        <button class="btn btn-sm btn-danger" onclick="deleteJob('${j.id}')">ğŸ—‘ï¸ Delete</button>
      </div>
    </div>`).join('');
  } catch (e) {
    el.innerHTML = '<p style="color:var(--red);">âŒ ' + e.message + '</p>';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 5: postJob â€” use proper endpoint and field names
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function postJob() {
  const title = document.getElementById('hrTitle').value.trim();
  if (!title) { toast('âŒ Enter job title'); return; }

  const btn = document.getElementById('postJobBtn');
  btn.disabled = true; btn.textContent = 'â³ Posting...';

  try {
    await api('POST', '/client/jobs', {
      title,
      job_type: document.getElementById('hrJobType').value,
      department: document.getElementById('hrDept').value.trim(),
      location: document.getElementById('hrLocation').value.trim(),
      level: document.getElementById('hrLevel').value,
      description: document.getElementById('hrJD').value.trim(),
      skills: document.getElementById('hrSkills').value.trim(),
      salary_min: document.getElementById('hrSalaryMin').value.trim(),
      salary_max: document.getElementById('hrSalaryMax').value.trim()
    }, true);
    toast('âœ… Job posted!');
    ['hrTitle', 'hrJD', 'hrSkills', 'hrDept', 'hrLocation', 'hrSalaryMin', 'hrSalaryMax'].forEach(k =>
      document.getElementById(k).value = ''
    );
    loadHRJobs();
    loadHRStats();
  } catch (e) { toast('âŒ ' + e.message); }
  btn.disabled = false; btn.textContent = 'ğŸ“¢ Post Job';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 6: Application submission â€” match worker response
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitApplication() {
  const name = document.getElementById('applyName').value.trim();
  const email = document.getElementById('applyEmail').value.trim();
  if (!name || !email) { toast('âŒ Name & Email required'); return; }
  if (!curJobId) { toast('âŒ Select a job first'); return; }

  const btn = document.getElementById('applyBtn');
  btn.disabled = true; btn.textContent = 'â³ Submitting...';
  const st = document.getElementById('applyStatus');
  st.textContent = '';

  try {
    const result = await api('POST', '/jobs/' + curJobId + '/apply', {
      name: name,
      email: email,
      phone: document.getElementById('applyPhone').value.trim(),
      cover_letter: document.getElementById('applyCover').value.trim(),
      resume_text: cv || '',
      source: 'website'
    });

    // â˜… FIX: Worker returns {application, message}
    st.innerHTML = '<span style="color:var(--green);">âœ… ' + (result.message || 'Application submitted!') + '</span>';
    toast('âœ… Applied successfully!');

    // Reset form
    ['applyName', 'applyEmail', 'applyPhone', 'applyCover'].forEach(k =>
      document.getElementById(k).value = ''
    );
    document.getElementById('applyFileName').textContent = 'No file';
    document.getElementById('applyUpload').classList.remove('ok');
    cv = '';
    _resumeFile = null;
  } catch (err) {
    st.innerHTML = '<span style="color:var(--red);">âŒ ' + err.message + '</span>';
  }
  btn.disabled = false; btn.textContent = 'ğŸ“¨ Submit Application';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 7: Token validation for real interviews
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function checkToken() {
  const params = new URLSearchParams(location.search);
  const token = params.get('token');
  if (location.hash === '#hr') { nav('hr'); return; }
  if (!token) return;

  toast('ğŸ”’ Token detected...');
  try {
    // â˜… FIX: Use /interviews/validate instead of /db
    const data = await api('POST', '/interviews/validate', { token });

    if (!data.interview) { toast('âŒ Invalid token'); return; }

    const d = data.interview;
    mode = 'real';
    curAppId = d.application_id || null;
    curJobId = d.job_id || null;

    startMode('real');

    if (d.role) {
      // Try to set dropdown, fallback to custom
      const sel = document.getElementById('roleSel');
      const opt = Array.from(sel.options).find(o => o.value === d.role);
      if (opt) {
        sel.value = d.role;
      } else {
        sel.value = 'custom';
        document.getElementById('customWrap').classList.remove('hidden');
        document.getElementById('customRole').value = d.role;
      }
      role = d.role;
    }
    if (d.level) document.getElementById('levelSel').value = d.level;
    if (d.questions) document.getElementById('qCount').value = d.questions;
    if (d.language) document.getElementById('langSel').value = d.language;

    // Set candidate info
    if (d.candidate_name) document.getElementById('candName').value = d.candidate_name;
    if (d.resume_text) {
      cv = d.resume_text;
      document.getElementById('cvFileName').textContent = 'âœ… Resume loaded';
      document.getElementById('cvUpArea').classList.add('ok');
    }

    document.getElementById('candToken').value = token;
    toast('âœ… Ready! Click Start.');
  } catch (e) { toast('âŒ ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 8: Save results using /interviews/submit
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function saveResults(r) {
  try {
    const token = document.getElementById('candToken')?.value ||
                  new URLSearchParams(location.search).get('token');

    if (token) {
      // â˜… FIX: Use proper /interviews/submit endpoint
      await api('POST', '/interviews/submit', {
        token: token,
        score: r.overallScore,
        grade: r.grade,
        recommendation: r.recommendation,
        summary: r.summary,
        strengths: r.strengths || [],
        improvements: r.improvements || [],
        feedback: r.feedback || [],
        answers: answers,
        violations: violations.length,
        violation_log: violations,
        duration: secs,
        started_at: new Date(Date.now() - secs * 1000).toISOString()
      });
      console.log('[SUBMIT] Results saved');
    }
  } catch (e) {
    console.error('[SUBMIT]', e.message);
  }
}
</script>
</body>
</html>
