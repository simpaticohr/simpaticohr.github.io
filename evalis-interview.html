<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Evalis AI â€“ Voice Interview</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body {
    background: #0b0f14;
    color: #fff;
    font-family: system-ui, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .card {
    width: 90%;
    max-width: 420px;
    background: #121821;
    padding: 24px;
    border-radius: 18px;
    text-align: center;
  }
  #question {
    font-size: 1.3rem;
    margin-bottom: 12px;
  }
  #status {
    font-size: 0.9rem;
    opacity: 0.7;
  }
  .orb {
    width: 90px;
    height: 90px;
    margin: 20px auto;
    border-radius: 50%;
    background: radial-gradient(circle, #4f9cff, #1e3a8a);
    animation: idle 3s infinite;
  }
  .listening {
    animation: pulse 1.2s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }
  @keyframes idle {
    0% { opacity: .7; }
    50% { opacity: 1; }
    100% { opacity: .7; }
  }
</style>
</head>

<body>
<div class="card">
  <div class="orb" id="orb"></div>
  <div id="question">Tap to start interview</div>
  <div id="status">Idle</div>
</div>

<script>
const WORKER_URL = "https://YOUR-WORKER.workers.dev";

let state = "introduction";
let history = [];
let recognition;
let speaking = false;

/* ---------- SPEAK ---------- */
function speak(text) {
  speaking = true;
  document.getElementById("status").innerText = "Speaking...";
  const utter = new SpeechSynthesisUtterance(text);
  utter.onend = () => {
    speaking = false;
    startListening();
  };
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

/* ---------- LISTEN ---------- */
function startListening() {
  if (speaking) return;

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.continuous = false;
  recognition.interimResults = false;

  document.getElementById("orb").classList.add("listening");
  document.getElementById("status").innerText = "Listening...";

  recognition.onresult = async (e) => {
    const answer = e.results[0][0].transcript;
    recognition.stop();
    document.getElementById("status").innerText = "Thinking...";

    const res = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ answer, state })
    });

    const data = await res.json();
    state = data.nextState || state;
    history.push(answer);

    document.getElementById("question").innerText = data.followUp;
    speak(data.followUp);
  };

  recognition.onerror = () => {
    recognition.stop();
    setTimeout(startListening, 800);
  };

  recognition.start();
}

/* ---------- START ---------- */
document.body.addEventListener("click", () => {
  if (!speaking && !recognition) {
    const first = "Tell me about yourself.";
    document.getElementById("question").innerText = first;
    speak(first);
  }
});
</script>
</body>
</html>
