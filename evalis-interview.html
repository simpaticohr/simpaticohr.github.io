<script>
const WORKER_URL = "https://evalis-ai.simpaticohrconsultancy.workers.dev";

let isThinking = false;
let currentState = "introduction";

async function sendAnswer(answer) {
  if (isThinking || !answer) return;

  isThinking = true;
  setThinking(true);

  try {
    const res = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        answer: answer.trim(),
        state: currentState
      })
    });

    if (!res.ok) throw new Error("Network error");

    const data = await res.json();

    // ðŸ”Š Speak next question
    speak(data.followUp || "Tell me more about that.");

    // ðŸ§  Advance interview state (NOT index)
    currentState = data.nextState || currentState;

  } catch (err) {
    console.error(err);
    speak("Sorry, please repeat that.");
  } finally {
    isThinking = false;
    setThinking(false);
  }
}

function setThinking(on) {
  const el = document.getElementById("thinking");
  if (el) el.textContent = on ? "Thinking..." : "";
}
</script>
