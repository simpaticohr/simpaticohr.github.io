<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evalis AI Interview</title>

<style>
:root { --primary:#6366f1; --bg:#020617; }
body {
  margin:0; background:var(--bg); color:#fff;
  font-family:system-ui,sans-serif;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh;
}
.card {
  width:90%; max-width:440px;
  background:rgba(255,255,255,.05);
  backdrop-filter:blur(16px);
  border-radius:22px;
  padding:28px;
  border:1px solid rgba(255,255,255,.1);
}
#timer { color:var(--primary); font-size:24px; font-weight:700; }
#status { font-size:12px; color:#94a3b8; margin:10px 0 20px; }
.btn {
  width:100%; padding:15px;
  border:none; border-radius:14px;
  background:var(--primary);
  color:white; font-weight:700;
  margin-top:10px;
}
.btn.danger { background:#ef4444 }
#log { margin-top:20px; font-size:14px }
</style>
</head>

<body>
<div class="card">
  <div id="timer">15:00</div>
  <div id="status">Upload Resume to Start</div>

  <input id="cvInput" type="file" accept=".pdf">
  <button id="startBtn" class="btn" disabled>Start Interview</button>
  <button id="endBtn" class="btn danger" style="display:none">End Interview</button>

  <div id="log"></div>
</div>

<script>
let cvText = "";
let interviewActive = false;

/* ---------- FILE PICKER ---------- */
document.getElementById("cvInput").onchange = async e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    cvText = reader.result;
    document.getElementById("startBtn").disabled = false;
    document.getElementById("status").innerText = "Resume Ready";
  };
  reader.readAsText(file);
};

/* ---------- START INTERVIEW ---------- */
document.getElementById("startBtn").onclick = () => {

  if (!cvText || cvText.length < 50) {
    alert("Upload a valid resume");
    return;
  }

  if (typeof Android === "undefined") {
    alert("Android bridge missing");
    return;
  }

  interviewActive = true;

  document.getElementById("cvInput").style.display = "none";
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("endBtn").style.display = "block";
  document.getElementById("status").innerText = "Connecting to AI…";

  // unlock audio
  try {
    speechSynthesis.speak(new SpeechSynthesisUtterance(""));
  } catch(e){}

  Android.startInterview(cvText);
};

/* ---------- END ---------- */
document.getElementById("endBtn").onclick = () => {
  interviewActive = false;
  Android.endInterview();
};

/* ---------- ANDROID → JS CALLBACKS ---------- */
window.onAIReply = text => {
  document.getElementById("status").innerText = "Listening…";
  speak(text);
};

window.onInterviewEnd = report => {
  document.body.innerHTML = `
    <div class="card">
      <h2 style="color:#6366f1">Final Report</h2>
      <pre>${report}</pre>
      <button class="btn" onclick="location.reload()">New Session</button>
    </div>`;
};

/* ---------- TTS ---------- */
function speak(text) {
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  speechSynthesis.speak(u);

  const d = document.createElement("div");
  d.innerHTML = `<p><b>AI:</b> ${text}</p>`;
  document.getElementById("log").prepend(d);
}
</script>
</body>
</html>
