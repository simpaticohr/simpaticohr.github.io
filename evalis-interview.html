<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Evalis Interview</title>
</head>
<body>

<h2 id="question">Ready</h2>
<p id="status"></p>
<button id="startBtn">Start Interview</button>

<script>
const profile = JSON.parse(localStorage.getItem("profile") || "{}");

const QUESTIONS = profile.role?.toLowerCase().includes("recruit")
  ? ["Tell me about a difficult hiring case you handled."]
  : ["Tell me about a recent project you worked on."];

let depth = 0;
let currentQuestion = QUESTIONS[0];

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

function speak(text) {
  question.textContent = text;
  const u = new SpeechSynthesisUtterance(text);
  u.onend = listen;
  speechSynthesis.speak(u);
}

function listen() {
  if (!SpeechRecognition) {
    status.textContent = "Speech not supported";
    return;
  }

  const rec = new SpeechRecognition();
  rec.lang = "en-US";
  status.textContent = "Listeningâ€¦";

  rec.onresult = e => {
    rec.stop();
    depth++;

    if (depth < 3) {
      speak("Can you explain that in more detail?");
    } else {
      speak("Thank you. Interview completed.");
    }
  };

  rec.start();
}

startBtn.onclick = () => {
  startBtn.style.display = "none";
  speak(currentQuestion);
};
</script>

</body>
</html>
