<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Evalis AI - Elite Live Interview</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root { --primary: #6366f1; --bg: #020617; --danger: #ef4444; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg);
            color: white;
            font-family: system-ui, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 16px;
        }

        .card {
            width: 100%;
            max-width: 440px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 28px 24px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        #timer {
            font-size: 40px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
            font-variant-numeric: tabular-nums;
        }
        #timer.warn { color: var(--danger); }

        #status {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            min-height: 18px;
        }

        .wave-box {
            height: 60px;
            margin: 12px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        canvas { width: 100%; height: 60px; display: block; }

        /* Upload */
        .upload-area {
            border: 1.5px dashed rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 14px;
            cursor: pointer;
            position: relative;
            transition: border-color 0.2s;
        }
        .upload-area.ready { border-color: var(--primary); background: rgba(99,102,241,0.08); }
        .upload-area input {
            position: absolute; inset: 0; opacity: 0;
            cursor: pointer; width: 100%; height: 100%;
        }
        .upload-icon { font-size: 26px; margin-bottom: 4px; }
        .upload-label { font-size: 12px; color: #64748b; }
        .upload-name { font-size: 12px; color: var(--primary); margin-top: 4px; }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: none;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            margin-bottom: 10px;
        }
        .btn:active { transform: scale(0.97); }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }

        #startBtn { background: var(--primary); color: white; }
        #endBtn   { background: var(--danger); color: white; display: none; }

        /* Push-to-talk */
        #pttBtn {
            width: 100%;
            padding: 22px;
            border-radius: 14px;
            border: 2px solid rgba(99,102,241,0.4);
            background: rgba(99,102,241,0.08);
            color: var(--primary);
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            display: none;
            margin-bottom: 10px;
            transition: all 0.15s;
            user-select: none;
            -webkit-user-select: none;
        }
        #pttBtn.recording {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 24px rgba(99,102,241,0.5);
        }

        /* Error */
        .error {
            background: rgba(239,68,68,0.1);
            border: 1px solid rgba(239,68,68,0.3);
            color: #fca5a5;
            border-radius: 10px;
            padding: 12px;
            font-size: 12px;
            margin-bottom: 12px;
            display: none;
            line-height: 1.5;
            text-align: left;
        }

        /* Log */
        #log {
            margin-top: 16px;
            max-height: 220px;
            overflow-y: auto;
            border-top: 1px solid #1e293b;
            padding-top: 14px;
            text-align: left;
        }
        .entry { margin-bottom: 12px; font-size: 13px; line-height: 1.5; }
        .entry.ai  { color: #a5b4fc; }
        .entry.you { color: #94a3b8; }
        .entry b   { font-size: 10px; letter-spacing: 1px; opacity: 0.6; display: block; margin-bottom: 2px; }

        /* Text fallback */
        #textFallback {
            display: none;
            gap: 8px;
            margin-bottom: 10px;
        }
        #textFallback input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 12px;
            color: white;
            font-size: 13px;
            outline: none;
        }
        #textFallback button {
            background: var(--primary);
            border: none;
            border-radius: 10px;
            padding: 12px 16px;
            color: white;
            font-size: 13px;
            cursor: pointer;
        }

        /* Report */
        .report-card {
            width: 100%;
            max-width: 600px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 28px 24px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .report-card h2 { color: var(--primary); margin-bottom: 16px; }
        .report-box {
            background: rgba(99,102,241,0.08);
            border: 1px solid rgba(99,102,241,0.25);
            border-radius: 12px;
            padding: 20px;
            font-size: 13px;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #e2e8f0;
            text-align: left;
        }
    </style>
</head>
<body>
<div class="card" id="mainCard">
    <div id="timer">15:00</div>
    <div id="status">Upload Resume to Start</div>

    <div class="wave-box"><canvas id="canvas"></canvas></div>

    <div class="error" id="errBox"></div>

    <div class="upload-area" id="uploadArea">
        <input type="file" id="cvInput" accept=".pdf">
        <div class="upload-icon">ðŸ“„</div>
        <div class="upload-label">Tap to upload your resume (PDF)</div>
        <div class="upload-name" id="uploadName"></div>
    </div>

    <button id="startBtn" class="btn" disabled>Start Interview</button>
    <button id="pttBtn">ðŸŽ™ Hold to Speak</button>
    <div id="textFallback">
        <input id="textInput" placeholder="Type your answer here...">
        <button onclick="submitText()">Send</button>
    </div>
    <button id="endBtn" class="btn">End Interview</button>

    <div id="log"></div>
</div>

<script>
// â”€â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API = "https://evalis-ai.simpaticohrconsultancy.workers.dev";
pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

// â”€â”€â”€ Detect environment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// If window.Android exists, we're in the native WebView with the TTS bridge
const USE_ANDROID_BRIDGE = typeof window.Android !== "undefined"
    || typeof window.androidTTSReady !== "undefined";

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let cvText = "", history = [], interviewActive = false, isAISpeaking = false;
let audioCtx, analyser, dataArray, canvasCtx;
let timerInterval, timeLeft = 15 * 60;
let mediaStream, mediaRecorder, audioChunks = [];
let pttRecording = false;

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showError(msg) {
    const b = document.getElementById("errBox");
    b.textContent = msg;
    b.style.display = "block";
    setTimeout(() => b.style.display = "none", 7000);
}

function setStatus(msg) {
    document.getElementById("status").textContent = msg;
}

function addLog(role, text) {
    const el = document.createElement("div");
    el.className = `entry ${role}`;
    el.innerHTML = `<b>${role === "ai" ? "AI" : "YOU"}</b>${text}`;
    document.getElementById("log").prepend(el);
}

// â”€â”€â”€ PDF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("cvInput").onchange = async e => {
    const file = e.target.files[0];
    if (!file) return;
    setStatus("Reading resume...");
    try {
        const pdf = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
        let text = "";
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            text += (await page.getTextContent()).items.map(s => s.str).join(" ") + " ";
        }
        cvText = text;
        document.getElementById("startBtn").disabled = false;
        document.getElementById("uploadName").textContent = "âœ“ " + file.name;
        document.getElementById("uploadArea").classList.add("ready");
        setStatus("Resume Ready");
    } catch {
        showError("Failed to read PDF. Please try another file.");
        setStatus("Upload Resume to Start");
    }
};

// â”€â”€â”€ Waveform â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initWave(stream) {
    try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        audioCtx.createMediaStreamSource(stream).connect(analyser);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        const cv = document.getElementById("canvas");
        cv.width = cv.offsetWidth || 400;
        cv.height = 60;
        canvasCtx = cv.getContext("2d");
        (function draw() {
            if (!interviewActive) return;
            requestAnimationFrame(draw);
            analyser.getByteFrequencyData(dataArray);
            canvasCtx.clearRect(0, 0, cv.width, cv.height);
            const count = Math.floor(cv.width / 7);
            for (let i = 0; i < count; i++) {
                const v = dataArray[Math.floor(i * dataArray.length / count)];
                const h = Math.max(3, (v / 255) * 50);
                canvasCtx.fillStyle = isAISpeaking ? "#818cf8" : "#6366f1";
                canvasCtx.beginPath();
                canvasCtx.roundRect(i * 7, (60 - h) / 2, 4, h, 2);
                canvasCtx.fill();
            }
        })();
    } catch(e) { console.warn("Waveform:", e); }
}

// â”€â”€â”€ Timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
        const el = document.getElementById("timer");
        el.textContent = `${m}:${s < 10 ? "0" : ""}${s}`;
        if (timeLeft <= 60) el.classList.add("warn");
        if (timeLeft <= 0) finishInterview();
    }, 1000);
}

// â”€â”€â”€ TTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Uses Android native TTS bridge when in WebView, falls back to Web Speech API
function speak(text, onDone) {
    addLog("ai", text);
    isAISpeaking = true;
    setStatus("AI Speaking...");

    if (USE_ANDROID_BRIDGE && window.Android) {
        // Use native Android TTS â€” poll until done
        window.Android.speak(text);

        // Poll isSpeaking() to detect when TTS finishes
        // Android TTS starts slightly after the call, so wait 400ms first
        setTimeout(function poll() {
            try {
                if (window.Android.isSpeaking()) {
                    setTimeout(poll, 200);
                } else {
                    isAISpeaking = false;
                    if (onDone) onDone();
                }
            } catch(e) {
                isAISpeaking = false;
                if (onDone) onDone();
            }
        }, 600);
    } else {
        // Web Speech API fallback (desktop Chrome / non-bridge)
        window.speechSynthesis.cancel();
        const chunks = splitTTS(text);
        let i = 0;
        function sayNext() {
            if (i >= chunks.length) {
                isAISpeaking = false;
                if (onDone) onDone();
                return;
            }
            const u = new SpeechSynthesisUtterance(chunks[i++]);
            u.rate = 0.95;
            const voices = window.speechSynthesis.getVoices();
            const v = voices.find(v => v.lang.startsWith("en")) || voices[0];
            if (v) u.voice = v;
            u.onend = sayNext;
            u.onerror = () => { isAISpeaking = false; if (onDone) onDone(); };
            window.speechSynthesis.speak(u);
        }
        sayNext();
    }
}

function splitTTS(text) {
    const sentences = text.match(/[^.!?]+[.!?]*/g) || [text];
    const chunks = [];
    let cur = "";
    for (const s of sentences) {
        if ((cur + s).length > 180) { if (cur) chunks.push(cur.trim()); cur = s; }
        else cur += s;
    }
    if (cur.trim()) chunks.push(cur.trim());
    return chunks.length ? chunks : [text];
}

// â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendToAPI(transcript) {
    addLog("you", transcript);
    setStatus("Thinking...");
    try {
        const fd = new FormData();
        fd.append("mode", "interview");
        fd.append("history", JSON.stringify(history));
        fd.append("text", transcript);
        fd.append("cvText", cvText);
        const res = await fetch(API, { method: "POST", body: fd });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        history = data.history;
        speak(data.reply, () => {
            if (interviewActive) {
                setStatus("Hold button to speak");
                document.getElementById("pttBtn").disabled = false;
            }
        });
    } catch (err) {
        showError("Network error â€” check your connection.");
        setStatus("Error");
        document.getElementById("pttBtn").disabled = false;
    }
}

// â”€â”€â”€ Push-to-Talk â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SpeechRecognition does NOT work in Android WebView â€” we record with MediaRecorder
// then either use on-device SR (one-shot) or send to API

function initPTT() {
    const btn = document.getElementById("pttBtn");
    btn.style.display = "block";
    setStatus("Hold button to speak");

    const startRec = async () => {
        if (pttRecording || isAISpeaking || !mediaStream) return;
        pttRecording = true;
        audioChunks = [];
        btn.classList.add("recording");
        btn.textContent = "ðŸ”´ Recording... (release to send)";

        try {
            const mime = ["audio/webm;codecs=opus","audio/webm","audio/ogg",""]
                .find(m => m === "" || MediaRecorder.isTypeSupported(m));
            mediaRecorder = new MediaRecorder(mediaStream, mime ? { mimeType: mime } : {});
            mediaRecorder.ondataavailable = e => { if (e.data.size > 0) audioChunks.push(e.data); };
            mediaRecorder.onstop = processRecording;
            mediaRecorder.start();
        } catch(err) {
            showError("Recording failed: " + err.message);
            resetPTT();
        }
    };

    const stopRec = () => {
        if (!pttRecording || !mediaRecorder) return;
        resetPTT();
        try { mediaRecorder.stop(); } catch(e) {}
    };

    // Touch events (prevent ghost mouse events on Android)
    btn.addEventListener("touchstart", e => { e.preventDefault(); startRec(); }, { passive: false });
    btn.addEventListener("touchend",   e => { e.preventDefault(); stopRec();  }, { passive: false });
    btn.addEventListener("touchcancel",e => { e.preventDefault(); stopRec();  }, { passive: false });
    // Mouse events (desktop fallback)
    btn.addEventListener("mousedown", startRec);
    btn.addEventListener("mouseup",   stopRec);
    btn.addEventListener("mouseleave",stopRec);
}

function resetPTT() {
    pttRecording = false;
    const btn = document.getElementById("pttBtn");
    btn.classList.remove("recording");
    btn.textContent = "ðŸŽ™ Hold to Speak";
    btn.disabled = true; // disabled until AI finishes responding
    setStatus("Processing...");
}

async function processRecording() {
    if (!audioChunks.length) {
        document.getElementById("pttBtn").disabled = false;
        setStatus("Hold button to speak");
        return;
    }

    // Try on-device SpeechRecognition (works on some Android WebViews)
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SR) {
        const sr = new SR();
        sr.continuous = false;
        sr.interimResults = false;
        sr.lang = "en-US";
        let gotResult = false;

        sr.onresult = e => {
            gotResult = true;
            const t = e.results[0][0].transcript.trim();
            if (t) sendToAPI(t);
            else fallbackToText();
        };
        sr.onerror = () => { if (!gotResult) fallbackToText(); };
        sr.onend   = () => { if (!gotResult) fallbackToText(); };

        try { sr.start(); return; } catch(e) {}
    }

    // If SR not available, show text input fallback
    fallbackToText();
}

function fallbackToText() {
    setStatus("Type your answer below");
    document.getElementById("pttBtn").style.display = "none";
    document.getElementById("textFallback").style.display = "flex";
    document.getElementById("textInput").focus();
}

window.submitText = function() {
    const input = document.getElementById("textInput");
    const text = input.value.trim();
    if (!text) return;
    input.value = "";
    sendToAPI(text);
};

document.getElementById("textInput").addEventListener("keydown", e => {
    if (e.key === "Enter") window.submitText();
});

// â”€â”€â”€ Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("startBtn").onclick = async () => {
    // Unlock Web Audio on user gesture
    try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        ctx.resume();
    } catch(e) {}

    // Request microphone
    try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
    } catch(err) {
        if (err.name === "NotAllowedError" || err.name === "PermissionDeniedError") {
            showError("Microphone denied. Go to Android Settings â†’ Apps â†’ [App name] â†’ Permissions â†’ Microphone â†’ Allow, then restart the app.");
        } else if (err.name === "NotFoundError") {
            showError("No microphone found on this device.");
        } else {
            showError("Microphone error: " + err.message);
        }
        return;
    }

    interviewActive = true;
    initWave(mediaStream);
    startTimer();

    document.getElementById("uploadArea").style.display = "none";
    document.getElementById("startBtn").style.display = "none";
    document.getElementById("endBtn").style.display = "block";

    setStatus("Connecting...");

    try {
        const fd = new FormData();
        fd.append("mode", "start");
        fd.append("cvText", cvText);
        const res = await fetch(API, { method: "POST", body: fd });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        history = data.history;

        speak(data.reply, () => {
            if (interviewActive) initPTT();
        });
    } catch(err) {
        showError("Failed to connect to server. Check internet connection.");
        setStatus("Error");
        interviewActive = false;
    }
};

// â”€â”€â”€ Finish â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function finishInterview() {
    interviewActive = false;
    clearInterval(timerInterval);
    if (window.Android) try { window.Android.stop(); } catch(e) {}
    else window.speechSynthesis.cancel();
    if (mediaStream) mediaStream.getTracks().forEach(t => t.stop());

    document.body.innerHTML = `
        <div class="report-card">
            <h2>Generating Report...</h2>
            <p style="color:#64748b;font-size:13px">Analysing your interview performance...</p>
        </div>`;

    try {
        const fd = new FormData();
        fd.append("mode", "score");
        fd.append("history", JSON.stringify(history));
        const res = await fetch(API, { method: "POST", body: fd });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        document.body.innerHTML = `
            <div class="report-card">
                <h2>Final Score Report</h2>
                <div class="report-box">${data.reply}</div>
                <button onclick="location.reload()" class="btn" style="margin-top:20px;background:var(--primary);color:white">New Session</button>
            </div>`;
    } catch {
        document.body.innerHTML = `
            <div class="report-card">
                <h2 style="color:var(--danger)">Report Failed</h2>
                <p style="color:#64748b;font-size:13px">Could not generate report.</p>
                <button onclick="location.reload()" class="btn" style="margin-top:20px;background:var(--primary);color:white">Try Again</button>
            </div>`;
    }
}

document.getElementById("endBtn").onclick = finishInterview;
</script>
</body>
</html>
