<!-- platform/login.html - matches simpaticohrconsultancy.com design -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Platform Login - SimpaticoHR ATS</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary:#002d5a;--primary-dark:#001a33;--tech:#00e5ff;
  --accent:#0062ff;--light:#f4f7fa;--white:#fff;
  --text-dark:#0b1a27;--text-gray:#546b81;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Poppins',sans-serif;background:var(--light);min-height:100vh;display:flex}
.login-left{
  flex:1;background:linear-gradient(135deg,var(--primary) 0%,#001a33 100%);
  display:flex;align-items:center;justify-content:center;padding:60px;
  position:relative;overflow:hidden;
}
.login-left::before{
  content:'';position:absolute;top:-20%;right:-20%;width:500px;height:500px;
  background:radial-gradient(circle,rgba(0,229,255,0.15) 0%,transparent 70%);border-radius:50%;
}
.login-left::after{
  content:'';position:absolute;bottom:-10%;left:-10%;width:300px;height:300px;
  background:radial-gradient(circle,rgba(0,98,255,0.1) 0%,transparent 70%);border-radius:50%;
}
.login-left-content{position:relative;z-index:1;color:#fff;max-width:500px;}
.login-left-content h2{font-size:2.5rem;font-weight:800;margin-bottom:16px;line-height:1.2;}
.login-left-content h2 span{
  color:transparent;background:linear-gradient(135deg,#00e5ff,#0078d4);
  -webkit-background-clip:text;background-clip:text;
}
.login-left-content p{color:rgba(255,255,255,0.7);font-size:1.05rem;margin-bottom:32px;line-height:1.7;}
.feature-pill{
  display:flex;align-items:center;gap:12px;padding:14px 18px;
  background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);
  border-radius:12px;margin-bottom:10px;transition:0.3s;
}
.feature-pill:hover{background:rgba(0,229,255,0.08);border-color:rgba(0,229,255,0.2);}
.feature-pill i{color:var(--tech);font-size:1.1rem;width:20px;text-align:center;}
.feature-pill span{font-size:0.88rem;color:rgba(255,255,255,0.85);}

.login-right{
  flex:1;display:flex;align-items:center;justify-content:center;
  padding:40px;background:var(--white);
}
.login-form{width:100%;max-width:440px;}
.logo-row{display:flex;align-items:center;gap:12px;margin-bottom:32px;}
.logo-row img{height:40px;}
.logo-row span{font-size:1.4rem;font-weight:800;color:var(--primary);}
.logo-row span em{font-style:normal;color:var(--tech);}
.login-form h2{font-size:1.6rem;font-weight:800;color:var(--text-dark);margin-bottom:6px;}
.login-form .subtitle{color:var(--text-gray);font-size:0.92rem;margin-bottom:28px;}

.role-switcher{
  display:flex;gap:4px;background:var(--light);border-radius:10px;
  padding:4px;margin-bottom:24px;
}
.role-switcher button{
  flex:1;padding:10px;border:none;border-radius:8px;font-size:0.82rem;
  font-weight:600;cursor:pointer;transition:0.2s;font-family:inherit;
  color:var(--text-gray);background:transparent;
}
.role-switcher button.active{background:var(--white);color:var(--accent);box-shadow:0 2px 8px rgba(0,0,0,0.06);}

.form-grp{margin-bottom:18px;}
.form-grp label{display:block;font-size:0.82rem;font-weight:600;color:var(--text-dark);margin-bottom:6px;}
.form-grp input{
  width:100%;padding:12px 16px;border:1.5px solid #e2e8f0;border-radius:10px;
  font-size:0.92rem;font-family:inherit;color:var(--text-dark);transition:0.2s;
  background:var(--light);
}
.form-grp input:focus{outline:none;border-color:var(--accent);background:var(--white);box-shadow:0 0 0 3px rgba(0,98,255,0.08);}
.form-grp input::placeholder{color:#94a3b8;}

.submit-btn{
  width:100%;padding:14px;border:none;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),#0078d4);
  color:#fff;font-size:0.95rem;font-weight:700;cursor:pointer;
  font-family:inherit;transition:all 0.2s;margin-top:8px;
}
.submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,98,255,0.25);}
.submit-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;}

.form-links{text-align:center;margin-top:24px;font-size:0.88rem;color:var(--text-gray);}
.form-links a{color:var(--accent);font-weight:600;text-decoration:none;}
.form-links a:hover{text-decoration:underline;}

.divider{display:flex;align-items:center;gap:12px;margin:20px 0;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:#e2e8f0;}
.divider span{font-size:0.78rem;color:#94a3b8;}

.social-row{display:flex;gap:10px;margin-bottom:20px;}
.social-btn{
  flex:1;padding:10px;border:1.5px solid #e2e8f0;border-radius:10px;
  display:flex;align-items:center;justify-content:center;gap:8px;
  font-size:0.85rem;font-weight:500;cursor:pointer;background:var(--white);
  font-family:inherit;transition:0.2s;color:var(--text-dark);
}
.social-btn:hover{border-color:var(--accent);background:rgba(0,98,255,0.03);}

.error-msg{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:10px 14px;border-radius:8px;font-size:0.82rem;margin-bottom:16px;display:none;}

.toast{
  position:fixed;top:20px;right:20px;background:var(--white);border-radius:12px;
  padding:14px 20px;box-shadow:0 10px 40px rgba(0,0,0,0.12);z-index:10000;
  display:flex;align-items:center;gap:10px;font-size:0.88rem;font-weight:500;
  animation:toastIn 0.3s ease;border-left:4px solid var(--accent);max-width:400px;
}
.toast.success{border-left-color:#10b981;}
.toast.error{border-left-color:#ef4444;}
@keyframes toastIn{from{opacity:0;transform:translateX(100px)}to{opacity:1;transform:translateX(0)}}

@media(max-width:768px){
  .login-left{display:none;}
  body{flex-direction:column;}
  .login-right{padding:24px;}
}
</style>
</head>
<body>

<div class="login-left">
  <div class="login-left-content">
    <h2>Welcome to<br><span>SimpaticoHR</span> Platform</h2>
    <p>AI-Powered Hybrid Recruitment Platform with proctored interviews, eye tracking, automated ATS, and multi-tenant data isolation.</p>
    <div class="feature-pill"><i class="fas fa-eye"></i><span>AI Proctored Interviews with Eye Tracking</span></div>
    <div class="feature-pill"><i class="fas fa-robot"></i><span>Automated Sourcing, Screening & Shortlisting</span></div>
    <div class="feature-pill"><i class="fas fa-shield-halved"></i><span>99.2% Cheat Detection Accuracy</span></div>
    <div class="feature-pill"><i class="fas fa-building"></i><span>Multi-Client Data Isolation (SaaS)</span></div>
    <div class="feature-pill"><i class="fab fa-whatsapp"></i><span>WhatsApp + Email Automation</span></div>
    <div class="feature-pill"><i class="fas fa-wand-magic-sparkles"></i><span>AI JD Generation & Resume Matching</span></div>
  </div>
</div>

<div class="login-right">
  <div class="login-form">
    <div class="logo-row">
      <img src="../favicon-96x96.png" alt="SimpaticoHR Logo">
      <span>SIMPATICO <em>HR</em></span>
    </div>

    <h2>Sign In</h2>
    <p class="subtitle">Access your recruitment dashboard</p>

    <div class="role-switcher" id="roleSwitcher">
      <button class="active" onclick="switchRole(this,'hr')">HR / Company</button>
      <button onclick="switchRole(this,'candidate')">Candidate</button>
      <button onclick="switchRole(this,'admin')">Super Admin</button>
    </div>

    <div class="error-msg" id="errorMsg"></div>

    <div class="social-row">
      <button class="social-btn" onclick="socialLogin('google')"><i class="fab fa-google"></i> Google</button>
      <button class="social-btn" onclick="socialLogin('linkedin_oidc')"><i class="fab fa-linkedin-in"></i> LinkedIn</button>
    </div>

    <div class="divider"><span>or continue with email</span></div>

    <form onsubmit="handleLogin(event)">
      <div class="form-grp">
        <label>Email Address</label>
        <input type="email" id="loginEmail" placeholder="you@company.com" required>
      </div>
      <div class="form-grp">
        <label style="display:flex;justify-content:space-between;">
          Password
          <a href="#" style="color:var(--accent);font-size:0.78rem;font-weight:500;text-decoration:none;">Forgot?</a>
        </label>
        <input type="password" id="loginPassword" placeholder="••••••••" required>
      </div>
      <button type="submit" class="submit-btn" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i> Sign In
      </button>
    </form>

    <div class="form-links">
      Don't have an account?<br>
      <a href="register-company.html">Register Company</a> &nbsp;·&nbsp;
      <a href="register-candidate.html">Register as Candidate</a>
    </div>

    <div style="text-align:center;margin-top:24px;padding-top:20px;border-top:1px solid #e2e8f0;">
      <a href="../index.html" style="font-size:0.82rem;color:var(--text-gray);text-decoration:none;">
        ← Back to simpaticohrconsultancy.com
      </a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPA_URL = 'https://cvkxtsvgnynxexmemfuy.supabase.co';
const SUPA_KEY = 'YOUR_SUPABASE_ANON_KEY'; // Replace with your actual anon key
const W = 'https://evalis-ai.simpaticohrconsultancy.workers.dev';

const sb = supabase.createClient(SUPA_URL, SUPA_KEY);
let selectedRole = 'hr';

function switchRole(btn, role) {
  document.querySelectorAll('.role-switcher button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedRole = role;
}

async function handleLogin(e) {
  e.preventDefault();
  const btn = document.getElementById('loginBtn');
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
  document.getElementById('errorMsg').style.display = 'none';

  try {
    const res = await fetch(`${W}/api/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();

    if (!res.ok || !data.success) throw new Error(data.error || 'Login failed');

    // Store token
    localStorage.setItem('sb_token', data.token);
    localStorage.setItem('sb_refresh', data.refresh_token);
    localStorage.setItem('sb_user', JSON.stringify(data.user));

    showToast('Login successful! Redirecting...', 'success');

    // Redirect based on role
    const role = data.user.role;
    const routes = {
      'super_admin': 'dashboard-admin.html',
      'company_admin': 'dashboard-hr.html',
      'hr_manager': 'dashboard-hr.html',
      'interviewer': 'dashboard-hr.html',
      'candidate': 'dashboard-candidate.html'
    };
    setTimeout(() => {
      window.location.href = routes[role] || 'dashboard-candidate.html';
    }, 1000);

  } catch(err) {
    document.getElementById('errorMsg').textContent = err.message;
    document.getElementById('errorMsg').style.display = 'block';
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
  }
}

async function socialLogin(provider) {
  try {
    const { data, error } = await sb.auth.signInWithOAuth({
      provider,
      options: { redirectTo: window.location.origin + '/platform/callback.html' }
    });
    if (error) throw error;
  } catch(e) {
    showToast(e.message, 'error');
  }
}

function showToast(msg, type='info') {
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.innerHTML = `<i class="fas fa-${type==='success'?'check-circle':type==='error'?'exclamation-circle':'info-circle'}"></i> ${msg}`;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 4000);
}
</script>
</body>
</html>
