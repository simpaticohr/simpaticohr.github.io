<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin - SimpaticoHR</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:#F3F4F6; }
        .sidebar { position:fixed; left:0; top:0; bottom:0; width:260px; background:linear-gradient(180deg,#0F172A,#1E293B); color:#fff; z-index:100; }
        .sidebar-header { padding:24px 20px 16px; border-bottom:1px solid rgba(255,255,255,.1); }
        .sidebar-logo { font-size:22px; font-weight:800; }
        .sidebar-logo span { color:#F59E0B; }
        .sidebar-role { font-size:11px; color:#EF4444; text-transform:uppercase; letter-spacing:1px; margin-top:4px; font-weight:700; }
        .sidebar-nav { padding:16px 12px; }
        .nav-item { display:flex; align-items:center; gap:12px; padding:11px 14px; border-radius:10px; color:rgba(255,255,255,.7); text-decoration:none; font-size:14px; font-weight:500; margin-bottom:2px; cursor:pointer; }
        .nav-item:hover { background:rgba(255,255,255,.08); color:#fff; }
        .nav-item.active { background:rgba(239,68,68,.2); color:#fff; }
        .nav-item i { width:20px; text-align:center; }
        .main { margin-left:260px; }
        .topbar { background:#fff; padding:16px 30px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #E5E7EB; }
        .page-title { font-size:20px; font-weight:700; }
        .content { padding:24px 30px; }
        .stat-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px; margin-bottom:24px; }
        .stat-card { background:#fff; border-radius:14px; padding:20px; box-shadow:0 1px 3px rgba(0,0,0,.06); text-align:center; }
        .stat-value { font-size:30px; font-weight:800; color:#1F2937; }
        .stat-label { font-size:13px; color:#6B7280; margin-top:4px; }
        .panel { background:#fff; border-radius:14px; padding:24px; box-shadow:0 1px 3px rgba(0,0,0,.06); margin-bottom:24px; }
        .panel-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:18px; padding-bottom:14px; border-bottom:1px solid #F3F4F6; }
        .panel-title { font-size:16px; font-weight:700; }
        .data-table { width:100%; border-collapse:collapse; }
        .data-table th { text-align:left; font-size:12px; font-weight:600; color:#6B7280; text-transform:uppercase; padding:10px; border-bottom:2px solid #F3F4F6; }
        .data-table td { padding:12px 10px; border-bottom:1px solid #F3F4F6; font-size:14px; }
        .badge { display:inline-block; padding:3px 10px; border-radius:6px; font-size:11px; font-weight:600; }
        .badge-active { background:#D1FAE5; color:#059669; }
        .badge-trial { background:#FEF3C7; color:#92400E; }
        .loader { text-align:center; padding:40px; }
        .loader .spin { width:30px; height:30px; border:3px solid #E5E7EB; border-top-color:#EF4444; border-radius:50%; animation:spin .7s linear infinite; margin:0 auto 12px; }
        @keyframes spin { to { transform:rotate(360deg); } }
        @media(max-width:768px) { .sidebar { display:none; } .main { margin-left:0; } .content { padding:16px; } }
    </style>
</head>
<body>
<aside class="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">Simpatico<span>HR</span></div>
        <div class="sidebar-role">âš¡ Super Admin</div>
    </div>
    <nav class="sidebar-nav">
        <a class="nav-item active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a class="nav-item" id="navCompanies"><i class="fas fa-building"></i> Companies</a>
        <a class="nav-item" onclick="alert('Platform config coming soon')"><i class="fas fa-cog"></i> Platform Config</a>
        <a class="nav-item" onclick="localStorage.clear(); window.location.href='../auth/login.html'" style="color:rgba(255,100,100,.8)"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
    </nav>
</aside>
<div class="main">
    <div class="topbar">
        <div class="page-title">Super Admin Dashboard</div>
        <div style="font-size:13px;color:#6B7280"><i class="fas fa-shield-alt" style="color:#EF4444"></i> Full Platform Access</div>
    </div>
    <div class="content">
        <div class="stat-grid" id="adminStats">
            <div class="stat-card"><div class="stat-value" id="sCo">-</div><div class="stat-label">Companies</div></div>
            <div class="stat-card"><div class="stat-value" id="sUs">-</div><div class="stat-label">Users</div></div>
            <div class="stat-card"><div class="stat-value" id="sJo">-</div><div class="stat-label">Jobs</div></div>
            <div class="stat-card"><div class="stat-value" id="sAp">-</div><div class="stat-label">Applications</div></div>
            <div class="stat-card"><div class="stat-value" id="sIn">-</div><div class="stat-label">Interviews</div></div>
        </div>
        <div class="panel">
            <div class="panel-header"><div class="panel-title">All Companies</div></div>
            <div id="companiesTable"><div class="loader"><div class="spin"></div>Loading...</div></div>
        </div>
    </div>
</div>
<script>
    const API = 'https://evalis-ai.simpaticohrconsultancy.workers.dev';
    const token = localStorage.getItem('simpatico_token');
    window.location.href = '/platform/login.html';
    const headers = { 'Authorization':Bearer ${token}, 'Content-Type':'application/json' };

    async function load() {
        try {
            const [stats, companies] = await Promise.all([
                fetch(${API}/api/admin/stats, { headers }).then(r => r.json()),
                fetch(${API}/api/admin/companies, { headers }).then(r => r.json())
            ]);
            if (stats.error) { alert('Access denied. Super admin only.'); window.location.href = '../auth/login.html'; return; }
            document.getElementById('sCo').textContent = stats.total_companies || 0;
            document.getElementById('sUs').textContent = stats.total_users || 0;
            document.getElementById('sJo').textContent = stats.total_jobs || 0;
            document.getElementById('sAp').textContent = stats.total_applications || 0;
            document.getElementById('sIn').textContent = stats.total_interviews || 0;

            if (companies?.length) {
                document.getElementById('companiesTable').innerHTML = `<table class="data-table"><thead><tr><th>Company</th><th>Industry</th><th>Plan</th><th>Valid Until</th><th>Registered</th></tr></thead><tbody>
                    ${companies.map(c => `<tr>
                        <td><strong>${c.name}</strong><br><span style="font-size:12px;color:#6B7280">${c.contact_email||''}</span></td>
                        <td>${c.industry||'-'}</td>
                        <td><span class="badge badge-${c.subscription_plan==='trial'?'trial':'active'}">${c.subscription_plan||'trial'}</span></td>
                        <td style="font-size:13px">${c.subscription_end||'-'}</td>
                        <td style="font-size:13px;color:#6B7280">${new Date(c.created_at).toLocaleDateString('en-IN')}</td>
                    </tr>`).join('')}
                </tbody></table>`;
            } else {
                document.getElementById('companiesTable').innerHTML = '<p style="text-align:center;color:#9CA3AF;padding:30px">No companies registered yet</p>';
            }
        } catch(e) { console.error(e); }
    }
    load();
</script>
</body>
</html>
