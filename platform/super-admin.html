<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin - SimpaticoHR</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:#F3F4F6; }

        /* Sidebar */
        .sidebar {
            position:fixed; left:0; top:0; bottom:0; width:260px;
            background:linear-gradient(180deg,#0F172A,#1E293B);
            color:#fff; z-index:100; display:flex; flex-direction:column;
        }
        .sidebar-header { padding:24px 20px 16px; border-bottom:1px solid rgba(255,255,255,.1); }
        .sidebar-logo { font-size:22px; font-weight:800; }
        .sidebar-logo span { color:#F59E0B; }
        .sidebar-role { font-size:11px; color:#EF4444; text-transform:uppercase; letter-spacing:1px; margin-top:4px; font-weight:700; }
        .sidebar-nav { padding:16px 12px; flex:1; }
        .nav-item {
            display:flex; align-items:center; gap:12px; padding:11px 14px;
            border-radius:10px; color:rgba(255,255,255,.7); text-decoration:none;
            font-size:14px; font-weight:500; margin-bottom:2px; cursor:pointer;
            transition: all 0.2s;
        }
        .nav-item:hover { background:rgba(255,255,255,.08); color:#fff; }
        .nav-item.active { background:rgba(239,68,68,.2); color:#fff; font-weight:600; }
        .nav-item i { width:20px; text-align:center; }
        .nav-divider { height:1px; background:rgba(255,255,255,.08); margin:12px 0; }
        .sidebar-footer { padding:16px 12px; border-top:1px solid rgba(255,255,255,.08); }

        /* Main */
        .main { margin-left:260px; min-height:100vh; }
        .topbar {
            background:#fff; padding:16px 30px;
            display:flex; align-items:center; justify-content:space-between;
            border-bottom:1px solid #E5E7EB; position:sticky; top:0; z-index:50;
        }
        .page-title { font-size:20px; font-weight:700; color:#0F172A; }
        .topbar-right { display:flex; align-items:center; gap:12px; font-size:13px; color:#6B7280; }
        .dot-live { width:8px; height:8px; background:#10B981; border-radius:50%; animation:pulse 2s infinite; display:inline-block; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

        .content { padding:24px 30px; }

        /* Stats */
        .stat-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:16px; margin-bottom:24px; }
        .stat-card {
            background:#fff; border-radius:14px; padding:20px;
            box-shadow:0 1px 3px rgba(0,0,0,.06); text-align:center;
            border:1px solid transparent; transition:all 0.2s;
        }
        .stat-card:hover { border-color:rgba(245,158,11,.3); transform:translateY(-2px); }
        .stat-icon {
            width:36px; height:36px; border-radius:10px;
            display:flex; align-items:center; justify-content:center;
            font-size:16px; margin:0 auto 10px;
        }
        .stat-value { font-size:28px; font-weight:800; color:#0F172A; }
        .stat-label { font-size:12px; color:#6B7280; margin-top:4px; font-weight:500; }

        /* Panels */
        .panel {
            background:#fff; border-radius:14px; padding:24px;
            box-shadow:0 1px 3px rgba(0,0,0,.06); margin-bottom:24px;
            border:1px solid #F3F4F6;
        }
        .panel-header {
            display:flex; align-items:center; justify-content:space-between;
            margin-bottom:18px; padding-bottom:14px; border-bottom:1px solid #F3F4F6;
        }
        .panel-title { font-size:16px; font-weight:700; color:#0F172A; }
        .panel-badge {
            font-size:11px; font-weight:600; padding:4px 10px;
            border-radius:6px; background:#EFF6FF; color:#2563EB;
        }

        /* Table */
        .table-wrap { overflow-x:auto; }
        table { width:100%; border-collapse:collapse; }
        th {
            text-align:left; font-size:11px; font-weight:600;
            color:#6B7280; text-transform:uppercase; letter-spacing:.6px;
            padding:10px 14px; border-bottom:2px solid #F3F4F6;
        }
        td {
            padding:14px; font-size:14px;
            border-bottom:1px solid rgba(243,244,246,.8);
            vertical-align:middle;
        }
        tr:last-child td { border-bottom:none; }
        tr:hover td { background:#FAFBFC; }

        /* Badges */
        .badge {
            display:inline-flex; align-items:center; padding:3px 10px;
            border-radius:20px; font-size:11px; font-weight:700;
        }
        .badge-active { background:rgba(16,185,129,.12); color:#059669; border:1px solid rgba(16,185,129,.2); }
        .badge-trial { background:rgba(245,158,11,.12); color:#B45309; border:1px solid rgba(245,158,11,.2); }
        .badge-inactive { background:rgba(239,68,68,.1); color:#DC2626; border:1px solid rgba(239,68,68,.15); }
        .badge-premium { background:rgba(99,102,241,.12); color:#4F46E5; border:1px solid rgba(99,102,241,.2); }

        /* Action buttons */
        .btn-sm {
            padding:6px 12px; border-radius:8px; font-size:12px;
            font-weight:600; cursor:pointer; border:none; font-family:inherit;
            transition:all 0.2s;
        }
        .btn-view { background:#EFF6FF; color:#2563EB; }
        .btn-view:hover { background:#DBEAFE; }
        .btn-danger { background:#FEF2F2; color:#DC2626; }
        .btn-danger:hover { background:#FEE2E2; }
        .btn-create {
            padding:8px 16px; border-radius:10px; font-size:13px;
            font-weight:700; cursor:pointer; border:none; font-family:inherit;
            background:linear-gradient(135deg,#DC2626,#EF4444);
            color:#fff; transition:all 0.2s;
        }
        .btn-create:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(239,68,68,.3); }

        /* Loader */
        .loader { text-align:center; padding:40px; }
        .loader .spin {
            width:30px; height:30px; border:3px solid #E5E7EB;
            border-top-color:#EF4444; border-radius:50%;
            animation:spin .7s linear infinite; margin:0 auto 12px;
        }
        @keyframes spin { to { transform:rotate(360deg); } }
        .loader p { color:#9CA3AF; font-size:13px; }

        /* Access Denied */
        .access-denied { text-align:center; padding:80px 20px; }
        .access-denied .icon {
            width:80px; height:80px; border-radius:50%;
            background:rgba(239,68,68,.1); display:flex;
            align-items:center; justify-content:center;
            margin:0 auto 20px;
        }
        .access-denied .icon i { font-size:32px; color:#EF4444; }
        .access-denied h2 { font-size:22px; font-weight:700; color:#0F172A; margin-bottom:8px; }
        .access-denied p { color:#6B7280; margin-bottom:20px; max-width:400px; margin-left:auto; margin-right:auto; }
        .access-denied a {
            display:inline-flex; align-items:center; gap:6px;
            color:#2563EB; text-decoration:none; font-weight:600; font-size:14px;
        }
        .access-denied a:hover { text-decoration:underline; }

        /* Toast */
        .toast {
            position:fixed; top:20px; right:20px; padding:14px 20px;
            border-radius:10px; font-size:14px; font-weight:600; color:#fff;
            z-index:10000; max-width:400px; box-shadow:0 10px 30px rgba(0,0,0,.2);
            animation:toastIn .3s ease;
        }
        .toast-success { background:#059669; }
        .toast-error { background:#DC2626; }
        .toast-info { background:#2563EB; }
        @keyframes toastIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }

        /* Mobile */
        .menu-toggle {
            display:none; background:none; border:none;
            color:#0F172A; font-size:20px; cursor:pointer;
        }
        @media(max-width:768px) {
            .sidebar { transform:translateX(-100%); transition:0.3s; }
            .sidebar.open { transform:translateX(0); }
            .main { margin-left:0; }
            .content { padding:16px; }
            .stat-grid { grid-template-columns:repeat(2,1fr); }
            .menu-toggle { display:block; }
            .topbar { padding:12px 16px; }
        }
        @media(max-width:480px) {
            .stat-grid { grid-template-columns:1fr 1fr; }
        }
    </style>
</head>
<body>

<!-- ═══ SIDEBAR ═══ -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">Simpatico<span>HR</span></div>
        <div class="sidebar-role">⚡ Super Admin</div>
    </div>
    <nav class="sidebar-nav">
        <a class="nav-item active" id="navDash" onclick="showSection('dashboard')">
            <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a class="nav-item" id="navCompanies" onclick="showSection('companies')">
            <i class="fas fa-building"></i> Companies
        </a>
        <a class="nav-item" id="navUsers" onclick="showSection('users')">
            <i class="fas fa-users"></i> All Users
        </a>
        <a class="nav-item" id="navJobs" onclick="showSection('jobs')">
            <i class="fas fa-briefcase"></i> All Jobs
        </a>
        <div class="nav-divider"></div>
        <a class="nav-item" onclick="window.open('../index.html','_blank')">
            <i class="fas fa-external-link-alt"></i> View Website
        </a>
        <a class="nav-item" onclick="toast('Platform config coming soon','info')">
            <i class="fas fa-cog"></i> Settings
        </a>
    </nav>
    <div class="sidebar-footer">
        <a class="nav-item" onclick="signOut()" style="color:rgba(255,100,100,.8)">
            <i class="fas fa-sign-out-alt"></i> Sign Out
        </a>
    </div>
</aside>

<!-- ═══ MAIN ═══ -->
<div class="main">
    <div class="topbar">
        <div style="display:flex;align-items:center;gap:12px;">
            <button class="menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">
                <i class="fas fa-bars"></i>
            </button>
            <div class="page-title" id="pageTitle">Super Admin Dashboard</div>
        </div>
        <div class="topbar-right">
            <span class="dot-live"></span>
            <i class="fas fa-shield-alt" style="color:#EF4444"></i>
            <span id="adminName">Super Admin</span>
        </div>
    </div>

    <div class="content" id="mainContent">
        <!-- Filled by JavaScript -->
        <div class="loader"><div class="spin"></div><p>Loading dashboard...</p></div>
    </div>
</div>

<script>
// ═══════════════════════════════════════
// CONFIG
// ═══════════════════════════════════════
const API = 'https://evalis-ai.simpaticohrconsultancy.workers.dev';
const token = localStorage.getItem('simpatico_token');
const user = JSON.parse(localStorage.getItem('simpatico_user') || '{}');
const headers = {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
};

// Cache
let cachedStats = null;
let cachedCompanies = null;
let cachedUsers = null;

// ═══════════════════════════════════════
// AUTH CHECK — NO unconditional redirect!
// ═══════════════════════════════════════
function checkAuth() {
    if (!token) {
        showAccessDenied('No authentication token found. Please log in first.');
        return false;
    }
    if (user.role && user.role !== 'super_admin') {
        showAccessDenied(`Your role is "${user.role}". Super admin access required.`);
        return false;
    }
    return true;
}

function showAccessDenied(msg) {
    document.getElementById('mainContent').innerHTML = `
        <div class="access-denied">
            <div class="icon"><i class="fas fa-lock"></i></div>
            <h2>Access Denied</h2>
            <p>${msg}</p>
            <a href="login.html"><i class="fas fa-arrow-left"></i> Go to Login</a>
        </div>
    `;
}

// ═══════════════════════════════════════
// SET ADMIN NAME
// ═══════════════════════════════════════
try {
    const name = user.full_name || user.name || user.email || 'Super Admin';
    document.getElementById('adminName').textContent = name;
} catch(e) {}

// ═══════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════
function showSection(section) {
    // Update active nav
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    const navMap = { dashboard:'navDash', companies:'navCompanies', users:'navUsers', jobs:'navJobs' };
    const navEl = document.getElementById(navMap[section]);
    if (navEl) navEl.classList.add('active');

    // Close mobile sidebar
    document.getElementById('sidebar').classList.remove('open');

    switch(section) {
        case 'dashboard': loadDashboard(); break;
        case 'companies': loadCompanies(); break;
        case 'users': loadUsers(); break;
        case 'jobs': loadJobs(); break;
    }
}

// ═══════════════════════════════════════
// DASHBOARD
// ═══════════════════════════════════════
async function loadDashboard() {
    document.getElementById('pageTitle').textContent = 'Super Admin Dashboard';
    document.getElementById('mainContent').innerHTML = '<div class="loader"><div class="spin"></div><p>Loading stats...</p></div>';

    if (!checkAuth()) return;

    try {
        const res = await fetch(`${API}/api/admin/stats`, { headers });
        const stats = await res.json();

        if (stats.error) {
            showAccessDenied('API Error: ' + stats.error);
            return;
        }

        cachedStats = stats;

        document.getElementById('mainContent').innerHTML = `
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(59,130,246,.1);color:#3B82F6"><i class="fas fa-building"></i></div>
                    <div class="stat-value">${stats.total_companies || 0}</div>
                    <div class="stat-label">Companies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(16,185,129,.1);color:#10B981"><i class="fas fa-users"></i></div>
                    <div class="stat-value">${stats.total_users || 0}</div>
                    <div class="stat-label">Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(245,158,11,.1);color:#F59E0B"><i class="fas fa-briefcase"></i></div>
                    <div class="stat-value">${stats.total_jobs || 0}</div>
                    <div class="stat-label">Jobs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(139,92,246,.1);color:#8B5CF6"><i class="fas fa-file-alt"></i></div>
                    <div class="stat-value">${stats.total_applications || 0}</div>
                    <div class="stat-label">Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(239,68,68,.1);color:#EF4444"><i class="fas fa-video"></i></div>
                    <div class="stat-value">${stats.total_interviews || 0}</div>
                    <div class="stat-label">Interviews</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title"><i class="fas fa-building" style="color:#3B82F6;margin-right:8px"></i>Recent Companies</div>
                    <button class="btn-create" onclick="showSection('companies')">View All →</button>
                </div>
                <div id="recentCompanies"><div class="loader"><div class="spin"></div><p>Loading...</p></div></div>
            </div>
        `;

        // Load recent companies
        loadRecentCompanies();

    } catch(e) {
        console.error('Dashboard error:', e);
        document.getElementById('mainContent').innerHTML = `
            <div class="access-denied">
                <div class="icon"><i class="fas fa-exclamation-triangle" style="color:#F59E0B"></i></div>
                <h2>Connection Error</h2>
                <p>Could not reach the API server. Please check your connection.</p>
                <a href="#" onclick="loadDashboard();return false;"><i class="fas fa-redo"></i> Retry</a>
            </div>
        `;
    }
}

async function loadRecentCompanies() {
    try {
        const res = await fetch(`${API}/api/admin/companies`, { headers });
        const companies = await res.json();
        cachedCompanies = companies;

        const container = document.getElementById('recentCompanies');
        if (!container) return;

        if (Array.isArray(companies) && companies.length > 0) {
            const recent = companies.slice(0, 5);
            container.innerHTML = `
                <div class="table-wrap">
                    <table>
                        <thead><tr>
                            <th>Company</th><th>Industry</th><th>Plan</th><th>Registered</th><th>Actions</th>
                        </tr></thead>
                        <tbody>
                            ${recent.map(c => `<tr>
                                <td>
                                    <strong>${esc(c.name)}</strong><br>
                                    <span style="font-size:12px;color:#6B7280">${esc(c.contact_email || '')}</span>
                                </td>
                                <td>${esc(c.industry || '-')}</td>
                                <td><span class="badge badge-${getPlanBadge(c.subscription_plan)}">${esc(c.subscription_plan || 'trial')}</span></td>
                                <td style="font-size:13px;color:#6B7280">${formatDate(c.created_at)}</td>
                                <td><button class="btn-sm btn-view" onclick="toast('Company details coming soon','info')"><i class="fas fa-eye"></i></button></td>
                            </tr>`).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        } else {
            container.innerHTML = '<p style="text-align:center;color:#9CA3AF;padding:30px">No companies registered yet</p>';
        }
    } catch(e) {
        const container = document.getElementById('recentCompanies');
        if (container) container.innerHTML = '<p style="text-align:center;color:#EF4444;padding:20px">Failed to load companies</p>';
    }
}

// ═══════════════════════════════════════
// COMPANIES PAGE
// ═══════════════════════════════════════
async function loadCompanies() {
    document.getElementById('pageTitle').textContent = 'All Companies';
    document.getElementById('mainContent').innerHTML = '<div class="loader"><div class="spin"></div><p>Loading companies...</p></div>';

    if (!checkAuth()) return;

    try {
        let companies = cachedCompanies;
        if (!companies) {
            const res = await fetch(`${API}/api/admin/companies`, { headers });
            companies = await res.json();
            cachedCompanies = companies;
        }

        if (Array.isArray(companies) && companies.length > 0) {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><i class="fas fa-building" style="color:#3B82F6;margin-right:8px"></i>Companies (${companies.length})</div>
                        <span class="panel-badge">${companies.length} total</span>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead><tr>
                                <th>Company</th><th>Industry</th><th>Size</th><th>Plan</th><th>Valid Until</th><th>Registered</th><th>Actions</th>
                            </tr></thead>
                            <tbody>
                                ${companies.map(c => `<tr>
                                    <td>
                                        <strong>${esc(c.name)}</strong><br>
                                        <span style="font-size:12px;color:#6B7280">${esc(c.contact_email || '')}</span>
                                    </td>
                                    <td>${esc(c.industry || '-')}</td>
                                    <td style="font-size:13px">${esc(c.company_size || '-')}</td>
                                    <td><span class="badge badge-${getPlanBadge(c.subscription_plan)}">${esc(c.subscription_plan || 'trial')}</span></td>
                                    <td style="font-size:13px">${esc(c.subscription_end || '-')}</td>
                                    <td style="font-size:13px;color:#6B7280">${formatDate(c.created_at)}</td>
                                    <td>
                                        <button class="btn-sm btn-view" onclick="toast('View details coming soon','info')"><i class="fas fa-eye"></i></button>
                                    </td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        } else {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header"><div class="panel-title">Companies</div></div>
                    <p style="text-align:center;color:#9CA3AF;padding:40px">No companies registered yet</p>
                </div>
            `;
        }
    } catch(e) {
        document.getElementById('mainContent').innerHTML = '<p style="text-align:center;color:#EF4444;padding:40px">Failed to load companies</p>';
    }
}

// ═══════════════════════════════════════
// USERS PAGE
// ═══════════════════════════════════════
async function loadUsers() {
    document.getElementById('pageTitle').textContent = 'All Users';
    document.getElementById('mainContent').innerHTML = '<div class="loader"><div class="spin"></div><p>Loading users...</p></div>';

    if (!checkAuth()) return;

    try {
        const res = await fetch(`${API}/api/admin/users`, { headers });
        const users = await res.json();

        if (users.error) {
            // If endpoint doesn't exist yet, show message
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header"><div class="panel-title">All Users</div></div>
                    <p style="text-align:center;color:#6B7280;padding:40px">
                        <i class="fas fa-info-circle" style="color:#3B82F6"></i><br><br>
                        Users endpoint not available yet.<br>
                        Add <code>/api/admin/users</code> to your Cloudflare Worker.
                    </p>
                </div>
            `;
            return;
        }

        if (Array.isArray(users) && users.length > 0) {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><i class="fas fa-users" style="color:#10B981;margin-right:8px"></i>Users (${users.length})</div>
                        <span class="panel-badge">${users.length} total</span>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead><tr>
                                <th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Joined</th>
                            </tr></thead>
                            <tbody>
                                ${users.map(u => `<tr>
                                    <td><strong>${esc(u.full_name || '-')}</strong></td>
                                    <td style="font-size:13px">${esc(u.email)}</td>
                                    <td><span class="badge badge-${getRoleBadge(u.role)}">${esc(u.role)}</span></td>
                                    <td><span class="badge ${u.is_active ? 'badge-active' : 'badge-inactive'}">${u.is_active ? 'Active' : 'Inactive'}</span></td>
                                    <td style="font-size:13px;color:#6B7280">${formatDate(u.created_at)}</td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        } else {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header"><div class="panel-title">All Users</div></div>
                    <p style="text-align:center;color:#9CA3AF;padding:40px">No users found</p>
                </div>
            `;
        }
    } catch(e) {
        document.getElementById('mainContent').innerHTML = '<p style="text-align:center;color:#EF4444;padding:40px">Failed to load users</p>';
    }
}

// ═══════════════════════════════════════
// JOBS PAGE
// ═══════════════════════════════════════
async function loadJobs() {
    document.getElementById('pageTitle').textContent = 'All Jobs';
    document.getElementById('mainContent').innerHTML = '<div class="loader"><div class="spin"></div><p>Loading jobs...</p></div>';

    if (!checkAuth()) return;

    try {
        const res = await fetch(`${API}/api/admin/jobs`, { headers });
        const data = await res.json();

        if (data.error) {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header"><div class="panel-title">All Jobs</div></div>
                    <p style="text-align:center;color:#6B7280;padding:40px">
                        <i class="fas fa-info-circle" style="color:#3B82F6"></i><br><br>
                        Jobs endpoint not available yet.<br>
                        Add <code>/api/admin/jobs</code> to your Cloudflare Worker.
                    </p>
                </div>
            `;
            return;
        }

        const jobs = Array.isArray(data) ? data : (data.jobs || []);

        if (jobs.length > 0) {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><i class="fas fa-briefcase" style="color:#F59E0B;margin-right:8px"></i>Jobs (${jobs.length})</div>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead><tr>
                                <th>Title</th><th>Company</th><th>Location</th><th>Status</th><th>Posted</th>
                            </tr></thead>
                            <tbody>
                                ${jobs.map(j => `<tr>
                                    <td><strong>${esc(j.title || '-')}</strong></td>
                                    <td style="font-size:13px">${esc(j.company_name || '-')}</td>
                                    <td style="font-size:13px">${esc(j.location || '-')}</td>
                                    <td><span class="badge ${j.is_active ? 'badge-active' : 'badge-inactive'}">${j.is_active ? 'Active' : 'Closed'}</span></td>
                                    <td style="font-size:13px;color:#6B7280">${formatDate(j.created_at)}</td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        } else {
            document.getElementById('mainContent').innerHTML = `
                <div class="panel">
                    <div class="panel-header"><div class="panel-title">All Jobs</div></div>
                    <p style="text-align:center;color:#9CA3AF;padding:40px">No jobs posted yet</p>
                </div>
            `;
        }
    } catch(e) {
        document.getElementById('mainContent').innerHTML = '<p style="text-align:center;color:#EF4444;padding:40px">Failed to load jobs</p>';
    }
}

// ═══════════════════════════════════════
// UTILS
// ═══════════════════════════════════════
function esc(str) {
    return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function formatDate(dateStr) {
    if (!dateStr) return '-';
    try { return new Date(dateStr).toLocaleDateString('en-IN', { day:'numeric', month:'short', year:'numeric' }); }
    catch(e) { return dateStr; }
}

function getPlanBadge(plan) {
    if (!plan || plan === 'trial') return 'trial';
    if (plan === 'premium' || plan === 'enterprise') return 'premium';
    return 'active';
}

function getRoleBadge(role) {
    const map = { super_admin:'inactive', company_admin:'premium', hr:'active', candidate:'trial', interviewer:'active' };
    return map[role] || 'trial';
}

function signOut() {
    if (confirm('Sign out of super admin?')) {
        localStorage.removeItem('simpatico_token');
        localStorage.removeItem('simpatico_user');
        localStorage.removeItem('simpatico_company');
        window.location.href = 'login.html';
    }
}

function toast(msg, type = 'info') {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();
    const t = document.createElement('div');
    t.className = `toast toast-${type}`;
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 4000);
}

// ═══════════════════════════════════════
// INIT — Load dashboard on page load
// ═══════════════════════════════════════
loadDashboard();
</script>
</body>
</html>
