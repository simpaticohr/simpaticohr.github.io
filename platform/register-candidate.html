<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate Registration - SimpaticoHR</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; min-height: 100vh; display: flex; background: #F3F4F6; }

        .auth-left {
            flex: 1;
            background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: white;
        }
        .auth-left-content { max-width: 500px; }
        .auth-left-content h2 { font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; }
        .auth-left-content p { color: rgba(255,255,255,0.8); font-size: 1rem; line-height: 1.7; margin-bottom: 2rem; }
        .benefit-list { list-style: none; }
        .benefit-list li {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; background: rgba(255,255,255,0.1);
            border-radius: 10px; margin-bottom: 8px;
            font-size: 14px; color: rgba(255,255,255,0.9);
        }
        .benefit-list li i { font-size: 16px; }

        .auth-right {
            flex: 1; display: flex; align-items: center;
            justify-content: center; padding: 2rem; overflow-y: auto;
        }
        .auth-form {
            width: 100%; max-width: 500px;
            background: #fff; border-radius: 16px;
            padding: 32px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .auth-form .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 1.5rem; }
        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, #7c3aed, #ec4899);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            color: #fff; font-size: 18px;
        }
        .logo-text { font-size: 18px; font-weight: 800; color: #0F172A; }
        .logo-text span { color: #7c3aed; }

        .auth-form h2 { font-size: 1.4rem; font-weight: 800; margin-bottom: 0.3rem; }
        .auth-form .subtitle { color: #6B7280; font-size: 0.85rem; margin-bottom: 1.5rem; }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 5px; }
        .form-input, .form-select {
            width: 100%; padding: 10px 14px;
            border: 1.5px solid #E5E7EB; border-radius: 10px;
            font-size: 14px; font-family: inherit;
            background: #F9FAFB; color: #1F2937;
            outline: none; transition: all 0.2s;
        }
        .form-input:focus, .form-select:focus {
            border-color: #7c3aed; background: #fff;
            box-shadow: 0 0 0 3px rgba(124,58,237,0.1);
        }
        .form-input::placeholder { color: #9CA3AF; }

        .resume-upload {
            border: 2px dashed #D1D5DB; border-radius: 10px;
            padding: 2rem; text-align: center; cursor: pointer;
            transition: all 0.2s; background: #F9FAFB;
        }
        .resume-upload:hover { border-color: #7c3aed; background: rgba(124,58,237,0.03); }
        .resume-upload i { font-size: 2rem; color: #7c3aed; margin-bottom: 0.5rem; }
        .resume-upload p { font-size: 13px; color: #6B7280; }
        .resume-upload .filename { font-size: 13px; color: #059669; font-weight: 600; margin-top: 8px; }

        .submit-btn {
            width: 100%; padding: 12px;
            background: linear-gradient(135deg, #7c3aed, #ec4899);
            color: #fff; border: none; border-radius: 10px;
            font-size: 15px; font-weight: 700; cursor: pointer;
            font-family: inherit; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 0.5rem;
        }
        .submit-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(124,58,237,0.3); }
        .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .submit-btn .spinner {
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #fff; border-radius: 50%;
            animation: spin 0.7s linear infinite; display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .auth-links { text-align: center; margin-top: 1.2rem; font-size: 0.85rem; color: #6B7280; }
        .auth-links a { color: #7c3aed; font-weight: 600; text-decoration: none; }
        .auth-links a:hover { text-decoration: underline; }

        .toast {
            position: fixed; top: 20px; right: 20px;
            padding: 14px 20px; border-radius: 10px;
            font-size: 14px; font-weight: 600; color: #fff;
            z-index: 10000; max-width: 400px;
            animation: toastIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .toast-success { background: #059669; }
        .toast-error { background: #DC2626; }
        .toast-info { background: #2563EB; }
        @keyframes toastIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        @media (max-width: 768px) {
            .auth-left { display: none; }
            body { background: #fff; }
            .auth-form { box-shadow: none; padding: 20px; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Left Panel -->
    <div class="auth-left">
        <div class="auth-left-content">
            <h2>Start Your Career Journey</h2>
            <p>Join thousands of candidates finding dream jobs through AI-powered matching.</p>
            <ul class="benefit-list">
                <li><i class="fas fa-check-circle"></i> AI resume scoring & optimization</li>
                <li><i class="fas fa-check-circle"></i> Matched to relevant job openings</li>
                <li><i class="fas fa-check-circle"></i> Practice with AI mock interviews</li>
                <li><i class="fas fa-check-circle"></i> Track all your applications</li>
                <li><i class="fas fa-check-circle"></i> Get noticed by top companies</li>
                <li><i class="fas fa-check-circle"></i> Career Lab tools access</li>
            </ul>
        </div>
    </div>

    <!-- Right Panel (Form) -->
    <div class="auth-right">
        <div class="auth-form">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-user-plus"></i></div>
                <div class="logo-text">SIMPATICO <span>HR</span></div>
            </div>

            <h2>Candidate Registration</h2>
            <p class="subtitle">Create your profile and get discovered</p>

            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="fullName" placeholder="Your full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone *</label>
                        <input type="tel" class="form-input" id="phone" placeholder="+91 98765 43210" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-input" id="email" placeholder="you@email.com" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Experience Level</label>
                        <select class="form-select" id="experience">
                            <option value="">Select level</option>
                            <option value="fresher">Fresher (0-1 yr)</option>
                            <option value="junior">Junior (1-3 yrs)</option>
                            <option value="mid">Mid (3-6 yrs)</option>
                            <option value="senior">Senior (6-10 yrs)</option>
                            <option value="lead">Lead (10+ yrs)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preferred Sector</label>
                        <select class="form-select" id="sector">
                            <option value="">Select sector</option>
                            <option value="IT & Technology">IT & Technology</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Finance">Finance & Banking</option>
                            <option value="Retail">Retail & FMCG</option>
                            <option value="Oil & Gas">Oil & Gas</option>
                            <option value="Hospitality">Hospitality</option>
                            <option value="Logistics">Logistics</option>
                            <option value="Education">Education</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Key Skills</label>
                    <input type="text" class="form-input" id="skills" placeholder="e.g. Python, React, Project Management">
                </div>

                <div class="form-group">
                    <label class="form-label">Current Location</label>
                    <input type="text" class="form-input" id="location" placeholder="e.g. Kerala, India">
                </div>

                <!-- Resume Upload -->
                <div class="form-group">
                    <label class="form-label">Resume (PDF)</label>
                    <div class="resume-upload" onclick="document.getElementById('resumeFile').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload your resume (PDF, max 5MB)</p>
                        <div class="filename" id="fileName"></div>
                    </div>
                    <input type="file" id="resumeFile" accept=".pdf" style="display:none" onchange="showFileName(this)">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-input" id="password" placeholder="Min 8 characters" required minlength="8">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm password" required>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    <span class="spinner" id="spinner"></span>
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </form>

            <div class="auth-links">
                Already have an account? <a href="login.html">Sign In</a>
                <br>
                <a href="register-company.html" style="font-weight:400;font-size:12px">Or register a company â†’</a>
            </div>
        </div>
    </div>

    <script>
    const API = 'https://evalis-ai.simpaticohrconsultancy.workers.dev';

    function showFileName(input) {
        const fn = document.getElementById('fileName');
        if (input.files && input.files[0]) {
            fn.textContent = 'ðŸ“„ ' + input.files[0].name;
        }
    }

    async function handleRegister(e) {
        e.preventDefault();
        
        const btn = document.getElementById('submitBtn');
        const spinner = document.getElementById('spinner');
        
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (password !== confirmPassword) {
            toast('Passwords do not match', 'error');
            return;
        }
        if (password.length < 8) {
            toast('Password must be at least 8 characters', 'error');
            return;
        }

        const payload = {
            full_name: document.getElementById('fullName').value.trim(),
            phone: document.getElementById('phone').value.trim(),
            email: document.getElementById('email').value.trim(),
            experience: document.getElementById('experience').value,
            sector: document.getElementById('sector').value,
            skills: document.getElementById('skills').value.trim(),
            location: document.getElementById('location').value.trim(),
            password: password
        };

        if (!payload.full_name || !payload.email || !payload.phone) {
            toast('Please fill in all required fields', 'error');
            return;
        }

        btn.disabled = true;
        spinner.style.display = 'inline-block';

        try {
            const res = await fetch(`${API}/api/auth/register-candidate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await res.json();

            if (!res.ok || data.error) {
                throw new Error(data.error || data.message || 'Registration failed');
            }

            // Handle resume upload if file selected
            const resumeFile = document.getElementById('resumeFile').files[0];
            if (resumeFile && data.token) {
                try {
                    const formData = new FormData();
                    formData.append('resume', resumeFile);
                    
                    await fetch(`${API}/api/candidate/upload-resume`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${data.token}` },
                        body: formData
                    });
                } catch (uploadErr) {
                    console.warn('Resume upload failed, can be done later:', uploadErr);
                }
            }

            // Save auth data
            if (data.token) {
                localStorage.setItem('simpatico_token', data.token);
                localStorage.setItem('simpatico_user', JSON.stringify(data.user || {
                    email: payload.email,
                    full_name: payload.full_name,
                    role: 'candidate'
                }));
            }

            toast('Account created successfully! Redirecting...', 'success');
            
            setTimeout(() => {
                if (data.token) {
                    window.location.href = '../dashboard/candidate.html';
                } else {
                    window.location.href = 'login.html';
                }
            }, 1500);

        } catch (err) {
            console.error('Registration error:', err);
            toast(err.message || 'Registration failed. Please try again.', 'error');
        } finally {
            btn.disabled = false;
            spinner.style.display = 'none';
        }
    }

    function toast(msg, type = 'info') {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();
        const t = document.createElement('div');
        t.className = `toast toast-${type}`;
        t.textContent = msg;
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 4000);
    }
    </script>
</body>
</html>
