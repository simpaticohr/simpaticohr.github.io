<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - SimpaticoHR Super Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:#F3F4F6; }

        /* Sidebar */
        .sidebar {
            position:fixed; left:0; top:0; bottom:0; width:260px;
            background:linear-gradient(180deg,#0F172A,#1E293B);
            color:#fff; z-index:100; display:flex; flex-direction:column;
        }
        .sidebar-header { padding:24px 20px 16px; border-bottom:1px solid rgba(255,255,255,.1); }
        .sidebar-logo { font-size:22px; font-weight:800; }
        .sidebar-logo span { color:#F59E0B; }
        .sidebar-role { font-size:11px; color:#EF4444; text-transform:uppercase; letter-spacing:1px; margin-top:4px; font-weight:700; }
        .sidebar-nav { padding:16px 12px; flex:1; }
        .nav-item {
            display:flex; align-items:center; gap:12px; padding:11px 14px;
            border-radius:10px; color:rgba(255,255,255,.7); text-decoration:none;
            font-size:14px; font-weight:500; margin-bottom:2px; cursor:pointer;
            transition:all 0.2s;
        }
        .nav-item:hover { background:rgba(255,255,255,.08); color:#fff; }
        .nav-item.active { background:rgba(239,68,68,.2); color:#fff; font-weight:600; }
        .nav-item i { width:20px; text-align:center; }
        .nav-divider { height:1px; background:rgba(255,255,255,.08); margin:12px 0; }
        .sidebar-footer { padding:16px 12px; border-top:1px solid rgba(255,255,255,.08); }

        /* Main */
        .main { margin-left:260px; min-height:100vh; }
        .topbar {
            background:#fff; padding:16px 30px;
            display:flex; align-items:center; justify-content:space-between;
            border-bottom:1px solid #E5E7EB; position:sticky; top:0; z-index:50;
        }
        .page-title { font-size:20px; font-weight:700; color:#0F172A; }
        .topbar-right { display:flex; align-items:center; gap:12px; font-size:13px; color:#6B7280; }
        .dot-live { width:8px; height:8px; background:#10B981; border-radius:50%; animation:pulse 2s infinite; display:inline-block; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

        .content { padding:24px 30px; }

        /* Tabs */
        .settings-tabs {
            display:flex; gap:4px; background:#fff; padding:6px;
            border-radius:14px; border:1px solid #E5E7EB;
            margin-bottom:24px; overflow-x:auto;
        }
        .tab-btn {
            padding:10px 18px; border-radius:10px; border:none;
            font-size:13px; font-weight:600; cursor:pointer;
            font-family:inherit; color:#6B7280; background:transparent;
            transition:all 0.2s; white-space:nowrap;
            display:flex; align-items:center; gap:8px;
        }
        .tab-btn.active { background:#0F172A; color:#fff; }
        .tab-btn:hover:not(.active) { background:#F3F4F6; color:#374151; }

        /* Tab sections */
        .tab-section { display:none; }
        .tab-section.active { display:block; }

        /* Panel */
        .panel {
            background:#fff; border-radius:14px; padding:24px;
            box-shadow:0 1px 3px rgba(0,0,0,.06); margin-bottom:24px;
            border:1px solid #F3F4F6;
        }
        .panel-header {
            display:flex; align-items:center; justify-content:space-between;
            margin-bottom:20px; padding-bottom:14px; border-bottom:1px solid #F3F4F6;
        }
        .panel-title { font-size:16px; font-weight:700; color:#0F172A; }

        /* Plan grid */
        .plan-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
        .plan-card {
            border:2px solid #E5E7EB; border-radius:14px; padding:20px;
            position:relative; transition:all 0.2s; cursor:pointer;
        }
        .plan-card:hover { border-color:#3B82F6; box-shadow:0 4px 20px rgba(59,130,246,.1); }
        .plan-card.popular { border-color:#F59E0B; }
        .popular-badge {
            position:absolute; top:-10px; left:50%; transform:translateX(-50%);
            background:#F59E0B; color:#fff; font-size:10px; font-weight:800;
            padding:3px 12px; border-radius:20px; white-space:nowrap;
        }
        .plan-name { font-size:18px; font-weight:800; color:#0F172A; margin-bottom:4px; }
        .plan-price { font-size:28px; font-weight:800; color:#3B82F6; margin:8px 0; }
        .plan-price span { font-size:14px; color:#6B7280; font-weight:500; }
        .plan-desc { font-size:13px; color:#6B7280; margin-bottom:16px; line-height:1.5; }
        .plan-features { list-style:none; margin-bottom:16px; }
        .plan-features li {
            font-size:12px; color:#374151; padding:4px 0;
            display:flex; align-items:center; gap:8px;
        }
        .plan-features li i { width:14px; font-size:11px; }
        .plan-features li i.fa-check { color:#10B981; }
        .plan-features li i.fa-times { color:#D1D5DB; }
        .plan-actions { display:flex; gap:8px; margin-top:12px; }

        /* Forms */
        .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
        .form-grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; }
        .form-group { margin-bottom:16px; }
        .form-group.full { grid-column:1/-1; }
        .form-label {
            display:block; font-size:13px; font-weight:600;
            color:#374151; margin-bottom:6px;
        }
        .form-label .hint { font-weight:400; color:#9CA3AF; font-size:11px; margin-left:6px; }
        .form-input, .form-select, .form-textarea {
            width:100%; padding:10px 12px;
            border:1.5px solid #E5E7EB; border-radius:10px;
            font-size:14px; font-family:inherit; color:#1F2937;
            background:#F9FAFB; outline:none; transition:all 0.2s;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color:#3B82F6; background:#fff;
            box-shadow:0 0 0 3px rgba(59,130,246,.08);
        }
        .form-textarea { resize:vertical; min-height:80px; }

        /* Toggle switch */
        .toggle-group {
            display:flex; align-items:center; justify-content:space-between;
            padding:12px 16px; background:#F9FAFB; border-radius:10px;
            border:1.5px solid #E5E7EB; margin-bottom:8px;
            transition:border-color 0.2s;
        }
        .toggle-group:hover { border-color:#D1D5DB; }
        .toggle-label { font-size:13px; font-weight:600; color:#374151; }
        .toggle-desc { font-size:11px; color:#9CA3AF; margin-top:2px; }
        .toggle-switch { position:relative; width:44px; height:24px; flex-shrink:0; }
        .toggle-switch input { opacity:0; width:0; height:0; }
        .toggle-slider {
            position:absolute; cursor:pointer; inset:0;
            background:#D1D5DB; border-radius:24px; transition:0.3s;
        }
        .toggle-slider:before {
            content:''; position:absolute;
            width:18px; height:18px; left:3px; bottom:3px;
            background:#fff; border-radius:50%; transition:0.3s;
            box-shadow:0 1px 3px rgba(0,0,0,.2);
        }
        .toggle-switch input:checked + .toggle-slider { background:#10B981; }
        .toggle-switch input:checked + .toggle-slider:before { transform:translateX(20px); }

        /* Feature sections */
        .feature-section { margin-bottom:20px; }
        .feature-section-title {
            font-size:12px; font-weight:700; color:#9CA3AF;
            text-transform:uppercase; letter-spacing:.8px;
            margin-bottom:10px; padding-bottom:6px;
            border-bottom:1px solid #F3F4F6;
        }

        /* Buttons */
        .btn {
            padding:10px 20px; border-radius:10px; font-size:13px;
            font-weight:700; cursor:pointer; border:none; font-family:inherit;
            transition:all 0.2s; display:inline-flex; align-items:center; gap:8px;
        }
        .btn-primary {
            background:linear-gradient(135deg,#1E40AF,#3B82F6); color:#fff;
        }
        .btn-primary:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(59,130,246,.3); }
        .btn-success {
            background:linear-gradient(135deg,#059669,#10B981); color:#fff;
        }
        .btn-success:hover { box-shadow:0 4px 12px rgba(16,185,129,.3); }
        .btn-danger { background:#FEF2F2; color:#DC2626; border:1px solid #FECACA; }
        .btn-danger:hover { background:#FEE2E2; }
        .btn-ghost { background:#F3F4F6; color:#374151; }
        .btn-ghost:hover { background:#E5E7EB; }
        .btn:disabled { opacity:.5; cursor:not-allowed; transform:none !important; }

        /* Company subscription table */
        .table-wrap { overflow-x:auto; }
        table { width:100%; border-collapse:collapse; }
        th {
            text-align:left; font-size:11px; font-weight:600; color:#6B7280;
            text-transform:uppercase; letter-spacing:.6px;
            padding:10px 14px; border-bottom:2px solid #F3F4F6;
        }
        td { padding:14px; font-size:14px; border-bottom:1px solid rgba(243,244,246,.8); vertical-align:middle; }
        tr:last-child td { border-bottom:none; }
        tr:hover td { background:#FAFBFC; }

        .badge {
            display:inline-flex; align-items:center; padding:3px 10px;
            border-radius:20px; font-size:11px; font-weight:700;
        }
        .badge-active   { background:rgba(16,185,129,.12); color:#059669; border:1px solid rgba(16,185,129,.2); }
        .badge-trial    { background:rgba(245,158,11,.12); color:#B45309; border:1px solid rgba(245,158,11,.2); }
        .badge-expired  { background:rgba(239,68,68,.1); color:#DC2626; border:1px solid rgba(239,68,68,.15); }
        .badge-premium  { background:rgba(99,102,241,.12); color:#4F46E5; border:1px solid rgba(99,102,241,.2); }

        /* Modal */
        .modal-overlay {
            position:fixed; inset:0; background:rgba(0,0,0,.5);
            z-index:1000; display:none; align-items:center; justify-content:center;
            padding:20px;
        }
        .modal-overlay.open { display:flex; }
        .modal {
            background:#fff; border-radius:16px; width:100%; max-width:680px;
            max-height:90vh; overflow-y:auto;
            box-shadow:0 25px 60px rgba(0,0,0,.2);
            animation:modalIn .25s ease;
        }
        @keyframes modalIn { from{transform:scale(.95);opacity:0} to{transform:scale(1);opacity:1} }
        .modal-header {
            padding:20px 24px; border-bottom:1px solid #F3F4F6;
            display:flex; align-items:center; justify-content:space-between;
            position:sticky; top:0; background:#fff; z-index:1;
        }
        .modal-title { font-size:17px; font-weight:700; color:#0F172A; }
        .modal-close {
            background:none; border:none; font-size:20px; cursor:pointer;
            color:#9CA3AF; transition:color 0.2s; line-height:1;
        }
        .modal-close:hover { color:#374151; }
        .modal-body { padding:24px; }
        .modal-footer {
            padding:16px 24px; border-top:1px solid #F3F4F6;
            display:flex; justify-content:flex-end; gap:10px;
            position:sticky; bottom:0; background:#fff;
        }

        /* Loader */
        .loader { text-align:center; padding:40px; }
        .loader .spin {
            width:28px; height:28px; border:3px solid #E5E7EB;
            border-top-color:#3B82F6; border-radius:50%;
            animation:spin .7s linear infinite; margin:0 auto 10px;
        }
        @keyframes spin { to{transform:rotate(360deg);} }

        /* Toast */
        .toast {
            position:fixed; top:20px; right:20px; padding:14px 20px;
            border-radius:10px; font-size:14px; font-weight:600; color:#fff;
            z-index:10000; max-width:400px; box-shadow:0 10px 30px rgba(0,0,0,.2);
            animation:toastIn .3s ease;
        }
        .toast-success { background:#059669; }
        .toast-error   { background:#DC2626; }
        .toast-info    { background:#2563EB; }
        @keyframes toastIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }

        .menu-toggle { display:none; background:none; border:none; color:#0F172A; font-size:20px; cursor:pointer; }
        @media(max-width:768px) {
            .sidebar { transform:translateX(-100%); transition:0.3s; }
            .sidebar.open { transform:translateX(0); }
            .main { margin-left:0; }
            .content { padding:16px; }
            .form-grid, .form-grid-3 { grid-template-columns:1fr; }
            .plan-grid { grid-template-columns:1fr; }
            .menu-toggle { display:block; }
        }
    </style>
</head>
<body>

<!-- ═══ SIDEBAR ═══ -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">Simpatico<span>HR</span></div>
        <div class="sidebar-role">⚡ Super Admin</div>
    </div>
    <nav class="sidebar-nav">
        <a class="nav-item" href="super-admin.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a class="nav-item" href="super-admin.html"><i class="fas fa-building"></i> Companies</a>
        <a class="nav-item" href="super-admin.html"><i class="fas fa-users"></i> All Users</a>
        <a class="nav-item" href="super-admin.html"><i class="fas fa-briefcase"></i> All Jobs</a>
        <div class="nav-divider"></div>
        <a class="nav-item" onclick="window.open('../index.html','_blank')"><i class="fas fa-external-link-alt"></i> View Website</a>
        <a class="nav-item active"><i class="fas fa-cog"></i> Settings</a>
    </nav>
    <div class="sidebar-footer">
        <a class="nav-item" onclick="signOut()" style="color:rgba(255,100,100,.8)">
            <i class="fas fa-sign-out-alt"></i> Sign Out
        </a>
    </div>
</aside>

<!-- ═══ MAIN ═══ -->
<div class="main">
    <div class="topbar">
        <div style="display:flex;align-items:center;gap:12px;">
            <button class="menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">
                <i class="fas fa-bars"></i>
            </button>
            <div class="page-title">Platform Settings</div>
        </div>
        <div class="topbar-right">
            <span class="dot-live"></span>
            <i class="fas fa-shield-alt" style="color:#EF4444"></i>
            <span id="adminName">Super Admin</span>
        </div>
    </div>

    <div class="content">

        <!-- Settings Tabs -->
        <div class="settings-tabs">
            <button class="tab-btn active" onclick="switchTab('plans')">
                <i class="fas fa-layer-group"></i> Subscription Plans
            </button>
            <button class="tab-btn" onclick="switchTab('companies')">
                <i class="fas fa-building"></i> Company Subscriptions
            </button>
            <button class="tab-btn" onclick="switchTab('platform')">
                <i class="fas fa-sliders-h"></i> Platform Config
            </button>
            <button class="tab-btn" onclick="switchTab('email')">
                <i class="fas fa-envelope"></i> Email / SMTP
            </button>
            <button class="tab-btn" onclick="switchTab('integrations')">
                <i class="fas fa-plug"></i> Integrations
            </button>
        </div>

        <!-- ══ TAB: SUBSCRIPTION PLANS ══ -->
        <div class="tab-section active" id="tab-plans">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title"><i class="fas fa-layer-group" style="color:#3B82F6;margin-right:8px"></i>Subscription Plans</div>
                    <button class="btn btn-primary" onclick="openPlanModal()">
                        <i class="fas fa-plus"></i> New Plan
                    </button>
                </div>
                <div id="plansContainer">
                    <div class="loader"><div class="spin"></div><p style="color:#9CA3AF;font-size:13px">Loading plans...</p></div>
                </div>
            </div>
        </div>

        <!-- ══ TAB: COMPANY SUBSCRIPTIONS ══ -->
        <div class="tab-section" id="tab-companies">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title"><i class="fas fa-building" style="color:#10B981;margin-right:8px"></i>Company Subscriptions</div>
                    <button class="btn btn-primary" onclick="openAssignModal()">
                        <i class="fas fa-plus"></i> Assign Plan
                    </button>
                </div>
                <div id="subscriptionsContainer">
                    <div class="loader"><div class="spin"></div><p style="color:#9CA3AF;font-size:13px">Loading...</p></div>
                </div>
            </div>
        </div>

        <!-- ══ TAB: PLATFORM CONFIG ══ -->
        <div class="tab-section" id="tab-platform">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title"><i class="fas fa-sliders-h" style="color:#8B5CF6;margin-right:8px"></i>Platform Configuration</div>
                    <button class="btn btn-success" onclick="savePlatformSettings()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
                <div id="platformSettingsContainer">
                    <div class="loader"><div class="spin"></div><p style="color:#9CA3AF;font-size:13px">Loading settings...</p></div>
                </div>
            </div>
        </div>

        <!-- ══ TAB: EMAIL / SMTP ══ -->
        <div class="tab-section" id="tab-email">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title"><i class="fas fa-envelope" style="color:#F59E0B;margin-right:8px"></i>Email / SMTP Settings</div>
                    <button class="btn btn-success" onclick="saveEmailSettings()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
                <div id="emailSettingsContainer">
                    <div class="loader"><div class="spin"></div><p style="color:#9CA3AF;font-size:13px">Loading...</p></div>
                </div>
            </div>
        </div>

        <!-- ══ TAB: INTEGRATIONS ══ -->
        <div class="tab-section" id="tab-integrations">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title"><i class="fas fa-plug" style="color:#EF4444;margin-right:8px"></i>Integrations</div>
                    <button class="btn btn-success" onclick="saveIntegrationSettings()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
                <div id="integrationSettingsContainer">
                    <div class="loader"><div class="spin"></div><p style="color:#9CA3AF;font-size:13px">Loading...</p></div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ══ PLAN MODAL ══ -->
<div class="modal-overlay" id="planModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title" id="planModalTitle">Create New Plan</div>
            <button class="modal-close" onclick="closeModal('planModal')">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="planId">

            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Plan Name</label>
                    <input type="text" class="form-input" id="planName" placeholder="e.g. Premium">
                </div>
                <div class="form-group">
                    <label class="form-label">Slug <span class="hint">lowercase, no spaces</span></label>
                    <input type="text" class="form-input" id="planSlug" placeholder="e.g. premium">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Price (₹)</label>
                    <input type="number" class="form-input" id="planPriceMonthly" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Yearly Price (₹)</label>
                    <input type="number" class="form-input" id="planPriceYearly" placeholder="0">
                </div>
                <div class="form-group full">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="planDesc" placeholder="Brief description of the plan..."></textarea>
                </div>
            </div>

            <div class="form-grid-3" style="margin-bottom:20px">
                <div class="form-group">
                    <label class="form-label">Max Jobs <span class="hint">-1 = unlimited</span></label>
                    <input type="number" class="form-input" id="planMaxJobs" value="5">
                </div>
                <div class="form-group">
                    <label class="form-label">Max Applications</label>
                    <input type="number" class="form-input" id="planMaxApps" value="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Max HR Users</label>
                    <input type="number" class="form-input" id="planMaxUsers" value="3">
                </div>
                <div class="form-group">
                    <label class="form-label">Max Interviews/Month</label>
                    <input type="number" class="form-input" id="planMaxInterviews" value="10">
                </div>
                <div class="form-group">
                    <label class="form-label">Sort Order</label>
                    <input type="number" class="form-input" id="planSortOrder" value="1">
                </div>
            </div>

            <!-- Features -->
            <div class="feature-section">
                <div class="feature-section-title">Core Features</div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Applicant Tracking System</div><div class="toggle-desc">Basic ATS for managing applications</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_ats" checked><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Email Automation</div><div class="toggle-desc">Automated email sequences for candidates</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_email"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">WhatsApp Automation</div><div class="toggle-desc">WhatsApp messaging integration</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_whatsapp"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">AI Job Description Generation</div><div class="toggle-desc">AI-powered JD creation</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_jd"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">AI Resume Matching</div><div class="toggle-desc">Automated resume scoring and shortlisting</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_resume"><span class="toggle-slider"></span></label>
                </div>
            </div>

            <div class="feature-section">
                <div class="feature-section-title">Interview Features</div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Video Interviews</div><div class="toggle-desc">Schedule and conduct video interviews</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_video"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">AI Proctoring</div><div class="toggle-desc">AI-monitored interview sessions</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_proctor"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Eye Tracking</div><div class="toggle-desc">Real-time eye movement monitoring</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_eye"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Cheat Detection</div><div class="toggle-desc">99.2% accuracy cheat detection AI</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_cheat"><span class="toggle-slider"></span></label>
                </div>
            </div>

            <div class="feature-section">
                <div class="feature-section-title">Advanced Features</div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Advanced Analytics</div><div class="toggle-desc">Detailed recruitment analytics & reports</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_analytics"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Custom Branding</div><div class="toggle-desc">Company logo and colour customisation</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_branding"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">API Access</div><div class="toggle-desc">REST API access for integrations</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_api"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Single Sign-On (SSO)</div><div class="toggle-desc">Google/Microsoft SSO integration</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_sso"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Dedicated Support</div><div class="toggle-desc">Dedicated account manager</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_support"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Data Export</div><div class="toggle-desc">Export all data to CSV/Excel</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="feat_export"><span class="toggle-slider"></span></label>
                </div>
            </div>

            <div class="form-grid" style="margin-top:16px">
                <div class="toggle-group">
                    <div><div class="toggle-label">Mark as Popular</div><div class="toggle-desc">Show "Most Popular" badge</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="planPopular"><span class="toggle-slider"></span></label>
                </div>
                <div class="toggle-group">
                    <div><div class="toggle-label">Active</div><div class="toggle-desc">Plan is visible and assignable</div></div>
                    <label class="toggle-switch"><input type="checkbox" id="planActive" checked><span class="toggle-slider"></span></label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" onclick="closeModal('planModal')">Cancel</button>
            <button class="btn btn-primary" id="savePlanBtn" onclick="savePlan()">
                <i class="fas fa-save"></i> Save Plan
            </button>
        </div>
    </div>
</div>

<!-- ══ ASSIGN PLAN MODAL ══ -->
<div class="modal-overlay" id="assignModal">
    <div class="modal" style="max-width:480px">
        <div class="modal-header">
            <div class="modal-title">Assign / Update Plan</div>
            <button class="modal-close" onclick="closeModal('assignModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Company</label>
                <select class="form-select" id="assignCompany"></select>
            </div>
            <div class="form-group">
                <label class="form-label">Subscription Plan</label>
                <select class="form-select" id="assignPlan"></select>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Billing Cycle</label>
                    <select class="form-select" id="assignCycle">
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                        <option value="lifetime">Lifetime</option>
                        <option value="manual">Manual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount Paid (₹)</label>
                    <input type="number" class="form-input" id="assignAmount" placeholder="0">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Expires At <span class="hint">leave blank = never expires</span></label>
                <input type="date" class="form-input" id="assignExpiry">
            </div>
            <div class="form-group">
                <label class="form-label">Notes <span class="hint">internal only</span></label>
                <textarea class="form-textarea" id="assignNotes" placeholder="e.g. Paid via bank transfer, invoice #123"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" onclick="closeModal('assignModal')">Cancel</button>
            <button class="btn btn-success" onclick="saveAssignment()">
                <i class="fas fa-check"></i> Assign Plan
            </button>
        </div>
    </div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════════
// CONFIGURATION
// ═══════════════════════════════════════════════════════════════════
const SUPABASE_URL      = "https://cvkxtsvgnynxexmemfuy.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3h0c3ZnbnlueGV4bWVtZnV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0MjE2NTEsImV4cCI6MjA4Mjk5NzY1MX0.2mys8Cc-ucJ1uLThEGJubeDEg1TvfIAkW-xFsR4ecq4";

const token = localStorage.getItem('simpatico_token') || sessionStorage.getItem('simpatico_token');
const user  = JSON.parse(localStorage.getItem('simpatico_user') || sessionStorage.getItem('simpatico_user') || '{}');

if (!token || user.role !== 'super_admin') {
    window.location.href = 'login.html';
}

const sbHeaders = {
    'apikey':        SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${token}`,
    'Content-Type':  'application/json',
    'Prefer':        'return=representation'
};

try { document.getElementById('adminName').textContent = user.email || 'Super Admin'; } catch(e) {}

// ═══════════════════════════════════════════════════════════════════
// HELPERS
// ═══════════════════════════════════════════════════════════════════
async function sbQuery(table, params = '') {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${params}`, { headers: sbHeaders });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.message || data?.hint || JSON.stringify(data));
    return data;
}

async function sbInsert(table, body) {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
        method: 'POST', headers: sbHeaders, body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.message || data?.hint || JSON.stringify(data));
    return Array.isArray(data) ? data[0] : data;
}

async function sbUpdate(table, filter, body) {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${filter}`, {
        method: 'PATCH', headers: sbHeaders, body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.message || data?.hint || JSON.stringify(data));
    return Array.isArray(data) ? data[0] : data;
}

async function sbUpsert(table, body, onConflict = '') {
    const headers = { ...sbHeaders, 'Prefer': `resolution=merge-duplicates,return=representation` };
    const url = onConflict
        ? `${SUPABASE_URL}/rest/v1/${table}?on_conflict=${onConflict}`
        : `${SUPABASE_URL}/rest/v1/${table}`;
    const res = await fetch(url, {
        method: 'POST', headers, body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.message || data?.hint || JSON.stringify(data));
    return data;
}

async function sbDelete(table, filter) {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${filter}`, {
        method: 'DELETE', headers: sbHeaders
    });
    if (!res.ok) {
        const data = await res.json();
        throw new Error(data?.message || 'Delete failed');
    }
}

function esc(str) {
    return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function formatDate(d) {
    if (!d) return '—';
    return new Date(d).toLocaleDateString('en-IN', { day:'numeric', month:'short', year:'numeric' });
}

// ═══════════════════════════════════════════════════════════════════
// TABS
// ═══════════════════════════════════════════════════════════════════
const tabLoaded = {};
function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-section').forEach(s => s.classList.remove('active'));
    event.currentTarget.classList.add('active');
    document.getElementById(`tab-${tab}`).classList.add('active');

    if (!tabLoaded[tab]) {
        tabLoaded[tab] = true;
        if (tab === 'plans')        loadPlans();
        if (tab === 'companies')    loadCompanySubscriptions();
        if (tab === 'platform')     loadSettingsGroup('general');
        if (tab === 'email')        loadSettingsGroup('email');
        if (tab === 'integrations') loadSettingsGroup('integrations');
    }
}

// ═══════════════════════════════════════════════════════════════════
// PLANS
// ═══════════════════════════════════════════════════════════════════
let allPlans = [];

async function loadPlans() {
    try {
        allPlans = await sbQuery('subscription_plans', 'select=*&order=sort_order.asc');
        renderPlans();
    } catch(e) {
        document.getElementById('plansContainer').innerHTML =
            `<p style="color:#EF4444;padding:20px;text-align:center">${e.message}</p>`;
    }
}

function renderPlans() {
    const container = document.getElementById('plansContainer');
    if (!allPlans.length) {
        container.innerHTML = '<p style="text-align:center;color:#9CA3AF;padding:30px">No plans yet. Create one above.</p>';
        return;
    }
    container.innerHTML = `<div class="plan-grid">${allPlans.map(p => `
        <div class="plan-card ${p.is_popular ? 'popular' : ''}">
            ${p.is_popular ? '<div class="popular-badge">⭐ Most Popular</div>' : ''}
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
                <div class="plan-name">${esc(p.name)}</div>
                <span class="badge ${p.is_active ? 'badge-active' : 'badge-expired'}">${p.is_active ? 'Active' : 'Inactive'}</span>
            </div>
            <div class="plan-price">₹${(p.price_monthly||0).toLocaleString()}<span>/mo</span></div>
            <div class="plan-desc">${esc(p.description || '')}</div>
            <ul class="plan-features">
                <li><i class="fas ${p.max_jobs === -1 ? 'fa-infinity' : 'fa-briefcase'}" style="color:#3B82F6"></i> ${p.max_jobs === -1 ? 'Unlimited' : p.max_jobs} Jobs</li>
                <li><i class="fas ${p.max_users === -1 ? 'fa-infinity' : 'fa-users'}" style="color:#10B981"></i> ${p.max_users === -1 ? 'Unlimited' : p.max_users} HR Users</li>
                <li><i class="fas ${p.feature_ai_proctoring ? 'fa-check' : 'fa-times'}"></i> AI Proctoring</li>
                <li><i class="fas ${p.feature_eye_tracking ? 'fa-check' : 'fa-times'}"></i> Eye Tracking</li>
                <li><i class="fas ${p.feature_whatsapp ? 'fa-check' : 'fa-times'}"></i> WhatsApp Automation</li>
                <li><i class="fas ${p.feature_resume_matching ? 'fa-check' : 'fa-times'}"></i> AI Resume Matching</li>
                <li><i class="fas ${p.feature_custom_branding ? 'fa-check' : 'fa-times'}"></i> Custom Branding</li>
                <li><i class="fas ${p.feature_dedicated_support ? 'fa-check' : 'fa-times'}"></i> Dedicated Support</li>
            </ul>
            <div class="plan-actions">
                <button class="btn btn-ghost" style="flex:1;font-size:12px" onclick="editPlan('${p.id}')">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger" style="font-size:12px" onclick="deletePlan('${p.id}','${esc(p.name)}')">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `).join('')}</div>`;
}

function openPlanModal(plan = null) {
    document.getElementById('planModalTitle').textContent = plan ? 'Edit Plan' : 'Create New Plan';
    document.getElementById('planId').value       = plan?.id || '';
    document.getElementById('planName').value     = plan?.name || '';
    document.getElementById('planSlug').value     = plan?.slug || '';
    document.getElementById('planDesc').value     = plan?.description || '';
    document.getElementById('planPriceMonthly').value = plan?.price_monthly || 0;
    document.getElementById('planPriceYearly').value  = plan?.price_yearly || 0;
    document.getElementById('planMaxJobs').value       = plan?.max_jobs ?? 5;
    document.getElementById('planMaxApps').value       = plan?.max_applications ?? 100;
    document.getElementById('planMaxUsers').value      = plan?.max_users ?? 3;
    document.getElementById('planMaxInterviews').value = plan?.max_interviews_per_month ?? 10;
    document.getElementById('planSortOrder').value     = plan?.sort_order ?? 1;
    document.getElementById('planPopular').checked     = plan?.is_popular || false;
    document.getElementById('planActive').checked      = plan?.is_active ?? true;

    // Feature toggles
    const featureMap = {
        feat_ats:      'feature_ats',
        feat_email:    'feature_email_automation',
        feat_whatsapp: 'feature_whatsapp',
        feat_jd:       'feature_jd_generation',
        feat_resume:   'feature_resume_matching',
        feat_video:    'feature_video_interviews',
        feat_proctor:  'feature_ai_proctoring',
        feat_eye:      'feature_eye_tracking',
        feat_cheat:    'feature_cheat_detection',
        feat_analytics:'feature_analytics',
        feat_branding: 'feature_custom_branding',
        feat_api:      'feature_api_access',
        feat_sso:      'feature_sso',
        feat_support:  'feature_dedicated_support',
        feat_export:   'feature_data_export',
    };
    for (const [elId, key] of Object.entries(featureMap)) {
        const el = document.getElementById(elId);
        if (el) el.checked = plan ? (plan[key] || false) : (key === 'feature_ats');
    }

    document.getElementById('planModal').classList.add('open');
}

function editPlan(id) {
    const plan = allPlans.find(p => p.id === id);
    if (plan) openPlanModal(plan);
}

async function savePlan() {
    const btn = document.getElementById('savePlanBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

    const id = document.getElementById('planId').value;
    const body = {
        name:                      document.getElementById('planName').value.trim(),
        slug:                      document.getElementById('planSlug').value.trim().toLowerCase().replace(/\s+/g,'-'),
        description:               document.getElementById('planDesc').value.trim(),
        price_monthly:             parseFloat(document.getElementById('planPriceMonthly').value) || 0,
        price_yearly:              parseFloat(document.getElementById('planPriceYearly').value) || 0,
        max_jobs:                  parseInt(document.getElementById('planMaxJobs').value),
        max_applications:          parseInt(document.getElementById('planMaxApps').value),
        max_users:                 parseInt(document.getElementById('planMaxUsers').value),
        max_interviews_per_month:  parseInt(document.getElementById('planMaxInterviews').value),
        sort_order:                parseInt(document.getElementById('planSortOrder').value),
        is_popular:                document.getElementById('planPopular').checked,
        is_active:                 document.getElementById('planActive').checked,
        feature_ats:               document.getElementById('feat_ats').checked,
        feature_email_automation:  document.getElementById('feat_email').checked,
        feature_whatsapp:          document.getElementById('feat_whatsapp').checked,
        feature_jd_generation:     document.getElementById('feat_jd').checked,
        feature_resume_matching:   document.getElementById('feat_resume').checked,
        feature_video_interviews:  document.getElementById('feat_video').checked,
        feature_ai_proctoring:     document.getElementById('feat_proctor').checked,
        feature_eye_tracking:      document.getElementById('feat_eye').checked,
        feature_cheat_detection:   document.getElementById('feat_cheat').checked,
        feature_analytics:         document.getElementById('feat_analytics').checked,
        feature_custom_branding:   document.getElementById('feat_branding').checked,
        feature_api_access:        document.getElementById('feat_api').checked,
        feature_sso:               document.getElementById('feat_sso').checked,
        feature_dedicated_support: document.getElementById('feat_support').checked,
        feature_data_export:       document.getElementById('feat_export').checked,
    };

    try {
        if (id) {
            await sbUpdate('subscription_plans', `id=eq.${id}`, body);
            toast('Plan updated successfully', 'success');
        } else {
            await sbInsert('subscription_plans', body);
            toast('Plan created successfully', 'success');
        }
        closeModal('planModal');
        tabLoaded['plans'] = false;
        allPlans = [];
        loadPlans();
    } catch(e) {
        toast(e.message, 'error');
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-save"></i> Save Plan';
    }
}

async function deletePlan(id, name) {
    if (!confirm(`Delete plan "${name}"? This cannot be undone.`)) return;
    try {
        await sbDelete('subscription_plans', `id=eq.${id}`);
        toast('Plan deleted', 'success');
        tabLoaded['plans'] = false;
        allPlans = [];
        loadPlans();
    } catch(e) {
        toast(e.message, 'error');
    }
}

// ═══════════════════════════════════════════════════════════════════
// COMPANY SUBSCRIPTIONS
// ═══════════════════════════════════════════════════════════════════
async function loadCompanySubscriptions() {
    try {
        const [subs, plans, companies] = await Promise.all([
            sbQuery('company_subscriptions', 'select=*,subscription_plans(name,slug),companies(name,contact_email)&order=created_at.desc'),
            sbQuery('subscription_plans', 'select=id,name,slug&is_active=eq.true&order=sort_order.asc'),
            sbQuery('companies', 'select=id,name&order=name.asc')
        ]);

        // Populate assign modal dropdowns
        document.getElementById('assignCompany').innerHTML =
            companies.map(c => `<option value="${c.id}">${esc(c.name)}</option>`).join('');
        document.getElementById('assignPlan').innerHTML =
            plans.map(p => `<option value="${p.id}">${esc(p.name)}</option>`).join('');

        const container = document.getElementById('subscriptionsContainer');

        if (!subs.length) {
            container.innerHTML = '<p style="text-align:center;color:#9CA3AF;padding:30px">No subscriptions assigned yet.</p>';
            return;
        }

        container.innerHTML = `
            <div class="table-wrap">
                <table>
                    <thead><tr>
                        <th>Company</th><th>Plan</th><th>Billing</th>
                        <th>Amount Paid</th><th>Expires</th><th>Status</th><th>Actions</th>
                    </tr></thead>
                    <tbody>
                        ${subs.map(s => `<tr>
                            <td>
                                <strong>${esc(s.companies?.name || '—')}</strong><br>
                                <span style="font-size:12px;color:#9CA3AF">${esc(s.companies?.contact_email || '')}</span>
                            </td>
                            <td><strong>${esc(s.subscription_plans?.name || '—')}</strong></td>
                            <td style="font-size:13px">${esc(s.billing_cycle || '—')}</td>
                            <td style="font-size:13px">₹${(s.amount_paid||0).toLocaleString()}</td>
                            <td style="font-size:13px">${s.expires_at ? formatDate(s.expires_at) : '<span style="color:#10B981">Never</span>'}</td>
                            <td><span class="badge badge-${s.status === 'active' ? 'active' : 'expired'}">${esc(s.status)}</span></td>
                            <td>
                                <button class="btn btn-ghost" style="font-size:12px;padding:6px 10px"
                                    onclick="editSubscription('${s.id}','${s.company_id}','${s.plan_id}','${s.billing_cycle}',${s.amount_paid||0},'${s.expires_at||''}','${esc(s.notes||'')}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        `;
    } catch(e) {
        document.getElementById('subscriptionsContainer').innerHTML =
            `<p style="color:#EF4444;padding:20px;text-align:center">${e.message}</p>`;
    }
}

function openAssignModal() {
    document.getElementById('assignModal').dataset.editId = '';
    document.getElementById('assignAmount').value = '';
    document.getElementById('assignExpiry').value = '';
    document.getElementById('assignNotes').value = '';
    document.getElementById('assignModal').classList.add('open');
}

function editSubscription(id, companyId, planId, cycle, amount, expiry, notes) {
    document.getElementById('assignModal').dataset.editId = id;
    document.getElementById('assignCompany').value = companyId;
    document.getElementById('assignPlan').value = planId;
    document.getElementById('assignCycle').value = cycle;
    document.getElementById('assignAmount').value = amount;
    document.getElementById('assignExpiry').value = expiry ? expiry.split('T')[0] : '';
    document.getElementById('assignNotes').value = notes;
    document.getElementById('assignModal').classList.add('open');
}

async function saveAssignment() {
    const editId = document.getElementById('assignModal').dataset.editId;
    const body = {
        company_id:    document.getElementById('assignCompany').value,
        plan_id:       document.getElementById('assignPlan').value,
        billing_cycle: document.getElementById('assignCycle').value,
        amount_paid:   parseFloat(document.getElementById('assignAmount').value) || 0,
        expires_at:    document.getElementById('assignExpiry').value || null,
        notes:         document.getElementById('assignNotes').value.trim(),
        status:        'active',
        assigned_by:   user.id || null
    };

    try {
        if (editId) {
            await sbUpdate('company_subscriptions', `id=eq.${editId}`, body);
            toast('Subscription updated', 'success');
        } else {
            await sbUpsert('company_subscriptions', body, 'company_id');
            toast('Plan assigned successfully', 'success');
        }
        closeModal('assignModal');
        tabLoaded['companies'] = false;
        loadCompanySubscriptions();
    } catch(e) {
        toast(e.message, 'error');
    }
}

// ═══════════════════════════════════════════════════════════════════
// PLATFORM SETTINGS
// ═══════════════════════════════════════════════════════════════════
async function loadSettingsGroup(group) {
    const containerId = group === 'general' ? 'platformSettingsContainer'
                      : group === 'email'   ? 'emailSettingsContainer'
                      : 'integrationSettingsContainer';

    try {
        const settings = await sbQuery('platform_settings', `group_name=eq.${group}&order=key.asc`);
        const container = document.getElementById(containerId);

        if (!settings.length) {
            container.innerHTML = '<p style="text-align:center;color:#9CA3AF;padding:30px">No settings found for this group.</p>';
            return;
        }

        container.innerHTML = `
            <div class="form-grid">
                ${settings.map(s => `
                    <div class="form-group ${s.type === 'boolean' ? 'full' : ''}">
                        ${s.type === 'boolean' ? `
                            <div class="toggle-group">
                                <div>
                                    <div class="toggle-label">${esc(s.label || s.key)}</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" data-key="${esc(s.key)}" data-type="boolean"
                                        ${s.value === 'true' ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        ` : `
                            <label class="form-label">${esc(s.label || s.key)}</label>
                            <input type="${s.type === 'number' ? 'number' : s.type === 'email' ? 'email' : s.type === 'url' ? 'url' : 'text'}"
                                class="form-input"
                                data-key="${esc(s.key)}"
                                value="${esc(s.value || '')}"
                                placeholder="${esc(s.label || s.key)}">
                        `}
                    </div>
                `).join('')}
            </div>
        `;
    } catch(e) {
        const container = document.getElementById(containerId);
        container.innerHTML = `<p style="color:#EF4444;padding:20px;text-align:center">${e.message}</p>`;
    }
}

async function saveSettingsFromContainer(containerId) {
    const container = document.getElementById(containerId);
    const inputs = container.querySelectorAll('[data-key]');
    const updates = [];

    inputs.forEach(el => {
        const key   = el.dataset.key;
        const type  = el.dataset.type;
        const value = type === 'boolean' ? String(el.checked) : el.value;
        updates.push({ key, value, updated_at: new Date().toISOString() });
    });

    try {
        await sbUpsert('platform_settings', updates, 'key');
        toast('Settings saved successfully', 'success');
    } catch(e) {
        toast(e.message, 'error');
    }
}

function savePlatformSettings()    { saveSettingsFromContainer('platformSettingsContainer'); }
function saveEmailSettings()       { saveSettingsFromContainer('emailSettingsContainer'); }
function saveIntegrationSettings() { saveSettingsFromContainer('integrationSettingsContainer'); }

// ═══════════════════════════════════════════════════════════════════
// MODAL HELPERS
// ═══════════════════════════════════════════════════════════════════
function closeModal(id) {
    document.getElementById(id).classList.remove('open');
}
// Close on backdrop click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.addEventListener('click', e => {
        if (e.target === overlay) overlay.classList.remove('open');
    });
});

// ═══════════════════════════════════════════════════════════════════
// SIGN OUT / TOAST
// ═══════════════════════════════════════════════════════════════════
function signOut() {
    if (confirm('Sign out?')) {
        ['simpatico_token','simpatico_user','simpatico_refresh','simpatico_company'].forEach(k => {
            localStorage.removeItem(k); sessionStorage.removeItem(k);
        });
        window.location.href = 'login.html';
    }
}

function toast(msg, type = 'info') {
    document.querySelectorAll('.toast').forEach(t => t.remove());
    const t = document.createElement('div');
    t.className = `toast toast-${type}`;
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 4000);
}

// ═══════════════════════════════════════════════════════════════════
// INIT — load first tab
// ═══════════════════════════════════════════════════════════════════
tabLoaded['plans'] = true;
loadPlans();
</script>
</body>
</html>
