<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin | Simpatico HR</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#020617;--card:rgba(15,23,42,.65);--border:rgba(255,255,255,.08);--accent:#6366f1;--accent2:#8b5cf6;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--blue:#3b82f6;--text:#f8fafc;--muted:#94a3b8;--glow:rgba(99,102,241,.15)}
    body{font-family:'Plus Jakarta Sans',system-ui,sans-serif;background:radial-gradient(circle at 10% 20%,rgba(99,102,241,.15),transparent 40%),radial-gradient(circle at 90% 80%,rgba(79,70,229,.1),transparent 40%),var(--bg);color:var(--text);min-height:100vh;line-height:1.5}
    .top-nav{backdrop-filter:blur(16px);background:rgba(2,6,23,.85);padding:1rem 6%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
    .top-logo{font-weight:800;font-size:1.1rem;color:#fff;text-decoration:none}.top-logo span{color:var(--accent)}
    .top-links{display:flex;gap:12px;align-items:center}
    .top-link{color:var(--muted);text-decoration:none;font-size:12px;font-weight:600;padding:6px 12px;border-radius:8px;transition:all 0.2s}
    .top-link:hover{color:#fff;background:rgba(255,255,255,.05)}
    .container{max-width:900px;margin:0 auto;padding:20px}
    .login-card{max-width:400px;margin:80px auto;background:var(--card);border:1px solid var(--border);border-radius:24px;padding:40px;text-align:center;backdrop-filter:blur(22px)}
    .login-card h1{font-size:1.5rem;margin-bottom:8px;background:linear-gradient(135deg,#f59e0b,#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .login-card p{color:var(--muted);font-size:0.88rem;margin-bottom:24px}
    .login-input{width:100%;padding:14px 16px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:1rem;outline:none;font-family:inherit;margin-bottom:16px;text-align:center;letter-spacing:2px}
    .login-input:focus{border-color:rgba(245,158,11,.4);box-shadow:0 0 0 3px rgba(245,158,11,.1)}
    .login-btn{width:100%;padding:14px;background:linear-gradient(135deg,#f59e0b,#ef4444);border:none;border-radius:14px;color:#fff;font-size:1rem;font-weight:800;cursor:pointer;font-family:inherit;transition:all 0.2s}
    .login-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,158,11,.3)}
    .login-error{color:var(--red);font-size:0.85rem;margin-top:12px;display:none}
    .admin-wrap{display:none}
    .admin-header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid var(--border);margin-bottom:20px}
    .admin-header h1{font-size:1.4rem;background:linear-gradient(135deg,#f59e0b,#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .admin-tabs{display:flex;gap:0;background:rgba(255,255,255,.03);border-radius:14px;padding:4px;border:1px solid var(--border);margin-bottom:20px;flex-wrap:wrap}
    .admin-tab{flex:1;padding:10px 6px;text-align:center;border:none;background:transparent;color:var(--muted);font-size:0.72rem;font-weight:700;cursor:pointer;border-radius:10px;transition:all 0.2s;font-family:inherit;min-width:70px}
    .admin-tab.active{background:linear-gradient(135deg,#f59e0b,#ef4444);color:#fff}
    .admin-tab:hover:not(.active){background:rgba(245,158,11,.1)}
    .card{background:var(--card);backdrop-filter:blur(22px);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px}
    .card h3{font-size:0.95rem;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:#f59e0b}
    label{display:block;font-size:0.78rem;color:var(--muted);margin:12px 0 4px;font-weight:600}
    select,input[type="text"],input[type="email"],input[type="number"],input[type="password"],input[type="date"],textarea{width:100%;padding:10px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;outline:none;transition:border-color 0.2s;font-family:inherit}
    select:focus,input:focus,textarea:focus{border-color:rgba(245,158,11,.4);box-shadow:0 0 0 3px rgba(245,158,11,.1)}
    select option{background:#1e293b}
    textarea{resize:vertical;min-height:60px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
    .stat-card{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
    .stat-num{font-size:1.6rem;font-weight:800}.stat-lbl{font-size:0.7rem;color:var(--muted)}
    .edit-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);flex-wrap:wrap}.edit-row:last-child{border-bottom:none}
    .edit-label{font-size:0.8rem;color:var(--muted);min-width:140px;font-weight:600}
    .edit-input{flex:1;padding:8px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;font-family:inherit;outline:none;min-width:200px}
    .edit-input:focus{border-color:rgba(245,158,11,.4)}
    .edit-color{width:40px;height:32px;border:none;border-radius:6px;cursor:pointer;background:transparent}
    .edit-preview{font-size:0.75rem;color:var(--muted);padding:2px 8px;background:rgba(255,255,255,.03);border-radius:6px}
    .edit-textarea{width:100%;min-height:80px;padding:10px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.85rem;font-family:inherit;outline:none;resize:vertical;margin-top:6px}
    .pay-table{width:100%;border-collapse:collapse;font-size:0.82rem}.pay-table th{text-align:left;padding:8px;color:var(--muted);font-weight:700;border-bottom:1px solid var(--border);font-size:0.75rem}.pay-table td{padding:8px;border-bottom:1px solid var(--border)}
    .toggle-switch{position:relative;width:44px;height:24px;background:rgba(255,255,255,.1);border-radius:12px;cursor:pointer;transition:all 0.3s;flex-shrink:0}
    .toggle-switch.on{background:var(--green)}.toggle-switch::after{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:all 0.3s}.toggle-switch.on::after{left:23px}
    .btn{padding:8px 16px;border:none;border-radius:8px;font-size:0.82rem;font-weight:700;cursor:pointer;font-family:inherit;transition:all 0.2s;color:#fff}
    .btn-save{background:linear-gradient(135deg,#10b981,#059669)}.btn-danger{background:rgba(239,68,68,.15);color:var(--red)}.btn-primary{background:linear-gradient(135deg,#f59e0b,#ef4444)}.btn-accent{background:var(--accent)}.btn-full{width:100%;padding:14px;font-size:1rem;border-radius:14px}
    .btn:hover{transform:translateY(-1px)}
    .status-pill{padding:2px 8px;border-radius:10px;font-size:0.72rem;font-weight:700;display:inline-block}
    .score-badge{padding:2px 8px;border-radius:8px;font-size:0.75rem;font-weight:700;display:inline-block}
    .activity-log{max-height:250px;overflow-y:auto;font-size:0.78rem;color:var(--muted);background:rgba(0,0,0,.3);border-radius:10px;padding:10px}
    .activity-log div{padding:4px 0;border-bottom:1px solid rgba(255,255,255,.03)}
    .cand-row{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border);gap:8px;flex-wrap:wrap}.cand-row:last-child{border-bottom:none}
    .cand-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.8rem;flex-shrink:0}
    .toast-box{position:fixed;top:16px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px}
    .toast{background:rgba(15,23,42,.9);backdrop-filter:blur(12px);border:1px solid var(--border);color:var(--text);padding:10px 18px;border-radius:12px;font-size:0.85rem;box-shadow:0 8px 24px rgba(0,0,0,.4);animation:tIn .3s ease,tOut .3s ease 2.7s forwards}
    @keyframes tIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes tOut{to{transform:translateX(120%);opacity:0}}
    .hidden{display:none!important}
    .loading{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .job-card{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s}
    .job-card:hover{border-color:rgba(99,102,241,.3)}
    .job-card h4{font-size:0.95rem;margin-bottom:4px;color:var(--accent)}
    .job-meta{font-size:0.78rem;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}
    @media(max-width:600px){.stat-grid{grid-template-columns:1fr 1fr}.row2,.row3{grid-template-columns:1fr}.edit-row{flex-direction:column;align-items:flex-start}.edit-input{width:100%}.admin-tab{font-size:0.65rem;min-width:50px;padding:8px 4px}.cand-row{flex-direction:column;align-items:flex-start}.top-nav{padding:1rem 4%}}
  </style>
</head>
<body>
  <div class="toast-box" id="toasts"></div>

  <nav class="top-nav">
    <a class="top-logo" href="evalis-platform.html">SIMPATICO <span>HR</span></a>
    <div class="top-links">
      <a class="top-link" href="evalis-platform.html">ğŸ  Platform</a>
      <a class="top-link" href="career-lab.html">ğŸ§  Career Lab</a>
      <span class="top-link" style="color:var(--yellow);">ğŸ” Admin</span>
    </div>
  </nav>

  <!-- LOGIN -->
  <div id="loginScreen">
    <div class="login-card">
      <div style="font-size:3rem;margin-bottom:12px;">ğŸ”</div>
      <h1>Super Admin</h1>
      <p>Enter password to access</p>
      <input type="password" class="login-input" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()">
      <button class="login-btn" onclick="doLogin()">ğŸ”“ Login</button>
      <div class="login-error" id="loginError">âŒ Wrong password</div>
    </div>
  </div>

  <!-- ADMIN -->
  <div class="admin-wrap" id="adminWrap">
    <div class="container">
      <div class="admin-header">
        <h1>ğŸ” Super Admin Panel</h1>
        <button class="btn btn-danger" onclick="doLogout()">ğŸšª Logout</button>
      </div>

      <div class="admin-tabs" id="adminTabs">
        <button class="admin-tab active" onclick="showTab('dashboard')">ğŸ“Š Dash</button>
        <button class="admin-tab" onclick="showTab('editor')">ğŸ¨ Site</button>
        <button class="admin-tab" onclick="showTab('payments')">ğŸ’³ Pay</button>
        <button class="admin-tab" onclick="showTab('access')">ğŸ”‘ Codes</button>
        <button class="admin-tab" onclick="showTab('clients')">ğŸ¢ Clients</button>
        <button class="admin-tab" onclick="showTab('jobs')">ğŸ’¼ Jobs</button>
        <button class="admin-tab" onclick="showTab('candidates')">ğŸ‘¥ People</button>
        <button class="admin-tab" onclick="showTab('settings')">âš™ï¸ Set</button>
      </div>

      <!-- DASHBOARD -->
      <div id="tab-dashboard">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="sRevenue">â‚¹0</div><div class="stat-lbl">Revenue</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="sUsers">0</div><div class="stat-lbl">Applications</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="sInterviews">0</div><div class="stat-lbl">Interviews</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="sJobs">0</div><div class="stat-lbl">Jobs</div></div>
        </div>
        <div class="card"><h3>ğŸ“ˆ Activity</h3><div class="activity-log" id="activityLog">Loading...</div></div>
        <div class="card"><h3>âš¡ Quick Actions</h3><div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-primary" onclick="showTab('editor')">ğŸ¨ Edit Site</button>
          <button class="btn btn-save" onclick="showTab('payments')">ğŸ’³ Payments</button>
          <button class="btn btn-accent" onclick="showTab('clients')">ğŸ¢ Clients</button>
          <button class="btn" style="background:var(--blue);" onclick="exportAllData()">ğŸ“¥ Export</button>
        </div></div>
      </div>

      <!-- EDITOR -->
      <div id="tab-editor" class="hidden">
        <div class="card"><h3>ğŸ·ï¸ Branding</h3>
          <div class="edit-row"><span class="edit-label">Site Title</span><input class="edit-input" id="ed_title" value="AI Interview Platform" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Subtitle</span><input class="edit-input" id="ed_subtitle" value="Intelligent â€¢ Adaptive â€¢ Proctored" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Company</span><input class="edit-input" id="ed_company" value="SIMPATICO HR" onchange="saveSiteConfig()"></div>
        </div>
        <div class="card"><h3>ğŸ¨ Colors</h3>
          <div class="edit-row"><span class="edit-label">Primary</span><input type="color" class="edit-color" id="ed_primary" value="#6366f1" onchange="saveSiteConfig()"><span class="edit-preview">#6366f1</span></div>
          <div class="edit-row"><span class="edit-label">Secondary</span><input type="color" class="edit-color" id="ed_secondary" value="#8b5cf6" onchange="saveSiteConfig()"><span class="edit-preview">#8b5cf6</span></div>
          <div class="edit-row"><span class="edit-label">Success</span><input type="color" class="edit-color" id="ed_success" value="#10b981" onchange="saveSiteConfig()"><span class="edit-preview">#10b981</span></div>
          <div class="edit-row"><span class="edit-label">Background</span><input type="color" class="edit-color" id="ed_bg" value="#020617" onchange="saveSiteConfig()"><span class="edit-preview">#020617</span></div>
        </div>
        <div class="card"><h3>ğŸ”¤ Font & Style</h3>
          <div class="edit-row"><span class="edit-label">Font</span><select class="edit-input" id="ed_font" onchange="saveSiteConfig()"><option value="'Plus Jakarta Sans',system-ui,sans-serif">Jakarta Sans</option><option value="'Inter',system-ui,sans-serif">Inter</option><option value="'Poppins',system-ui,sans-serif">Poppins</option><option value="system-ui,sans-serif">System</option></select></div>
          <div class="edit-row"><span class="edit-label">Radius</span><input type="range" class="edit-input" id="ed_radius" min="0" max="30" step="2" value="20" style="max-width:200px;" oninput="document.getElementById('rv').textContent=this.value+'px'" onchange="saveSiteConfig()"><span class="edit-preview" id="rv">20px</span></div>
        </div>
        <div class="card"><h3>ğŸ“¢ Banner</h3>
          <div class="edit-row"><span class="edit-label">Show</span><div class="toggle-switch" id="tog_banner" onclick="toggleSwitch(this);saveSiteConfig()"></div><span class="edit-preview">Off</span></div>
          <div class="edit-row"><span class="edit-label">Text</span><input class="edit-input" id="ed_bannerText" value="ğŸ‰ AI Mock Interviews now available!" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Color</span><input type="color" class="edit-color" id="ed_bannerColor" value="#6366f1" onchange="saveSiteConfig()"></div>
        </div>
        <div style="display:flex;gap:10px;margin-top:16px;">
          <button class="btn btn-save btn-full" onclick="saveSiteConfig();toast('ğŸ’¾ Published!')">ğŸ’¾ Save & Publish</button>
          <button class="btn btn-danger" style="padding:14px;" onclick="resetSiteConfig()">ğŸ”„ Reset</button>
        </div>
      </div>

      <!-- PAYMENTS -->
      <div id="tab-payments" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="pTotal">â‚¹0</div><div class="stat-lbl">Revenue</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="pCount">0</div><div class="stat-lbl">Total</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="pPending">0</div><div class="stat-lbl">Pending</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="pActive">0</div><div class="stat-lbl">Active</div></div>
        </div>
        <div class="card"><h3>ğŸ’° Pricing</h3>
          <div class="edit-row"><span class="edit-label">Mock Price (â‚¹)</span><input class="edit-input" type="number" id="ed_price" value="199" style="max-width:120px;"></div>
          <div class="edit-row"><span class="edit-label">Duration</span><select class="edit-input" id="ed_days" style="max-width:160px;"><option value="7">7 days</option><option value="30" selected>30 days</option><option value="90">90 days</option><option value="365">1 year</option></select></div>
          <div class="edit-row"><span class="edit-label">Mock Paid</span><div class="toggle-switch on" id="tog_paid" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
          <button class="btn btn-save" onclick="savePricing()" style="margin-top:10px;">ğŸ’¾ Save</button>
        </div>
        <div class="card"><h3>ğŸ¦ Gateway</h3>
          <div class="edit-row"><span class="edit-label">Razorpay Key</span><input class="edit-input" type="password" id="ed_razorKey" placeholder="rzp_live_xxxx"></div>
          <div class="edit-row"><span class="edit-label">UPI ID</span><input class="edit-input" id="ed_upiId" placeholder="your@upi"></div>
          <button class="btn btn-save" onclick="saveGateway()" style="margin-top:10px;">ğŸ’¾ Save</button>
        </div>
        <div class="card"><h3>ğŸ“œ History</h3><div style="overflow-x:auto;"><table class="pay-table"><thead><tr><th>Date</th><th>User</th><th>Amount</th><th>Type</th><th>Status</th><th>Act</th></tr></thead><tbody id="payHistory"><tr><td colspan="6" style="text-align:center;color:var(--muted);">Loading...</td></tr></tbody></table></div></div>
        <div class="card"><h3>âœ‹ Manual Payment</h3>
          <div class="row2"><div><label>Email *</label><input type="email" id="mp_email" placeholder="user@email.com"></div><div><label>Amount</label><input type="number" id="mp_amount" value="199"></div></div>
          <div class="row2" style="margin-top:4px;"><div><label>Days</label><input type="number" id="mp_days" value="30"></div><div><label>Note</label><input type="text" id="mp_note" placeholder="UPI / Cash"></div></div>
          <button class="btn btn-save btn-full" onclick="addManualPayment()" style="margin-top:12px;">âœ… Add Payment</button>
        </div>
      </div>

      <!-- ACCESS CODES -->
      <div id="tab-access" class="hidden">
        <div class="card"><h3>ğŸ”‘ Generate Code</h3>
          <div class="row2"><div><label>Code *</label><input type="text" id="ac_code" placeholder="CAMPUS2025"></div><div><label>Max Uses</label><input type="number" id="ac_max" value="50"></div></div>
          <div class="row2" style="margin-top:4px;"><div><label>Days</label><input type="number" id="ac_days" value="30"></div><div><label>Expires</label><input type="date" id="ac_expiry"></div></div>
          <div style="display:flex;gap:8px;margin-top:12px;"><button class="btn btn-save" style="flex:1;padding:12px;" onclick="genCode()">ğŸ”‘ Generate</button><button class="btn btn-primary" style="padding:12px;" onclick="genRandom()">ğŸ² Random</button></div>
        </div>
        <div class="card"><h3>ğŸ“‹ All Codes</h3><div id="codesList">Loading...</div></div>
      </div>

      <!-- HR CLIENTS -->
      <div id="tab-clients" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="clTotal">0</div><div class="stat-lbl">Total</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="clActive">0</div><div class="stat-lbl">Active</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="clExpiring">0</div><div class="stat-lbl">Expiring</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#ef4444;" id="clExpired">0</div><div class="stat-lbl">Expired</div></div>
        </div>

        <div class="card"><h3>ğŸ¢ Add HR Client</h3>
          <div class="row2"><div><label>Company *</label><input type="text" id="cl_name" placeholder="TCS, Infosys"></div><div><label>Email *</label><input type="email" id="cl_email" placeholder="hr@company.com"></div></div>
          <div class="row2" style="margin-top:4px;">
            <div><label>ğŸŒ Country *</label>
              <select id="cl_country" onchange="updateCountryPricing()">
                <option value="">â€” Select â€”</option>
                <optgroup label="ğŸ‡®ğŸ‡³ South Asia"><option value="IN" selected>ğŸ‡®ğŸ‡³ India</option><option value="LK">ğŸ‡±ğŸ‡° Sri Lanka</option><option value="BD">ğŸ‡§ğŸ‡© Bangladesh</option><option value="PK">ğŸ‡µğŸ‡° Pakistan</option><option value="NP">ğŸ‡³ğŸ‡µ Nepal</option></optgroup>
                <optgroup label="ğŸ‡ºğŸ‡¸ Americas"><option value="US">ğŸ‡ºğŸ‡¸ USA</option><option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option><option value="MX">ğŸ‡²ğŸ‡½ Mexico</option><option value="BR">ğŸ‡§ğŸ‡· Brazil</option><option value="AR">ğŸ‡¦ğŸ‡· Argentina</option></optgroup>
                <optgroup label="ğŸ‡¬ğŸ‡§ Europe"><option value="GB">ğŸ‡¬ğŸ‡§ UK</option><option value="DE">ğŸ‡©ğŸ‡ª Germany</option><option value="FR">ğŸ‡«ğŸ‡· France</option><option value="NL">ğŸ‡³ğŸ‡± Netherlands</option><option value="CH">ğŸ‡¨ğŸ‡­ Switzerland</option><option value="SE">ğŸ‡¸ğŸ‡ª Sweden</option></optgroup>
                <optgroup label="ğŸ‡¦ğŸ‡ª Middle East"><option value="AE">ğŸ‡¦ğŸ‡ª UAE</option><option value="SA">ğŸ‡¸ğŸ‡¦ Saudi</option><option value="QA">ğŸ‡¶ğŸ‡¦ Qatar</option><option value="KW">ğŸ‡°ğŸ‡¼ Kuwait</option><option value="BH">ğŸ‡§ğŸ‡­ Bahrain</option><option value="OM">ğŸ‡´ğŸ‡² Oman</option></optgroup>
                <optgroup label="ğŸ‡¦ğŸ‡º Asia Pacific"><option value="AU">ğŸ‡¦ğŸ‡º Australia</option><option value="SG">ğŸ‡¸ğŸ‡¬ Singapore</option><option value="MY">ğŸ‡²ğŸ‡¾ Malaysia</option><option value="JP">ğŸ‡¯ğŸ‡µ Japan</option><option value="PH">ğŸ‡µğŸ‡­ Philippines</option></optgroup>
                <optgroup label="ğŸŒ Africa"><option value="ZA">ğŸ‡¿ğŸ‡¦ South Africa</option><option value="NG">ğŸ‡³ğŸ‡¬ Nigeria</option><option value="KE">ğŸ‡°ğŸ‡ª Kenya</option></optgroup>
              </select>
            </div>
            <div><label>City</label><input type="text" id="cl_city" placeholder="Mumbai, Dubai"></div>
          </div>
          <div id="countryPriceInfo" style="margin-top:8px;padding:10px 16px;background:rgba(99,102,241,.05);border:1px solid rgba(99,102,241,.15);border-radius:10px;font-size:0.82rem;color:var(--muted);display:none;"><span id="countryFlag" style="font-size:1.2rem;"></span> <span id="countryPriceText"></span></div>
          <div class="row2" style="margin-top:4px;"><div><label>Person</label><input type="text" id="cl_person" placeholder="John Doe"></div><div><label>Phone</label><input type="text" id="cl_phone" placeholder="+91 XXXXX"></div></div>
          <div class="row2" style="margin-top:4px;">
            <div><label>Plan *</label><select id="cl_plan" onchange="updatePlanPrice()"><option value="starter" id="opt_starter">ğŸŸ¢ Starter â€” â‚¹999/mo</option><option value="professional" id="opt_professional" selected>ğŸ”µ Pro â€” â‚¹2,999/mo</option><option value="enterprise" id="opt_enterprise">ğŸŸ£ Enterprise â€” â‚¹9,999/mo</option><option value="custom">âš™ï¸ Custom</option></select></div>
            <div><label>Duration</label><select id="cl_duration"><option value="30">1 Month</option><option value="90">3 Months</option><option value="180">6 Months</option><option value="365" selected>1 Year</option></select></div>
          </div>
          <div class="row2" style="margin-top:4px;"><div><label>Amount Paid</label><input type="number" id="cl_amount" value="2999"></div><div><label>Payment Method</label><select id="cl_payMethod"><option value="razorpay">Razorpay</option><option value="bank">Bank</option><option value="upi">UPI</option><option value="cash">Cash</option><option value="free">Free Trial</option></select></div></div>

          <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">
            <label style="font-size:0.9rem;color:var(--text);margin-bottom:12px;">ğŸ” Feature Permissions</label>
            <div class="edit-row"><span class="edit-label">ğŸ“¢ Post Jobs</span><div class="toggle-switch on" id="ft_postJobs" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
            <div class="edit-row"><span class="edit-label">Max Jobs</span><input class="edit-input" type="number" id="ft_maxJobs" value="10" style="max-width:100px;"></div>
            <div class="edit-row"><span class="edit-label">ğŸ“ Applications</span><div class="toggle-switch on" id="ft_applications" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ¤– AI ATS</span><div class="toggle-switch on" id="ft_ats" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ¤ AI Interviews</span><div class="toggle-switch on" id="ft_interviews" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
            <div class="edit-row"><span class="edit-label">Max Interviews/mo</span><input class="edit-input" type="number" id="ft_maxInterviews" value="50" style="max-width:100px;"></div>
            <div class="edit-row"><span class="edit-label">ğŸ”’ Proctoring</span><div class="toggle-switch" id="ft_proctoring" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ“Š Reports</span><div class="toggle-switch on" id="ft_reports" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ“„ Resume DL</span><div class="toggle-switch on" id="ft_resume" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ“§ Email Invites</span><div class="toggle-switch" id="ft_email" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
            <div class="edit-row"><span class="edit-label">ğŸŒ Multi-language</span><div class="toggle-switch" id="ft_multilang" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ·ï¸ Branding</span><div class="toggle-switch" id="ft_branding" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
            <div class="edit-row"><span class="edit-label">ğŸ“¥ Export</span><div class="toggle-switch" id="ft_export" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
          </div>
          <label>Notes</label><textarea id="cl_notes" placeholder="Internal notes..."></textarea>
          <button class="btn btn-save btn-full" onclick="addClient()" style="margin-top:12px;">ğŸ¢ Add Client & Generate Login</button>
        </div>

        <div class="card"><h3>ğŸ“‹ Plan Templates</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;"><button class="btn btn-save" style="padding:10px 16px;" onclick="applyPlan('starter')">ğŸŸ¢ Starter</button><button class="btn btn-accent" style="padding:10px 16px;" onclick="applyPlan('professional')">ğŸ”µ Pro</button><button class="btn btn-primary" style="padding:10px 16px;" onclick="applyPlan('enterprise')">ğŸŸ£ Enterprise</button></div>
          <div id="planPriceTable" style="margin-top:12px;font-size:0.8rem;color:var(--muted);line-height:1.8;">
            <p>ğŸŸ¢ <strong>Starter:</strong> <span id="pt_starter">â‚¹999/mo</span> â€” 5 jobs, 20 interviews</p>
            <p>ğŸ”µ <strong>Pro:</strong> <span id="pt_pro">â‚¹2,999/mo</span> â€” 20 jobs, 100 interviews, proctoring</p>
            <p>ğŸŸ£ <strong>Enterprise:</strong> <span id="pt_ent">â‚¹9,999/mo</span> â€” Unlimited, all features</p>
          </div>
          <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);overflow-x:auto;">
            <table class="pay-table"><thead><tr><th>Country</th><th>Currency</th><th>Starter</th><th>Pro</th><th>Enterprise</th></tr></thead><tbody>
              <tr><td>ğŸ‡®ğŸ‡³ India</td><td>â‚¹</td><td>â‚¹999</td><td>â‚¹2,999</td><td>â‚¹9,999</td></tr>
              <tr><td>ğŸ‡ºğŸ‡¸ USA</td><td>$</td><td>$29</td><td>$79</td><td>$199</td></tr>
              <tr><td>ğŸ‡¬ğŸ‡§ UK</td><td>Â£</td><td>Â£25</td><td>Â£65</td><td>Â£159</td></tr>
              <tr><td>ğŸ‡¦ğŸ‡ª UAE</td><td>AED</td><td>99</td><td>299</td><td>749</td></tr>
              <tr><td>ğŸ‡¸ğŸ‡¬ SG</td><td>S$</td><td>39</td><td>99</td><td>269</td></tr>
              <tr><td>ğŸ‡¦ğŸ‡º AU</td><td>A$</td><td>45</td><td>119</td><td>299</td></tr>
              <tr><td>ğŸ‡©ğŸ‡ª EU</td><td>â‚¬</td><td>27</td><td>69</td><td>179</td></tr>
            </tbody></table>
          </div>
        </div>
        <div class="card"><h3>ğŸ“‹ All Clients</h3><div id="clientsList">Loading...</div></div>
      </div>

      <!-- JOBS -->
      <div id="tab-jobs" class="hidden"><div class="card"><h3>ğŸ’¼ All Jobs</h3><div id="adminJobsList"><span class="loading"></span></div></div></div>

      <!-- CANDIDATES -->
      <div id="tab-candidates" class="hidden">
        <div class="card"><h3>ğŸ‘¥ Applications</h3><div id="adminCandList"><span class="loading"></span></div></div>
        <div class="card"><h3>ğŸ¤ Interviews</h3><div id="adminIntList"><span class="loading"></span></div></div>
      </div>

      <!-- SETTINGS -->
      <div id="tab-settings" class="hidden">
        <div class="card"><h3>ğŸ” Passwords</h3>
          <div class="edit-row"><span class="edit-label">Admin Pass</span><input class="edit-input" type="password" id="set_adminPass" placeholder="Min 6 chars"><button class="btn btn-primary" onclick="changeAdminPass()" style="margin-left:8px;">Change</button></div>
          <div class="edit-row"><span class="edit-label">HR Pass</span><input class="edit-input" type="password" id="set_hrPass" placeholder="Min 4 chars"><button class="btn btn-primary" onclick="changeHRPass()" style="margin-left:8px;">Change</button></div>
        </div>
        <div class="card"><h3>âš™ï¸ Platform</h3>
          <div class="edit-row"><span class="edit-label">Worker URL</span><input class="edit-input" id="set_worker" value="https://evalis-ai.simpaticohrconsultancy.workers.dev"></div>
          <div class="edit-row"><span class="edit-label">Max Violations</span><input class="edit-input" type="number" id="set_violations" value="3" style="max-width:100px;"></div>
          <div class="edit-row"><span class="edit-label">Maintenance</span><div class="toggle-switch" id="tog_maint" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
          <button class="btn btn-save btn-full" onclick="savePlatformSettings()" style="margin-top:12px;">ğŸ’¾ Save</button>
        </div>
        <div class="card"><h3>ğŸ—ƒï¸ Data</h3><div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-primary" onclick="exportAllData()">ğŸ“¥ Export</button>
          <button class="btn btn-accent" onclick="importData()">ğŸ“¤ Import</button>
          <button class="btn btn-danger" onclick="dangerReset()">âš ï¸ Reset All</button>
        </div></div>
      </div>

    </div>
  </div>
  <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_DEFAULT="superadmin@2025";
const W_DEFAULT="https://evalis-ai.simpaticohrconsultancy.workers.dev";
function getConfig(k,fb){try{return JSON.parse(localStorage.getItem("adminConfig")||"{}")[k]??fb}catch(e){return fb}}
function setConfig(k,v){try{const c=JSON.parse(localStorage.getItem("adminConfig")||"{}");c[k]=v;localStorage.setItem("adminConfig",JSON.stringify(c))}catch(e){}}
function getW(){return getConfig('workerUrl',W_DEFAULT)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function db(a,t,d=null,f=null,s=null,o=null){
  const r=await fetch(getW()+"/db",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:a,table:t,data:d,filters:f,select:s,order:o})});
  return await r.json();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(m){const c=document.getElementById("toasts"),t=document.createElement("div");t.className="toast";t.textContent=m;c.appendChild(t);setTimeout(()=>t.remove(),3200)}
function toggleSwitch(el){el.classList.toggle('on');const n=el.nextElementSibling;if(n?.classList.contains('edit-preview'))n.textContent=el.classList.contains('on')?'On':'Off'}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  const pwd=document.getElementById('loginPass').value;
  if(pwd===getConfig('adminPassword',ADMIN_DEFAULT)){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('adminWrap').style.display='block';
    setConfig('lastLogin',new Date().toISOString());
    loadDashboard();toast('âœ… Welcome, Admin!');
  }else{
    document.getElementById('loginError').style.display='block';
    setTimeout(()=>document.getElementById('loginError').style.display='none',3000);
  }
}
function doLogout(){
  document.getElementById('adminWrap').style.display='none';
  document.getElementById('loginScreen').style.display='block';
  document.getElementById('loginPass').value='';toast('ğŸšª Logged out');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(tab){
  const tabs=['dashboard','editor','payments','access','clients','jobs','candidates','settings'];
  tabs.forEach(t=>document.getElementById('tab-'+t)?.classList.add('hidden'));
  document.getElementById('tab-'+tab)?.classList.remove('hidden');
  document.querySelectorAll('.admin-tab').forEach((b,i)=>b.classList.toggle('active',tabs[i]===tab));
  if(tab==='dashboard')loadDashboard();
  if(tab==='payments')loadPayments();
  if(tab==='access')loadCodes();
  if(tab==='clients')loadClients();
  if(tab==='jobs')loadAdminJobs();
  if(tab==='candidates')loadAdminCandidates();
  if(tab==='settings')loadSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDashboard(){
  try{
    const[pay,apps,ints,jobs]=await Promise.all([db('select','payments').catch(()=>[]),db('select','applications').catch(()=>[]),db('select','interviews').catch(()=>[]),db('select','jobs').catch(()=>[])]);
    const pa=Array.isArray(pay)?pay:[];const aa=Array.isArray(apps)?apps:[];const ia=Array.isArray(ints)?ints:[];const ja=Array.isArray(jobs)?jobs:[];
    const rev=pa.filter(p=>p.status==='completed').reduce((s,p)=>s+(p.amount||0),0);
    document.getElementById('sRevenue').textContent='â‚¹'+rev.toLocaleString();
    document.getElementById('sUsers').textContent=aa.length;
    document.getElementById('sInterviews').textContent=ia.length;
    document.getElementById('sJobs').textContent=ja.length;
    const log=document.getElementById('activityLog');
    const items=[...aa.map(a=>({t:a.created_at,m:`ğŸ“ ${a.name||'?'} applied${a.ats_score?' (ATS:'+a.ats_score+')':''}`})),...ia.map(i=>({t:i.started_at||i.created_at,m:`ğŸ¤ ${i.interview_role||'?'}: ${i.status}`})),...pa.map(p=>({t:p.created_at,m:`ğŸ’³ ${p.currency_symbol||'â‚¹'}${p.amount} ${p.type||''}: ${p.status}`}))].sort((a,b)=>new Date(b.t||0)-new Date(a.t||0)).slice(0,30);
    log.innerHTML=items.length?items.map(i=>`<div><span style="font-size:0.7rem;color:var(--muted);">${i.t?new Date(i.t).toLocaleString():'?'}</span> ${i.m}</div>`).join(''):'<div>No activity</div>';
  }catch(e){console.error(e)}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SITE EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveSiteConfig(){
  const config={siteTitle:document.getElementById('ed_title').value,siteSubtitle:document.getElementById('ed_subtitle').value,companyName:document.getElementById('ed_company').value,colorPrimary:document.getElementById('ed_primary').value,colorSecondary:document.getElementById('ed_secondary').value,colorSuccess:document.getElementById('ed_success').value,colorBg:document.getElementById('ed_bg').value,font:document.getElementById('ed_font').value,radius:document.getElementById('ed_radius').value,bannerShow:document.getElementById('tog_banner').classList.contains('on'),bannerText:document.getElementById('ed_bannerText').value,bannerColor:document.getElementById('ed_bannerColor').value};
  localStorage.setItem("siteConfig",JSON.stringify(config));
  db('upsert','site_config',{id:'main',config,updated_at:new Date().toISOString()}).catch(()=>{});
  toast('ğŸ’¾ Saved!');
}
function resetSiteConfig(){if(!confirm('Reset all?'))return;localStorage.removeItem("siteConfig");db('delete','site_config',null,{id:'main'}).catch(()=>{});toast('ğŸ”„ Reset!');location.reload()}
function loadSiteConfig(){try{const c=JSON.parse(localStorage.getItem("siteConfig")||"{}");if(c.siteTitle)document.getElementById('ed_title').value=c.siteTitle;if(c.siteSubtitle)document.getElementById('ed_subtitle').value=c.siteSubtitle;if(c.companyName)document.getElementById('ed_company').value=c.companyName;if(c.colorPrimary)document.getElementById('ed_primary').value=c.colorPrimary;if(c.colorSecondary)document.getElementById('ed_secondary').value=c.colorSecondary;if(c.colorSuccess)document.getElementById('ed_success').value=c.colorSuccess;if(c.colorBg)document.getElementById('ed_bg').value=c.colorBg;if(c.font)document.getElementById('ed_font').value=c.font;if(c.radius)document.getElementById('ed_radius').value=c.radius;if(c.bannerShow)document.getElementById('tog_banner').classList.add('on');if(c.bannerText)document.getElementById('ed_bannerText').value=c.bannerText;if(c.bannerColor)document.getElementById('ed_bannerColor').value=c.bannerColor}catch(e){}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAYMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPayments(){
  try{
    const data=await db('select','payments',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
    const total=arr.filter(p=>p.status==='completed').reduce((s,p)=>s+(p.amount||0),0);
    document.getElementById('pTotal').textContent='â‚¹'+total.toLocaleString();document.getElementById('pCount').textContent=arr.length;
    document.getElementById('pPending').textContent=arr.filter(p=>p.status==='pending').length;
    document.getElementById('pActive').textContent=arr.filter(p=>p.status==='completed').length;
    const tbody=document.getElementById('payHistory');
    if(!arr.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--muted);">No payments</td></tr>';return}
    tbody.innerHTML=arr.map(p=>{const sc=p.status==='completed'?'#10b981':'#f59e0b';const sb=p.status==='completed'?'rgba(16,185,129,.15)':'rgba(245,158,11,.15)';
    return`<tr><td>${p.created_at?new Date(p.created_at).toLocaleDateString():'?'}</td><td>${p.email||p.user_email||'?'}</td><td style="font-weight:700;">${p.currency_symbol||'â‚¹'}${(p.amount||0).toLocaleString()}</td><td>${p.type||'?'}</td><td><span class="status-pill" style="background:${sb};color:${sc};">${p.status||'?'}</span></td><td>${p.status!=='completed'?`<button class="btn btn-save" style="padding:4px 8px;font-size:0.72rem;" onclick="approvePay('${p.id}')">âœ…</button>`:''}<button class="btn btn-danger" style="padding:4px 8px;font-size:0.72rem;" onclick="deletePay('${p.id}')">ğŸ—‘ï¸</button></td></tr>`}).join('')
  }catch(e){console.error(e)}
  document.getElementById('ed_price').value=getConfig('mockPrice',199);
  document.getElementById('ed_days').value=getConfig('accessDays',30);
  if(getConfig('mockPaid',true))document.getElementById('tog_paid').classList.add('on');
  document.getElementById('ed_razorKey').value=getConfig('razorpayKey','');
  document.getElementById('ed_upiId').value=getConfig('upiId','');
}
async function approvePay(id){try{await db('update','payments',{status:'completed'},{id});toast('âœ… Approved');loadPayments()}catch(e){toast('âŒ '+e.message)}}
async function deletePay(id){if(!confirm('Delete?'))return;try{await db('delete','payments',null,{id});toast('ğŸ—‘ï¸');loadPayments()}catch(e){toast('âŒ '+e.message)}}
async function addManualPayment(){
  const email=document.getElementById('mp_email').value.trim();if(!email){toast('âŒ Enter email');return}
  try{await db('insert','payments',{email,user_email:email,amount:parseInt(document.getElementById('mp_amount').value)||199,currency:'INR',currency_symbol:'â‚¹',type:'manual',status:'completed',note:document.getElementById('mp_note').value.trim()||'Manual',days_granted:parseInt(document.getElementById('mp_days').value)||30,created_at:new Date().toISOString()});
  toast('âœ… Added for '+email);document.getElementById('mp_email').value='';document.getElementById('mp_note').value='';loadPayments()}catch(e){toast('âŒ '+e.message)}
}
function savePricing(){setConfig('mockPrice',document.getElementById('ed_price').value);setConfig('accessDays',document.getElementById('ed_days').value);setConfig('mockPaid',document.getElementById('tog_paid').classList.contains('on'));toast('ğŸ’¾ Pricing saved!')}
function saveGateway(){const k=document.getElementById('ed_razorKey').value.trim();const u=document.getElementById('ed_upiId').value.trim();if(k)setConfig('razorpayKey',k);if(u)setConfig('upiId',u);toast('ğŸ’¾ Gateway saved!')}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCESS CODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function genCode(){
  const code=document.getElementById('ac_code').value.trim().toUpperCase();if(!code){toast('âŒ Enter code');return}
  try{const exp=document.getElementById('ac_expiry').value;
  await db('insert','access_codes',{code,max_uses:parseInt(document.getElementById('ac_max').value)||50,used:0,days:parseInt(document.getElementById('ac_days').value)||30,is_active:true,expires_at:exp?new Date(exp).toISOString():null,created_at:new Date().toISOString()});
  toast('âœ… '+code);document.getElementById('ac_code').value='';loadCodes()}catch(e){toast('âŒ '+e.message)}
}
function genRandom(){const ch='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';let c='SIM-';for(let i=0;i<8;i++)c+=ch.charAt(Math.floor(Math.random()*ch.length));document.getElementById('ac_code').value=c;toast('ğŸ² '+c)}
async function loadCodes(){
  const el=document.getElementById('codesList');
  try{const data=await db('select','access_codes',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;padding:16px;">No codes</p>';return}
  el.innerHTML=arr.map(c=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px;"><div><div style="font-weight:700;color:var(--accent);">${c.code}</div><div style="font-size:0.72rem;color:var(--muted);">${c.used||0}/${c.max_uses||'âˆ'} â€¢ ${c.days||30}d â€¢ ${c.is_active?'ğŸŸ¢':'ğŸ”´'}${c.expires_at?' â€¢ Exp:'+new Date(c.expires_at).toLocaleDateString():''}</div></div><div style="display:flex;gap:6px;"><button class="btn btn-accent" style="padding:4px 10px;font-size:0.75rem;" onclick="navigator.clipboard?.writeText('${c.code}');toast('ğŸ“‹ ${c.code}')">ğŸ“‹</button>${c.is_active?`<button class="btn btn-danger" style="padding:4px 10px;font-size:0.75rem;" onclick="deactCode('${c.id}')">ğŸš«</button>`:`<button class="btn btn-save" style="padding:4px 10px;font-size:0.75rem;" onclick="actCode('${c.id}')">âœ…</button>`}<button class="btn btn-danger" style="padding:4px 10px;font-size:0.75rem;" onclick="delCode('${c.id}')">ğŸ—‘ï¸</button></div></div>`).join('')}catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function deactCode(id){try{await db('update','access_codes',{is_active:false},{id});toast('ğŸš«');loadCodes()}catch(e){toast('âŒ '+e.message)}}
async function actCode(id){try{await db('update','access_codes',{is_active:true},{id});toast('âœ…');loadCodes()}catch(e){toast('âŒ '+e.message)}}
async function delCode(id){if(!confirm('Delete?'))return;try{await db('delete','access_codes',null,{id});toast('ğŸ—‘ï¸');loadCodes()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒ COUNTRY PRICING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COUNTRY_DATA={
  IN:{name:'India',flag:'ğŸ‡®ğŸ‡³',currency:'â‚¹',code:'INR',symbol:'â‚¹',region:'south_asia',plans:{starter:999,professional:2999,enterprise:9999},mockPrice:199},
  LK:{name:'Sri Lanka',flag:'ğŸ‡±ğŸ‡°',currency:'Rs',code:'LKR',symbol:'Rs.',region:'south_asia',plans:{starter:4999,professional:14999,enterprise:49999},mockPrice:999},
  BD:{name:'Bangladesh',flag:'ğŸ‡§ğŸ‡©',currency:'à§³',code:'BDT',symbol:'à§³',region:'south_asia',plans:{starter:2499,professional:7499,enterprise:24999},mockPrice:499},
  PK:{name:'Pakistan',flag:'ğŸ‡µğŸ‡°',currency:'Rs',code:'PKR',symbol:'Rs.',region:'south_asia',plans:{starter:5999,professional:17999,enterprise:59999},mockPrice:999},
  NP:{name:'Nepal',flag:'ğŸ‡³ğŸ‡µ',currency:'Rs',code:'NPR',symbol:'Rs.',region:'south_asia',plans:{starter:2999,professional:8999,enterprise:29999},mockPrice:599},
  US:{name:'United States',flag:'ğŸ‡ºğŸ‡¸',currency:'$',code:'USD',symbol:'$',region:'north_america',plans:{starter:29,professional:79,enterprise:199},mockPrice:9},
  CA:{name:'Canada',flag:'ğŸ‡¨ğŸ‡¦',currency:'C$',code:'CAD',symbol:'C$',region:'north_america',plans:{starter:39,professional:99,enterprise:259},mockPrice:12},
  MX:{name:'Mexico',flag:'ğŸ‡²ğŸ‡½',currency:'MX$',code:'MXN',symbol:'MX$',region:'north_america',plans:{starter:499,professional:1499,enterprise:3999},mockPrice:99},
  GB:{name:'United Kingdom',flag:'ğŸ‡¬ğŸ‡§',currency:'Â£',code:'GBP',symbol:'Â£',region:'europe',plans:{starter:25,professional:65,enterprise:159},mockPrice:7},
  DE:{name:'Germany',flag:'ğŸ‡©ğŸ‡ª',currency:'â‚¬',code:'EUR',symbol:'â‚¬',region:'europe',plans:{starter:27,professional:69,enterprise:179},mockPrice:8},
  FR:{name:'France',flag:'ğŸ‡«ğŸ‡·',currency:'â‚¬',code:'EUR',symbol:'â‚¬',region:'europe',plans:{starter:27,professional:69,enterprise:179},mockPrice:8},
  NL:{name:'Netherlands',flag:'ğŸ‡³ğŸ‡±',currency:'â‚¬',code:'EUR',symbol:'â‚¬',region:'europe',plans:{starter:27,professional:69,enterprise:179},mockPrice:8},
  CH:{name:'Switzerland',flag:'ğŸ‡¨ğŸ‡­',currency:'CHF',code:'CHF',symbol:'CHF',region:'europe',plans:{starter:35,professional:89,enterprise:229},mockPrice:10},
  SE:{name:'Sweden',flag:'ğŸ‡¸ğŸ‡ª',currency:'kr',code:'SEK',symbol:'kr',region:'europe',plans:{starter:299,professional:799,enterprise:1999},mockPrice:89},
  AE:{name:'UAE',flag:'ğŸ‡¦ğŸ‡ª',currency:'AED',code:'AED',symbol:'Ø¯.Ø¥',region:'middle_east',plans:{starter:99,professional:299,enterprise:749},mockPrice:29},
  SA:{name:'Saudi Arabia',flag:'ğŸ‡¸ğŸ‡¦',currency:'SAR',code:'SAR',symbol:'ï·¼',region:'middle_east',plans:{starter:109,professional:319,enterprise:799},mockPrice:35},
  QA:{name:'Qatar',flag:'ğŸ‡¶ğŸ‡¦',currency:'QAR',code:'QAR',symbol:'ï·¼',region:'middle_east',plans:{starter:109,professional:299,enterprise:749},mockPrice:35},
  KW:{name:'Kuwait',flag:'ğŸ‡°ğŸ‡¼',currency:'KD',code:'KWD',symbol:'Ø¯.Ùƒ',region:'middle_east',plans:{starter:9,professional:24,enterprise:59},mockPrice:3},
  BH:{name:'Bahrain',flag:'ğŸ‡§ğŸ‡­',currency:'BD',code:'BHD',symbol:'BD',region:'middle_east',plans:{starter:11,professional:29,enterprise:75},mockPrice:3},
  OM:{name:'Oman',flag:'ğŸ‡´ğŸ‡²',currency:'OMR',code:'OMR',symbol:'ï·¼',region:'middle_east',plans:{starter:11,professional:29,enterprise:75},mockPrice:3},
  AU:{name:'Australia',flag:'ğŸ‡¦ğŸ‡º',currency:'A$',code:'AUD',symbol:'A$',region:'asia_pacific',plans:{starter:45,professional:119,enterprise:299},mockPrice:14},
  SG:{name:'Singapore',flag:'ğŸ‡¸ğŸ‡¬',currency:'S$',code:'SGD',symbol:'S$',region:'asia_pacific',plans:{starter:39,professional:99,enterprise:269},mockPrice:12},
  MY:{name:'Malaysia',flag:'ğŸ‡²ğŸ‡¾',currency:'RM',code:'MYR',symbol:'RM',region:'asia_pacific',plans:{starter:129,professional:349,enterprise:899},mockPrice:39},
  JP:{name:'Japan',flag:'ğŸ‡¯ğŸ‡µ',currency:'Â¥',code:'JPY',symbol:'Â¥',region:'asia_pacific',plans:{starter:4500,professional:11900,enterprise:29900},mockPrice:1400},
  PH:{name:'Philippines',flag:'ğŸ‡µğŸ‡­',currency:'â‚±',code:'PHP',symbol:'â‚±',region:'asia_pacific',plans:{starter:1499,professional:4499,enterprise:11999},mockPrice:499},
  ZA:{name:'South Africa',flag:'ğŸ‡¿ğŸ‡¦',currency:'R',code:'ZAR',symbol:'R',region:'africa',plans:{starter:499,professional:1499,enterprise:3999},mockPrice:149},
  NG:{name:'Nigeria',flag:'ğŸ‡³ğŸ‡¬',currency:'â‚¦',code:'NGN',symbol:'â‚¦',region:'africa',plans:{starter:15000,professional:45000,enterprise:120000},mockPrice:4999},
  KE:{name:'Kenya',flag:'ğŸ‡°ğŸ‡ª',currency:'KSh',code:'KES',symbol:'KSh',region:'africa',plans:{starter:3999,professional:11999,enterprise:29999},mockPrice:999},
  BR:{name:'Brazil',flag:'ğŸ‡§ğŸ‡·',currency:'R$',code:'BRL',symbol:'R$',region:'south_america',plans:{starter:149,professional:399,enterprise:999},mockPrice:49},
  AR:{name:'Argentina',flag:'ğŸ‡¦ğŸ‡·',currency:'ARS',code:'ARS',symbol:'$',region:'south_america',plans:{starter:9999,professional:29999,enterprise:79999},mockPrice:2999}
};

function getCountryData(code){return COUNTRY_DATA[code]||COUNTRY_DATA['IN']}

function updateCountryPricing(){
  const cc=document.getElementById('cl_country').value;if(!cc)return;
  const c=getCountryData(cc);const plan=document.getElementById('cl_plan').value;
  const price=c.plans[plan]||c.plans.professional;
  document.getElementById('cl_amount').value=price;
  document.getElementById('opt_starter').textContent='ğŸŸ¢ Starter â€” '+c.symbol+c.plans.starter.toLocaleString()+'/mo';
  document.getElementById('opt_professional').textContent='ğŸ”µ Pro â€” '+c.symbol+c.plans.professional.toLocaleString()+'/mo';
  document.getElementById('opt_enterprise').textContent='ğŸŸ£ Enterprise â€” '+c.symbol+c.plans.enterprise.toLocaleString()+'/mo';
  const info=document.getElementById('countryPriceInfo');info.style.display='block';
  document.getElementById('countryFlag').textContent=c.flag;
  document.getElementById('countryPriceText').textContent=' '+c.name+' â€¢ '+c.code+' ('+c.symbol+') â€¢ '+c.symbol+price.toLocaleString();
  document.getElementById('pt_starter').textContent=c.symbol+c.plans.starter.toLocaleString()+'/mo';
  document.getElementById('pt_pro').textContent=c.symbol+c.plans.professional.toLocaleString()+'/mo';
  document.getElementById('pt_ent').textContent=c.symbol+c.plans.enterprise.toLocaleString()+'/mo';
}

function updatePlanPrice(){
  const cc=document.getElementById('cl_country').value;if(!cc)return;
  const c=getCountryData(cc);const plan=document.getElementById('cl_plan').value;
  if(plan!=='custom')document.getElementById('cl_amount').value=c.plans[plan]||0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¢ HR CLIENT MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PLANS={
  starter:{name:'Starter',color:'#10b981',features:{postJobs:true,maxJobs:5,applications:true,ats:true,interviews:true,maxInterviews:20,proctoring:false,reports:true,resume:true,email:false,multilang:false,branding:false,export:false}},
  professional:{name:'Professional',color:'#6366f1',features:{postJobs:true,maxJobs:20,applications:true,ats:true,interviews:true,maxInterviews:100,proctoring:true,reports:true,resume:true,email:true,multilang:true,branding:false,export:false}},
  enterprise:{name:'Enterprise',color:'#8b5cf6',features:{postJobs:true,maxJobs:999,applications:true,ats:true,interviews:true,maxInterviews:9999,proctoring:true,reports:true,resume:true,email:true,multilang:true,branding:true,export:true}}
};

function applyPlan(plan){
  const p=PLANS[plan];if(!p)return;
  document.getElementById('cl_plan').value=plan;
  document.getElementById('ft_maxJobs').value=p.features.maxJobs;
  document.getElementById('ft_maxInterviews').value=p.features.maxInterviews;
  const cc=document.getElementById('cl_country').value||'IN';const c=getCountryData(cc);
  document.getElementById('cl_amount').value=c.plans[plan]||0;
  const tm={ft_postJobs:p.features.postJobs,ft_applications:p.features.applications,ft_ats:p.features.ats,ft_interviews:p.features.interviews,ft_proctoring:p.features.proctoring,ft_reports:p.features.reports,ft_resume:p.features.resume,ft_email:p.features.email,ft_multilang:p.features.multilang,ft_branding:p.features.branding,ft_export:p.features.export};
  Object.keys(tm).forEach(id=>{const el=document.getElementById(id);if(el){if(tm[id])el.classList.add('on');else el.classList.remove('on');const pr=el.nextElementSibling;if(pr&&pr.classList.contains('edit-preview'))pr.textContent=tm[id]?'On':'Off'}});
  toast('ğŸ“‹ '+p.name+' â€” '+c.symbol+c.plans[plan].toLocaleString());
}

function getFeatureSettings(){
  return{postJobs:document.getElementById('ft_postJobs').classList.contains('on'),maxJobs:parseInt(document.getElementById('ft_maxJobs').value)||5,applications:document.getElementById('ft_applications').classList.contains('on'),ats:document.getElementById('ft_ats').classList.contains('on'),interviews:document.getElementById('ft_interviews').classList.contains('on'),maxInterviews:parseInt(document.getElementById('ft_maxInterviews').value)||20,proctoring:document.getElementById('ft_proctoring').classList.contains('on'),reports:document.getElementById('ft_reports').classList.contains('on'),resume:document.getElementById('ft_resume').classList.contains('on'),email:document.getElementById('ft_email').classList.contains('on'),multilang:document.getElementById('ft_multilang').classList.contains('on'),branding:document.getElementById('ft_branding').classList.contains('on'),export:document.getElementById('ft_export').classList.contains('on')};
}

async function addClient(){
  const name=document.getElementById('cl_name').value.trim();const email=document.getElementById('cl_email').value.trim();const country=document.getElementById('cl_country').value;
  if(!name||!email){toast('âŒ Company & email required');return}
  if(!country){toast('âŒ Select country');return}
  const c=getCountryData(country);const days=parseInt(document.getElementById('cl_duration').value)||365;
  const expires=new Date();expires.setDate(expires.getDate()+days);
  const password='HR-'+Math.random().toString(36).substring(2,10).toUpperCase();
  const clientId='CL-'+Date.now().toString(36).toUpperCase();
  const client={client_id:clientId,company_name:name,email,contact_person:document.getElementById('cl_person').value.trim(),phone:document.getElementById('cl_phone').value.trim(),country,country_name:c.name,city:document.getElementById('cl_city').value.trim(),currency:c.code,currency_symbol:c.symbol,region:c.region,plan:document.getElementById('cl_plan').value,amount_paid:parseInt(document.getElementById('cl_amount').value)||0,payment_method:document.getElementById('cl_payMethod').value,duration_days:days,hr_password:password,features:getFeatureSettings(),notes:document.getElementById('cl_notes').value.trim(),status:'active',jobs_used:0,interviews_used:0,created_at:new Date().toISOString(),expires_at:expires.toISOString(),last_login:null};
  try{
    await db('insert','hr_clients',client);
    await db('insert','payments',{email,user_email:email,amount:client.amount_paid,currency:c.code,currency_symbol:c.symbol,type:client.payment_method,status:'completed',note:c.flag+' '+name+' ('+client.plan+') '+c.symbol+client.amount_paid,days_granted:days,country,created_at:new Date().toISOString()});
    alert('âœ… Client Created!\n\nâ”â”â” CREDENTIALS â”â”â”\n\n'+c.flag+' Company: '+name+'\nğŸŒ Country: '+c.name+'\nğŸ“§ Email: '+email+'\nğŸ”‘ Password: '+password+'\nğŸ“‹ Plan: '+client.plan+'\nğŸ’° Price: '+c.symbol+client.amount_paid+' '+c.code+'\nğŸ“… Expires: '+expires.toLocaleDateString()+'\n\nâ”â”â” Send to client â”â”â”');
    try{await navigator.clipboard.writeText('HR Login\nCompany: '+name+'\nCountry: '+c.name+'\nPassword: '+password+'\nPlan: '+client.plan+'\nPrice: '+c.symbol+client.amount_paid+'\nExpires: '+expires.toLocaleDateString());toast('ğŸ“‹ Copied!')}catch(e){}
    document.getElementById('cl_name').value='';document.getElementById('cl_email').value='';document.getElementById('cl_person').value='';document.getElementById('cl_phone').value='';document.getElementById('cl_city').value='';document.getElementById('cl_notes').value='';
    loadClients();toast('âœ… Client added!');
  }catch(e){toast('âŒ '+e.message)}
}

async function loadClients(){
  const el=document.getElementById('clientsList');el.innerHTML='<span class="loading"></span>';
  try{
    const data=await db('select','hr_clients',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];const now=new Date();
    const active=arr.filter(c=>c.status==='active'&&new Date(c.expires_at)>now);
    const expiring=arr.filter(c=>{const d=(new Date(c.expires_at)-now)/86400000;return c.status==='active'&&d>0&&d<=7});
    const expired=arr.filter(c=>new Date(c.expires_at)<=now);
    document.getElementById('clTotal').textContent=arr.length;document.getElementById('clActive').textContent=active.length;
    document.getElementById('clExpiring').textContent=expiring.length;document.getElementById('clExpired').textContent=expired.length;
    if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No clients</p>';return}
    el.innerHTML=arr.map(c=>{
      const exp=new Date(c.expires_at);const dl=Math.ceil((exp-now)/86400000);const ie=dl<=0;const ix=dl>0&&dl<=7;
      const sc=ie?'#ef4444':ix?'#f59e0b':'#10b981';const sb=ie?'rgba(239,68,68,.15)':ix?'rgba(245,158,11,.15)':'rgba(16,185,129,.15)';const st=ie?'Expired':ix?dl+'d left':'Active';
      const cd=COUNTRY_DATA[c.country]||{};const f=c.features||{};
      const fl=[f.postJobs?'ğŸ“¢Jobs('+f.maxJobs+')':'',f.ats?'ğŸ¤–ATS':'',f.interviews?'ğŸ¤Int('+f.maxInterviews+')':'',f.proctoring?'ğŸ”’Proctor':'',f.email?'ğŸ“§Email':'',f.multilang?'ğŸŒLang':'',f.branding?'ğŸ·ï¸Brand':'',f.export?'ğŸ“¥Export':''].filter(Boolean).join(' â€¢ ');
      return`<div style="padding:14px;border-bottom:1px solid var(--border);"><div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;"><div><div style="font-weight:700;">${c.company_name||'?'}</div><div style="font-size:0.72rem;color:var(--muted);">${c.email||''} â€¢ ${cd.flag||'ğŸŒ'} ${c.country_name||''} ${c.city?'â€¢ '+c.city:''}</div></div><div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;"><span class="status-pill" style="background:${sb};color:${sc};">${st}</span><span class="status-pill" style="color:var(--accent);">${c.plan||'?'}</span><span class="score-badge" style="background:rgba(16,185,129,.15);color:#10b981;">${c.currency_symbol||'â‚¹'}${(c.amount_paid||0).toLocaleString()}</span></div></div><div style="font-size:0.7rem;color:var(--muted);margin-top:4px;">${fl}</div><div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;"><button class="btn btn-save" style="padding:4px 10px;font-size:0.7rem;" onclick="renewClient('${c.id}')">ğŸ”„ Renew</button><button class="btn btn-primary" style="padding:4px 10px;font-size:0.7rem;" onclick="editFeatures('${c.id}')">âš™ï¸ Features</button><button class="btn btn-accent" style="padding:4px 10px;font-size:0.7rem;" onclick="copyCredentials('${(c.company_name||'').replace(/'/g,"\\'")}','${c.hr_password||''}','${(cd.flag||'')}','${c.country_name||''}')">ğŸ“‹ Credentials</button>${ie?`<button class="btn btn-save" style="padding:4px 10px;font-size:0.7rem;" onclick="reactivateClient('${c.id}')">âœ… Reactivate</button>`:''}<button class="btn btn-danger" style="padding:4px 10px;font-size:0.7rem;" onclick="suspendClient('${c.id}','${c.status==='suspended'?'active':'suspended'}')">${c.status==='suspended'?'âœ… Unsuspend':'â›” Suspend'}</button></div></div>`
    }).join('');
  }catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}

function copyCredentials(name,pass,flag,country){
  const t=flag+' HR Login\nCompany: '+name+'\nCountry: '+country+'\nPassword: '+pass;
  navigator.clipboard?.writeText(t);toast('ğŸ“‹ Copied!');alert('ğŸ”‘ Credentials:\n\n'+t);
}

async function renewClient(id){
  const days=prompt('Renew for how many days?','365');if(!days)return;const d=parseInt(days);if(!d)return;
  try{const data=await db('select','hr_clients',null,{id});const cl=Array.isArray(data)?data[0]:data;if(!cl){toast('âŒ Not found');return}
  const base=new Date(cl.expires_at)>new Date()?new Date(cl.expires_at):new Date();base.setDate(base.getDate()+d);
  await db('update','hr_clients',{expires_at:base.toISOString(),status:'active'},{id});
  toast('âœ… Renewed '+d+' days! Exp: '+base.toLocaleDateString());loadClients()}catch(e){toast('âŒ '+e.message)}
}

async function editFeatures(id){
  try{const data=await db('select','hr_clients',null,{id});const cl=Array.isArray(data)?data[0]:data;if(!cl){toast('âŒ Not found');return}
  const f=cl.features||{};
  const msg='Features for '+cl.company_name+':\n\nğŸ“¢ Jobs: '+(f.postJobs?'YES('+f.maxJobs+')':'NO')+'\nğŸ¤– ATS: '+(f.ats?'YES':'NO')+'\nğŸ¤ Interviews: '+(f.interviews?'YES('+f.maxInterviews+')':'NO')+'\nğŸ”’ Proctor: '+(f.proctoring?'YES':'NO')+'\nğŸ“§ Email: '+(f.email?'YES':'NO')+'\nğŸŒ Multi-lang: '+(f.multilang?'YES':'NO')+'\nğŸ·ï¸ Brand: '+(f.branding?'YES':'NO')+'\nğŸ“¥ Export: '+(f.export?'YES':'NO')+'\n\nType plan name to change (starter/professional/enterprise):';
  const plan=prompt(msg);if(!plan)return;
  if(PLANS[plan]){await db('update','hr_clients',{plan,features:PLANS[plan].features},{id});toast('âœ… Updated to '+plan);loadClients()}else{toast('âŒ Invalid plan')}
  }catch(e){toast('âŒ '+e.message)}
}

async function suspendClient(id,st){try{await db('update','hr_clients',{status:st},{id});toast(st==='suspended'?'â›” Suspended':'âœ… Activated');loadClients()}catch(e){toast('âŒ '+e.message)}}

async function reactivateClient(id){
  const days=prompt('Reactivate for days?','30');if(!days)return;const d=parseInt(days);if(!d)return;
  const exp=new Date();exp.setDate(exp.getDate()+d);
  try{await db('update','hr_clients',{status:'active',expires_at:exp.toISOString()},{id});toast('âœ… Reactivated '+d+' days');loadClients()}catch(e){toast('âŒ '+e.message)}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JOBS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminJobs(){
  const el=document.getElementById('adminJobsList');el.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','jobs',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No jobs</p>';return}
  el.innerHTML=arr.map(j=>`<div class="job-card"><div style="display:flex;justify-content:space-between;align-items:center;"><h4>${j.title||'?'}</h4><div style="display:flex;gap:6px;"><span class="status-pill" style="background:${j.is_active?'rgba(16,185,129,.15)':'rgba(239,68,68,.15)'};color:${j.is_active?'#10b981':'#ef4444'};">${j.is_active?'Active':'Off'}</span><button class="btn ${j.is_active?'btn-danger':'btn-save'}" style="padding:3px 8px;font-size:0.7rem;" onclick="toggleJob('${j.id}',${!j.is_active})">${j.is_active?'Disable':'Enable'}</button><button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteJob('${j.id}')">ğŸ—‘ï¸</button></div></div><div class="job-meta" style="margin-top:6px;"><span>ğŸ¢ ${j["Company Name"]||j.department||''}</span><span>ğŸ“ ${j.location||''}</span><span>ğŸ“Š ${j.level||''}</span><span>ğŸ¯ ATS:${j.ats_threshold>0?j.ats_threshold+'+':'Manual'}</span></div></div>`).join('')}catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function toggleJob(id,active){try{await db('update','jobs',{is_active:active},{id});toast(active?'âœ…':'ğŸš«');loadAdminJobs()}catch(e){toast('âŒ '+e.message)}}
async function deleteJob(id){if(!confirm('Delete job?'))return;try{await db('delete','jobs',null,{id});toast('ğŸ—‘ï¸');loadAdminJobs()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANDIDATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminCandidates(){
  const el=document.getElementById('adminCandList');el.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','applications',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No applications</p>';return}
  el.innerHTML=arr.map(c=>{const sc=c.ats_score||0;const col=sc>=70?'#10b981':sc>=50?'#f59e0b':'#ef4444';const bg=sc>=70?'rgba(16,185,129,.15)':sc>=50?'rgba(245,158,11,.15)':'rgba(239,68,68,.15)';const stc={applied:'#f59e0b',shortlisted:'#10b981',interviewed:'#3b82f6',rejected:'#ef4444'}[c.status]||'#94a3b8';const stb={applied:'rgba(245,158,11,.15)',shortlisted:'rgba(16,185,129,.15)',interviewed:'rgba(59,130,246,.15)',rejected:'rgba(239,68,68,.15)'}[c.status]||'rgba(255,255,255,.05)';
  return`<div class="cand-row"><div style="display:flex;align-items:center;gap:8px;flex:1;"><div class="cand-avatar">${(c.name||'?')[0].toUpperCase()}</div><div><div style="font-weight:700;font-size:0.88rem;">${c.name||'?'}</div><div style="font-size:0.72rem;color:var(--muted);">${c.email||''} â€¢ ${c.created_at?new Date(c.created_at).toLocaleDateString():''}</div></div></div><div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;"><span class="score-badge" style="background:${bg};color:${col};">ATS:${sc}</span><span class="status-pill" style="background:${stb};color:${stc};">${c.status||'?'}</span>${c.resume_url?`<a href="${c.resume_url}" target="_blank" class="btn btn-accent" style="padding:3px 8px;font-size:0.7rem;text-decoration:none;">ğŸ“„</a>`:''}<button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteApp('${c.id}')">ğŸ—‘ï¸</button></div></div>`}).join('')}catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}

  const el2=document.getElementById('adminIntList');el2.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','interviews',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el2.innerHTML='<p style="color:var(--muted);text-align:center;">No interviews</p>';return}
  el2.innerHTML=arr.map(i=>{const sc=i.overall_score||0;const col=sc>=70?'#10b981':sc>=50?'#f59e0b':'#ef4444';const stc={pending:'#f59e0b',in_progress:'#3b82f6',completed:'#10b981'}[i.status]||'#94a3b8';
  return`<div class="cand-row"><div style="flex:1;"><div style="font-weight:700;font-size:0.88rem;">${i.interview_role||'?'} â€” ${i.interview_level||''}</div><div style="font-size:0.72rem;color:var(--muted);">Token: ${i.token?.substring(0,12)||'?'}... â€¢ ${i.created_at?new Date(i.created_at).toLocaleDateString():''}</div></div><div style="display:flex;gap:6px;align-items:center;">${sc?`<span class="score-badge" style="background:rgba(16,185,129,.15);color:${col};">${sc}/100</span>`:''}<span class="status-pill" style="color:${stc};">${i.status||'?'}</span><button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteInt('${i.id}')">ğŸ—‘ï¸</button></div></div>`}).join('')}catch(e){el2.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function deleteApp(id){if(!confirm('Delete?'))return;try{await db('delete','applications',null,{id});toast('ğŸ—‘ï¸');loadAdminCandidates()}catch(e){toast('âŒ '+e.message)}}
async function deleteInt(id){if(!confirm('Delete?'))return;try{await db('delete','interviews',null,{id});toast('ğŸ—‘ï¸');loadAdminCandidates()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadSettings(){
  document.getElementById('set_worker').value=getConfig('workerUrl',W_DEFAULT);
  document.getElementById('set_violations').value=getConfig('maxViolations',3);
  if(getConfig('maintenance',false))document.getElementById('tog_maint').classList.add('on');
}
function changeAdminPass(){const p=document.getElementById('set_adminPass').value.trim();if(!p||p.length<6){toast('âŒ Min 6 chars');return}setConfig('adminPassword',p);toast('âœ… Admin pass changed!');document.getElementById('set_adminPass').value=''}
function changeHRPass(){const p=document.getElementById('set_hrPass').value.trim();if(!p||p.length<4){toast('âŒ Min 4 chars');return}setConfig('hrPassword',p);toast('âœ… HR pass changed!');document.getElementById('set_hrPass').value=''}
function savePlatformSettings(){setConfig('workerUrl',document.getElementById('set_worker').value);setConfig('maxViolations',document.getElementById('set_violations').value);setConfig('maintenance',document.getElementById('tog_maint').classList.contains('on'));toast('ğŸ’¾ Saved!')}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT / IMPORT / RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function exportAllData(){
  toast('ğŸ“¥ Exporting...');
  try{const[jobs,apps,ints,pay,codes,clients]=await Promise.all([db('select','jobs').catch(()=>[]),db('select','applications').catch(()=>[]),db('select','interviews').catch(()=>[]),db('select','payments').catch(()=>[]),db('select','access_codes').catch(()=>[]),db('select','hr_clients').catch(()=>[])]);
  const data={exported:new Date().toISOString(),adminConfig:JSON.parse(localStorage.getItem("adminConfig")||"{}"),siteConfig:JSON.parse(localStorage.getItem("siteConfig")||"{}"),jobs,applications:apps,interviews:ints,payments:pay,access_codes:codes,hr_clients:clients};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='simpatico-export-'+Date.now()+'.json';a.click();URL.revokeObjectURL(url);toast('âœ… Exported!')}catch(e){toast('âŒ '+e.message)}
}
function importData(){const input=document.createElement('input');input.type='file';input.accept='.json';input.onchange=async e=>{const file=e.target.files[0];if(!file)return;try{const data=JSON.parse(await file.text());if(data.adminConfig)localStorage.setItem("adminConfig",JSON.stringify(data.adminConfig));if(data.siteConfig)localStorage.setItem("siteConfig",JSON.stringify(data.siteConfig));toast('âœ… Imported!')}catch(err){toast('âŒ Invalid')}};input.click()}
function dangerReset(){if(!confirm('âš ï¸ DELETE ALL?'))return;if(prompt('Type DELETE ALL:')!=='DELETE ALL')return;localStorage.clear();toast('ğŸ—‘ï¸ Cleared!');setTimeout(()=>location.reload(),1000)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded',()=>{
  loadSiteConfig();
  document.getElementById('loginPass')?.focus();
  // Trigger initial country pricing
  updateCountryPricing();
});
</script>
</body>
</html>
