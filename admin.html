<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin | Simpatico HR</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#020617;--card:rgba(15,23,42,.65);--border:rgba(255,255,255,.08);--accent:#6366f1;--accent2:#8b5cf6;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--blue:#3b82f6;--text:#f8fafc;--muted:#94a3b8;--glow:rgba(99,102,241,.15)}
    body{font-family:'Plus Jakarta Sans',system-ui,sans-serif;background:radial-gradient(circle at 10% 20%,rgba(99,102,241,.15),transparent 40%),radial-gradient(circle at 90% 80%,rgba(79,70,229,.1),transparent 40%),var(--bg);color:var(--text);min-height:100vh;line-height:1.5}
    .top-nav{backdrop-filter:blur(16px);background:rgba(2,6,23,.85);padding:1rem 6%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
    .top-logo{font-weight:800;font-size:1.1rem;color:#fff;text-decoration:none}.top-logo span{color:var(--accent)}
    .top-links{display:flex;gap:12px;align-items:center}
    .top-link{color:var(--muted);text-decoration:none;font-size:12px;font-weight:600;padding:6px 12px;border-radius:8px;transition:all 0.2s}
    .top-link:hover{color:#fff;background:rgba(255,255,255,.05)}
    .container{max-width:960px;margin:0 auto;padding:20px}
    .login-card{max-width:400px;margin:80px auto;background:var(--card);border:1px solid var(--border);border-radius:24px;padding:40px;text-align:center;backdrop-filter:blur(22px)}
    .login-card h1{font-size:1.5rem;margin-bottom:8px;background:linear-gradient(135deg,#f59e0b,#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .login-card p{color:var(--muted);font-size:0.88rem;margin-bottom:24px}
    .login-input{width:100%;padding:14px 16px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:1rem;outline:none;font-family:inherit;margin-bottom:16px;text-align:center;letter-spacing:2px}
    .login-input:focus{border-color:rgba(245,158,11,.4);box-shadow:0 0 0 3px rgba(245,158,11,.1)}
    .login-btn{width:100%;padding:14px;background:linear-gradient(135deg,#f59e0b,#ef4444);border:none;border-radius:14px;color:#fff;font-size:1rem;font-weight:800;cursor:pointer;font-family:inherit;transition:all 0.2s}
    .login-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,158,11,.3)}
    .login-error{color:var(--red);font-size:0.85rem;margin-top:12px;display:none}
    .admin-wrap{display:none}
    .admin-header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid var(--border);margin-bottom:20px}
    .admin-header h1{font-size:1.4rem;background:linear-gradient(135deg,#f59e0b,#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .admin-tabs{display:flex;gap:0;background:rgba(255,255,255,.03);border-radius:14px;padding:4px;border:1px solid var(--border);margin-bottom:20px;flex-wrap:wrap}
    .admin-tab{flex:1;padding:10px 6px;text-align:center;border:none;background:transparent;color:var(--muted);font-size:0.68rem;font-weight:700;cursor:pointer;border-radius:10px;transition:all 0.25s ease;font-family:inherit;min-width:60px;overflow:hidden}
    .admin-tab.active{background:linear-gradient(135deg,#f59e0b,#ef4444);color:#fff}
    .admin-tab:hover:not(.active){background:rgba(245,158,11,.1)}
    .card{background:var(--card);backdrop-filter:blur(22px);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px}
    .card h3{font-size:0.95rem;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:#f59e0b}
    label{display:block;font-size:0.78rem;color:var(--muted);margin:12px 0 4px;font-weight:600}
    select,input[type="text"],input[type="email"],input[type="number"],input[type="password"],input[type="date"],textarea{width:100%;padding:10px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;outline:none;transition:border-color 0.2s;font-family:inherit}
    select:focus,input:focus,textarea:focus{border-color:rgba(245,158,11,.4);box-shadow:0 0 0 3px rgba(245,158,11,.1)}
    select option{background:#1e293b}
    textarea{resize:vertical;min-height:60px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .row4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}
    .stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
    .stat-card{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
    .stat-num{font-size:1.6rem;font-weight:800}.stat-lbl{font-size:0.7rem;color:var(--muted)}
    .edit-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);flex-wrap:wrap}.edit-row:last-child{border-bottom:none}
    .edit-label{font-size:0.8rem;color:var(--muted);min-width:140px;font-weight:600}
    .edit-input{flex:1;padding:8px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;font-family:inherit;outline:none;min-width:200px}
    .edit-input:focus{border-color:rgba(245,158,11,.4)}
    .edit-color{width:40px;height:32px;border:none;border-radius:6px;cursor:pointer;background:transparent}
    .edit-preview{font-size:0.75rem;color:var(--muted);padding:2px 8px;background:rgba(255,255,255,.03);border-radius:6px}
    .pay-table{width:100%;border-collapse:collapse;font-size:0.82rem}.pay-table th{text-align:left;padding:8px;color:var(--muted);font-weight:700;border-bottom:1px solid var(--border);font-size:0.75rem}.pay-table td{padding:8px;border-bottom:1px solid var(--border)}
    .toggle-switch{position:relative;width:44px;height:24px;background:rgba(255,255,255,.1);border-radius:12px;cursor:pointer;transition:all 0.3s;flex-shrink:0}
    .toggle-switch.on{background:var(--green)}.toggle-switch::after{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:all 0.3s}.toggle-switch.on::after{left:23px}
    .btn{padding:8px 16px;border:none;border-radius:8px;font-size:0.82rem;font-weight:700;cursor:pointer;font-family:inherit;transition:all 0.2s;color:#fff}
    .btn-save{background:linear-gradient(135deg,#10b981,#059669)}.btn-danger{background:rgba(239,68,68,.15);color:var(--red)}.btn-primary{background:linear-gradient(135deg,#f59e0b,#ef4444)}.btn-accent{background:var(--accent)}.btn-full{width:100%;padding:14px;font-size:1rem;border-radius:14px}
    .btn-wa{background:linear-gradient(135deg,#25d366,#128c7e)}.btn-payroll{background:linear-gradient(135deg,#8b5cf6,#6366f1)}.btn-jd{background:linear-gradient(135deg,#ec4899,#8b5cf6)}.btn-onboard{background:linear-gradient(135deg,#06b6d4,#3b82f6)}
    .btn:hover{transform:translateY(-1px)}
    .status-pill{padding:2px 8px;border-radius:10px;font-size:0.72rem;font-weight:700;display:inline-block}
    .score-badge{padding:2px 8px;border-radius:8px;font-size:0.75rem;font-weight:700;display:inline-block}
    .activity-log{max-height:250px;overflow-y:auto;font-size:0.78rem;color:var(--muted);background:rgba(0,0,0,.3);border-radius:10px;padding:10px}
    .activity-log div{padding:4px 0;border-bottom:1px solid rgba(255,255,255,.03)}
    .cand-row{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border);gap:8px;flex-wrap:wrap}.cand-row:last-child{border-bottom:none}
    .cand-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.8rem;flex-shrink:0}
    .toast-box{position:fixed;top:16px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px}
    .toast{background:rgba(15,23,42,.9);backdrop-filter:blur(12px);border:1px solid var(--border);color:var(--text);padding:10px 18px;border-radius:12px;font-size:0.85rem;box-shadow:0 8px 24px rgba(0,0,0,.4);animation:tIn .3s ease,tOut .3s ease 2.7s forwards}
    @keyframes tIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes tOut{to{transform:translateX(120%);opacity:0}}
    .hidden{display:none!important}
    .feature-disabled-overlay{position:relative}
    .feature-disabled-overlay::after{content:'ğŸ”’ Feature Disabled â€” Enable in Settings âš™ï¸';position:absolute;inset:0;background:rgba(2,6,23,.88);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;font-size:0.95rem;font-weight:700;color:var(--muted);border-radius:16px;z-index:10;pointer-events:none}
    .feature-toggle-card{background:rgba(245,158,11,.04);border:1px solid rgba(245,158,11,.15);border-radius:14px;padding:16px;margin-bottom:10px}
    .feature-toggle-card .ft-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
    .feature-toggle-card .ft-title{font-weight:800;font-size:0.92rem;display:flex;align-items:center;gap:8px}
    .feature-toggle-card .ft-desc{font-size:0.76rem;color:var(--muted);margin-top:4px}
    .ft-badge-on{background:rgba(16,185,129,.15);color:#10b981;padding:2px 10px;border-radius:10px;font-size:0.72rem;font-weight:800}
    .ft-badge-off{background:rgba(239,68,68,.15);color:#ef4444;padding:2px 10px;border-radius:10px;font-size:0.72rem;font-weight:800}
    .loading{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .job-card{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;transition:all 0.2s}
    .job-card:hover{border-color:rgba(99,102,241,.3)}
    .job-card h4{font-size:0.95rem;margin-bottom:4px;color:var(--accent)}
    .job-meta{font-size:0.78rem;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}
    .token-display{background:rgba(0,0,0,.4);border:1px solid var(--border);border-radius:10px;padding:12px;font-family:monospace;font-size:0.82rem;word-break:break-all;margin:8px 0;cursor:pointer;transition:all 0.2s}
    .token-display:hover{border-color:var(--accent);background:rgba(99,102,241,.05)}
    .usage-bar{height:6px;background:rgba(255,255,255,.05);border-radius:3px;overflow:hidden;margin-top:4px}
    .usage-fill{height:100%;border-radius:3px;transition:width 0.5s}
    .invite-card{background:rgba(99,102,241,.05);border:1px solid rgba(99,102,241,.15);border-radius:14px;padding:16px;margin-bottom:10px}
    .invite-card h4{color:var(--accent);font-size:0.9rem;margin-bottom:6px}
    .copy-box{display:flex;gap:8px;align-items:center;margin-top:8px}
    .copy-input{flex:1;padding:8px 12px;background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:8px;color:var(--accent);font-size:0.78rem;font-family:monospace;outline:none}
    .copy-btn{padding:8px 14px;background:var(--accent);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:0.78rem;cursor:pointer;white-space:nowrap}
    .copy-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px var(--glow)}

    /* â”€â”€ PAYROLL STYLES â”€â”€ */
    .payslip-modal{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:9998;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
    .payslip-box{background:#fff;color:#000;border-radius:16px;padding:32px;max-width:680px;width:95%;max-height:90vh;overflow-y:auto;font-family:'Plus Jakarta Sans',sans-serif}
    .payslip-header{display:flex;justify-content:space-between;align-items:flex-start;border-bottom:3px solid #6366f1;padding-bottom:16px;margin-bottom:20px}
    .payslip-company{font-size:1.3rem;font-weight:800;color:#6366f1}
    .payslip-title{font-size:1.1rem;font-weight:700;color:#1e293b;margin-top:4px}
    .payslip-table{width:100%;border-collapse:collapse;font-size:0.9rem}
    .payslip-table td{padding:8px 10px;border:1px solid #e2e8f0}
    .payslip-table thead td{background:#f1f5f9;font-weight:700;color:#475569}
    .payslip-total{background:#f0fdf4;font-weight:800;color:#059669}

    /* â”€â”€ JD STYLES â”€â”€ */
    .jd-output{background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:12px;padding:16px;font-size:0.85rem;line-height:1.8;white-space:pre-wrap;max-height:500px;overflow-y:auto;color:#e2e8f0}
    .jd-ai-thinking{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:0.85rem}

    /* â”€â”€ WHATSAPP STYLES â”€â”€ */
    .wa-template-card{background:rgba(37,211,102,.05);border:1px solid rgba(37,211,102,.15);border-radius:12px;padding:14px;margin-bottom:10px}
    .wa-template-card h4{color:#25d366;font-size:0.88rem;margin-bottom:6px}
    .wa-preview{background:rgba(0,0,0,.3);border-radius:10px;padding:12px;font-size:0.82rem;line-height:1.7;white-space:pre-wrap;border-left:3px solid #25d366;color:#d1fae5}
    .wa-link-btn{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:linear-gradient(135deg,#25d366,#128c7e);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:0.78rem;cursor:pointer;text-decoration:none;margin-top:8px}

    /* â”€â”€ ONBOARDING STYLES â”€â”€ */
    .onboard-stage{background:rgba(6,182,212,.05);border:1px solid rgba(6,182,212,.15);border-radius:12px;padding:14px;margin-bottom:12px}
    .onboard-stage h4{color:#06b6d4;font-size:0.9rem;margin-bottom:10px;display:flex;align-items:center;gap:8px}
    .check-item{display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid rgba(255,255,255,.04)}
    .check-item:last-child{border-bottom:none}
    .check-item input[type="checkbox"]{width:16px;height:16px;cursor:pointer;accent-color:var(--green)}
    .check-item label{margin:0;font-size:0.83rem;cursor:pointer;color:var(--text)}
    .check-item.done label{text-decoration:line-through;color:var(--muted)}
    .progress-bar{height:8px;background:rgba(255,255,255,.06);border-radius:4px;overflow:hidden;margin:8px 0}
    .progress-fill{height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);border-radius:4px;transition:width .5s}

    /* â”€â”€ PIPELINE KANBAN STYLES â”€â”€ */
    .kanban-board{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;overflow-x:auto;padding-bottom:8px;min-width:0}
    .kanban-col{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:14px;padding:12px;min-height:300px;min-width:150px}
    .kanban-col-header{font-size:0.78rem;font-weight:800;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center}
    .kanban-badge{background:rgba(255,255,255,.1);border-radius:10px;padding:1px 8px;font-size:0.7rem}
    .k-card{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px;cursor:grab;font-size:0.8rem;transition:all 0.2s}
    .k-card:hover{border-color:rgba(99,102,241,.4);background:rgba(99,102,241,.05)}
    .k-card-name{font-weight:700;margin-bottom:2px}
    .k-card-role{color:var(--muted);font-size:0.72rem}

    /* â”€â”€ SALARY CALCULATOR â”€â”€ */
    .calc-result{background:rgba(16,185,129,.05);border:1px solid rgba(16,185,129,.15);border-radius:10px;padding:14px;margin-top:12px}
    .calc-row{display:flex;justify-content:space-between;padding:5px 0;font-size:0.83rem;border-bottom:1px solid rgba(255,255,255,.04)}
    .calc-row:last-child{border-bottom:none;font-weight:800;color:#10b981;font-size:0.95rem}
    .calc-row.deduct{color:#f87171}

    @media(max-width:768px){
      .stat-grid{grid-template-columns:1fr 1fr}
      .row2,.row3,.row4{grid-template-columns:1fr}
      .edit-row{flex-direction:column;align-items:flex-start}
      .edit-input{width:100%}
      .admin-tab{font-size:0.6rem;min-width:46px;padding:8px 3px}
      .cand-row{flex-direction:column;align-items:flex-start}
      .top-nav{padding:1rem 4%}
      .kanban-board{grid-template-columns:repeat(3,minmax(150px,1fr))}
    }
    @media(max-width:480px){.kanban-board{grid-template-columns:repeat(2,minmax(140px,1fr))}}
  </style>
</head>
<body>
  <div class="toast-box" id="toasts"></div>

  <nav class="top-nav">
    <a class="top-logo" href="evalis-platform.html">SIMPATICO <span>HR</span></a>
    <div class="top-links">
      <a class="top-link" href="evalis-platform.html">ğŸ  Platform</a>
      <a class="top-link" href="career-lab.html">ğŸ§  Career Lab</a>
      <span class="top-link" style="color:var(--yellow);">ğŸ” Admin</span>
    </div>
  </nav>

  <!-- LOGIN -->
  <div id="loginScreen">
    <div class="login-card">
      <div style="font-size:3rem;margin-bottom:12px;">ğŸ”</div>
      <h1>Super Admin</h1>
      <p>Enter password to access</p>
      <input type="password" class="login-input" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()">
      <button class="login-btn" onclick="doLogin()">ğŸ”“ Login</button>
      <div class="login-error" id="loginError">âŒ Wrong password</div>
    </div>
  </div>

  <!-- ADMIN -->
  <div class="admin-wrap" id="adminWrap">
    <div class="container">
      <div class="admin-header">
        <h1>ğŸ” Super Admin Panel</h1>
        <button class="btn btn-danger" onclick="doLogout()">ğŸšª Logout</button>
      </div>

      <div class="admin-tabs" id="adminTabs">
        <button class="admin-tab active" onclick="showTab('dashboard')">ğŸ“Š Dash</button>
        <button class="admin-tab" onclick="showTab('tokens')">ğŸ« Tokens</button>
        <button class="admin-tab" onclick="showTab('jdbuilder')">âœï¸ JD AI</button>
        <button class="admin-tab" onclick="showTab('payroll')">ğŸ’° Payroll</button>
        <button class="admin-tab" onclick="showTab('whatsapp')">ğŸ’¬ WA</button>
        <button class="admin-tab" onclick="showTab('onboarding')">ğŸ‰ Onboard</button>
        <button class="admin-tab" onclick="showTab('pipeline')">ğŸ”„ Pipeline</button>
        <button class="admin-tab" onclick="showTab('editor')">ğŸ¨ Site</button>
        <button class="admin-tab" onclick="showTab('payments')">ğŸ’³ Pay</button>
        <button class="admin-tab" onclick="showTab('access')">ğŸ”‘ Codes</button>
        <button class="admin-tab" onclick="showTab('clients')">ğŸ¢ Clients</button>
        <button class="admin-tab" onclick="showTab('jobs')">ğŸ’¼ Jobs</button>
        <button class="admin-tab" onclick="showTab('candidates')">ğŸ‘¥ People</button>
        <button class="admin-tab" onclick="showTab('usage')">ğŸ“ˆ Usage</button>
        <button class="admin-tab" onclick="showTab('settings')">âš™ï¸ Set</button>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-dashboard">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="sRevenue">â‚¹0</div><div class="stat-lbl">Revenue</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="sUsers">0</div><div class="stat-lbl">Applications</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="sInterviews">0</div><div class="stat-lbl">Interviews</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="sJobs">0</div><div class="stat-lbl">Jobs</div></div>
        </div>
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#8b5cf6;" id="sEmployees">0</div><div class="stat-lbl">Employees</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#25d366;" id="sWaSent">0</div><div class="stat-lbl">WA Sent</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#06b6d4;" id="sOnboarding">0</div><div class="stat-lbl">Onboarding</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#ec4899;" id="sJdGenerated">0</div><div class="stat-lbl">JDs Generated</div></div>
        </div>
        <div class="card"><h3>ğŸ“ˆ Activity Feed</h3><div class="activity-log" id="activityLog">Loading...</div></div>
        <div class="card"><h3>âš¡ Quick Actions</h3><div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-primary" onclick="showTab('tokens')">ğŸ« Interview Token</button>
          <button class="btn btn-jd" onclick="showTab('jdbuilder')">âœï¸ Generate JD</button>
          <button class="btn btn-wa" onclick="showTab('whatsapp')">ğŸ’¬ WhatsApp</button>
          <button class="btn btn-payroll" onclick="showTab('payroll')">ğŸ’° Payroll</button>
          <button class="btn btn-onboard" onclick="showTab('onboarding')">ğŸ‰ Onboard</button>
          <button class="btn btn-save" onclick="showTab('clients')">ğŸ¢ Add Client</button>
          <button class="btn" style="background:var(--blue);" onclick="exportAllData()">ğŸ“¥ Export</button>
        </div></div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOKENS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-tokens" class="hidden">
        <div class="card">
          <h3>ğŸ« Generate Interview Token</h3>
          <div class="row2">
            <div><label>Candidate Name *</label><input type="text" id="tk_name" placeholder="John Doe"></div>
            <div><label>Candidate Email *</label><input type="email" id="tk_email" placeholder="john@email.com"></div>
          </div>
          <div class="row2" style="margin-top:4px;">
            <div><label>Job Role *</label>
              <select id="tk_role">
                <option value="">â€” Select Role â€”</option>
                <option>Frontend Developer</option><option>Backend Developer</option><option>Full Stack Developer</option>
                <option>Mobile Developer</option><option>Data Scientist</option><option>DevOps Engineer</option>
                <option>UI/UX Designer</option><option>Product Manager</option><option>QA Engineer</option>
                <option>Cybersecurity Analyst</option><option>Sales Representative</option><option>Marketing Manager</option>
                <option>HR Recruiter</option><option>Finance Analyst</option><option>Customer Support</option>
                <option value="custom">âœï¸ Custom...</option>
              </select>
            </div>
            <div><label>Level</label>
              <select id="tk_level"><option>Fresher</option><option>Junior</option><option selected>Mid-Level</option><option>Senior</option><option>Lead</option></select>
            </div>
          </div>
          <div id="tk_customWrap" class="hidden" style="margin-top:4px;"><label>Custom Role</label><input type="text" id="tk_customRole" placeholder="e.g. Blockchain Developer"></div>
          <div class="row3" style="margin-top:4px;">
            <div><label>Questions</label><select id="tk_questions"><option>5</option><option>8</option><option selected>10</option><option>15</option></select></div>
            <div><label>Language</label><select id="tk_lang"><option value="en">English</option><option value="hi">Hindi</option><option value="ml">Malayalam</option><option value="ta">Tamil</option><option value="te">Telugu</option><option value="ar">Arabic</option></select></div>
            <div><label>Expires In</label><select id="tk_expiry"><option value="24">24 Hours</option><option value="48">48 Hours</option><option value="72" selected>72 Hours</option><option value="168">7 Days</option><option value="720">30 Days</option></select></div>
          </div>
          <div class="row2" style="margin-top:4px;">
            <div><label>Interview Type</label><select id="tk_type"><option value="real">ğŸ”’ Proctored (Real)</option><option value="mock">ğŸ¯ Mock (Practice)</option></select></div>
            <div><label>Link to Job</label><select id="tk_jobId"><option value="">â€” None â€”</option></select></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="generateToken()" style="margin-top:16px;">ğŸ« Generate Interview Token</button>
        </div>
        <div class="card hidden" id="tokenResultCard">
          <h3>âœ… Token Generated!</h3>
          <div class="invite-card">
            <h4 id="tokenResultName">â€”</h4>
            <div style="font-size:0.78rem;color:var(--muted);" id="tokenResultMeta">â€”</div>
            <div class="copy-box"><input class="copy-input" id="tokenResultUrl" readonly><button class="copy-btn" onclick="copyTokenUrl()">ğŸ“‹ Copy</button></div>
            <div class="token-display" id="tokenResultToken" onclick="copyTokenRaw()" title="Click to copy token">â€”</div>
            <div style="font-size:0.78rem;color:var(--muted);margin-top:6px;" id="tokenResultExpiry">â€”</div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
            <button class="btn btn-save" onclick="copyInviteEmail()">ğŸ“§ Copy Email</button>
            <button class="btn btn-wa" onclick="copyWhatsApp()">ğŸ’¬ WA Message</button>
            <button class="btn btn-accent" onclick="sendToWA()">ğŸ“² Open WhatsApp</button>
          </div>
        </div>
        <div class="card">
          <h3>ğŸ“‹ All Tokens</h3>
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;">
            <button class="btn btn-accent" style="padding:6px 12px;font-size:0.75rem;" onclick="filterTokens('all')">All</button>
            <button class="btn" style="padding:6px 12px;font-size:0.75rem;background:rgba(245,158,11,.15);color:#f59e0b;" onclick="filterTokens('pending')">Pending</button>
            <button class="btn" style="padding:6px 12px;font-size:0.75rem;background:rgba(16,185,129,.15);color:#10b981;" onclick="filterTokens('completed')">Done</button>
            <button class="btn" style="padding:6px 12px;font-size:0.75rem;background:rgba(239,68,68,.15);color:#ef4444;" onclick="filterTokens('expired')">Expired</button>
          </div>
          <div id="allTokensList"><span class="loading"></span></div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JD AI BUILDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-jdbuilder" class="hidden">
        <div class="card">
          <h3>âœï¸ AI Job Description Generator</h3>
          <p style="font-size:0.82rem;color:var(--muted);margin-bottom:14px;">Enter a job title and details â€” our AI will generate a professional, ATS-optimized JD in seconds.</p>
          <div class="row2">
            <div><label>Job Title *</label><input type="text" id="jd_title" placeholder="e.g. Senior React Developer" oninput="jdSuggestTitle(this)"></div>
            <div><label>Industry</label>
              <select id="jd_industry">
                <option>Technology / IT</option><option>Finance / Banking</option><option>Healthcare</option>
                <option>Manufacturing</option><option>Retail / E-commerce</option><option>Education</option>
                <option>Real Estate</option><option>Hospitality</option><option>Marketing / Media</option><option>Other</option>
              </select>
            </div>
          </div>
          <div class="row3" style="margin-top:8px;">
            <div><label>Experience Level</label>
              <select id="jd_level"><option>Entry Level (0â€“2 yrs)</option><option selected>Mid Level (3â€“5 yrs)</option><option>Senior Level (6â€“10 yrs)</option><option>Lead / Manager (10+ yrs)</option></select>
            </div>
            <div><label>Employment Type</label>
              <select id="jd_emptype"><option>Full-Time</option><option>Part-Time</option><option>Contract</option><option>Internship</option><option>Remote</option><option>Hybrid</option></select>
            </div>
            <div><label>Location</label><input type="text" id="jd_location" placeholder="e.g. Bangalore / Remote"></div>
          </div>
          <div class="row2" style="margin-top:8px;">
            <div><label>Salary Range (optional)</label><input type="text" id="jd_salary" placeholder="e.g. â‚¹8â€“12 LPA / $80,000â€“100,000"></div>
            <div><label>Key Skills (comma separated)</label><input type="text" id="jd_skills" placeholder="React, Node.js, MongoDB, AWS"></div>
          </div>
          <div style="margin-top:8px;"><label>Additional Requirements / Tone</label><textarea id="jd_extra" style="min-height:50px;" placeholder="Any extra notes: work culture, benefits, preferred background..."></textarea></div>
          <div style="display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;">
            <button class="btn btn-jd btn-full" onclick="generateJD()" id="jd_genBtn">âœ¨ Generate JD with AI</button>
          </div>
        </div>
        <div class="card hidden" id="jd_resultCard">
          <h3>ğŸ“„ Generated Job Description</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
            <button class="btn btn-save" onclick="copyJD()">ğŸ“‹ Copy JD</button>
            <button class="btn btn-accent" onclick="saveJDtoDB()">ğŸ’¾ Save as Job Posting</button>
            <button class="btn btn-primary" onclick="downloadJD()">â¬‡ï¸ Download .txt</button>
            <button class="btn" style="background:rgba(255,255,255,.08);" onclick="regenerateJD()">ğŸ”„ Regenerate</button>
          </div>
          <div id="jd_output" class="jd-output">â€”</div>
        </div>
        <div class="card">
          <h3>ğŸ“š Saved JD Library</h3>
          <div id="jd_library"><p style="color:var(--muted);text-align:center;font-size:0.85rem;">No JDs saved yet. Generate and save above.</p></div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAYROLL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-payroll" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#8b5cf6;" id="py_empCount">0</div><div class="stat-lbl">Employees</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="py_totalPay">â‚¹0</div><div class="stat-lbl">Monthly Outflow</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="py_pending">0</div><div class="stat-lbl">Pending Payroll</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="py_processed">0</div><div class="stat-lbl">Processed</div></div>
        </div>

        <div class="card">
          <h3>ğŸ‘¤ Add / Edit Employee</h3>
          <div class="row2">
            <div><label>Full Name *</label><input type="text" id="emp_name" placeholder="John Doe"></div>
            <div><label>Employee ID</label><input type="text" id="emp_id" placeholder="EMP-001"></div>
          </div>
          <div class="row2" style="margin-top:6px;">
            <div><label>Department</label><select id="emp_dept"><option>Engineering</option><option>HR</option><option>Sales</option><option>Marketing</option><option>Finance</option><option>Operations</option><option>Design</option><option>Management</option></select></div>
            <div><label>Designation</label><input type="text" id="emp_desig" placeholder="Senior Engineer"></div>
          </div>
          <div class="row3" style="margin-top:6px;">
            <div><label>Basic Salary (â‚¹/mo)</label><input type="number" id="emp_basic" placeholder="50000" oninput="calcPayroll()"></div>
            <div><label>HRA (â‚¹/mo)</label><input type="number" id="emp_hra" placeholder="20000" oninput="calcPayroll()"></div>
            <div><label>Allowances (â‚¹/mo)</label><input type="number" id="emp_allow" placeholder="10000" oninput="calcPayroll()"></div>
          </div>
          <div class="row4" style="margin-top:6px;">
            <div><label>PF %</label><input type="number" id="emp_pf" value="12" oninput="calcPayroll()"></div>
            <div><label>ESI %</label><input type="number" id="emp_esi" value="0.75" step="0.25" oninput="calcPayroll()"></div>
            <div><label>TDS (â‚¹/mo)</label><input type="number" id="emp_tds" value="0" oninput="calcPayroll()"></div>
            <div><label>Bonus (â‚¹/mo)</label><input type="number" id="emp_bonus" value="0" oninput="calcPayroll()"></div>
          </div>
          <div class="row2" style="margin-top:6px;">
            <div><label>Bank Account</label><input type="text" id="emp_bank" placeholder="HDFC â€” 1234****5678"></div>
            <div><label>Join Date</label><input type="date" id="emp_joindate"></div>
          </div>

          <!-- Live Calculator -->
          <div class="calc-result" id="calc_result" style="display:none;">
            <strong style="font-size:0.88rem;color:var(--accent);">ğŸ“Š Live Salary Breakdown</strong>
            <div class="calc-row"><span>Basic Salary</span><span id="cr_basic">â€”</span></div>
            <div class="calc-row"><span>HRA</span><span id="cr_hra">â€”</span></div>
            <div class="calc-row"><span>Special Allowances</span><span id="cr_allow">â€”</span></div>
            <div class="calc-row"><span>Bonus</span><span id="cr_bonus">â€”</span></div>
            <div class="calc-row" style="font-weight:700;color:var(--text);"><span>Gross Salary</span><span id="cr_gross">â€”</span></div>
            <div class="calc-row deduct"><span>PF (Employee 12%)</span><span id="cr_pf">â€”</span></div>
            <div class="calc-row deduct"><span>ESI (Employee 0.75%)</span><span id="cr_esi">â€”</span></div>
            <div class="calc-row deduct"><span>TDS</span><span id="cr_tds">â€”</span></div>
            <div class="calc-row"><span style="color:#10b981;font-weight:800;">Net Take-Home</span><span id="cr_net">â€”</span></div>
          </div>

          <div style="display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;">
            <button class="btn btn-save btn-full" onclick="addEmployee()">ğŸ’¾ Save Employee</button>
          </div>
        </div>

        <div class="card">
          <h3>ğŸ‘¥ Employee List & Payroll Actions</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;">
            <button class="btn btn-payroll" onclick="runBulkPayroll()">ğŸš€ Run Monthly Payroll</button>
            <button class="btn btn-save" onclick="exportPayrollCSV()">ğŸ“¥ Export CSV</button>
            <button class="btn btn-primary" onclick="generateAllPayslips()">ğŸ§¾ Generate All Payslips</button>
          </div>
          <div id="employeeList"><p style="color:var(--muted);text-align:center;padding:20px;">No employees added yet.</p></div>
        </div>

        <div class="card">
          <h3>ğŸ“… Payroll History</h3>
          <div id="payrollHistory"><p style="color:var(--muted);text-align:center;font-size:0.85rem;">Run payroll to see history.</p></div>
        </div>
      </div>

      <!-- Payslip Modal -->
      <div class="payslip-modal hidden" id="payslipModal">
        <div class="payslip-box" id="payslipContent">
          <!-- Generated dynamically -->
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WHATSAPP AUTOMATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-whatsapp" class="hidden">
        <div class="card">
          <h3>ğŸ’¬ WhatsApp Automation Hub</h3>
          <p style="font-size:0.82rem;color:var(--muted);margin-bottom:16px;">Send personalized WhatsApp messages via wa.me links or bulk campaigns. No API key needed for single sends.</p>

          <!-- Single Send -->
          <div style="margin-bottom:20px;">
            <h4 style="font-size:0.9rem;color:var(--accent);margin-bottom:10px;">ğŸ“² Quick Single Message</h4>
            <div class="row2">
              <div><label>Recipient Phone (with country code)</label><input type="text" id="wa_phone" placeholder="+919876543210"></div>
              <div><label>Template</label>
                <select id="wa_template" onchange="loadWATemplate()">
                  <option value="interview">ğŸ¤ Interview Invitation</option>
                  <option value="shortlist">â­ Shortlisted Notification</option>
                  <option value="offer">ğŸ‰ Offer Letter</option>
                  <option value="followup">ğŸ”” Follow-up</option>
                  <option value="rejection">ğŸ’Œ Rejection (Polite)</option>
                  <option value="onboard">ğŸ‰ Onboarding Welcome</option>
                  <option value="payslip">ğŸ’° Payslip Ready</option>
                  <option value="custom">âœï¸ Custom Message</option>
                </select>
              </div>
            </div>
            <div class="row3" style="margin-top:8px;">
              <div><label>Candidate Name</label><input type="text" id="wa_cname" placeholder="John Doe" oninput="previewWAMessage()"></div>
              <div><label>Role / Position</label><input type="text" id="wa_role" placeholder="Software Engineer" oninput="previewWAMessage()"></div>
              <div><label>Interview Link / Detail</label><input type="text" id="wa_link" placeholder="https://..." oninput="previewWAMessage()"></div>
            </div>
            <div style="margin-top:10px;"><label>Custom Message (if custom selected)</label><textarea id="wa_custom" style="min-height:80px;" placeholder="Type your message..." oninput="previewWAMessage()"></textarea></div>
          </div>

          <div id="wa_preview" class="wa-preview" style="display:none;">â€”</div>

          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:14px;">
            <a id="wa_sendLink" href="#" target="_blank" class="wa-link-btn" onclick="trackWASend()">ğŸ“² Open WhatsApp & Send</a>
            <button class="btn btn-save" onclick="copyWAMessage()">ğŸ“‹ Copy Message</button>
          </div>
        </div>

        <!-- Bulk Sender -->
        <div class="card">
          <h3>ğŸ“¢ Bulk WhatsApp Campaign</h3>
          <div class="row2">
            <div>
              <label>Phone Numbers (one per line)</label>
              <textarea id="wa_bulk_phones" style="min-height:100px;" placeholder="+919876543210&#10;+919876543211&#10;+919876543212"></textarea>
            </div>
            <div>
              <label>Bulk Message Template</label>
              <textarea id="wa_bulk_msg" style="min-height:100px;" placeholder="Hi! You're shortlisted for [Role] at Simpatico HR. Interview link: [LINK]"></textarea>
            </div>
          </div>
          <div class="row2" style="margin-top:8px;">
            <div><label>Replacement â€” [Role]</label><input type="text" id="wa_bulk_role" placeholder="Senior Developer"></div>
            <div><label>Replacement â€” [LINK]</label><input type="text" id="wa_bulk_link" placeholder="https://..."></div>
          </div>
          <button class="btn btn-wa btn-full" onclick="generateBulkWALinks()" style="margin-top:14px;">ğŸ“¢ Generate Bulk WA Links</button>
          <div id="wa_bulk_results" class="hidden" style="margin-top:12px;max-height:300px;overflow-y:auto;"></div>
        </div>

        <!-- Templates Library -->
        <div class="card">
          <h3>ğŸ“š Message Templates Library</h3>
          <div id="wa_templates_list"></div>
        </div>

        <!-- Campaign Tracker -->
        <div class="card">
          <h3>ğŸ“Š Campaign Tracker</h3>
          <div id="wa_campaign_log"><p style="color:var(--muted);font-size:0.85rem;text-align:center;">No campaigns yet.</p></div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ONBOARDING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-onboarding" class="hidden">
        <div class="card">
          <h3>ğŸ‰ New Employee Onboarding</h3>
          <div class="row2">
            <div><label>Employee Name *</label><input type="text" id="ob_name" placeholder="John Doe"></div>
            <div><label>Role / Position *</label><input type="text" id="ob_role" placeholder="Senior Developer"></div>
          </div>
          <div class="row3" style="margin-top:8px;">
            <div><label>Department</label><select id="ob_dept"><option>Engineering</option><option>HR</option><option>Sales</option><option>Marketing</option><option>Finance</option><option>Operations</option></select></div>
            <div><label>Start Date</label><input type="date" id="ob_start"></div>
            <div><label>Reporting Manager</label><input type="text" id="ob_manager" placeholder="Jane Smith"></div>
          </div>
          <div class="row2" style="margin-top:8px;">
            <div><label>Work Email</label><input type="email" id="ob_email" placeholder="john@company.com"></div>
            <div><label>Personal Phone</label><input type="text" id="ob_phone" placeholder="+91 98765 43210"></div>
          </div>
          <button class="btn btn-onboard btn-full" onclick="createOnboardingProfile()" style="margin-top:14px;">ğŸ‰ Create Onboarding Profile</button>
        </div>

        <div id="ob_activeProfiles">
          <!-- Active onboarding profiles shown here -->
        </div>

        <!-- Default Checklist Template -->
        <div class="card">
          <h3>ğŸ“‹ Onboarding Checklist Template</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;">
            <button class="btn btn-accent" onclick="selectAllChecks()">âœ… Select All</button>
            <button class="btn btn-danger" onclick="clearAllChecks()">âŒ Clear All</button>
            <button class="btn btn-save" onclick="saveChecklistTemplate()">ğŸ’¾ Save Template</button>
          </div>

          <div class="onboard-stage">
            <h4>ğŸ“… Pre-Arrival (Day -7 to 0)</h4>
            <div id="checklist_pre"></div>
          </div>
          <div class="onboard-stage">
            <h4>ğŸŒ… Day 1</h4>
            <div id="checklist_day1"></div>
          </div>
          <div class="onboard-stage">
            <h4>ğŸ“† Week 1</h4>
            <div id="checklist_week1"></div>
          </div>
          <div class="onboard-stage">
            <h4>ğŸ“† Month 1</h4>
            <div id="checklist_month1"></div>
          </div>

          <div style="margin-top:16px;">
            <div class="edit-row"><span class="edit-label">Overall Progress</span>
              <div style="flex:1;">
                <div class="progress-bar"><div class="progress-fill" id="ob_progress_bar" style="width:0%"></div></div>
                <span style="font-size:0.78rem;color:var(--muted);" id="ob_progress_text">0 / 0 tasks completed</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Document Collection Tracker -->
        <div class="card">
          <h3>ğŸ“ Document Collection Tracker</h3>
          <div id="doc_tracker_list"></div>
          <button class="btn btn-save" onclick="markAllDocs()" style="margin-top:12px;">âœ… Mark All Received</button>
        </div>

        <!-- Welcome Email Generator -->
        <div class="card">
          <h3>ğŸ“§ Auto Welcome Email / Message</h3>
          <div class="row2">
            <div><label>Employee</label><input type="text" id="wel_name" placeholder="John Doe"></div>
            <div><label>Role</label><input type="text" id="wel_role" placeholder="Senior Developer"></div>
          </div>
          <div style="margin-top:8px;"><label>First Day Agenda</label><textarea id="wel_agenda" style="min-height:60px;" placeholder="9:00 AM - Office tour&#10;10:00 AM - IT setup&#10;11:00 AM - Team meet"></textarea></div>
          <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
            <button class="btn btn-onboard" onclick="generateWelcomeEmail()">âœï¸ Generate Welcome Email</button>
            <button class="btn btn-wa" onclick="generateWelcomeWA()">ğŸ’¬ Generate WA Welcome</button>
          </div>
          <div id="welcome_output" class="jd-output hidden" style="margin-top:12px;"></div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PIPELINE KANBAN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-pipeline" class="hidden">
        <div class="card" style="padding:14px;">
          <h3>ğŸ”„ Recruitment Pipeline</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:14px;">
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <button class="btn btn-primary" onclick="showAddCandModal()">+ Add Candidate</button>
              <button class="btn btn-accent" onclick="loadPipeline()">ğŸ”„ Refresh</button>
              <button class="btn btn-save" onclick="exportPipeline()">ğŸ“¥ Export</button>
            </div>
            <div style="display:flex;gap:6px;align-items:center;">
              <label style="margin:0;font-size:0.78rem;">Filter Job:</label>
              <select id="pipe_jobFilter" style="max-width:200px;" onchange="loadPipeline()">
                <option value="">All Jobs</option>
              </select>
            </div>
          </div>
          <div class="kanban-board" id="kanbanBoard">
            <div class="kanban-col">
              <div class="kanban-col-header" style="color:#94a3b8;">ğŸ“¥ Applied <span class="kanban-badge" id="kc_applied">0</span></div>
              <div id="kcol_applied"></div>
            </div>
            <div class="kanban-col">
              <div class="kanban-col-header" style="color:#f59e0b;">â­ Shortlisted <span class="kanban-badge" id="kc_shortlisted">0</span></div>
              <div id="kcol_shortlisted"></div>
            </div>
            <div class="kanban-col">
              <div class="kanban-col-header" style="color:#3b82f6;">ğŸ¤ Interviewed <span class="kanban-badge" id="kc_interviewed">0</span></div>
              <div id="kcol_interviewed"></div>
            </div>
            <div class="kanban-col">
              <div class="kanban-col-header" style="color:#8b5cf6;">ğŸ¤ Offered <span class="kanban-badge" id="kc_offered">0</span></div>
              <div id="kcol_offered"></div>
            </div>
            <div class="kanban-col">
              <div class="kanban-col-header" style="color:#10b981;">âœ… Hired <span class="kanban-badge" id="kc_hired">0</span></div>
              <div id="kcol_hired"></div>
            </div>
          </div>
        </div>

        <!-- Add Candidate Modal -->
        <div class="payslip-modal hidden" id="addCandModal">
          <div style="background:#0f172a;border:1px solid var(--border);border-radius:20px;padding:28px;width:95%;max-width:480px;">
            <h3 style="color:#f59e0b;margin-bottom:16px;">+ Add to Pipeline</h3>
            <div class="row2">
              <div><label>Name *</label><input type="text" id="ac_name" placeholder="John Doe"></div>
              <div><label>Email *</label><input type="email" id="ac_email" placeholder="john@email.com"></div>
            </div>
            <div class="row2" style="margin-top:6px;">
              <div><label>Job Role *</label><input type="text" id="ac_role" placeholder="Frontend Developer"></div>
              <div><label>Phone</label><input type="text" id="ac_phone" placeholder="+91 98765 43210"></div>
            </div>
            <div class="row2" style="margin-top:6px;">
              <div><label>Stage</label><select id="ac_stage"><option value="applied">Applied</option><option value="shortlisted">Shortlisted</option><option value="interviewed">Interviewed</option><option value="offered">Offered</option><option value="hired">Hired</option></select></div>
              <div><label>ATS Score</label><input type="number" id="ac_ats" placeholder="75" min="0" max="100"></div>
            </div>
            <div style="margin-top:8px;"><label>Notes</label><textarea id="ac_notes" style="min-height:50px;" placeholder="Any notes about this candidate..."></textarea></div>
            <div style="display:flex;gap:8px;margin-top:16px;">
              <button class="btn btn-save btn-full" onclick="addToPipeline()">âœ… Add Candidate</button>
              <button class="btn btn-danger" style="padding:14px 20px;" onclick="document.getElementById('addCandModal').classList.add('hidden')">âœ•</button>
            </div>
          </div>
        </div>

        <!-- Pipeline Analytics -->
        <div class="card">
          <h3>ğŸ“Š Pipeline Analytics</h3>
          <div class="stat-grid" id="pipelineStats">
            <div class="stat-card"><div class="stat-num" style="color:#94a3b8;" id="ps_total">0</div><div class="stat-lbl">Total</div></div>
            <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="ps_hired">0</div><div class="stat-lbl">Hired</div></div>
            <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="ps_conversion">0%</div><div class="stat-lbl">Hire Rate</div></div>
            <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="ps_avgScore">0</div><div class="stat-lbl">Avg ATS Score</div></div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SITE EDITOR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-editor" class="hidden">
        <div class="card"><h3>ğŸ·ï¸ Branding</h3>
          <div class="edit-row"><span class="edit-label">Site Title</span><input class="edit-input" id="ed_title" value="AI Interview Platform" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Subtitle</span><input class="edit-input" id="ed_subtitle" value="Intelligent â€¢ Adaptive â€¢ Proctored" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Company</span><input class="edit-input" id="ed_company" value="SIMPATICO HR" onchange="saveSiteConfig()"></div>
        </div>
        <div class="card"><h3>ğŸ¨ Colors</h3>
          <div class="edit-row"><span class="edit-label">Primary</span><input type="color" class="edit-color" id="ed_primary" value="#6366f1" onchange="saveSiteConfig()"><span class="edit-preview">#6366f1</span></div>
          <div class="edit-row"><span class="edit-label">Secondary</span><input type="color" class="edit-color" id="ed_secondary" value="#8b5cf6" onchange="saveSiteConfig()"><span class="edit-preview">#8b5cf6</span></div>
          <div class="edit-row"><span class="edit-label">Success</span><input type="color" class="edit-color" id="ed_success" value="#10b981" onchange="saveSiteConfig()"><span class="edit-preview">#10b981</span></div>
          <div class="edit-row"><span class="edit-label">Background</span><input type="color" class="edit-color" id="ed_bg" value="#020617" onchange="saveSiteConfig()"><span class="edit-preview">#020617</span></div>
        </div>
        <div class="card"><h3>ğŸ”¤ Font & Style</h3>
          <div class="edit-row"><span class="edit-label">Font</span><select class="edit-input" id="ed_font" onchange="saveSiteConfig()"><option value="'Plus Jakarta Sans',system-ui,sans-serif">Jakarta Sans</option><option value="'Inter',system-ui,sans-serif">Inter</option><option value="'Poppins',system-ui,sans-serif">Poppins</option><option value="system-ui,sans-serif">System</option></select></div>
          <div class="edit-row"><span class="edit-label">Radius</span><input type="range" class="edit-input" id="ed_radius" min="0" max="30" step="2" value="20" style="max-width:200px;" oninput="document.getElementById('rv').textContent=this.value+'px'" onchange="saveSiteConfig()"><span class="edit-preview" id="rv">20px</span></div>
        </div>
        <div class="card"><h3>ğŸ“¢ Banner</h3>
          <div class="edit-row"><span class="edit-label">Show</span><div class="toggle-switch" id="tog_banner" onclick="toggleSwitch(this);saveSiteConfig()"></div><span class="edit-preview">Off</span></div>
          <div class="edit-row"><span class="edit-label">Text</span><input class="edit-input" id="ed_bannerText" value="ğŸ‰ AI Mock Interviews now available!" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Color</span><input type="color" class="edit-color" id="ed_bannerColor" value="#6366f1" onchange="saveSiteConfig()"></div>
        </div>
        <div style="display:flex;gap:10px;margin-top:16px;">
          <button class="btn btn-save btn-full" onclick="saveSiteConfig();toast('ğŸ’¾ Published!')">ğŸ’¾ Save & Publish</button>
          <button class="btn btn-danger" style="padding:14px;" onclick="resetSiteConfig()">ğŸ”„ Reset</button>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAYMENTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="tab-payments" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="pTotal">â‚¹0</div><div class="stat-lbl">Revenue</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="pCount">0</div><div class="stat-lbl">Total</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="pPending">0</div><div class="stat-lbl">Pending</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="pActive">0</div><div class="stat-lbl">Active</div></div>
        </div>
        <div class="card"><h3>ğŸ’° Pricing</h3>
          <div class="edit-row"><span class="edit-label">Mock Price (â‚¹)</span><input class="edit-input" type="number" id="ed_price" value="199" style="max-width:120px;"></div>
          <div class="edit-row"><span class="edit-label">Duration</span><select class="edit-input" id="ed_days" style="max-width:160px;"><option value="7">7 days</option><option value="30" selected>30 days</option><option value="90">90 days</option><option value="365">1 year</option></select></div>
          <div class="edit-row"><span class="edit-label">Mock Paid</span><div class="toggle-switch on" id="tog_paid" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
          <button class="btn btn-save" onclick="savePricing()" style="margin-top:10px;">ğŸ’¾ Save</button>
        </div>
        <div class="card"><h3>ğŸ¦ Gateway</h3>
          <div class="edit-row"><span class="edit-label">Razorpay Key</span><input class="edit-input" type="password" id="ed_razorKey" placeholder="rzp_live_xxxx"></div>
          <div class="edit-row"><span class="edit-label">UPI ID</span><input class="edit-input" id="ed_upiId" placeholder="your@upi"></div>
          <button class="btn btn-save" onclick="saveGateway()" style="margin-top:10px;">ğŸ’¾ Save</button>
        </div>
        <div class="card"><h3>ğŸ“œ Payment History</h3><div style="overflow-x:auto;"><table class="pay-table"><thead><tr><th>Date</th><th>User</th><th>Amount</th><th>Type</th><th>Status</th><th>Act</th></tr></thead><tbody id="payHistory"><tr><td colspan="6" style="text-align:center;color:var(--muted);">Loading...</td></tr></tbody></table></div></div>
        <div class="card"><h3>âœ‹ Manual Payment</h3>
          <div class="row2"><div><label>Email *</label><input type="email" id="mp_email" placeholder="user@email.com"></div><div><label>Amount</label><input type="number" id="mp_amount" value="199"></div></div>
          <div class="row2" style="margin-top:4px;"><div><label>Days</label><input type="number" id="mp_days" value="30"></div><div><label>Note</label><input type="text" id="mp_note" placeholder="UPI / Cash"></div></div>
          <button class="btn btn-save btn-full" onclick="addManualPayment()" style="margin-top:12px;">âœ… Add Payment</button>
        </div>
      </div>

      <!-- ACCESS CODES -->
      <div id="tab-access" class="hidden">
        <div class="card"><h3>ğŸ”‘ Generate Code</h3>
          <div class="row2"><div><label>Code *</label><input type="text" id="ac_code" placeholder="CAMPUS2025"></div><div><label>Max Uses</label><input type="number" id="ac_max" value="50"></div></div>
          <div class="row2" style="margin-top:4px;"><div><label>Days</label><input type="number" id="ac_days" value="30"></div><div><label>Expires</label><input type="date" id="ac_expiry"></div></div>
          <div style="display:flex;gap:8px;margin-top:12px;"><button class="btn btn-save" style="flex:1;padding:12px;" onclick="genCode()">ğŸ”‘ Generate</button><button class="btn btn-primary" style="padding:12px;" onclick="genRandom()">ğŸ² Random</button></div>
        </div>
        <div class="card"><h3>ğŸ“‹ All Codes</h3><div id="codesList">Loading...</div></div>
      </div>

      <!-- CLIENTS -->
      <div id="tab-clients" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="clTotal">0</div><div class="stat-lbl">Total</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="clActive">0</div><div class="stat-lbl">Active</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="clExpiring">0</div><div class="stat-lbl">Expiring</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#ef4444;" id="clExpired">0</div><div class="stat-lbl">Expired</div></div>
        </div>
        <div class="card"><h3>ğŸ¢ Add Client</h3>
          <div class="row2"><div><label>Company *</label><input type="text" id="cl_name" placeholder="TCS, Infosys"></div><div><label>Email *</label><input type="email" id="cl_email" placeholder="hr@company.com"></div></div>
          <div class="row2" style="margin-top:4px;"><div><label>Plan</label><select id="cl_plan"><option value="starter">Starter â‚¹999</option><option value="professional" selected>Pro â‚¹2,999</option><option value="enterprise">Enterprise â‚¹9,999</option></select></div><div><label>Duration</label><select id="cl_duration"><option value="30">1 Month</option><option value="90">3 Months</option><option value="365" selected>1 Year</option></select></div></div>
          <div class="row2" style="margin-top:4px;"><div><label>Amount Paid</label><input type="number" id="cl_amount" value="2999"></div><div><label>Payment</label><select id="cl_payMethod"><option value="razorpay">Razorpay</option><option value="bank">Bank</option><option value="upi">UPI</option><option value="free">Free Trial</option></select></div></div>
          <button class="btn btn-save btn-full" onclick="addClient()" style="margin-top:12px;">ğŸ¢ Add Client</button>
        </div>
        <div class="card"><h3>ğŸ“‹ All Clients</h3><div id="clientsList">Loading...</div></div>
      </div>

      <!-- JOBS -->
      <div id="tab-jobs" class="hidden"><div class="card"><h3>ğŸ’¼ All Jobs</h3><div id="adminJobsList"><span class="loading"></span></div></div></div>

      <!-- CANDIDATES -->
      <div id="tab-candidates" class="hidden">
        <div class="card"><h3>ğŸ‘¥ Applications</h3><div id="adminCandList"><span class="loading"></span></div></div>
        <div class="card"><h3>ğŸ¤ Interviews</h3><div id="adminIntList"><span class="loading"></span></div></div>
      </div>

      <!-- USAGE ANALYTICS -->
      <div id="tab-usage" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="uToday">0</div><div class="stat-lbl">Today</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="uWeek">0</div><div class="stat-lbl">This Week</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="uMonth">0</div><div class="stat-lbl">This Month</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="uTotal">0</div><div class="stat-lbl">All Time</div></div>
        </div>
        <div class="card"><h3>ğŸ“Š Interview Analytics</h3><div id="usageBreakdown">Loading...</div></div>
        <div class="card"><h3>ğŸŒ API Usage</h3>
          <div id="apiUsage">
            <div class="edit-row"><span class="edit-label">Groq AI (JDs + Chat)</span><span class="edit-preview" id="apiGroq">â€”</span></div>
            <div class="edit-row"><span class="edit-label">Cloudflare Workers</span><span class="edit-preview" id="apiCF">â€”</span></div>
            <div class="edit-row"><span class="edit-label">WhatsApp Messages Sent</span><span class="edit-preview" id="apiWA">â€”</span></div>
          </div>
        </div>
        <div class="card"><h3>ğŸ‘¥ Top Candidates</h3><div id="topCandidates">Loading...</div></div>
      </div>

      <!-- SETTINGS -->
      <div id="tab-settings" class="hidden">

        <!-- â”€â”€ FEATURE CONTROLS â”€â”€ -->
        <div class="card">
          <h3>ğŸ§© Feature Module Controls</h3>
          <p style="font-size:0.8rem;color:var(--muted);margin-bottom:16px;">Enable or disable each module. Disabled modules are hidden from the tab bar and their content is locked. Changes apply instantly.</p>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ« Interview Tokens</div>
                <div class="ft-desc">Generate proctored & mock interview links for candidates</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_tokens" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_tokens" onclick="toggleFeature('tokens',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">âœï¸ AI Job Description Builder</div>
                <div class="ft-desc">Generate ATS-optimized JDs using AI from just a job title</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_jdbuilder" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_jdbuilder" onclick="toggleFeature('jdbuilder',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ’° Payroll Management</div>
                <div class="ft-desc">Employee salary tracking, payslip generation, bulk payroll runs & CSV export</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_payroll" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_payroll" onclick="toggleFeature('payroll',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ’¬ WhatsApp Automation</div>
                <div class="ft-desc">Message templates, bulk WA links, campaign tracker & Twilio webhook</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_whatsapp" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_whatsapp" onclick="toggleFeature('whatsapp',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ‰ Onboarding Automation</div>
                <div class="ft-desc">New hire profiles, checklists, document tracker & welcome email/WA generator</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_onboarding" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_onboarding" onclick="toggleFeature('onboarding',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ”„ Recruitment Pipeline (Kanban)</div>
                <div class="ft-desc">Visual kanban board tracking candidates across hiring stages</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_pipeline" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_pipeline" onclick="toggleFeature('pipeline',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ¨ Site Editor</div>
                <div class="ft-desc">Branding, colors, banner, and font customization for the platform</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_editor" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_editor" onclick="toggleFeature('editor',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ’³ Payments</div>
                <div class="ft-desc">Revenue tracking, payment history, Razorpay/UPI gateway & manual payments</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_payments" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_payments" onclick="toggleFeature('payments',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ”‘ Access Codes</div>
                <div class="ft-desc">Generate and manage career lab access codes with usage limits</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_access" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_access" onclick="toggleFeature('access',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ¢ Client Management</div>
                <div class="ft-desc">Add and manage HR clients with plans, expiry and renewal tracking</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_clients" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_clients" onclick="toggleFeature('clients',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ’¼ Jobs Management</div>
                <div class="ft-desc">View, enable/disable and delete job postings from the platform</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_jobs" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_jobs" onclick="toggleFeature('jobs',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ‘¥ Candidates & People</div>
                <div class="ft-desc">View applications, ATS scores, interview status and candidate records</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_candidates" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_candidates" onclick="toggleFeature('candidates',this)"></div>
              </div>
            </div>
          </div>

          <div class="feature-toggle-card">
            <div class="ft-header">
              <div>
                <div class="ft-title">ğŸ“ˆ Usage Analytics</div>
                <div class="ft-desc">Interview stats, API usage, top candidates and conversion analytics</div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <span id="ft_badge_usage" class="ft-badge-on">Enabled</span>
                <div class="toggle-switch on" id="ft_usage" onclick="toggleFeature('usage',this)"></div>
              </div>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:16px;flex-wrap:wrap;">
            <button class="btn btn-save" onclick="enableAllFeatures()">âœ… Enable All</button>
            <button class="btn btn-danger" onclick="disableAllFeatures()">ğŸš« Disable All (except Dashboard)</button>
          </div>
        </div>

        <div class="card"><h3>ğŸ” Passwords</h3>
          <div class="edit-row"><span class="edit-label">Admin Pass</span><input class="edit-input" type="password" id="set_adminPass" placeholder="Min 6 chars"><button class="btn btn-primary" onclick="changeAdminPass()" style="margin-left:8px;">Change</button></div>
          <div class="edit-row"><span class="edit-label">HR Pass</span><input class="edit-input" type="password" id="set_hrPass" placeholder="Min 4 chars"><button class="btn btn-primary" onclick="changeHRPass()" style="margin-left:8px;">Change</button></div>
        </div>
        <div class="card"><h3>âš™ï¸ Platform</h3>
          <div class="edit-row"><span class="edit-label">Worker URL</span><input class="edit-input" id="set_worker" value="https://evalis-ai.simpaticohrconsultancy.workers.dev"></div>
          <div class="edit-row"><span class="edit-label">Max Violations</span><input class="edit-input" type="number" id="set_violations" value="3" style="max-width:100px;"></div>
          <div class="edit-row"><span class="edit-label">Maintenance Mode</span><div class="toggle-switch" id="tog_maint" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
          <button class="btn btn-save btn-full" onclick="savePlatformSettings()" style="margin-top:12px;">ğŸ’¾ Save</button>
        </div>
        <div class="card"><h3>ğŸ—ƒï¸ Data Management</h3><div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-primary" onclick="exportAllData()">ğŸ“¥ Export All</button>
          <button class="btn btn-accent" onclick="importData()">ğŸ“¤ Import</button>
          <button class="btn btn-danger" onclick="dangerReset()">âš ï¸ Reset All</button>
        </div></div>
      </div>

    </div>
  </div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG & CORE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_DEFAULT="superadmin@2025";
const W_DEFAULT="https://evalis-ai.simpaticohrconsultancy.workers.dev";
function getConfig(k,fb){try{return JSON.parse(localStorage.getItem("adminConfig")||"{}")[k]??fb}catch(e){return fb}}
function setConfig(k,v){try{const c=JSON.parse(localStorage.getItem("adminConfig")||"{}");c[k]=v;localStorage.setItem("adminConfig",JSON.stringify(c))}catch(e){}}
function getW(){return getConfig('workerUrl',W_DEFAULT)}

async function db(a,t,d=null,f=null,s=null,o=null){
  try{const r=await fetch(getW()+"/db",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:a,table:t,data:d,filters:f,select:s,order:o})});return await r.json()}
  catch(e){console.error('[DB]',e);return[]}
}

async function aiChat(messages){
  try{const r=await fetch(getW(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages})});const d=await r.json();return d.response||''}
  catch(e){console.error('[AI]',e);return''}
}

function toast(m,dur=3200){const c=document.getElementById("toasts"),t=document.createElement("div");t.className="toast";t.textContent=m;c.appendChild(t);setTimeout(()=>t.remove(),dur)}
function toggleSwitch(el){el.classList.toggle('on');const n=el.nextElementSibling;if(n?.classList.contains('edit-preview'))n.textContent=el.classList.contains('on')?'On':'Off'}
function genUUID(){return crypto.randomUUID?crypto.randomUUID():(Date.now().toString(36)+'-'+Math.random().toString(36).substring(2,10))}
function fmtINR(n){return'â‚¹'+(n||0).toLocaleString('en-IN')}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  const pwd=document.getElementById('loginPass').value;
  if(pwd===getConfig('adminPassword',ADMIN_DEFAULT)){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('adminWrap').style.display='block';
    setConfig('lastLogin',new Date().toISOString());
    applyFeatureVisibility();
    loadDashboard();toast('âœ… Welcome, Admin!');
  }else{
    document.getElementById('loginError').style.display='block';
    setTimeout(()=>document.getElementById('loginError').style.display='none',3000);
  }
}
function doLogout(){
  document.getElementById('adminWrap').style.display='none';
  document.getElementById('loginScreen').style.display='block';
  document.getElementById('loginPass').value='';toast('ğŸšª Logged out');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ALL_TABS=['dashboard','tokens','jdbuilder','payroll','whatsapp','onboarding','pipeline','editor','payments','access','clients','jobs','candidates','usage','settings'];
function showTab(tab){
  // Block navigation to disabled tabs (except dashboard & settings)
  if(FEATURE_TABS.includes(tab) && !getFeatureState(tab)){
    toast('âš™ï¸ This module is disabled. Enable it in Settings.');
    return;
  }
  ALL_TABS.forEach(t=>document.getElementById('tab-'+t)?.classList.add('hidden'));
  document.getElementById('tab-'+tab)?.classList.remove('hidden');
  document.querySelectorAll('.admin-tab').forEach((b,i)=>b.classList.toggle('active',ALL_TABS[i]===tab));
  const loaders={dashboard:loadDashboard,tokens:loadTokens,jdbuilder:loadJDLibrary,payroll:loadPayrollTab,whatsapp:initWATab,onboarding:initOnboardingTab,pipeline:loadPipeline,payments:loadPayments,access:loadCodes,clients:loadClients,jobs:loadAdminJobs,candidates:loadAdminCandidates,usage:loadUsageAnalytics,settings:loadSettings};
  loaders[tab]?.();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDashboard(){
  try{
    const[pay,apps,ints,jobs]=await Promise.all([db('select','payments').catch(()=>[]),db('select','applications').catch(()=>[]),db('select','interviews').catch(()=>[]),db('select','jobs').catch(()=>[])]);
    const pa=Array.isArray(pay)?pay:[];const aa=Array.isArray(apps)?apps:[];const ia=Array.isArray(ints)?ints:[];const ja=Array.isArray(jobs)?jobs:[];
    const rev=pa.filter(p=>p.status==='completed').reduce((s,p)=>s+(p.amount||0),0);
    document.getElementById('sRevenue').textContent=fmtINR(rev);
    document.getElementById('sUsers').textContent=aa.length;
    document.getElementById('sInterviews').textContent=ia.length;
    document.getElementById('sJobs').textContent=ja.length;
    const emps=JSON.parse(localStorage.getItem('hr_employees')||'[]');
    document.getElementById('sEmployees').textContent=emps.length;
    document.getElementById('sWaSent').textContent=getConfig('waSentCount',0);
    const obs=JSON.parse(localStorage.getItem('hr_onboarding')||'[]');
    document.getElementById('sOnboarding').textContent=obs.filter(o=>o.status!=='completed').length;
    document.getElementById('sJdGenerated').textContent=getConfig('jdCount',0);
    const log=document.getElementById('activityLog');
    const items=[...aa.map(a=>({t:a.created_at,m:`ğŸ“ ${a.name||'?'} applied${a.ats_score?' (ATS:'+a.ats_score+')':''}`})),...ia.map(i=>({t:i.started_at||i.created_at,m:`ğŸ¤ ${i.interview_role||'?'}: ${i.status} ${i.overall_score?'('+i.overall_score+'/100)':''}`})),...pa.map(p=>({t:p.created_at,m:`ğŸ’³ ${fmtINR(p.amount)} ${p.type||''}: ${p.status}`})),...emps.slice(-5).map(e=>({t:e.joinDate||new Date().toISOString(),m:`ğŸ‘¤ ${e.name} added â€” ${e.designation}`}))].sort((a,b)=>new Date(b.t||0)-new Date(a.t||0)).slice(0,30);
    log.innerHTML=items.length?items.map(i=>`<div><span style="font-size:0.7rem;color:var(--muted);">${i.t?new Date(i.t).toLocaleString():'?'}</span> ${i.m}</div>`).join(''):'<div>No activity yet</div>';
  }catch(e){console.error(e)}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ« TOKEN GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _lastGeneratedToken=null;
document.getElementById('tk_role')?.addEventListener('change',e=>{
  document.getElementById('tk_customWrap').classList.toggle('hidden',e.target.value!=='custom');
});

async function loadTokenJobs(){
  try{const data=await db('select','jobs',null,{is_active:true});const arr=Array.isArray(data)?data:[];const sel=document.getElementById('tk_jobId');sel.innerHTML='<option value="">â€” None â€”</option>';arr.forEach(j=>{sel.innerHTML+=`<option value="${j.id}">${j.title}</option>`})}catch(e){}
}

async function generateToken(){
  const name=document.getElementById('tk_name').value.trim();
  const email=document.getElementById('tk_email').value.trim();
  const roleEl=document.getElementById('tk_role');
  let role=roleEl.value==='custom'?document.getElementById('tk_customRole').value.trim():roleEl.value;
  if(!name||!email||!role){toast('âŒ Fill all required fields');return}
  const level=document.getElementById('tk_level').value;
  const questions=parseInt(document.getElementById('tk_questions').value)||10;
  const lang=document.getElementById('tk_lang').value;
  const hours=parseInt(document.getElementById('tk_expiry').value)||72;
  const type=document.getElementById('tk_type').value;
  const jobId=document.getElementById('tk_jobId').value||null;
  const token=genUUID();
  const expires=new Date(Date.now()+hours*3600000);
  toast('â³ Creating token...');
  try{
    let appId=null;
    try{const ar=await db('insert','applications',{job_id:jobId,name,email,resume_text:'',status:'shortlisted',created_at:new Date().toISOString()});const a=Array.isArray(ar)?ar[0]:ar;appId=a?.id}catch(e){}
    await db('insert','interviews',{application_id:appId,job_id:jobId,token,interview_type:type,status:'pending',interview_role:role,interview_level:level,question_count:questions,interview_language:lang,expires_at:expires.toISOString(),created_at:new Date().toISOString()});
    const baseUrl=window.location.origin;
    const interviewPage=type==='real'?'evalis-interview.html':'evalis-platform.html';
    const fullUrl=`${baseUrl}/${interviewPage}?token=${token}`;
    _lastGeneratedToken={name,email,role,level,token,url:fullUrl,expires,type,questions,lang,phone:''};
    document.getElementById('tokenResultCard').classList.remove('hidden');
    document.getElementById('tokenResultName').textContent=`${name} â€” ${role} (${level})`;
    document.getElementById('tokenResultMeta').textContent=`ğŸ“§ ${email} â€¢ ğŸ”¢ ${questions} questions â€¢ ğŸŒ ${lang} â€¢ ${type==='real'?'ğŸ”’ Proctored':'ğŸ¯ Mock'}`;
    document.getElementById('tokenResultUrl').value=fullUrl;
    document.getElementById('tokenResultToken').textContent='Token: '+token;
    document.getElementById('tokenResultExpiry').textContent=`â° Expires: ${expires.toLocaleString()} (${hours}h)`;
    toast('âœ… Token generated for '+name+'!');
    loadAllTokens();
  }catch(e){toast('âŒ Failed: '+e.message)}
}

function copyTokenUrl(){navigator.clipboard?.writeText(_lastGeneratedToken?.url||'');toast('ğŸ“‹ URL copied!')}
function copyTokenRaw(){navigator.clipboard?.writeText(_lastGeneratedToken?.token||'');toast('ğŸ“‹ Token copied!')}
function sendToWA(){
  if(!_lastGeneratedToken)return;
  const t=_lastGeneratedToken;
  const msg=encodeURIComponent(`ğŸ¤ *Interview Invitation*\n\nHi ${t.name}! You're shortlisted for *${t.role}* (${t.level}).\n\nComplete your AI interview here:\n${t.url}\n\nğŸ“‹ ${t.questions} questions â€¢ ${t.type==='real'?'ğŸ”’ Proctored':'ğŸ¯ Practice'}\nâ° Expires: ${t.expires.toLocaleDateString()}\n\nGood luck! ğŸ€\nâ€” Simpatico HR`);
  window.open(`https://wa.me/?text=${msg}`,'_blank');
  incrementWASent();
}
function copyInviteEmail(){
  if(!_lastGeneratedToken)return;
  const t=_lastGeneratedToken;
  const email=`Subject: Interview Invitation â€” ${t.role} at Simpatico HR\n\nDear ${t.name},\n\nCongratulations! You have been shortlisted for the ${t.role} (${t.level}) position.\n\nPlease complete your AI interview:\nğŸ”— ${t.url}\n\nğŸ“‹ ${t.questions} questions â€¢ Type: ${t.type==='real'?'Proctored':'Mock'}\nâ° Expires: ${t.expires.toLocaleString()}\n\nBest regards,\nSimpatico HR Consultancy`;
  navigator.clipboard?.writeText(email);toast('ğŸ“§ Email copied!');
}
function copyWhatsApp(){
  if(!_lastGeneratedToken)return;
  const t=_lastGeneratedToken;
  const msg=`ğŸ¤ *Interview Invitation*\n\nHi ${t.name}! Shortlisted for *${t.role}* (${t.level}).\n\nğŸ”— ${t.url}\n\nğŸ“‹ ${t.questions} questions â€¢ ${t.type==='real'?'ğŸ”’ Proctored':'ğŸ¯ Practice'}\nâ° Expires: ${t.expires.toLocaleDateString()}\n\nGood luck! ğŸ€\nâ€” Simpatico HR`;
  navigator.clipboard?.writeText(msg);toast('ğŸ’¬ WA message copied!');
}
let _tokenFilter='all';
function filterTokens(f){_tokenFilter=f;loadAllTokens()}
async function loadAllTokens(){
  const el=document.getElementById('allTokensList');el.innerHTML='<span class="loading"></span>';
  try{
    const data=await db('select','interviews',null,null,null,'created_at.desc');let arr=Array.isArray(data)?data:[];const now=new Date();
    if(_tokenFilter==='expired')arr=arr.filter(i=>i.expires_at&&new Date(i.expires_at)<now&&i.status!=='completed');
    else if(_tokenFilter!=='all')arr=arr.filter(i=>i.status===_tokenFilter);
    if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No tokens found</p>';return}
    el.innerHTML=arr.slice(0,50).map(i=>{
      const exp=i.expires_at?new Date(i.expires_at):null;const isExp=exp&&exp<now&&i.status!=='completed';
      const sc={pending:'#f59e0b',in_progress:'#3b82f6',completed:'#10b981'}[i.status]||'#94a3b8';
      const url=`${window.location.origin}/${i.interview_type==='real'?'evalis-interview.html':'evalis-platform.html'}?token=${i.token}`;
      return`<div style="padding:12px;border-bottom:1px solid var(--border);${isExp?'opacity:0.5':''}">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:6px;">
          <div><div style="font-weight:700;font-size:0.9rem;">${i.interview_role||'?'} â€” ${i.interview_level||''}</div>
          <div style="font-size:0.72rem;color:var(--muted);">Token: ${(i.token||'?').substring(0,16)}... â€¢ ${i.created_at?new Date(i.created_at).toLocaleDateString():''}</div></div>
          <div style="display:flex;gap:6px;align-items:center;">
            ${i.overall_score?`<span class="score-badge" style="background:rgba(16,185,129,.15);color:${i.overall_score>=70?'#10b981':'#f59e0b'};">${i.overall_score}/100</span>`:''}
            <span class="status-pill" style="color:${isExp?'#ef4444':sc};">${isExp?'Expired':i.status}</span>
          </div>
        </div>
        <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
          <button class="btn btn-accent" style="padding:3px 10px;font-size:0.72rem;" onclick="navigator.clipboard?.writeText('${url}');toast('ğŸ“‹ URL copied!')">ğŸ“‹ URL</button>
          <button class="btn btn-wa" style="padding:3px 10px;font-size:0.72rem;" onclick="window.open('https://wa.me/?text='+encodeURIComponent('Interview link: ${url}'),'_blank');incrementWASent()">ğŸ’¬ WA</button>
          <button class="btn btn-danger" style="padding:3px 10px;font-size:0.72rem;" onclick="revokeToken('${i.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>`}).join('');
  }catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function revokeToken(id){if(!confirm('Delete?'))return;try{await db('delete','interviews',null,{id});toast('ğŸ—‘ï¸ Deleted');loadAllTokens()}catch(e){toast('âŒ '+e.message)}}
function loadTokens(){loadTokenJobs();loadAllTokens()}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœï¸ JD AI BUILDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _currentJD='';
async function generateJD(){
  const title=document.getElementById('jd_title').value.trim();
  if(!title){toast('âŒ Enter a job title');return}
  const industry=document.getElementById('jd_industry').value;
  const level=document.getElementById('jd_level').value;
  const emptype=document.getElementById('jd_emptype').value;
  const location=document.getElementById('jd_location').value||'Not specified';
  const salary=document.getElementById('jd_salary').value||'Competitive';
  const skills=document.getElementById('jd_skills').value;
  const extra=document.getElementById('jd_extra').value;
  const btn=document.getElementById('jd_genBtn');
  btn.textContent='â³ Generating...';btn.disabled=true;
  document.getElementById('jd_resultCard').classList.remove('hidden');
  document.getElementById('jd_output').innerHTML='<div class="jd-ai-thinking"><span class="loading"></span> AI is crafting your JD...</div>';

  const prompt=`You are an expert HR professional and technical writer. Generate a comprehensive, ATS-optimized job description for:

Job Title: ${title}
Industry: ${industry}
Level: ${level}
Employment Type: ${emptype}
Location: ${location}
Salary: ${salary}
Key Skills Required: ${skills||'To be determined based on role'}
Additional Notes: ${extra||'None'}

Write a professional job description with these EXACT sections:
1. ğŸ¢ About the Company (3-4 lines about a dynamic tech/HR company)
2. ğŸ“‹ Job Overview (2-3 lines summary)
3. ğŸ¯ Key Responsibilities (8-10 bullet points)
4. âœ… Required Qualifications (6-8 bullet points)
5. â­ Preferred Qualifications (4-5 bullet points)
6. ğŸ’¡ What We Offer (5-6 bullet points with benefits)
7. ğŸ“Š Skills & Technologies (technical and soft skills)
8. ğŸ”— How to Apply (brief instruction)

Make it engaging, inclusive, and ATS-friendly. Use action verbs. Format clearly.`;

  try{
    const response=await aiChat([{role:'user',content:prompt}]);
    _currentJD=response||'Failed to generate JD. Please try again.';
    document.getElementById('jd_output').textContent=_currentJD;
    setConfig('jdCount',(getConfig('jdCount',0)||0)+1);
    toast('âœ… JD generated!');
  }catch(e){
    document.getElementById('jd_output').textContent='âŒ Error: '+e.message;
    toast('âŒ Generation failed');
  }
  btn.textContent='âœ¨ Generate JD with AI';btn.disabled=false;
}

function copyJD(){
  if(!_currentJD){toast('âŒ Generate a JD first');return}
  navigator.clipboard?.writeText(_currentJD);toast('ğŸ“‹ JD copied to clipboard!');
}

function downloadJD(){
  if(!_currentJD){toast('âŒ Generate first');return}
  const title=document.getElementById('jd_title').value.trim()||'Job Description';
  const blob=new Blob([_currentJD],{type:'text/plain'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=title.replace(/\s+/g,'-')+'-JD.txt';a.click();
  toast('â¬‡ï¸ Downloaded!');
}

async function saveJDtoDB(){
  if(!_currentJD){toast('âŒ Generate first');return}
  const title=document.getElementById('jd_title').value.trim();
  const level=document.getElementById('jd_level').value;
  const location=document.getElementById('jd_location').value;
  const emptype=document.getElementById('jd_emptype').value;
  try{
    await db('insert','jobs',{title,level,location,employment_type:emptype,description:_currentJD,is_active:true,created_at:new Date().toISOString()});
    // Also save to local library
    const lib=JSON.parse(localStorage.getItem('jd_library')||'[]');
    lib.unshift({id:genUUID(),title,level,location,content:_currentJD,created_at:new Date().toISOString()});
    localStorage.setItem('jd_library',JSON.stringify(lib.slice(0,50)));
    toast('ğŸ’¾ Saved as job posting!');loadJDLibrary();
  }catch(e){
    // If DB fails, save locally
    const lib=JSON.parse(localStorage.getItem('jd_library')||'[]');
    lib.unshift({id:genUUID(),title,level,location,content:_currentJD,created_at:new Date().toISOString()});
    localStorage.setItem('jd_library',JSON.stringify(lib.slice(0,50)));
    toast('ğŸ’¾ Saved locally!');loadJDLibrary();
  }
}

function regenerateJD(){_currentJD='';generateJD()}

function loadJDLibrary(){
  const lib=JSON.parse(localStorage.getItem('jd_library')||'[]');
  const el=document.getElementById('jd_library');
  if(!lib.length){el.innerHTML='<p style="color:var(--muted);text-align:center;font-size:0.85rem;">No JDs saved yet.</p>';return}
  el.innerHTML=lib.map(jd=>`<div style="padding:12px;border-bottom:1px solid var(--border);">
    <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px;">
      <div><strong style="color:var(--accent);">${jd.title}</strong><div style="font-size:0.72rem;color:var(--muted);">${jd.level||''} â€¢ ${jd.location||''} â€¢ ${jd.created_at?new Date(jd.created_at).toLocaleDateString():''}</div></div>
      <div style="display:flex;gap:6px;">
        <button class="btn btn-save" style="padding:4px 10px;font-size:0.72rem;" onclick="loadJDFromLibrary('${jd.id}')">ğŸ‘ï¸ View</button>
        <button class="btn btn-danger" style="padding:4px 10px;font-size:0.72rem;" onclick="deleteJD('${jd.id}')">ğŸ—‘ï¸</button>
      </div>
    </div>
  </div>`).join('');
}

function loadJDFromLibrary(id){
  const lib=JSON.parse(localStorage.getItem('jd_library')||'[]');
  const jd=lib.find(j=>j.id===id);if(!jd)return;
  _currentJD=jd.content;
  document.getElementById('jd_title').value=jd.title||'';
  document.getElementById('jd_output').textContent=jd.content;
  document.getElementById('jd_resultCard').classList.remove('hidden');
  toast('ğŸ“„ JD loaded!');
}

function deleteJD(id){
  const lib=JSON.parse(localStorage.getItem('jd_library')||'[]').filter(j=>j.id!==id);
  localStorage.setItem('jd_library',JSON.stringify(lib));loadJDLibrary();toast('ğŸ—‘ï¸ Deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’° PAYROLL MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getEmployees(){return JSON.parse(localStorage.getItem('hr_employees')||'[]')}
function saveEmployees(e){localStorage.setItem('hr_employees',JSON.stringify(e))}

function calcPayroll(){
  const basic=parseFloat(document.getElementById('emp_basic').value)||0;
  const hra=parseFloat(document.getElementById('emp_hra').value)||0;
  const allow=parseFloat(document.getElementById('emp_allow').value)||0;
  const bonus=parseFloat(document.getElementById('emp_bonus').value)||0;
  const pfPct=parseFloat(document.getElementById('emp_pf').value)||12;
  const esiPct=parseFloat(document.getElementById('emp_esi').value)||0.75;
  const tds=parseFloat(document.getElementById('emp_tds').value)||0;
  if(!basic){document.getElementById('calc_result').style.display='none';return}
  const gross=basic+hra+allow+bonus;
  const pf=(basic*pfPct)/100;
  const esi=(gross*esiPct)/100;
  const net=gross-pf-esi-tds;
  document.getElementById('calc_result').style.display='block';
  document.getElementById('cr_basic').textContent=fmtINR(basic);
  document.getElementById('cr_hra').textContent=fmtINR(hra);
  document.getElementById('cr_allow').textContent=fmtINR(allow);
  document.getElementById('cr_bonus').textContent=fmtINR(bonus);
  document.getElementById('cr_gross').textContent=fmtINR(gross);
  document.getElementById('cr_pf').textContent='âˆ’'+fmtINR(Math.round(pf));
  document.getElementById('cr_esi').textContent='âˆ’'+fmtINR(Math.round(esi));
  document.getElementById('cr_tds').textContent='âˆ’'+fmtINR(tds);
  document.getElementById('cr_net').textContent=fmtINR(Math.round(net));
}

function addEmployee(){
  const name=document.getElementById('emp_name').value.trim();
  if(!name){toast('âŒ Name required');return}
  const emps=getEmployees();
  const id=document.getElementById('emp_id').value.trim()||'EMP-'+String(emps.length+1).padStart(3,'0');
  const basic=parseFloat(document.getElementById('emp_basic').value)||0;
  const hra=parseFloat(document.getElementById('emp_hra').value)||0;
  const allow=parseFloat(document.getElementById('emp_allow').value)||0;
  const bonus=parseFloat(document.getElementById('emp_bonus').value)||0;
  const pfPct=parseFloat(document.getElementById('emp_pf').value)||12;
  const esiPct=parseFloat(document.getElementById('emp_esi').value)||0.75;
  const tds=parseFloat(document.getElementById('emp_tds').value)||0;
  const gross=basic+hra+allow+bonus;
  const pf=(basic*pfPct)/100;
  const esi=(gross*esiPct)/100;
  const net=Math.round(gross-pf-esi-tds);
  const emp={id,name,department:document.getElementById('emp_dept').value,designation:document.getElementById('emp_desig').value,basic,hra,allow,bonus,pfPct,esiPct,tds,gross:Math.round(gross),net,bank:document.getElementById('emp_bank').value,joinDate:document.getElementById('emp_joindate').value,status:'active',addedAt:new Date().toISOString()};
  const existing=emps.findIndex(e=>e.id===id);
  if(existing>=0)emps[existing]=emp;else emps.push(emp);
  saveEmployees(emps);
  // Clear form
  ['emp_name','emp_id','emp_desig','emp_basic','emp_hra','emp_allow','emp_bonus','emp_bank','emp_joindate'].forEach(k=>{const el=document.getElementById(k);if(el)el.value=''});
  document.getElementById('emp_pf').value=12;document.getElementById('emp_esi').value=0.75;document.getElementById('emp_tds').value=0;
  document.getElementById('calc_result').style.display='none';
  toast('âœ… Employee '+name+' saved!');renderEmployeeList();
}

function renderEmployeeList(){
  const emps=getEmployees();const el=document.getElementById('employeeList');
  updatePayrollStats(emps);
  if(!emps.length){el.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No employees added.</p>';return}
  el.innerHTML=`<div style="overflow-x:auto;"><table class="pay-table">
    <thead><tr><th>ID</th><th>Name</th><th>Dept</th><th>Designation</th><th>Gross</th><th>Net Take-Home</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody>
    ${emps.map(e=>`<tr>
      <td style="font-family:monospace;color:var(--accent);">${e.id}</td>
      <td><strong>${e.name}</strong></td>
      <td>${e.department}</td>
      <td style="color:var(--muted);">${e.designation||'â€”'}</td>
      <td style="color:var(--yellow);">${fmtINR(e.gross)}</td>
      <td style="color:#10b981;font-weight:700;">${fmtINR(e.net)}</td>
      <td><span class="status-pill" style="background:rgba(16,185,129,.15);color:#10b981;">${e.status||'active'}</span></td>
      <td style="display:flex;gap:4px;flex-wrap:wrap;">
        <button class="btn btn-payroll" style="padding:3px 8px;font-size:0.7rem;" onclick="showPayslip('${e.id}')">ğŸ§¾ Slip</button>
        <button class="btn btn-accent" style="padding:3px 8px;font-size:0.7rem;" onclick="editEmployee('${e.id}')">âœï¸</button>
        <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteEmployee('${e.id}')">ğŸ—‘ï¸</button>
      </td>
    </tr>`).join('')}
    </tbody></table></div>`;
}

function updatePayrollStats(emps){
  document.getElementById('py_empCount').textContent=emps.length;
  const total=emps.reduce((s,e)=>s+(e.net||0),0);
  document.getElementById('py_totalPay').textContent=fmtINR(total);
  const hist=JSON.parse(localStorage.getItem('payroll_history')||'[]');
  const thisMonth=new Date().toISOString().slice(0,7);
  const processed=hist.filter(h=>h.month===thisMonth).length;
  document.getElementById('py_pending').textContent=Math.max(0,emps.length-processed);
  document.getElementById('py_processed').textContent=processed;
}

function editEmployee(id){
  const emps=getEmployees();const e=emps.find(x=>x.id===id);if(!e)return;
  document.getElementById('emp_name').value=e.name||'';
  document.getElementById('emp_id').value=e.id||'';
  document.getElementById('emp_dept').value=e.department||'Engineering';
  document.getElementById('emp_desig').value=e.designation||'';
  document.getElementById('emp_basic').value=e.basic||0;
  document.getElementById('emp_hra').value=e.hra||0;
  document.getElementById('emp_allow').value=e.allow||0;
  document.getElementById('emp_bonus').value=e.bonus||0;
  document.getElementById('emp_pf').value=e.pfPct||12;
  document.getElementById('emp_esi').value=e.esiPct||0.75;
  document.getElementById('emp_tds').value=e.tds||0;
  document.getElementById('emp_bank').value=e.bank||'';
  document.getElementById('emp_joindate').value=e.joinDate||'';
  calcPayroll();
  document.querySelector('.card h3')?.scrollIntoView({behavior:'smooth'});
  toast('âœï¸ Edit mode: '+e.name);
}

function deleteEmployee(id){
  if(!confirm('Delete this employee?'))return;
  const emps=getEmployees().filter(e=>e.id!==id);
  saveEmployees(emps);toast('ğŸ—‘ï¸ Deleted');renderEmployeeList();
}

function showPayslip(empId){
  const emps=getEmployees();const e=emps.find(x=>x.id===empId);if(!e)return;
  const month=new Date().toLocaleDateString('en-IN',{month:'long',year:'numeric'});
  const pf=Math.round((e.basic*(e.pfPct||12))/100);
  const esi=Math.round((e.gross*(e.esiPct||0.75))/100);
  const pfEmployer=Math.round((e.basic*13.15)/100);
  const ctc=e.gross+pfEmployer;
  document.getElementById('payslipContent').innerHTML=`
    <div class="payslip-header">
      <div>
        <div class="payslip-company">ğŸ¢ SIMPATICO HR</div>
        <div style="font-size:0.78rem;color:#64748b;">Perinthalmanna, Kerala | simpaticohrconsultancy.com</div>
      </div>
      <div style="text-align:right;">
        <div class="payslip-title">SALARY SLIP</div>
        <div style="font-size:0.82rem;color:#64748b;">${month}</div>
      </div>
    </div>
    <table class="payslip-table" style="margin-bottom:16px;">
      <tr><td><strong>Employee Name</strong></td><td>${e.name}</td><td><strong>Employee ID</strong></td><td>${e.id}</td></tr>
      <tr><td><strong>Designation</strong></td><td>${e.designation||'â€”'}</td><td><strong>Department</strong></td><td>${e.department}</td></tr>
      <tr><td><strong>Join Date</strong></td><td>${e.joinDate||'â€”'}</td><td><strong>Bank Account</strong></td><td>${e.bank||'â€”'}</td></tr>
      <tr><td><strong>Pay Period</strong></td><td>${month}</td><td><strong>Working Days</strong></td><td>26</td></tr>
    </table>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
      <div>
        <table class="payslip-table" style="width:100%;">
          <thead><tr><td>Earnings</td><td style="text-align:right;">Amount</td></tr></thead>
          <tbody>
            <tr><td>Basic Salary</td><td style="text-align:right;">${fmtINR(e.basic)}</td></tr>
            <tr><td>HRA</td><td style="text-align:right;">${fmtINR(e.hra||0)}</td></tr>
            <tr><td>Special Allowance</td><td style="text-align:right;">${fmtINR(e.allow||0)}</td></tr>
            <tr><td>Performance Bonus</td><td style="text-align:right;">${fmtINR(e.bonus||0)}</td></tr>
            <tr class="payslip-total"><td><strong>Gross Earnings</strong></td><td style="text-align:right;"><strong>${fmtINR(e.gross)}</strong></td></tr>
          </tbody>
        </table>
      </div>
      <div>
        <table class="payslip-table" style="width:100%;">
          <thead><tr><td>Deductions</td><td style="text-align:right;">Amount</td></tr></thead>
          <tbody>
            <tr><td>Provident Fund (${e.pfPct||12}%)</td><td style="text-align:right;color:#dc2626;">${fmtINR(pf)}</td></tr>
            <tr><td>ESI (${e.esiPct||0.75}%)</td><td style="text-align:right;color:#dc2626;">${fmtINR(esi)}</td></tr>
            <tr><td>TDS / Income Tax</td><td style="text-align:right;color:#dc2626;">${fmtINR(e.tds||0)}</td></tr>
            <tr class="payslip-total" style="background:#fff7ed;color:#d97706;"><td><strong>Total Deductions</strong></td><td style="text-align:right;"><strong>${fmtINR(pf+esi+(e.tds||0))}</strong></td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <table class="payslip-table" style="margin-bottom:20px;">
      <tr style="background:#f0fdf4;font-size:1.1rem;font-weight:800;color:#059669;">
        <td>ğŸ’° NET PAY (Take Home)</td>
        <td style="text-align:right;">${fmtINR(e.net)}</td>
        <td style="font-size:0.82rem;font-weight:400;color:#64748b;">CTC: ${fmtINR(ctc)}/month</td>
      </tr>
    </table>
    <div style="border-top:2px solid #e2e8f0;padding-top:14px;display:flex;justify-content:space-between;font-size:0.78rem;color:#94a3b8;">
      <div>Generated: ${new Date().toLocaleDateString('en-IN')}</div>
      <div>This is a computer-generated payslip.</div>
      <div>Authorized by: HR Dept</div>
    </div>
    <div style="display:flex;gap:8px;margin-top:16px;flex-wrap:wrap;">
      <button onclick="window.print()" style="padding:10px 20px;background:#6366f1;border:none;border-radius:8px;color:#fff;font-weight:700;cursor:pointer;">ğŸ–¨ï¸ Print / Save PDF</button>
      <button onclick="document.getElementById('payslipModal').classList.add('hidden')" style="padding:10px 20px;background:#f1f5f9;border:none;border-radius:8px;color:#475569;font-weight:700;cursor:pointer;">âœ• Close</button>
    </div>`;
  document.getElementById('payslipModal').classList.remove('hidden');
}

function runBulkPayroll(){
  const emps=getEmployees();if(!emps.length){toast('âŒ No employees added');return}
  const month=new Date().toISOString().slice(0,7);
  const hist=JSON.parse(localStorage.getItem('payroll_history')||'[]');
  const already=hist.filter(h=>h.month===month);
  if(already.length===emps.length){if(!confirm('Payroll already processed for this month. Run again?'))return}
  const batch={id:genUUID(),month,date:new Date().toISOString(),count:emps.length,totalAmount:emps.reduce((s,e)=>s+(e.net||0),0),status:'completed'};
  hist.unshift(batch);localStorage.setItem('payroll_history',JSON.stringify(hist.slice(0,24)));
  renderPayrollHistory();updatePayrollStats(emps);
  toast(`âœ… Payroll processed for ${emps.length} employees â€” ${fmtINR(batch.totalAmount)}`);
}

function renderPayrollHistory(){
  const hist=JSON.parse(localStorage.getItem('payroll_history')||'[]');
  const el=document.getElementById('payrollHistory');
  if(!hist.length){el.innerHTML='<p style="color:var(--muted);text-align:center;font-size:0.85rem;">No history.</p>';return}
  el.innerHTML=`<table class="pay-table"><thead><tr><th>Month</th><th>Employees</th><th>Total Paid</th><th>Date</th><th>Status</th></tr></thead><tbody>
  ${hist.map(h=>`<tr><td style="font-weight:700;">${h.month}</td><td>${h.count}</td><td style="color:#10b981;font-weight:700;">${fmtINR(h.totalAmount)}</td><td>${h.date?new Date(h.date).toLocaleDateString():''}</td><td><span class="status-pill" style="background:rgba(16,185,129,.15);color:#10b981;">${h.status}</span></td></tr>`).join('')}
  </tbody></table>`;
}

function exportPayrollCSV(){
  const emps=getEmployees();if(!emps.length){toast('âŒ No employees');return}
  const header='ID,Name,Department,Designation,Basic,HRA,Allowance,Bonus,Gross,PF,ESI,TDS,Net Pay';
  const rows=emps.map(e=>[e.id,e.name,e.department,e.designation,e.basic,e.hra||0,e.allow||0,e.bonus||0,e.gross,Math.round((e.basic*(e.pfPct||12))/100),Math.round((e.gross*(e.esiPct||0.75))/100),e.tds||0,e.net].join(',')).join('\n');
  const blob=new Blob([header+'\n'+rows],{type:'text/csv'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='payroll-'+new Date().toISOString().slice(0,7)+'.csv';a.click();
  toast('ğŸ“¥ CSV exported!');
}

function generateAllPayslips(){toast('ğŸ§¾ Print all payslips â€” open each via the list above')}

function loadPayrollTab(){renderEmployeeList();renderPayrollHistory()}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’¬ WHATSAPP AUTOMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WA_TEMPLATES={
  interview:{name:'ğŸ¤ Interview Invitation',body:`Hi *{name}*! ğŸ‘‹

You've been shortlisted for the *{role}* position at *Simpatico HR*.

ğŸ”— *AI Interview Link:*
{link}

ğŸ“‹ Please complete your interview at your earliest convenience.
â° Link expires in 72 hours.

Good luck! ğŸ€
â€” *Simpatico HR Team*`},
  shortlist:{name:'â­ Shortlisted',body:`Dear *{name}*,

Great news! ğŸ‰ You have been *shortlisted* for the *{role}* role.

Our team will reach out shortly with next steps.

Best regards,
*Simpatico HR Consultancy*`},
  offer:{name:'ğŸ‰ Offer Letter',body:`Congratulations *{name}*! ğŸ¥³

We're thrilled to offer you the position of *{role}* at our organization.

Your offer details have been shared via email. Please check and revert.

ğŸ”— {link}

Welcome to the team!
â€” *Simpatico HR*`},
  followup:{name:'ğŸ”” Follow-up',body:`Hi *{name}*! ğŸ‘‹

Just following up on your application for the *{role}* position.

Could you please confirm your availability for a quick call?

ğŸ”— {link}

Thank you!
â€” *Simpatico HR*`},
  rejection:{name:'ğŸ’Œ Polite Rejection',body:`Dear *{name}*,

Thank you for your interest in the *{role}* position.

After careful consideration, we've decided to move forward with other candidates whose experience more closely matches our current needs.

We truly appreciate your time and encourage you to apply for future openings.

Best wishes,
*Simpatico HR Consultancy*`},
  onboard:{name:'ğŸ‰ Onboarding Welcome',body:`Welcome aboard, *{name}*! ğŸŠ

We're so excited to have you join us as *{role}*!

ğŸ“‹ *First Day Info:*
{link}

Please reach out if you have any questions before your start date.

Looking forward to working with you! ğŸ’ª
â€” *Simpatico HR Team*`},
  payslip:{name:'ğŸ’° Payslip Ready',body:`Hi *{name}*,

Your payslip for this month is ready! ğŸ’°

ğŸ”— {link}

Please review and reach out to HR for any queries.

Regards,
*Simpatico HR*`},
  custom:{name:'âœï¸ Custom',body:''}
};

function initWATab(){previewWAMessage();renderWATemplates();renderWACampaignLog()}

function loadWATemplate(){
  const tpl=WA_TEMPLATES[document.getElementById('wa_template').value];
  if(tpl&&tpl.body){document.getElementById('wa_custom').value=tpl.body}
  previewWAMessage();
}

function previewWAMessage(){
  const tplKey=document.getElementById('wa_template').value;
  const name=document.getElementById('wa_cname').value||'{name}';
  const role=document.getElementById('wa_role').value||'{role}';
  const link=document.getElementById('wa_link').value||'{link}';
  let msg=WA_TEMPLATES[tplKey]?.body||document.getElementById('wa_custom').value;
  if(tplKey==='custom')msg=document.getElementById('wa_custom').value;
  msg=msg.replace(/\{name\}/g,name).replace(/\{role\}/g,role).replace(/\{link\}/g,link);
  const preview=document.getElementById('wa_preview');
  if(msg){preview.style.display='block';preview.textContent=msg}else{preview.style.display='none'}
  // Update WA link
  const phone=document.getElementById('wa_phone').value.replace(/\D/g,'');
  const wa_link=document.getElementById('wa_sendLink');
  wa_link.href=phone?`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`:`https://wa.me/?text=${encodeURIComponent(msg)}`;
}

function copyWAMessage(){
  const tplKey=document.getElementById('wa_template').value;
  const name=document.getElementById('wa_cname').value||'{name}';
  const role=document.getElementById('wa_role').value||'{role}';
  const link=document.getElementById('wa_link').value||'{link}';
  let msg=WA_TEMPLATES[tplKey]?.body||document.getElementById('wa_custom').value;
  if(tplKey==='custom')msg=document.getElementById('wa_custom').value;
  msg=msg.replace(/\{name\}/g,name).replace(/\{role\}/g,role).replace(/\{link\}/g,link);
  navigator.clipboard?.writeText(msg);toast('ğŸ“‹ Message copied!');
}

function trackWASend(){incrementWASent();logWACampaign('single',document.getElementById('wa_cname').value,document.getElementById('wa_role').value)}
function incrementWASent(){setConfig('waSentCount',(getConfig('waSentCount',0)||0)+1)}

function generateBulkWALinks(){
  const phones=document.getElementById('wa_bulk_phones').value.trim().split('\n').map(p=>p.trim()).filter(p=>p);
  const msg=document.getElementById('wa_bulk_msg').value.trim();
  const role=document.getElementById('wa_bulk_role').value.trim();
  const link=document.getElementById('wa_bulk_link').value.trim();
  if(!phones.length||!msg){toast('âŒ Enter phones and message');return}
  const el=document.getElementById('wa_bulk_results');el.classList.remove('hidden');
  el.innerHTML='<strong style="font-size:0.85rem;color:var(--accent);">WhatsApp Links Generated:</strong><br><br>';
  phones.forEach((phone,i)=>{
    const cleanPhone=phone.replace(/\D/g,'');
    const finalMsg=msg.replace(/\[Role\]/g,role||'Position').replace(/\[LINK\]/g,link||'');
    const waUrl=`https://wa.me/${cleanPhone}?text=${encodeURIComponent(finalMsg)}`;
    el.innerHTML+=`<div style="padding:8px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
      <span style="font-size:0.78rem;color:var(--muted);">${i+1}. ${phone}</span>
      <a href="${waUrl}" target="_blank" class="wa-link-btn" style="margin-top:0;font-size:0.72rem;" onclick="incrementWASent()">ğŸ“² Send</a>
      <button class="copy-btn" style="background:rgba(255,255,255,.08);color:var(--text);" onclick="navigator.clipboard?.writeText('${waUrl}');toast('ğŸ“‹ Copied!')">ğŸ“‹</button>
    </div>`;
  });
  logWACampaign('bulk',phones.length+' contacts',role);
  toast(`ğŸ“¢ ${phones.length} WA links generated!`);
}

function logWACampaign(type,target,role){
  const log=JSON.parse(localStorage.getItem('wa_campaigns')||'[]');
  log.unshift({id:genUUID(),type,target,role,date:new Date().toISOString()});
  localStorage.setItem('wa_campaigns',JSON.stringify(log.slice(0,50)));
  renderWACampaignLog();
}

function renderWACampaignLog(){
  const log=JSON.parse(localStorage.getItem('wa_campaigns')||'[]');
  const el=document.getElementById('wa_campaign_log');
  if(!log.length){el.innerHTML='<p style="color:var(--muted);font-size:0.85rem;text-align:center;">No campaigns yet.</p>';return}
  el.innerHTML=log.slice(0,10).map(c=>`<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:0.8rem;">
    <div><span class="status-pill" style="color:var(--green);">${c.type}</span> ${c.target} â€” ${c.role||'â€”'}</div>
    <span style="color:var(--muted);">${c.date?new Date(c.date).toLocaleDateString():''}</span>
  </div>`).join('');
}

function renderWATemplates(){
  const el=document.getElementById('wa_templates_list');
  el.innerHTML=Object.entries(WA_TEMPLATES).filter(([k])=>k!=='custom').map(([k,t])=>`<div class="wa-template-card">
    <h4>${t.name}</h4>
    <div class="wa-preview">${t.body.slice(0,180)}${t.body.length>180?'...':''}</div>
    <button class="btn btn-wa" style="padding:5px 12px;font-size:0.75rem;margin-top:8px;" onclick="document.getElementById('wa_template').value='${k}';loadWATemplate();toast('âœ… Template loaded!')">Use This Template</button>
  </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‰ ONBOARDING AUTOMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHECKLIST_ITEMS={
  pre:['Send offer letter via email','Share company handbook & policies','Set up work email account','Order laptop / equipment','Assign workspace / desk','Create Slack / Teams account','Send pre-boarding welcome message','Share first day schedule','Background verification','Reference checks'],
  day1:['Welcome meeting with HR','Office / remote tour','IT setup & software installation','Introduction to team','Review job description & KPIs','Sign employment contract','Submit bank details for payroll','ID card / access card issued','Buddy / mentor assigned','Lunch with team'],
  week1:['Complete compliance training','System access & tools walkthrough','Meet key stakeholders','1:1 with direct manager','Review team workflows & processes','Set 30-60-90 day goals','Complete security training','Review benefits & leave policy','Social media & communication guidelines'],
  month1:['30-day performance check-in','Complete all required training','First project assigned','Probation review scheduled','Payroll confirmed & first payslip','Benefits enrollment completed','360 feedback from team','Goal alignment with manager','Culture & values discussion']
};

const REQUIRED_DOCS=['Resume / CV','Aadhar Card','PAN Card','Educational Certificates','Experience Letters','Bank Account Details','Passport Size Photos (4 copies)','Address Proof','COVID Vaccination Certificate','Emergency Contact Details'];

function initOnboardingTab(){renderOnboardingChecklist();renderDocTracker();renderOnboardingProfiles()}

function renderOnboardingChecklist(){
  Object.keys(CHECKLIST_ITEMS).forEach(stage=>{
    const el=document.getElementById('checklist_'+stage);if(!el)return;
    const saved=JSON.parse(localStorage.getItem('ob_checks_'+stage)||'{}');
    el.innerHTML=CHECKLIST_ITEMS[stage].map((item,i)=>`<div class="check-item ${saved[i]?'done':''}" id="ci_${stage}_${i}">
      <input type="checkbox" id="chk_${stage}_${i}" ${saved[i]?'checked':''} onchange="toggleCheck('${stage}',${i})">
      <label for="chk_${stage}_${i}">${item}</label>
    </div>`).join('');
  });
  updateChecklistProgress();
}

function toggleCheck(stage,idx){
  const saved=JSON.parse(localStorage.getItem('ob_checks_'+stage)||'{}');
  const el=document.getElementById('chk_'+stage+'_'+idx);
  saved[idx]=el.checked;
  localStorage.setItem('ob_checks_'+stage,JSON.stringify(saved));
  const row=document.getElementById('ci_'+stage+'_'+idx);
  row?.classList.toggle('done',el.checked);
  updateChecklistProgress();
}

function updateChecklistProgress(){
  let total=0,done=0;
  Object.keys(CHECKLIST_ITEMS).forEach(stage=>{
    const items=CHECKLIST_ITEMS[stage];
    const saved=JSON.parse(localStorage.getItem('ob_checks_'+stage)||'{}');
    total+=items.length;
    done+=Object.values(saved).filter(Boolean).length;
  });
  const pct=total?Math.round(done/total*100):0;
  document.getElementById('ob_progress_bar').style.width=pct+'%';
  document.getElementById('ob_progress_text').textContent=`${done} / ${total} tasks completed (${pct}%)`;
}

function selectAllChecks(){Object.keys(CHECKLIST_ITEMS).forEach(s=>{const all={};CHECKLIST_ITEMS[s].forEach((_,i)=>all[i]=true);localStorage.setItem('ob_checks_'+s,JSON.stringify(all))});renderOnboardingChecklist();toast('âœ… All selected')}
function clearAllChecks(){Object.keys(CHECKLIST_ITEMS).forEach(s=>localStorage.removeItem('ob_checks_'+s));renderOnboardingChecklist();toast('âŒ Cleared')}
function saveChecklistTemplate(){toast('ğŸ’¾ Template auto-saved to localStorage!')}

function renderDocTracker(){
  const el=document.getElementById('doc_tracker_list');
  const saved=JSON.parse(localStorage.getItem('ob_docs')||'{}');
  el.innerHTML=REQUIRED_DOCS.map((doc,i)=>`<div class="check-item ${saved[i]?'done':''}">
    <input type="checkbox" id="doc_${i}" ${saved[i]?'checked':''} onchange="toggleDoc(${i})">
    <label for="doc_${i}">${doc}</label>
    ${saved[i]?'<span class="status-pill" style="background:rgba(16,185,129,.15);color:#10b981;margin-left:auto;">âœ… Received</span>':'<span class="status-pill" style="background:rgba(245,158,11,.15);color:#f59e0b;margin-left:auto;">â³ Pending</span>'}
  </div>`).join('');
}

function toggleDoc(i){
  const saved=JSON.parse(localStorage.getItem('ob_docs')||'{}');
  saved[i]=document.getElementById('doc_'+i).checked;
  localStorage.setItem('ob_docs',JSON.stringify(saved));
  renderDocTracker();
}

function markAllDocs(){
  const all={};REQUIRED_DOCS.forEach((_,i)=>all[i]=true);
  localStorage.setItem('ob_docs',JSON.stringify(all));renderDocTracker();toast('âœ… All docs marked received');
}

function createOnboardingProfile(){
  const name=document.getElementById('ob_name').value.trim();
  const role=document.getElementById('ob_role').value.trim();
  if(!name||!role){toast('âŒ Name and role required');return}
  const profiles=JSON.parse(localStorage.getItem('hr_onboarding')||'[]');
  profiles.unshift({id:genUUID(),name,role,department:document.getElementById('ob_dept').value,startDate:document.getElementById('ob_start').value,manager:document.getElementById('ob_manager').value,email:document.getElementById('ob_email').value,phone:document.getElementById('ob_phone').value,status:'in-progress',createdAt:new Date().toISOString(),progress:0});
  localStorage.setItem('hr_onboarding',JSON.stringify(profiles));
  ['ob_name','ob_role','ob_manager','ob_email','ob_phone'].forEach(k=>document.getElementById(k).value='');
  toast('ğŸ‰ Onboarding profile created for '+name+'!');renderOnboardingProfiles();
}

function renderOnboardingProfiles(){
  const profiles=JSON.parse(localStorage.getItem('hr_onboarding')||'[]');
  const el=document.getElementById('ob_activeProfiles');
  if(!profiles.length){el.innerHTML='';return}
  el.innerHTML='<div class="card"><h3>ğŸ‘¤ Active Onboarding Profiles</h3>'+profiles.filter(p=>p.status!=='completed').slice(0,10).map(p=>`<div class="cand-row">
    <div style="display:flex;align-items:center;gap:8px;flex:1;">
      <div class="cand-avatar">${(p.name||'?')[0].toUpperCase()}</div>
      <div>
        <div style="font-weight:700;">${p.name}</div>
        <div style="font-size:0.72rem;color:var(--muted);">${p.role} â€¢ ${p.department} â€¢ Start: ${p.startDate||'TBD'}</div>
      </div>
    </div>
    <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
      <span class="status-pill" style="background:rgba(6,182,212,.15);color:#06b6d4;">${p.status}</span>
      <button class="btn btn-wa" style="padding:3px 8px;font-size:0.7rem;" onclick="sendWelcomeWA('${p.name}','${p.role}','${p.phone||''}')">ğŸ’¬ WA</button>
      <button class="btn btn-onboard" style="padding:3px 8px;font-size:0.7rem;" onclick="completeOnboarding('${p.id}')">âœ… Done</button>
      <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteOnboarding('${p.id}')">ğŸ—‘ï¸</button>
    </div>
  </div>`).join('')+'</div>';
}

function completeOnboarding(id){
  const profiles=JSON.parse(localStorage.getItem('hr_onboarding')||'[]');
  const p=profiles.find(x=>x.id===id);if(p)p.status='completed';
  localStorage.setItem('hr_onboarding',JSON.stringify(profiles));renderOnboardingProfiles();toast('âœ… Marked complete!');
}

function deleteOnboarding(id){
  const profiles=JSON.parse(localStorage.getItem('hr_onboarding')||'[]').filter(p=>p.id!==id);
  localStorage.setItem('hr_onboarding',JSON.stringify(profiles));renderOnboardingProfiles();toast('ğŸ—‘ï¸ Deleted');
}

function sendWelcomeWA(name,role,phone){
  const msg=`ğŸŠ *Welcome to Simpatico HR, ${name}!*\n\nWe're thrilled to have you joining us as *${role}*.\n\nYour onboarding checklist and first-day guide will be shared soon.\n\nLooking forward to working with you! ğŸ’ª\nâ€” *Simpatico HR Team*`;
  const cleanPhone=phone.replace(/\D/g,'');
  const url=cleanPhone?`https://wa.me/${cleanPhone}?text=${encodeURIComponent(msg)}`:`https://wa.me/?text=${encodeURIComponent(msg)}`;
  window.open(url,'_blank');incrementWASent();
}

async function generateWelcomeEmail(){
  const name=document.getElementById('wel_name').value.trim()||'Team Member';
  const role=document.getElementById('wel_role').value.trim()||'New Role';
  const agenda=document.getElementById('wel_agenda').value.trim();
  const el=document.getElementById('welcome_output');el.classList.remove('hidden');
  el.textContent='â³ Generating welcome email...';
  const prompt=`Write a warm, professional welcome email for a new employee joining a company.

Name: ${name}
Role: ${role}
First Day Agenda: ${agenda||'Standard onboarding'}

Include: Subject line, warm greeting, excitement about them joining, what to expect on day 1, key contact info, and a friendly closing. Keep it concise but personal.`;
  const resp=await aiChat([{role:'user',content:prompt}]);
  el.textContent=resp||'Generation failed. Please try again.';
}

function generateWelcomeWA(){
  const name=document.getElementById('wel_name').value.trim()||'Team Member';
  const role=document.getElementById('wel_role').value.trim()||'New Role';
  const agenda=document.getElementById('wel_agenda').value.trim();
  const msg=`ğŸŠ *Welcome aboard, ${name}!*\n\nWe're so excited to have you join us as *${role}*! ğŸŒŸ\n\nğŸ“… *Your First Day:*\n${agenda||'Details will be shared soon'}\n\nDon't hesitate to reach out if you have any questions. We're here to make your transition smooth! ğŸ’ª\n\nWelcome to the family!\nâ€” *Simpatico HR Team* ğŸ¢`;
  const el=document.getElementById('welcome_output');el.classList.remove('hidden');el.textContent=msg;
  navigator.clipboard?.writeText(msg);toast('ğŸ’¬ Welcome WA message copied!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”„ RECRUITMENT PIPELINE (KANBAN)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPipeline(){
  try{
    const jobFilter=document.getElementById('pipe_jobFilter').value;
    const[apps,jobs]=await Promise.all([db('select','applications',null,null,null,'created_at.desc').catch(()=>[]),db('select','jobs',null,{is_active:true}).catch(()=>[])]);
    const jarr=Array.isArray(jobs)?jobs:[];
    // Populate job filter
    const sel=document.getElementById('pipe_jobFilter');
    const curVal=sel.value;
    sel.innerHTML='<option value="">All Jobs</option>';
    jarr.forEach(j=>sel.innerHTML+=`<option value="${j.id}" ${curVal===j.id?'selected':''}>${j.title}</option>`);
    let arr=Array.isArray(apps)?apps:[];
    if(jobFilter)arr=arr.filter(a=>a.job_id===jobFilter);
    const stages=['applied','shortlisted','interviewed','offered','hired'];
    stages.forEach(stage=>{
      const cards=arr.filter(a=>a.status===stage||(stage==='applied'&&!['shortlisted','interviewed','offered','hired','rejected'].includes(a.status)));
      document.getElementById('kc_'+stage).textContent=cards.length;
      document.getElementById('kcol_'+stage).innerHTML=cards.slice(0,20).map(c=>`<div class="k-card" onclick="viewCandidateDetail('${c.id}')">
        <div class="k-card-name">${c.name||'?'}</div>
        <div class="k-card-role">${c.email||''}</div>
        ${c.ats_score?`<div style="margin-top:5px;"><span class="score-badge" style="background:rgba(99,102,241,.15);color:var(--accent);">ATS ${c.ats_score}</span></div>`:''}
        <div style="display:flex;gap:4px;margin-top:6px;flex-wrap:wrap;">
          ${['applied','shortlisted','interviewed','offered','hired'].filter(s=>s!==stage).slice(0,2).map(s=>`<button class="btn btn-save" style="padding:2px 7px;font-size:0.65rem;" onclick="event.stopPropagation();moveCandidate('${c.id}','${s}')">â†’${s.slice(0,3)}</button>`).join('')}
        </div>
      </div>`).join('')||`<div style="color:var(--muted);font-size:0.75rem;text-align:center;padding:16px;">Empty</div>`;
    });
    // Stats
    document.getElementById('ps_total').textContent=arr.length;
    const hired=arr.filter(a=>a.status==='hired').length;
    document.getElementById('ps_hired').textContent=hired;
    document.getElementById('ps_conversion').textContent=arr.length?Math.round(hired/arr.length*100)+'%':'0%';
    const withScore=arr.filter(a=>a.ats_score);
    document.getElementById('ps_avgScore').textContent=withScore.length?Math.round(withScore.reduce((s,a)=>s+(a.ats_score||0),0)/withScore.length):0;
  }catch(e){console.error(e)}
}

async function moveCandidate(id,newStatus){
  try{await db('update','applications',{status:newStatus},{id});toast(`âœ… Moved to ${newStatus}`);loadPipeline()}catch(e){toast('âŒ '+e.message)}
}

async function viewCandidateDetail(id){
  try{
    const data=await db('select','applications',null,{id});
    const c=Array.isArray(data)?data[0]:data;if(!c)return;
    const msg=`ğŸ‘¤ ${c.name}\nğŸ“§ ${c.email}\nğŸ¯ Status: ${c.status}\nğŸ“Š ATS Score: ${c.ats_score||'N/A'}\nğŸ“… Applied: ${c.created_at?new Date(c.created_at).toLocaleDateString():'?'}`;
    alert(msg);
  }catch(e){}
}

function showAddCandModal(){document.getElementById('addCandModal').classList.remove('hidden')}

async function addToPipeline(){
  const name=document.getElementById('ac_name').value.trim();
  const email=document.getElementById('ac_email').value.trim();
  if(!name||!email){toast('âŒ Name and email required');return}
  try{
    await db('insert','applications',{name,email,phone:document.getElementById('ac_phone').value.trim(),resume_text:document.getElementById('ac_role').value.trim(),ats_score:parseInt(document.getElementById('ac_ats').value)||0,status:document.getElementById('ac_stage').value,notes:document.getElementById('ac_notes').value.trim(),created_at:new Date().toISOString()});
    document.getElementById('addCandModal').classList.add('hidden');
    ['ac_name','ac_email','ac_phone','ac_role','ac_ats','ac_notes'].forEach(k=>document.getElementById(k).value='');
    toast('âœ… Added to pipeline!');loadPipeline();
  }catch(e){toast('âŒ '+e.message)}
}

async function exportPipeline(){
  try{
    const data=await db('select','applications');const arr=Array.isArray(data)?data:[];
    const csv='Name,Email,Status,ATS Score,Applied Date\n'+arr.map(a=>[a.name,a.email,a.status,a.ats_score||0,a.created_at?new Date(a.created_at).toLocaleDateString():''].join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='pipeline-'+Date.now()+'.csv';a.click();
    toast('ğŸ“¥ Exported!');
  }catch(e){toast('âŒ '+e.message)}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SITE EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveSiteConfig(){
  const config={siteTitle:document.getElementById('ed_title').value,siteSubtitle:document.getElementById('ed_subtitle').value,companyName:document.getElementById('ed_company').value,colorPrimary:document.getElementById('ed_primary').value,colorSecondary:document.getElementById('ed_secondary').value,colorSuccess:document.getElementById('ed_success').value,colorBg:document.getElementById('ed_bg').value,font:document.getElementById('ed_font').value,radius:document.getElementById('ed_radius').value,bannerShow:document.getElementById('tog_banner').classList.contains('on'),bannerText:document.getElementById('ed_bannerText').value,bannerColor:document.getElementById('ed_bannerColor').value};
  localStorage.setItem("siteConfig",JSON.stringify(config));toast('ğŸ’¾ Saved!');
}
function resetSiteConfig(){if(!confirm('Reset all?'))return;localStorage.removeItem("siteConfig");toast('ğŸ”„ Reset!');location.reload()}
function loadSiteConfig(){try{const c=JSON.parse(localStorage.getItem("siteConfig")||"{}");if(c.siteTitle)document.getElementById('ed_title').value=c.siteTitle;if(c.siteSubtitle)document.getElementById('ed_subtitle').value=c.siteSubtitle;if(c.companyName)document.getElementById('ed_company').value=c.companyName;if(c.colorPrimary)document.getElementById('ed_primary').value=c.colorPrimary;if(c.colorSecondary)document.getElementById('ed_secondary').value=c.colorSecondary;if(c.colorSuccess)document.getElementById('ed_success').value=c.colorSuccess;if(c.colorBg)document.getElementById('ed_bg').value=c.colorBg;if(c.font)document.getElementById('ed_font').value=c.font;if(c.radius)document.getElementById('ed_radius').value=c.radius;if(c.bannerShow)document.getElementById('tog_banner').classList.add('on');if(c.bannerText)document.getElementById('ed_bannerText').value=c.bannerText;if(c.bannerColor)document.getElementById('ed_bannerColor').value=c.bannerColor}catch(e){}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAYMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPayments(){
  try{const data=await db('select','payments',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  const total=arr.filter(p=>p.status==='completed').reduce((s,p)=>s+(p.amount||0),0);
  document.getElementById('pTotal').textContent=fmtINR(total);document.getElementById('pCount').textContent=arr.length;
  document.getElementById('pPending').textContent=arr.filter(p=>p.status==='pending').length;
  document.getElementById('pActive').textContent=arr.filter(p=>p.status==='completed').length;
  const tbody=document.getElementById('payHistory');
  if(!arr.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--muted);">No payments</td></tr>';return}
  tbody.innerHTML=arr.map(p=>{const sc=p.status==='completed'?'#10b981':'#f59e0b';const sb=p.status==='completed'?'rgba(16,185,129,.15)':'rgba(245,158,11,.15)';
  return`<tr><td>${p.created_at?new Date(p.created_at).toLocaleDateString():'?'}</td><td>${p.email||p.user_email||'?'}</td><td style="font-weight:700;">${fmtINR(p.amount||0)}</td><td>${p.type||'?'}</td><td><span class="status-pill" style="background:${sb};color:${sc};">${p.status||'?'}</span></td><td><button class="btn btn-danger" style="padding:4px 8px;font-size:0.72rem;" onclick="deletePay('${p.id}')">ğŸ—‘ï¸</button></td></tr>`}).join('')}catch(e){console.error(e)}
  document.getElementById('ed_price').value=getConfig('mockPrice',199);
  document.getElementById('ed_days').value=getConfig('accessDays',30);
  if(getConfig('mockPaid',true))document.getElementById('tog_paid').classList.add('on');
  document.getElementById('ed_razorKey').value=getConfig('razorpayKey','');
  document.getElementById('ed_upiId').value=getConfig('upiId','');
}
async function deletePay(id){if(!confirm('Delete?'))return;try{await db('delete','payments',null,{id});toast('ğŸ—‘ï¸');loadPayments()}catch(e){toast('âŒ '+e.message)}}
async function addManualPayment(){
  const email=document.getElementById('mp_email').value.trim();if(!email){toast('âŒ Enter email');return}
  try{await db('insert','payments',{email,user_email:email,amount:parseInt(document.getElementById('mp_amount').value)||199,currency:'INR',currency_symbol:'â‚¹',type:'manual',status:'completed',note:document.getElementById('mp_note').value.trim()||'Manual',days_granted:parseInt(document.getElementById('mp_days').value)||30,created_at:new Date().toISOString()});
  toast('âœ… Added');document.getElementById('mp_email').value='';loadPayments()}catch(e){toast('âŒ '+e.message)}
}
function savePricing(){setConfig('mockPrice',document.getElementById('ed_price').value);setConfig('accessDays',document.getElementById('ed_days').value);setConfig('mockPaid',document.getElementById('tog_paid').classList.contains('on'));toast('ğŸ’¾ Saved!')}
function saveGateway(){setConfig('razorpayKey',document.getElementById('ed_razorKey').value.trim());setConfig('upiId',document.getElementById('ed_upiId').value.trim());toast('ğŸ’¾ Saved!')}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCESS CODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function genCode(){
  const code=document.getElementById('ac_code').value.trim().toUpperCase();if(!code){toast('âŒ Enter code');return}
  try{const exp=document.getElementById('ac_expiry').value;
  await db('insert','access_codes',{code,max_uses:parseInt(document.getElementById('ac_max').value)||50,used:0,days:parseInt(document.getElementById('ac_days').value)||30,is_active:true,expires_at:exp?new Date(exp).toISOString():null,created_at:new Date().toISOString()});
  toast('âœ… '+code);document.getElementById('ac_code').value='';loadCodes()}catch(e){toast('âŒ '+e.message)}
}
function genRandom(){const ch='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';let c='SIM-';for(let i=0;i<8;i++)c+=ch.charAt(Math.floor(Math.random()*ch.length));document.getElementById('ac_code').value=c;toast('ğŸ² '+c)}
async function loadCodes(){
  const el=document.getElementById('codesList');
  try{const data=await db('select','access_codes',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No codes</p>';return}
  el.innerHTML=arr.map(c=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px;"><div><div style="font-weight:700;color:var(--accent);">${c.code}</div><div style="font-size:0.72rem;color:var(--muted);">${c.used||0}/${c.max_uses||'âˆ'} â€¢ ${c.days||30}d â€¢ ${c.is_active?'ğŸŸ¢ Active':'ğŸ”´ Off'}</div></div><div style="display:flex;gap:6px;"><button class="btn btn-accent" style="padding:4px 10px;font-size:0.75rem;" onclick="navigator.clipboard?.writeText('${c.code}');toast('ğŸ“‹')">ğŸ“‹</button><button class="btn btn-danger" style="padding:4px 10px;font-size:0.75rem;" onclick="delCode('${c.id}')">ğŸ—‘ï¸</button></div></div>`).join('')}catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function delCode(id){if(!confirm('Delete?'))return;try{await db('delete','access_codes',null,{id});toast('ğŸ—‘ï¸');loadCodes()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLIENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function addClient(){
  const name=document.getElementById('cl_name').value.trim();const email=document.getElementById('cl_email').value.trim();
  if(!name||!email){toast('âŒ Company & email required');return}
  const days=parseInt(document.getElementById('cl_duration').value)||365;
  const expires=new Date();expires.setDate(expires.getDate()+days);
  const password='HR-'+Math.random().toString(36).substring(2,10).toUpperCase();
  try{
    await db('insert','hr_clients',{company_name:name,email,plan:document.getElementById('cl_plan').value,amount_paid:parseInt(document.getElementById('cl_amount').value)||0,payment_method:document.getElementById('cl_payMethod').value,hr_password:password,status:'active',created_at:new Date().toISOString(),expires_at:expires.toISOString()});
    alert('âœ… Client Created!\n\nCompany: '+name+'\nEmail: '+email+'\nPassword: '+password+'\nExpires: '+expires.toLocaleDateString());
    try{navigator.clipboard?.writeText('Company: '+name+'\nPassword: '+password)}catch(e){}
    document.getElementById('cl_name').value='';document.getElementById('cl_email').value='';
    loadClients();toast('âœ… Added!');
  }catch(e){toast('âŒ '+e.message)}
}
async function loadClients(){
  const el=document.getElementById('clientsList');el.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','hr_clients',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];const now=new Date();
  document.getElementById('clTotal').textContent=arr.length;
  document.getElementById('clActive').textContent=arr.filter(c=>c.status==='active'&&new Date(c.expires_at)>now).length;
  document.getElementById('clExpiring').textContent=arr.filter(c=>{const d=(new Date(c.expires_at)-now)/86400000;return c.status==='active'&&d>0&&d<=7}).length;
  document.getElementById('clExpired').textContent=arr.filter(c=>new Date(c.expires_at)<=now).length;
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No clients</p>';return}
  el.innerHTML=arr.map(c=>{const exp=new Date(c.expires_at);const ie=exp<=now;const sc=ie?'#ef4444':'#10b981';
  return`<div style="padding:12px;border-bottom:1px solid var(--border);"><div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px;">
    <div><strong>${c.company_name}</strong><div style="font-size:0.72rem;color:var(--muted);">${c.email} â€¢ ${c.plan} â€¢ Exp: ${exp.toLocaleDateString()}</div></div>
    <div style="display:flex;gap:6px;align-items:center;">
      <span class="status-pill" style="color:${sc};">${ie?'Expired':'Active'}</span>
      <button class="btn btn-wa" style="padding:3px 8px;font-size:0.7rem;" onclick="window.open('https://wa.me/?text='+encodeURIComponent('Hi! Your Simpatico HR subscription for ${c.company_name} expires on ${exp.toLocaleDateString()}. Please renew to continue.'),'_blank')">ğŸ’¬ WA Remind</button>
    </div>
  </div></div>`}).join('');
  }catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JOBS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminJobs(){
  const el=document.getElementById('adminJobsList');el.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','jobs',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No jobs â€” <button class="btn btn-jd" style="padding:6px 12px;font-size:0.8rem;margin-left:8px;" onclick="showTab(\'jdbuilder\')">âœï¸ Generate JD</button></p>';return}
  el.innerHTML=arr.map(j=>`<div class="job-card"><div style="display:flex;justify-content:space-between;"><h4>${j.title||'?'}</h4><div style="display:flex;gap:6px;flex-wrap:wrap;">
    <span class="status-pill" style="color:${j.is_active?'#10b981':'#ef4444'};">${j.is_active?'Active':'Off'}</span>
    <button class="btn ${j.is_active?'btn-danger':'btn-save'}" style="padding:3px 8px;font-size:0.7rem;" onclick="toggleJob('${j.id}',${!j.is_active})">${j.is_active?'Disable':'Enable'}</button>
    <button class="btn btn-jd" style="padding:3px 8px;font-size:0.7rem;" onclick="cloneJD('${j.id}')">âœï¸ Edit JD</button>
    <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteJob('${j.id}')">ğŸ—‘ï¸</button>
  </div></div><div class="job-meta"><span>ğŸ“Š ${j.level||''}</span><span>ğŸ“ ${j.location||''}</span><span>ğŸ• ${j.employment_type||''}</span></div></div>`).join('')}catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function toggleJob(id,active){try{await db('update','jobs',{is_active:active},{id});toast(active?'âœ… Enabled':'ğŸš« Disabled');loadAdminJobs()}catch(e){toast('âŒ '+e.message)}}
async function deleteJob(id){if(!confirm('Delete?'))return;try{await db('delete','jobs',null,{id});toast('ğŸ—‘ï¸');loadAdminJobs()}catch(e){toast('âŒ '+e.message)}}
async function cloneJD(id){
  try{const data=await db('select','jobs',null,{id});const j=Array.isArray(data)?data[0]:data;if(!j)return;
  document.getElementById('jd_title').value=j.title||'';document.getElementById('jd_location').value=j.location||'';document.getElementById('jd_level').value=j.level||'Mid Level (3â€“5 yrs)';
  if(j.description){_currentJD=j.description;document.getElementById('jd_output').textContent=j.description;document.getElementById('jd_resultCard').classList.remove('hidden')}
  showTab('jdbuilder');toast('ğŸ“„ Job loaded into JD Builder')}catch(e){toast('âŒ '+e.message)}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANDIDATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminCandidates(){
  const el=document.getElementById('adminCandList');el.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','applications',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No applications</p>';return}
  el.innerHTML=arr.map(c=>{const sc=c.ats_score||0;const col=sc>=70?'#10b981':sc>=50?'#f59e0b':'#ef4444';const bg=sc>=70?'rgba(16,185,129,.15)':sc>=50?'rgba(245,158,11,.15)':'rgba(239,68,68,.15)';const stc={applied:'#f59e0b',shortlisted:'#10b981',interviewed:'#3b82f6',rejected:'#ef4444',hired:'#8b5cf6',offered:'#06b6d4'}[c.status]||'#94a3b8';
  return`<div class="cand-row"><div style="display:flex;align-items:center;gap:8px;flex:1;"><div class="cand-avatar">${(c.name||'?')[0].toUpperCase()}</div><div><div style="font-weight:700;font-size:0.88rem;">${c.name||'?'}</div><div style="font-size:0.72rem;color:var(--muted);">${c.email||''}</div></div></div>
  <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
    <span class="score-badge" style="background:${bg};color:${col};">ATS:${sc}</span>
    <span class="status-pill" style="color:${stc};">${c.status||'?'}</span>
    <button class="btn btn-wa" style="padding:3px 8px;font-size:0.7rem;" onclick="window.open('https://wa.me/?text='+encodeURIComponent('Hi! Regarding your application at Simpatico HR.'),'_blank')">ğŸ’¬</button>
    <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteApp('${c.id}')">ğŸ—‘ï¸</button>
  </div></div>`}).join('')}catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}

  const el2=document.getElementById('adminIntList');el2.innerHTML='<span class="loading"></span>';
  try{const data=await db('select','interviews',null,null,null,'created_at.desc');const arr=Array.isArray(data)?data:[];
  if(!arr.length){el2.innerHTML='<p style="color:var(--muted);text-align:center;">No interviews</p>';return}
  el2.innerHTML=arr.slice(0,30).map(i=>{const sc=i.overall_score||0;const col=sc>=70?'#10b981':sc>=50?'#f59e0b':'#ef4444';const stc={pending:'#f59e0b',in_progress:'#3b82f6',completed:'#10b981'}[i.status]||'#94a3b8';
  return`<div class="cand-row"><div style="flex:1;"><div style="font-weight:700;">${i.interview_role||'?'} â€” ${i.interview_level||''}</div><div style="font-size:0.72rem;color:var(--muted);">${i.status} â€¢ ${i.created_at?new Date(i.created_at).toLocaleDateString():''}</div></div>
  <div style="display:flex;gap:6px;">${sc?`<span class="score-badge" style="background:rgba(16,185,129,.15);color:${col};">${sc}/100</span>`:''}<span class="status-pill" style="color:${stc};">${i.status}</span></div></div>`}).join('')}catch(e){el2.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}
async function deleteApp(id){if(!confirm('Delete?'))return;try{await db('delete','applications',null,{id});toast('ğŸ—‘ï¸');loadAdminCandidates()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USAGE ANALYTICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadUsageAnalytics(){
  try{
    const ints=await db('select','interviews').catch(()=>[]);const arr=Array.isArray(ints)?ints:[];
    const now=new Date();const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
    document.getElementById('uTotal').textContent=arr.length;
    document.getElementById('uToday').textContent=arr.filter(i=>new Date(i.created_at)>=today).length;
    document.getElementById('uWeek').textContent=arr.filter(i=>new Date(i.created_at)>=new Date(today.getTime()-7*86400000)).length;
    document.getElementById('uMonth').textContent=arr.filter(i=>new Date(i.created_at)>=new Date(today.getTime()-30*86400000)).length;
    const completed=arr.filter(i=>i.status==='completed');const avgScore=completed.length?Math.round(completed.reduce((s,i)=>s+(i.overall_score||0),0)/completed.length):0;
    const roles={};arr.forEach(i=>{const r=i.interview_role||'Unknown';roles[r]=(roles[r]||0)+1});
    const topRoles=Object.entries(roles).sort((a,b)=>b[1]-a[1]).slice(0,8);
    document.getElementById('usageBreakdown').innerHTML=`
      <div class="row2" style="margin-bottom:12px;">
        <div style="text-align:center;padding:12px;background:rgba(16,185,129,.05);border-radius:10px;"><div style="font-size:1.4rem;font-weight:800;color:#10b981;">${completed.length}</div><div style="font-size:0.72rem;color:var(--muted);">Completed</div></div>
        <div style="text-align:center;padding:12px;background:rgba(245,158,11,.05);border-radius:10px;"><div style="font-size:1.4rem;font-weight:800;color:#f59e0b;">${arr.filter(i=>i.status==='pending').length}</div><div style="font-size:0.72rem;color:var(--muted);">Pending</div></div>
      </div>
      <div class="edit-row"><span class="edit-label">Avg Score</span><span class="score-badge" style="background:rgba(16,185,129,.15);color:${avgScore>=70?'#10b981':avgScore>=50?'#f59e0b':'#ef4444'};">${avgScore}/100</span></div>
      <div class="edit-row"><span class="edit-label">Completion Rate</span><span class="edit-preview">${arr.length?Math.round(completed.length/arr.length*100):0}%</span></div>
      <div style="margin-top:12px;"><strong style="font-size:0.85rem;">Top Roles:</strong></div>
      ${topRoles.map(([r,c])=>`<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);font-size:0.82rem;"><span>${r}</span><span style="color:var(--accent);font-weight:700;">${c}</span></div>`).join('')}`;
    document.getElementById('apiGroq').textContent=`~${getConfig('jdCount',0)} JDs + interviews (Groq LLaMA 70B)`;
    document.getElementById('apiCF').textContent='Backup worker active';
    document.getElementById('apiWA').textContent=getConfig('waSentCount',0)+' messages sent';
    const topEl=document.getElementById('topCandidates');
    const top=completed.filter(i=>i.overall_score).sort((a,b)=>(b.overall_score||0)-(a.overall_score||0)).slice(0,10);
    topEl.innerHTML=top.length?top.map(i=>`<div class="cand-row"><div><strong>${i.interview_role||'?'}</strong><div style="font-size:0.72rem;color:var(--muted);">${i.interview_level||''} â€¢ ${i.completed_at?new Date(i.completed_at).toLocaleDateString():''}</div></div><span class="score-badge" style="background:rgba(16,185,129,.15);color:${(i.overall_score||0)>=70?'#10b981':'#f59e0b'};">${i.overall_score}/100 ${i.grade||''}</span></div>`).join(''):'<p style="color:var(--muted);text-align:center;">No completed interviews</p>';
  }catch(e){console.error(e)}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§© FEATURE TOGGLE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// All toggleable tabs (dashboard & settings are always on)
const FEATURE_TABS = ['tokens','jdbuilder','payroll','whatsapp','onboarding','pipeline','editor','payments','access','clients','jobs','candidates','usage'];

// Tab index map â†’ matches ALL_TABS order for the tab buttons
const TAB_BTN_MAP = {
  tokens:1, jdbuilder:2, payroll:3, whatsapp:4, onboarding:5,
  pipeline:6, editor:7, payments:8, access:9, clients:10,
  jobs:11, candidates:12, usage:13
};

function getFeatureState(key){ return getConfig('feat_'+key, true) }
function setFeatureState(key, val){ setConfig('feat_'+key, val) }

function toggleFeature(key, el){
  const isOn = el.classList.toggle('on');
  setFeatureState(key, isOn);

  // Update badge text
  const badge = document.getElementById('ft_badge_'+key);
  if(badge){
    badge.textContent = isOn ? 'Enabled' : 'Disabled';
    badge.className = isOn ? 'ft-badge-on' : 'ft-badge-off';
  }

  applyFeatureVisibility();
  toast(isOn ? 'âœ… '+key+' enabled' : 'ğŸš« '+key+' disabled');
}

function applyFeatureVisibility(){
  const tabBtns = document.querySelectorAll('.admin-tab');
  FEATURE_TABS.forEach(key => {
    const enabled = getFeatureState(key);
    const btnIdx = TAB_BTN_MAP[key];
    const btn = tabBtns[btnIdx];
    const tabEl = document.getElementById('tab-'+key);

    if(btn){
      btn.style.display = enabled ? '' : 'none';
      btn.style.opacity = enabled ? '' : '0';
      btn.style.pointerEvents = enabled ? '' : 'none';
      btn.style.maxWidth = enabled ? '' : '0';
      btn.style.padding = enabled ? '' : '0';
      btn.style.minWidth = enabled ? '' : '0';
      btn.style.overflow = 'hidden';
    }

    // If tab is currently visible but gets disabled â†’ go to dashboard
    if(!enabled && tabEl && !tabEl.classList.contains('hidden')){
      showTab('dashboard');
    }
  });
}

function syncFeatureToggles(){
  FEATURE_TABS.forEach(key => {
    const el = document.getElementById('ft_'+key);
    const badge = document.getElementById('ft_badge_'+key);
    const enabled = getFeatureState(key);
    if(el){ el.classList.toggle('on', enabled) }
    if(badge){
      badge.textContent = enabled ? 'Enabled' : 'Disabled';
      badge.className = enabled ? 'ft-badge-on' : 'ft-badge-off';
    }
  });
  applyFeatureVisibility();
}

function enableAllFeatures(){
  FEATURE_TABS.forEach(key => setFeatureState(key, true));
  syncFeatureToggles();
  toast('âœ… All features enabled');
}

function disableAllFeatures(){
  if(!confirm('Disable all modules? Dashboard & Settings will remain.')) return;
  FEATURE_TABS.forEach(key => setFeatureState(key, false));
  syncFeatureToggles();
  showTab('dashboard');
  toast('ğŸš« All modules disabled');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadSettings(){
  document.getElementById('set_worker').value=getConfig('workerUrl',W_DEFAULT);
  document.getElementById('set_violations').value=getConfig('maxViolations',3);
  if(getConfig('maintenance',false))document.getElementById('tog_maint').classList.add('on');
  syncFeatureToggles();
}
function changeAdminPass(){const p=document.getElementById('set_adminPass').value.trim();if(!p||p.length<6){toast('âŒ Min 6 chars');return}setConfig('adminPassword',p);toast('âœ… Changed!');document.getElementById('set_adminPass').value=''}
function changeHRPass(){const p=document.getElementById('set_hrPass').value.trim();if(!p||p.length<4){toast('âŒ Min 4 chars');return}setConfig('hrPassword',p);toast('âœ… Changed!');document.getElementById('set_hrPass').value=''}
function savePlatformSettings(){setConfig('workerUrl',document.getElementById('set_worker').value);setConfig('maxViolations',document.getElementById('set_violations').value);setConfig('maintenance',document.getElementById('tog_maint').classList.contains('on'));toast('ğŸ’¾ Saved!')}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT / IMPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function exportAllData(){
  toast('ğŸ“¥ Exporting...');
  try{
    const[jobs,apps,ints,pay,codes,clients]=await Promise.all([db('select','jobs').catch(()=>[]),db('select','applications').catch(()=>[]),db('select','interviews').catch(()=>[]),db('select','payments').catch(()=>[]),db('select','access_codes').catch(()=>[]),db('select','hr_clients').catch(()=>[])]);
    const data={exported:new Date().toISOString(),adminConfig:JSON.parse(localStorage.getItem("adminConfig")||"{}"),siteConfig:JSON.parse(localStorage.getItem("siteConfig")||"{}"),employees:JSON.parse(localStorage.getItem("hr_employees")||"[]"),onboarding:JSON.parse(localStorage.getItem("hr_onboarding")||"[]"),jd_library:JSON.parse(localStorage.getItem("jd_library")||"[]"),payroll_history:JSON.parse(localStorage.getItem("payroll_history")||"[]"),jobs,applications:apps,interviews:ints,payments:pay,access_codes:codes,hr_clients:clients};
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='simpatico-full-export-'+Date.now()+'.json';a.click();URL.revokeObjectURL(url);toast('âœ… Exported!')
  }catch(e){toast('âŒ '+e.message)}
}
function importData(){
  const input=document.createElement('input');input.type='file';input.accept='.json';input.onchange=async e=>{
    const file=e.target.files[0];if(!file)return;
    try{const data=JSON.parse(await file.text());
    if(data.adminConfig)localStorage.setItem("adminConfig",JSON.stringify(data.adminConfig));
    if(data.siteConfig)localStorage.setItem("siteConfig",JSON.stringify(data.siteConfig));
    if(data.employees)localStorage.setItem("hr_employees",JSON.stringify(data.employees));
    if(data.onboarding)localStorage.setItem("hr_onboarding",JSON.stringify(data.onboarding));
    if(data.jd_library)localStorage.setItem("jd_library",JSON.stringify(data.jd_library));
    toast('âœ… Imported successfully!')}catch(err){toast('âŒ Invalid file')}
  };input.click();
}
function dangerReset(){if(!confirm('âš ï¸ This will DELETE ALL local data!'))return;if(prompt('Type DELETE ALL to confirm:')!=='DELETE ALL')return;localStorage.clear();toast('ğŸ—‘ï¸ All cleared!');setTimeout(()=>location.reload(),1000)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded',()=>{
  loadSiteConfig();
  document.getElementById('loginPass')?.focus();
});
</script>

<!-- Print style for payslips -->
<style>
@media print{
  body>*:not(.payslip-modal){display:none!important}
  .payslip-modal{position:static!important;background:none!important;backdrop-filter:none!important}
  .payslip-box{box-shadow:none!important;max-height:none!important}
  button{display:none!important}
}
</style>
</body>
</html>
