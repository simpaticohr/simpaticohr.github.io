<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin | Simpatico HR</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#020617;--card:rgba(15,23,42,.65);--border:rgba(255,255,255,.08);--accent:#6366f1;--accent2:#8b5cf6;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--blue:#3b82f6;--text:#f8fafc;--muted:#94a3b8;--glow:rgba(99,102,241,.15)}
    body{font-family:'Plus Jakarta Sans',system-ui,sans-serif;background:radial-gradient(circle at 10% 20%,rgba(99,102,241,.15),transparent 40%),radial-gradient(circle at 90% 80%,rgba(79,70,229,.1),transparent 40%),var(--bg);color:var(--text);min-height:100vh;line-height:1.5}

    /* Nav */
    .top-nav{backdrop-filter:blur(16px);background:rgba(2,6,23,.85);padding:1rem 6%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
    .top-logo{font-weight:800;font-size:1.1rem;color:#fff;text-decoration:none}.top-logo span{color:var(--accent)}
    .top-links{display:flex;gap:12px;align-items:center}
    .top-link{color:var(--muted);text-decoration:none;font-size:12px;font-weight:600;padding:6px 12px;border-radius:8px;transition:all 0.2s}
    .top-link:hover{color:#fff;background:rgba(255,255,255,.05)}

    /* Container */
    .container{max-width:900px;margin:0 auto;padding:20px}

    /* Login */
    .login-card{max-width:400px;margin:80px auto;background:var(--card);border:1px solid var(--border);border-radius:24px;padding:40px;text-align:center;backdrop-filter:blur(22px)}
    .login-card h1{font-size:1.5rem;margin-bottom:8px;background:linear-gradient(135deg,#f59e0b,#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .login-card p{color:var(--muted);font-size:0.88rem;margin-bottom:24px}
    .login-input{width:100%;padding:14px 16px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:1rem;outline:none;font-family:inherit;margin-bottom:16px;text-align:center;letter-spacing:2px}
    .login-input:focus{border-color:rgba(245,158,11,.4);box-shadow:0 0 0 3px rgba(245,158,11,.1)}
    .login-btn{width:100%;padding:14px;background:linear-gradient(135deg,#f59e0b,#ef4444);border:none;border-radius:14px;color:#fff;font-size:1rem;font-weight:800;cursor:pointer;font-family:inherit;transition:all 0.2s}
    .login-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,158,11,.3)}
    .login-error{color:var(--red);font-size:0.85rem;margin-top:12px;display:none}

    /* Admin Layout */
    .admin-wrap{display:none}
    .admin-header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid var(--border);margin-bottom:20px}
    .admin-header h1{font-size:1.4rem;background:linear-gradient(135deg,#f59e0b,#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

    /* Tabs */
    .admin-tabs{display:flex;gap:0;background:rgba(255,255,255,.03);border-radius:14px;padding:4px;border:1px solid var(--border);margin-bottom:20px;flex-wrap:wrap}
    .admin-tab{flex:1;padding:10px 8px;text-align:center;border:none;background:transparent;color:var(--muted);font-size:0.78rem;font-weight:700;cursor:pointer;border-radius:10px;transition:all 0.2s;font-family:inherit;min-width:80px}
    .admin-tab.active{background:linear-gradient(135deg,#f59e0b,#ef4444);color:#fff}
    .admin-tab:hover:not(.active){background:rgba(245,158,11,.1)}

    /* Cards */
    .card{background:var(--card);backdrop-filter:blur(22px);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px}
    .card h3{font-size:0.95rem;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:#f59e0b}
    label{display:block;font-size:0.78rem;color:var(--muted);margin:12px 0 4px;font-weight:600}
    select,input[type="text"],input[type="email"],input[type="number"],input[type="password"],input[type="date"],textarea{width:100%;padding:10px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;outline:none;transition:border-color 0.2s;font-family:inherit}
    select:focus,input:focus,textarea:focus{border-color:rgba(245,158,11,.4);box-shadow:0 0 0 3px rgba(245,158,11,.1)}
    select option{background:#1e293b}
    textarea{resize:vertical;min-height:80px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}

    /* Stats */
    .stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
    .stat-card{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
    .stat-num{font-size:1.6rem;font-weight:800}
    .stat-lbl{font-size:0.7rem;color:var(--muted)}

    /* Edit rows */
    .edit-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);flex-wrap:wrap}
    .edit-row:last-child{border-bottom:none}
    .edit-label{font-size:0.8rem;color:var(--muted);min-width:140px;font-weight:600}
    .edit-input{flex:1;padding:8px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;font-family:inherit;outline:none;min-width:200px}
    .edit-input:focus{border-color:rgba(245,158,11,.4)}
    .edit-color{width:40px;height:32px;border:none;border-radius:6px;cursor:pointer;background:transparent}
    .edit-preview{font-size:0.75rem;color:var(--muted);padding:2px 8px;background:rgba(255,255,255,.03);border-radius:6px}
    .edit-textarea{width:100%;min-height:100px;padding:10px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.85rem;font-family:inherit;outline:none;resize:vertical;margin-top:6px}

    /* Table */
    .pay-table{width:100%;border-collapse:collapse;font-size:0.82rem}
    .pay-table th{text-align:left;padding:8px;color:var(--muted);font-weight:700;border-bottom:1px solid var(--border);font-size:0.75rem}
    .pay-table td{padding:8px;border-bottom:1px solid var(--border)}

    /* Toggle */
    .toggle-switch{position:relative;width:44px;height:24px;background:rgba(255,255,255,.1);border-radius:12px;cursor:pointer;transition:all 0.3s;flex-shrink:0}
    .toggle-switch.on{background:var(--green)}
    .toggle-switch::after{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:all 0.3s}
    .toggle-switch.on::after{left:23px}

    /* Buttons */
    .btn{padding:8px 16px;border:none;border-radius:8px;font-size:0.82rem;font-weight:700;cursor:pointer;font-family:inherit;transition:all 0.2s;color:#fff}
    .btn-save{background:linear-gradient(135deg,#10b981,#059669)}
    .btn-danger{background:rgba(239,68,68,.15);color:var(--red)}
    .btn-primary{background:linear-gradient(135deg,#f59e0b,#ef4444)}
    .btn-accent{background:var(--accent)}
    .btn-full{width:100%;padding:14px;font-size:1rem;border-radius:14px}
    .btn:hover{transform:translateY(-1px)}

    /* Status */
    .status-pill{padding:2px 8px;border-radius:10px;font-size:0.72rem;font-weight:700;display:inline-block}
    .score-badge{padding:2px 8px;border-radius:8px;font-size:0.75rem;font-weight:700;display:inline-block}

    /* Log */
    .activity-log{max-height:250px;overflow-y:auto;font-size:0.78rem;color:var(--muted);background:rgba(0,0,0,.3);border-radius:10px;padding:10px}
    .activity-log div{padding:4px 0;border-bottom:1px solid rgba(255,255,255,.03)}

    /* Candidate */
    .cand-row{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border);gap:8px;flex-wrap:wrap}
    .cand-row:last-child{border-bottom:none}
    .cand-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.8rem;flex-shrink:0}

    /* Toast */
    .toast-box{position:fixed;top:16px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px}
    .toast{background:rgba(15,23,42,.9);backdrop-filter:blur(12px);border:1px solid var(--border);color:var(--text);padding:10px 18px;border-radius:12px;font-size:0.85rem;box-shadow:0 8px 24px rgba(0,0,0,.4);animation:tIn .3s ease,tOut .3s ease 2.7s forwards}
    @keyframes tIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes tOut{to{transform:translateX(120%);opacity:0}}

    .hidden{display:none!important}
    .loading{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .job-card{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;transition:all 0.2s;cursor:pointer}
    .job-card:hover{border-color:rgba(99,102,241,.3)}
    .job-card h4{font-size:0.95rem;margin-bottom:4px;color:var(--accent)}
    .job-meta{font-size:0.78rem;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}

    @media(max-width:600px){
      .stat-grid{grid-template-columns:1fr 1fr}
      .row2,.row3{grid-template-columns:1fr}
      .edit-row{flex-direction:column;align-items:flex-start}
      .edit-input{width:100%}
      .admin-tab{font-size:0.7rem;min-width:60px;padding:8px 4px}
      .cand-row{flex-direction:column;align-items:flex-start}
      .top-nav{padding:1rem 4%}
    }
  </style>
</head>
<body>
  <div class="toast-box" id="toasts"></div>

  <!-- Nav -->
  <nav class="top-nav">
    <a class="top-logo" href="evalis-platform.html">SIMPATICO <span>HR</span></a>
    <div class="top-links">
      <a class="top-link" href="evalis-platform.html">ğŸ  Platform</a>
      <a class="top-link" href="career-lab.html">ğŸ§  Career Lab</a>
      <span class="top-link" style="color:var(--yellow);">ğŸ” Admin</span>
    </div>
  </nav>

  <!-- LOGIN SCREEN -->
  <div id="loginScreen">
    <div class="login-card">
      <div style="font-size:3rem;margin-bottom:12px;">ğŸ”</div>
      <h1>Super Admin</h1>
      <p>Enter password to access admin panel</p>
      <input type="password" class="login-input" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()">
      <button class="login-btn" onclick="doLogin()">ğŸ”“ Login</button>
      <div class="login-error" id="loginError">âŒ Wrong password</div>
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-wrap" id="adminWrap">
    <div class="container">

      <div class="admin-header">
        <h1>ğŸ” Super Admin Panel</h1>
        <button class="btn btn-danger" onclick="doLogout()">ğŸšª Logout</button>
      </div>

      <!-- Tabs -->
      <div class="admin-tabs" id="adminTabs">
        <button class="admin-tab active" onclick="showTab('dashboard')">ğŸ“Š Dashboard</button>
        <button class="admin-tab" onclick="showTab('editor')">ğŸ¨ Website</button>
        <button class="admin-tab" onclick="showTab('payments')">ğŸ’³ Payments</button>
        <button class="admin-tab" onclick="showTab('access')">ğŸ”‘ Codes</button>
        <button class="admin-tab" onclick="showTab('jobs')">ğŸ’¼ Jobs</button>
        <button class="admin-tab" onclick="showTab('candidates')">ğŸ‘¥ People</button>
        <button class="admin-tab" onclick="showTab('settings')">âš™ï¸ Settings</button>
      </div>

      <!-- â•â•â• DASHBOARD â•â•â• -->
      <div id="tab-dashboard">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="sRevenue">â‚¹0</div><div class="stat-lbl">Revenue</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="sUsers">0</div><div class="stat-lbl">Applications</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="sInterviews">0</div><div class="stat-lbl">Interviews</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="sJobs">0</div><div class="stat-lbl">Jobs</div></div>
        </div>
        <div class="card">
          <h3>ğŸ“ˆ Recent Activity</h3>
          <div class="activity-log" id="activityLog">Loading...</div>
        </div>
        <div class="card">
          <h3>âš¡ Quick Actions</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="showTab('editor')">ğŸ¨ Edit Website</button>
            <button class="btn btn-save" onclick="showTab('payments')">ğŸ’³ Payments</button>
            <button class="btn btn-accent" onclick="exportAllData()">ğŸ“¥ Export Data</button>
            <button class="btn btn-danger" onclick="clearCache()">ğŸ—‘ï¸ Clear Cache</button>
          </div>
        </div>
      </div>

      <!-- â•â•â• WEBSITE EDITOR â•â•â• -->
      <div id="tab-editor" class="hidden">
        <div class="card">
          <h3>ğŸ·ï¸ Branding</h3>
          <div class="edit-row"><span class="edit-label">Site Title</span><input class="edit-input" id="ed_title" value="AI Interview Platform" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Subtitle</span><input class="edit-input" id="ed_subtitle" value="Intelligent â€¢ Adaptive â€¢ Proctored" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Company Name</span><input class="edit-input" id="ed_company" value="SIMPATICO HR" onchange="saveSiteConfig()"></div>
        </div>

        <div class="card">
          <h3>ğŸ¨ Colors</h3>
          <div class="edit-row"><span class="edit-label">Primary</span><input type="color" class="edit-color" id="ed_primary" value="#6366f1" onchange="saveSiteConfig()"><span class="edit-preview">#6366f1</span></div>
          <div class="edit-row"><span class="edit-label">Secondary</span><input type="color" class="edit-color" id="ed_secondary" value="#8b5cf6" onchange="saveSiteConfig()"><span class="edit-preview">#8b5cf6</span></div>
          <div class="edit-row"><span class="edit-label">Success</span><input type="color" class="edit-color" id="ed_success" value="#10b981" onchange="saveSiteConfig()"><span class="edit-preview">#10b981</span></div>
          <div class="edit-row"><span class="edit-label">Danger</span><input type="color" class="edit-color" id="ed_danger" value="#ef4444" onchange="saveSiteConfig()"><span class="edit-preview">#ef4444</span></div>
          <div class="edit-row"><span class="edit-label">Background</span><input type="color" class="edit-color" id="ed_bg" value="#020617" onchange="saveSiteConfig()"><span class="edit-preview">#020617</span></div>
        </div>

        <div class="card">
          <h3>ğŸ”¤ Typography</h3>
          <div class="edit-row"><span class="edit-label">Font</span>
            <select class="edit-input" id="ed_font" onchange="saveSiteConfig()">
              <option value="'Plus Jakarta Sans',system-ui,sans-serif">Plus Jakarta Sans</option>
              <option value="'Inter',system-ui,sans-serif">Inter</option>
              <option value="'Poppins',system-ui,sans-serif">Poppins</option>
              <option value="'Roboto',system-ui,sans-serif">Roboto</option>
              <option value="system-ui,sans-serif">System Default</option>
            </select>
          </div>
          <div class="edit-row"><span class="edit-label">Border Radius</span><input type="range" class="edit-input" id="ed_radius" min="0" max="30" step="2" value="20" style="max-width:200px;" oninput="document.getElementById('rv').textContent=this.value+'px'" onchange="saveSiteConfig()"><span class="edit-preview" id="rv">20px</span></div>
        </div>

        <div class="card">
          <h3>ğŸ  Home Page Cards</h3>
          <div class="edit-row"><span class="edit-label">Card 1 Title</span><input class="edit-input" id="ed_c1" value="Browse Jobs" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Card 2 Title</span><input class="edit-input" id="ed_c2" value="Mock Interview" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Card 3 Title</span><input class="edit-input" id="ed_c3" value="Real Interview" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Card 4 Title</span><input class="edit-input" id="ed_c4" value="HR Dashboard" onchange="saveSiteConfig()"></div>
        </div>

        <div class="card">
          <h3>ğŸ”— Navigation Links</h3>
          <div class="edit-row"><span class="edit-label">Link 1</span><input class="edit-input" id="ed_nav1" value="ğŸ§  Career Lab" onchange="saveSiteConfig()" style="max-width:200px;"><input class="edit-input" id="ed_nav1url" value="career-lab.html" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Link 2</span><input class="edit-input" id="ed_nav2" value="ğŸ’¼ Jobs" onchange="saveSiteConfig()" style="max-width:200px;"><input class="edit-input" id="ed_nav2url" value="jobs.html" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Link 3</span><input class="edit-input" id="ed_nav3" value="Home" onchange="saveSiteConfig()" style="max-width:200px;"><input class="edit-input" id="ed_nav3url" value="index.html" onchange="saveSiteConfig()"></div>
        </div>

        <div class="card">
          <h3>ğŸ“¢ Announcement Banner</h3>
          <div class="edit-row"><span class="edit-label">Show Banner</span><div class="toggle-switch" id="tog_banner" onclick="toggleSwitch(this);saveSiteConfig()"></div><span class="edit-preview">Off</span></div>
          <div class="edit-row"><span class="edit-label">Banner Text</span><input class="edit-input" id="ed_bannerText" value="ğŸ‰ AI Mock Interviews now available!" onchange="saveSiteConfig()"></div>
          <div class="edit-row"><span class="edit-label">Banner Color</span><input type="color" class="edit-color" id="ed_bannerColor" value="#6366f1" onchange="saveSiteConfig()"></div>
        </div>

        <div style="display:flex;gap:10px;margin-top:16px;">
          <button class="btn btn-save btn-full" onclick="saveSiteConfig();toast('ğŸ’¾ Saved & published!')">ğŸ’¾ Save & Publish</button>
          <button class="btn btn-danger" style="padding:14px;" onclick="resetSiteConfig()">ğŸ”„ Reset</button>
        </div>
      </div>

      <!-- â•â•â• PAYMENTS â•â•â• -->
      <div id="tab-payments" class="hidden">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-num" style="color:#10b981;" id="pTotal">â‚¹0</div><div class="stat-lbl">Total Revenue</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#6366f1;" id="pCount">0</div><div class="stat-lbl">Transactions</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#f59e0b;" id="pPending">0</div><div class="stat-lbl">Pending</div></div>
          <div class="stat-card"><div class="stat-num" style="color:#3b82f6;" id="pActive">0</div><div class="stat-lbl">Active</div></div>
        </div>

        <div class="card">
          <h3>ğŸ’° Pricing Settings</h3>
          <div class="edit-row"><span class="edit-label">Mock Price (â‚¹)</span><input class="edit-input" type="number" id="ed_price" value="199" style="max-width:120px;"></div>
          <div class="edit-row"><span class="edit-label">Access Duration</span>
            <select class="edit-input" id="ed_days" style="max-width:160px;">
              <option value="7">7 days</option><option value="30" selected>30 days</option><option value="90">90 days</option><option value="365">1 year</option><option value="9999">Lifetime</option>
            </select>
          </div>
          <div class="edit-row"><span class="edit-label">Mock is Paid</span><div class="toggle-switch on" id="tog_paid" onclick="toggleSwitch(this)"></div><span class="edit-preview">On</span></div>
          <div class="edit-row"><span class="edit-label">Free Trial</span><div class="toggle-switch" id="tog_trial" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
          <div class="edit-row"><span class="edit-label">Trial Count</span><input class="edit-input" type="number" id="ed_trialCount" value="1" style="max-width:100px;"></div>
          <button class="btn btn-save" onclick="savePricing()" style="margin-top:10px;">ğŸ’¾ Save Pricing</button>
        </div>

        <div class="card">
          <h3>ğŸ¦ Payment Gateway</h3>
          <div class="edit-row"><span class="edit-label">Razorpay Key</span><input class="edit-input" type="password" id="ed_razorKey" placeholder="rzp_live_xxxx"></div>
          <div class="edit-row"><span class="edit-label">UPI ID</span><input class="edit-input" id="ed_upiId" placeholder="your@upi"></div>
          <button class="btn btn-save" onclick="saveGateway()" style="margin-top:10px;">ğŸ’¾ Save Gateway</button>
        </div>

        <div class="card">
          <h3>ğŸ“œ Payment History</h3>
          <div style="overflow-x:auto;">
            <table class="pay-table">
              <thead><tr><th>Date</th><th>User</th><th>Amount</th><th>Type</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="payHistory"><tr><td colspan="6" style="text-align:center;color:var(--muted);">Loading...</td></tr></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h3>âœ‹ Add Manual Payment</h3>
          <div class="row2">
            <div><label>User Email *</label><input type="email" id="mp_email" placeholder="user@email.com"></div>
            <div><label>Amount (â‚¹)</label><input type="number" id="mp_amount" value="199"></div>
          </div>
          <div class="row2" style="margin-top:4px;">
            <div><label>Days Access</label><input type="number" id="mp_days" value="30"></div>
            <div><label>Note</label><input type="text" id="mp_note" placeholder="UPI / Cash / Free"></div>
          </div>
          <button class="btn btn-save btn-full" onclick="addManualPayment()" style="margin-top:12px;">âœ… Add Payment & Grant Access</button>
        </div>
      </div>

      <!-- â•â•â• ACCESS CODES â•â•â• -->
      <div id="tab-access" class="hidden">
        <div class="card">
          <h3>ğŸ”‘ Generate Access Code</h3>
          <div class="row2">
            <div><label>Code *</label><input type="text" id="ac_code" placeholder="e.g. CAMPUS2025"></div>
            <div><label>Max Uses</label><input type="number" id="ac_max" value="50"></div>
          </div>
          <div class="row2" style="margin-top:4px;">
            <div><label>Days Access</label><input type="number" id="ac_days" value="30"></div>
            <div><label>Expires Date</label><input type="date" id="ac_expiry"></div>
          </div>
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button class="btn btn-save" style="flex:1;padding:12px;" onclick="genCode()">ğŸ”‘ Generate</button>
            <button class="btn btn-primary" style="padding:12px;" onclick="genRandom()">ğŸ² Random</button>
          </div>
        </div>
        <div class="card">
          <h3>ğŸ“‹ All Codes</h3>
          <div id="codesList">Loading...</div>
        </div>
      </div>

      <!-- â•â•â• JOBS â•â•â• -->
      <div id="tab-jobs" class="hidden">
        <div class="card">
          <h3>ğŸ’¼ All Jobs</h3>
          <div id="adminJobsList"><span class="loading"></span> Loading...</div>
        </div>
      </div>

      <!-- â•â•â• CANDIDATES â•â•â• -->
      <div id="tab-candidates" class="hidden">
        <div class="card">
          <h3>ğŸ‘¥ All Applications</h3>
          <div id="adminCandList"><span class="loading"></span> Loading...</div>
        </div>
        <div class="card">
          <h3>ğŸ¤ All Interviews</h3>
          <div id="adminIntList"><span class="loading"></span> Loading...</div>
        </div>
      </div>

      <!-- â•â•â• SETTINGS â•â•â• -->
      <div id="tab-settings" class="hidden">
        <div class="card">
          <h3>ğŸ” Passwords</h3>
          <div class="edit-row"><span class="edit-label">Admin Password</span><input class="edit-input" type="password" id="set_adminPass" placeholder="Min 6 characters"><button class="btn btn-primary" onclick="changeAdminPass()" style="margin-left:8px;">Change</button></div>
          <div class="edit-row"><span class="edit-label">HR Password</span><input class="edit-input" type="password" id="set_hrPass" placeholder="Min 4 characters"><button class="btn btn-primary" onclick="changeHRPass()" style="margin-left:8px;">Change</button></div>
        </div>

        <div class="card">
          <h3>âš™ï¸ Platform Config</h3>
          <div class="edit-row"><span class="edit-label">Worker URL</span><input class="edit-input" id="set_worker" value="https://evalis-ai.simpaticohrconsultancy.workers.dev"></div>
          <div class="edit-row"><span class="edit-label">Max Violations</span><input class="edit-input" type="number" id="set_violations" value="3" style="max-width:100px;"></div>
          <div class="edit-row"><span class="edit-label">Silence Timeout</span><input class="edit-input" type="number" id="set_silence" value="3" step="0.5" style="max-width:100px;"></div>
          <div class="edit-row"><span class="edit-label">Maintenance Mode</span><div class="toggle-switch" id="tog_maint" onclick="toggleSwitch(this)"></div><span class="edit-preview">Off</span></div>
          <button class="btn btn-save btn-full" onclick="savePlatformSettings()" style="margin-top:12px;">ğŸ’¾ Save All Settings</button>
        </div>

        <div class="card">
          <h3>ğŸ—ƒï¸ Data Management</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="exportAllData()">ğŸ“¥ Export All</button>
            <button class="btn btn-accent" onclick="importData()">ğŸ“¤ Import JSON</button>
            <button class="btn btn-danger" onclick="dangerReset()">âš ï¸ Reset Everything</button>
          </div>
        </div>

        <div class="card">
          <h3>ğŸ“Š System Info</h3>
          <div class="edit-row"><span class="edit-label">Platform URL</span><span class="edit-preview" id="sysUrl">-</span></div>
          <div class="edit-row"><span class="edit-label">Config Size</span><span class="edit-preview" id="sysConfig">-</span></div>
          <div class="edit-row"><span class="edit-label">Last Login</span><span class="edit-preview" id="sysLogin">-</span></div>
        </div>
      </div>

    </div>
  </div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_DEFAULT="superadmin@2025";
const HR_DEFAULT="simpatico2025";
const W_DEFAULT="https://evalis-ai.simpaticohrconsultancy.workers.dev";

function getConfig(k,fb){try{return JSON.parse(localStorage.getItem("adminConfig")||"{}")[k]??fb}catch(e){return fb}}
function setConfig(k,v){try{const c=JSON.parse(localStorage.getItem("adminConfig")||"{}");c[k]=v;localStorage.setItem("adminConfig",JSON.stringify(c))}catch(e){}}
function getW(){return getConfig('workerUrl',W_DEFAULT)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function db(a,t,d=null,f=null,s=null,o=null){
  const r=await fetch(getW()+"/db",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:a,table:t,data:d,filters:f,select:s,order:o})});
  return await r.json();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(m){const c=document.getElementById("toasts"),t=document.createElement("div");t.className="toast";t.textContent=m;c.appendChild(t);setTimeout(()=>t.remove(),3200)}
function toggleSwitch(el){el.classList.toggle('on');const n=el.nextElementSibling;if(n?.classList.contains('edit-preview'))n.textContent=el.classList.contains('on')?'On':'Off'}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN / LOGOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  const pwd=document.getElementById('loginPass').value;
  if(pwd===getConfig('adminPassword',ADMIN_DEFAULT)){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('adminWrap').style.display='block';
    setConfig('lastLogin',new Date().toISOString());
    loadDashboard();toast('âœ… Welcome, Admin!');
  }else{
    document.getElementById('loginError').style.display='block';
    setTimeout(()=>document.getElementById('loginError').style.display='none',3000);
  }
}

function doLogout(){
  document.getElementById('adminWrap').style.display='none';
  document.getElementById('loginScreen').style.display='block';
  document.getElementById('loginPass').value='';
  toast('ğŸšª Logged out');
}

// Auto-login if session
if(sessionStorage.getItem('adminAuth')==='true'){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('adminWrap').style.display='block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(tab){
  const tabs=['dashboard','editor','payments','access','jobs','candidates','settings'];
  tabs.forEach(t=>document.getElementById('tab-'+t)?.classList.add('hidden'));
  document.getElementById('tab-'+tab)?.classList.remove('hidden');
  document.querySelectorAll('.admin-tab').forEach((b,i)=>b.classList.toggle('active',tabs[i]===tab));

  if(tab==='dashboard')loadDashboard();
  if(tab==='payments')loadPayments();
  if(tab==='access')loadCodes();
  if(tab==='jobs')loadAdminJobs();
  if(tab==='candidates')loadAdminCandidates();
  if(tab==='settings')loadSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDashboard(){
  try{
    const[pay,apps,ints,jobs]=await Promise.all([
      db('select','payments').catch(()=>[]),
      db('select','applications').catch(()=>[]),
      db('select','interviews').catch(()=>[]),
      db('select','jobs').catch(()=>[])
    ]);
    const pa=Array.isArray(pay)?pay:[];const aa=Array.isArray(apps)?apps:[];
    const ia=Array.isArray(ints)?ints:[];const ja=Array.isArray(jobs)?jobs:[];
    const rev=pa.filter(p=>p.status==='completed').reduce((s,p)=>s+(p.amount||0),0);

    document.getElementById('sRevenue').textContent='â‚¹'+rev;
    document.getElementById('sUsers').textContent=aa.length;
    document.getElementById('sInterviews').textContent=ia.length;
    document.getElementById('sJobs').textContent=ja.length;

    const log=document.getElementById('activityLog');
    const items=[
      ...aa.map(a=>({t:a.created_at,m:`ğŸ“ ${a.name||'?'} applied${a.ats_score?' (ATS:'+a.ats_score+')':''}`})),
      ...ia.map(i=>({t:i.started_at||i.created_at,m:`ğŸ¤ Interview ${i.status}: ${i.interview_role||'?'}`})),
      ...pa.map(p=>({t:p.created_at,m:`ğŸ’³ â‚¹${p.amount} ${p.type||''}: ${p.status}`}))
    ].sort((a,b)=>new Date(b.t||0)-new Date(a.t||0)).slice(0,30);

    log.innerHTML=items.length?items.map(i=>`<div><span style="font-size:0.7rem;color:var(--muted);">${i.t?new Date(i.t).toLocaleString():'?'}</span> ${i.m}</div>`).join(''):'<div>No activity yet</div>';
  }catch(e){console.error(e);toast('âŒ Load failed')}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEBSITE EDITOR â€” SAVE TO DB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveSiteConfig(){
  const config={
    siteTitle:document.getElementById('ed_title').value,
    siteSubtitle:document.getElementById('ed_subtitle').value,
    companyName:document.getElementById('ed_company').value,
    colorPrimary:document.getElementById('ed_primary').value,
    colorSecondary:document.getElementById('ed_secondary').value,
    colorSuccess:document.getElementById('ed_success').value,
    colorDanger:document.getElementById('ed_danger').value,
    colorBg:document.getElementById('ed_bg').value,
    font:document.getElementById('ed_font').value,
    radius:document.getElementById('ed_radius').value,
    card1:document.getElementById('ed_c1').value,
    card2:document.getElementById('ed_c2').value,
    card3:document.getElementById('ed_c3').value,
    card4:document.getElementById('ed_c4').value,
    nav1:document.getElementById('ed_nav1').value,
    nav1url:document.getElementById('ed_nav1url').value,
    nav2:document.getElementById('ed_nav2').value,
    nav2url:document.getElementById('ed_nav2url').value,
    nav3:document.getElementById('ed_nav3').value,
    nav3url:document.getElementById('ed_nav3url').value,
    bannerShow:document.getElementById('tog_banner').classList.contains('on'),
    bannerText:document.getElementById('ed_bannerText').value,
    bannerColor:document.getElementById('ed_bannerColor').value,
  };

  // Save to localStorage (platform reads this)
  localStorage.setItem("siteConfig",JSON.stringify(config));

  // Also save to DB for persistence
  db('upsert','site_config',{id:'main',config,updated_at:new Date().toISOString()}).catch(e=>{});

  toast('ğŸ’¾ Website config saved!');
}

function resetSiteConfig(){
  if(!confirm('Reset all website customizations?'))return;
  localStorage.removeItem("siteConfig");
  db('delete','site_config',null,{id:'main'}).catch(e=>{});
  toast('ğŸ”„ Reset! Reload platform to see changes.');
  location.reload();
}

function loadSiteConfig(){
  try{
    const cfg=JSON.parse(localStorage.getItem("siteConfig")||"{}");
    if(cfg.siteTitle)document.getElementById('ed_title').value=cfg.siteTitle;
    if(cfg.siteSubtitle)document.getElementById('ed_subtitle').value=cfg.siteSubtitle;
    if(cfg.companyName)document.getElementById('ed_company').value=cfg.companyName;
    if(cfg.colorPrimary)document.getElementById('ed_primary').value=cfg.colorPrimary;
    if(cfg.colorSecondary)document.getElementById('ed_secondary').value=cfg.colorSecondary;
    if(cfg.colorSuccess)document.getElementById('ed_success').value=cfg.colorSuccess;
    if(cfg.colorDanger)document.getElementById('ed_danger').value=cfg.colorDanger;
    if(cfg.colorBg)document.getElementById('ed_bg').value=cfg.colorBg;
    if(cfg.font)document.getElementById('ed_font').value=cfg.font;
    if(cfg.radius)document.getElementById('ed_radius').value=cfg.radius;
    if(cfg.card1)document.getElementById('ed_c1').value=cfg.card1;
    if(cfg.card2)document.getElementById('ed_c2').value=cfg.card2;
    if(cfg.card3)document.getElementById('ed_c3').value=cfg.card3;
    if(cfg.card4)document.getElementById('ed_c4').value=cfg.card4;
    if(cfg.nav1)document.getElementById('ed_nav1').value=cfg.nav1;
    if(cfg.nav1url)document.getElementById('ed_nav1url').value=cfg.nav1url;
    if(cfg.nav2)document.getElementById('ed_nav2').value=cfg.nav2;
    if(cfg.nav2url)document.getElementById('ed_nav2url').value=cfg.nav2url;
    if(cfg.nav3)document.getElementById('ed_nav3').value=cfg.nav3;
    if(cfg.nav3url)document.getElementById('ed_nav3url').value=cfg.nav3url;
    if(cfg.bannerShow)document.getElementById('tog_banner').classList.add('on');
    if(cfg.bannerText)document.getElementById('ed_bannerText').value=cfg.bannerText;
    if(cfg.bannerColor)document.getElementById('ed_bannerColor').value=cfg.bannerColor;
  }catch(e){}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAYMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPayments(){
  try{
    const data=await db('select','payments',null,null,null,'created_at.desc');
    const arr=Array.isArray(data)?data:[];
    const total=arr.filter(p=>p.status==='completed').reduce((s,p)=>s+(p.amount||0),0);
    document.getElementById('pTotal').textContent='â‚¹'+total;
    document.getElementById('pCount').textContent=arr.length;
    document.getElementById('pPending').textContent=arr.filter(p=>p.status==='pending').length;
    document.getElementById('pActive').textContent=arr.filter(p=>p.status==='completed').length;

    const tbody=document.getElementById('payHistory');
    if(!arr.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--muted);">No payments yet</td></tr>';return}
    tbody.innerHTML=arr.map(p=>{
      const sc=p.status==='completed'?'#10b981':'#f59e0b';
      const sb=p.status==='completed'?'rgba(16,185,129,.15)':'rgba(245,158,11,.15)';
      return`<tr>
        <td>${p.created_at?new Date(p.created_at).toLocaleDateString():'?'}</td>
        <td>${p.email||p.user_email||'?'}</td>
        <td style="font-weight:700;">â‚¹${p.amount||0}</td>
        <td>${p.type||'?'}</td>
        <td><span class="status-pill" style="background:${sb};color:${sc};">${p.status||'?'}</span></td>
        <td>
          ${p.status!=='completed'?`<button class="btn btn-save" style="padding:4px 8px;font-size:0.72rem;" onclick="approvePay('${p.id}')">âœ…</button>`:''}
          <button class="btn btn-danger" style="padding:4px 8px;font-size:0.72rem;" onclick="deletePay('${p.id}')">ğŸ—‘ï¸</button>
        </td>
      </tr>`}).join('');
  }catch(e){console.error(e)}

  // Load pricing settings
  document.getElementById('ed_price').value=getConfig('mockPrice',199);
  document.getElementById('ed_days').value=getConfig('accessDays',30);
  if(getConfig('mockPaid',true))document.getElementById('tog_paid').classList.add('on');
  if(getConfig('freeTrial',false))document.getElementById('tog_trial').classList.add('on');
  document.getElementById('ed_trialCount').value=getConfig('trialCount',1);
  document.getElementById('ed_razorKey').value=getConfig('razorpayKey','');
  document.getElementById('ed_upiId').value=getConfig('upiId','');
}

async function approvePay(id){try{await db('update','payments',{status:'completed'},{id});toast('âœ… Approved');loadPayments()}catch(e){toast('âŒ '+e.message)}}
async function deletePay(id){if(!confirm('Delete payment?'))return;try{await db('delete','payments',null,{id});toast('ğŸ—‘ï¸ Deleted');loadPayments()}catch(e){toast('âŒ '+e.message)}}

async function addManualPayment(){
  const email=document.getElementById('mp_email').value.trim();
  if(!email){toast('âŒ Enter email');return}
  try{
    await db('insert','payments',{
      email,user_email:email,
      amount:parseInt(document.getElementById('mp_amount').value)||199,
      currency:'INR',type:'manual',status:'completed',
      note:document.getElementById('mp_note').value.trim()||'Manual entry',
      days_granted:parseInt(document.getElementById('mp_days').value)||30,
      created_at:new Date().toISOString()
    });
    toast('âœ… Payment added for '+email);
    document.getElementById('mp_email').value='';
    document.getElementById('mp_note').value='';
    loadPayments();
  }catch(e){toast('âŒ '+e.message)}
}

function savePricing(){
  setConfig('mockPrice',document.getElementById('ed_price').value);
  setConfig('accessDays',document.getElementById('ed_days').value);
  setConfig('mockPaid',document.getElementById('tog_paid').classList.contains('on'));
  setConfig('freeTrial',document.getElementById('tog_trial').classList.contains('on'));
  setConfig('trialCount',document.getElementById('ed_trialCount').value);
  toast('ğŸ’¾ Pricing saved!');
}

function saveGateway(){
  const key=document.getElementById('ed_razorKey').value.trim();
  const upi=document.getElementById('ed_upiId').value.trim();
  if(key)setConfig('razorpayKey',key);
  if(upi)setConfig('upiId',upi);
  toast('ğŸ’¾ Gateway saved!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCESS CODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function genCode(){
  const code=document.getElementById('ac_code').value.trim().toUpperCase();
  if(!code){toast('âŒ Enter code');return}
  try{
    const expiry=document.getElementById('ac_expiry').value;
    await db('insert','access_codes',{
      code,max_uses:parseInt(document.getElementById('ac_max').value)||50,
      used:0,days:parseInt(document.getElementById('ac_days').value)||30,
      is_active:true,
      expires_at:expiry?new Date(expiry).toISOString():null,
      created_at:new Date().toISOString()
    });
    toast('âœ… Created: '+code);
    document.getElementById('ac_code').value='';
    loadCodes();
  }catch(e){toast('âŒ '+e.message)}
}

function genRandom(){
  const ch='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let c='SIM-';for(let i=0;i<8;i++)c+=ch.charAt(Math.floor(Math.random()*ch.length));
  document.getElementById('ac_code').value=c;toast('ğŸ² '+c);
}

async function loadCodes(){
  const el=document.getElementById('codesList');
  try{
    const data=await db('select','access_codes',null,null,null,'created_at.desc');
    const arr=Array.isArray(data)?data:[];
    if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;padding:16px;">No codes yet</p>';return}
    el.innerHTML=arr.map(c=>`
      <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px;">
        <div>
          <div style="font-weight:700;font-size:0.95rem;color:var(--accent);">${c.code}</div>
          <div style="font-size:0.72rem;color:var(--muted);">
            Used: ${c.used||0}/${c.max_uses||'âˆ'} â€¢ ${c.days||30} days â€¢ ${c.is_active?'ğŸŸ¢ Active':'ğŸ”´ Inactive'}
            ${c.expires_at?' â€¢ Expires: '+new Date(c.expires_at).toLocaleDateString():''}
          </div>
        </div>
        <div style="display:flex;gap:6px;">
          <button class="btn btn-accent" style="padding:4px 10px;font-size:0.75rem;" onclick="navigator.clipboard?.writeText('${c.code}');toast('ğŸ“‹ Copied: ${c.code}')">ğŸ“‹ Copy</button>
          ${c.is_active?`<button class="btn btn-danger" style="padding:4px 10px;font-size:0.75rem;" onclick="deactCode('${c.id}')">ğŸš« Disable</button>`:`<button class="btn btn-save" style="padding:4px 10px;font-size:0.75rem;" onclick="actCode('${c.id}')">âœ… Enable</button>`}
          <button class="btn btn-danger" style="padding:4px 10px;font-size:0.75rem;" onclick="delCode('${c.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>
    `).join('');
  }catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}

async function deactCode(id){try{await db('update','access_codes',{is_active:false},{id});toast('ğŸš« Disabled');loadCodes()}catch(e){toast('âŒ '+e.message)}}
async function actCode(id){try{await db('update','access_codes',{is_active:true},{id});toast('âœ… Enabled');loadCodes()}catch(e){toast('âŒ '+e.message)}}
async function delCode(id){if(!confirm('Delete code?'))return;try{await db('delete','access_codes',null,{id});toast('ğŸ—‘ï¸ Deleted');loadCodes()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JOBS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminJobs(){
  const el=document.getElementById('adminJobsList');el.innerHTML='<span class="loading"></span>';
  try{
    const data=await db('select','jobs',null,null,null,'created_at.desc');
    const arr=Array.isArray(data)?data:[];
    if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No jobs posted</p>';return}
    el.innerHTML=arr.map(j=>`
      <div class="job-card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h4>${j.title||'?'}</h4>
          <div style="display:flex;gap:6px;">
            <span class="status-pill" style="background:${j.is_active?'rgba(16,185,129,.15)':'rgba(239,68,68,.15)'};color:${j.is_active?'#10b981':'#ef4444'};">${j.is_active?'Active':'Inactive'}</span>
            <button class="btn ${j.is_active?'btn-danger':'btn-save'}" style="padding:3px 8px;font-size:0.7rem;" onclick="toggleJob('${j.id}',${!j.is_active})">${j.is_active?'Disable':'Enable'}</button>
            <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteJob('${j.id}')">ğŸ—‘ï¸</button>
          </div>
        </div>
        <div class="job-meta" style="margin-top:6px;">
          <span>ğŸ¢ ${j["Company Name"]||j.department||''}</span>
          <span>ğŸ“ ${j.location||''}</span>
          <span>ğŸ“Š ${j.level||''}</span>
          <span>ğŸ¯ ATS: ${j.ats_threshold>0?j.ats_threshold+'+':'Manual'}</span>
          <span>â“ ${j.question_count||10} Qs</span>
        </div>
      </div>
    `).join('');
  }catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}

async function toggleJob(id,active){try{await db('update','jobs',{is_active:active},{id});toast(active?'âœ… Activated':'ğŸš« Disabled');loadAdminJobs()}catch(e){toast('âŒ '+e.message)}}
async function deleteJob(id){if(!confirm('Delete this job?'))return;try{await db('delete','jobs',null,{id});toast('ğŸ—‘ï¸ Deleted');loadAdminJobs()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANDIDATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminCandidates(){
  // Applications
  const el=document.getElementById('adminCandList');el.innerHTML='<span class="loading"></span>';
  try{
    const data=await db('select','applications',null,null,null,'created_at.desc');
    const arr=Array.isArray(data)?data:[];
    if(!arr.length){el.innerHTML='<p style="color:var(--muted);text-align:center;">No applications</p>';return}
    el.innerHTML=arr.map(c=>{
      const sc=c.ats_score||0;const col=sc>=70?'#10b981':sc>=50?'#f59e0b':'#ef4444';
      const bg=sc>=70?'rgba(16,185,129,.15)':sc>=50?'rgba(245,158,11,.15)':'rgba(239,68,68,.15)';
      const stc={applied:'#f59e0b',shortlisted:'#10b981',interviewed:'#3b82f6',rejected:'#ef4444'}[c.status]||'#94a3b8';
      const stb={applied:'rgba(245,158,11,.15)',shortlisted:'rgba(16,185,129,.15)',interviewed:'rgba(59,130,246,.15)',rejected:'rgba(239,68,68,.15)'}[c.status]||'rgba(255,255,255,.05)';
      return`<div class="cand-row">
        <div style="display:flex;align-items:center;gap:8px;flex:1;">
          <div class="cand-avatar">${(c.name||'?')[0].toUpperCase()}</div>
          <div><div style="font-weight:700;font-size:0.88rem;">${c.name||'?'}</div><div style="font-size:0.72rem;color:var(--muted);">${c.email||''} â€¢ ${c.created_at?new Date(c.created_at).toLocaleDateString():''}</div></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
          <span class="score-badge" style="background:${bg};color:${col};">ATS:${sc}</span>
          <span class="status-pill" style="background:${stb};color:${stc};">${c.status||'?'}</span>
          ${c.resume_url?`<a href="${c.resume_url}" target="_blank" class="btn" style="padding:3px 8px;font-size:0.7rem;background:var(--accent);text-decoration:none;">ğŸ“„</a>`:''}
          <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteApp('${c.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>`}).join('');
  }catch(e){el.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}

  // Interviews
  const el2=document.getElementById('adminIntList');el2.innerHTML='<span class="loading"></span>';
  try{
    const data=await db('select','interviews',null,null,null,'created_at.desc');
    const arr=Array.isArray(data)?data:[];
    if(!arr.length){el2.innerHTML='<p style="color:var(--muted);text-align:center;">No interviews</p>';return}
    el2.innerHTML=arr.map(i=>{
      const sc=i.overall_score||0;const col=sc>=70?'#10b981':sc>=50?'#f59e0b':'#ef4444';
      const stc={pending:'#f59e0b',in_progress:'#3b82f6',completed:'#10b981'}[i.status]||'#94a3b8';
      return`<div class="cand-row">
        <div style="flex:1;">
          <div style="font-weight:700;font-size:0.88rem;">${i.interview_role||'?'} â€” ${i.interview_level||''}</div>
          <div style="font-size:0.72rem;color:var(--muted);">Token: ${i.token?.substring(0,12)||'?'}... â€¢ ${i.created_at?new Date(i.created_at).toLocaleDateString():''}</div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          ${sc?`<span class="score-badge" style="background:rgba(${col==='#10b981'?'16,185,129':col==='#f59e0b'?'245,158,11':'239,68,68'},.15);color:${col};">${sc}/100</span>`:''}
          <span class="status-pill" style="color:${stc};">${i.status||'?'}</span>
          <button class="btn btn-danger" style="padding:3px 8px;font-size:0.7rem;" onclick="deleteInt('${i.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>`}).join('');
  }catch(e){el2.innerHTML='<p style="color:var(--red);">'+e.message+'</p>'}
}

async function deleteApp(id){if(!confirm('Delete application?'))return;try{await db('delete','applications',null,{id});toast('ğŸ—‘ï¸ Deleted');loadAdminCandidates()}catch(e){toast('âŒ '+e.message)}}
async function deleteInt(id){if(!confirm('Delete interview?'))return;try{await db('delete','interviews',null,{id});toast('ğŸ—‘ï¸ Deleted');loadAdminCandidates()}catch(e){toast('âŒ '+e.message)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadSettings(){
  document.getElementById('set_worker').value=getConfig('workerUrl',W_DEFAULT);
  document.getElementById('set_violations').value=getConfig('maxViolations',3);
  document.getElementById('set_silence').value=getConfig('silenceTimeout',3);
  if(getConfig('maintenance',false))document.getElementById('tog_maint').classList.add('on');
  document.getElementById('sysUrl').textContent=location.href;
  document.getElementById('sysConfig').textContent=((localStorage.getItem("adminConfig")||"").length/1024).toFixed(1)+' KB';
  document.getElementById('sysLogin').textContent=getConfig('lastLogin','Never');
}

function changeAdminPass(){
  const p=document.getElementById('set_adminPass').value.trim();
  if(!p||p.length<6){toast('âŒ Min 6 characters');return}
  setConfig('adminPassword',p);toast('âœ… Admin password changed!');
  document.getElementById('set_adminPass').value='';
}

function changeHRPass(){
  const p=document.getElementById('set_hrPass').value.trim();
  if(!p||p.length<4){toast('âŒ Min 4 characters');return}
  setConfig('hrPassword',p);toast('âœ… HR password changed!');
  document.getElementById('set_hrPass').value='';
}

function savePlatformSettings(){
  setConfig('workerUrl',document.getElementById('set_worker').value);
  setConfig('maxViolations',document.getElementById('set_violations').value);
  setConfig('silenceTimeout',document.getElementById('set_silence').value);
  setConfig('maintenance',document.getElementById('tog_maint').classList.contains('on'));
  toast('ğŸ’¾ Platform settings saved!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT / IMPORT / RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function exportAllData(){
  toast('ğŸ“¥ Exporting...');
  try{
    const[jobs,apps,ints,pay,codes]=await Promise.all([
      db('select','jobs').catch(()=>[]),
      db('select','applications').catch(()=>[]),
      db('select','interviews').catch(()=>[]),
      db('select','payments').catch(()=>[]),
      db('select','access_codes').catch(()=>[])
    ]);
    const data={
      exported:new Date().toISOString(),
      adminConfig:JSON.parse(localStorage.getItem("adminConfig")||"{}"),
      siteConfig:JSON.parse(localStorage.getItem("siteConfig")||"{}"),
      jobs,applications:apps,interviews:ints,payments:pay,access_codes:codes
    };
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);const a=document.createElement('a');
    a.href=url;a.download='simpatico-export-'+Date.now()+'.json';a.click();
    URL.revokeObjectURL(url);toast('âœ… Exported!');
  }catch(e){toast('âŒ '+e.message)}
}

function importData(){
  const input=document.createElement('input');input.type='file';input.accept='.json';
  input.onchange=async e=>{
    const file=e.target.files[0];if(!file)return;
    try{
      const data=JSON.parse(await file.text());
      if(data.adminConfig)localStorage.setItem("adminConfig",JSON.stringify(data.adminConfig));
      if(data.siteConfig)localStorage.setItem("siteConfig",JSON.stringify(data.siteConfig));
      toast('âœ… Imported! Reload to apply.');
    }catch(err){toast('âŒ Invalid file')}
  };input.click();
}

function dangerReset(){
  if(!confirm('âš ï¸ This will DELETE all local data!'))return;
  const c=prompt('Type "DELETE ALL" to confirm:');
  if(c!=='DELETE ALL'){toast('Cancelled');return}
  localStorage.clear();toast('ğŸ—‘ï¸ Everything cleared! Reloading...');
  setTimeout(()=>location.reload(),1000);
}

function clearCache(){
  if(!confirm('Clear cached data?'))return;
  localStorage.removeItem("mockAccess");
  localStorage.removeItem("trialUsed");
  toast('ğŸ—‘ï¸ Cache cleared!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded',()=>{
  loadSiteConfig();

  // Auto-focus password
  document.getElementById('loginPass')?.focus();
});
</script>
</body>
</html>
