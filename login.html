<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login ‚Äî SimpaticoHR</title>
    <link rel="stylesheet" href="css/shared.css">
    <style>
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-deepest);
            position: relative;
            overflow: hidden;
        }

        .login-page::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at 30% 20%, rgba(108, 99, 255, 0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at 70% 80%, rgba(0, 212, 170, 0.06) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-2%, 2%); }
        }

        .login-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 440px;
            padding: 1rem;
        }

        .login-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        .login-header {
            padding: 2.5rem 2rem 1.5rem;
            text-align: center;
        }

        .login-logo {
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .login-logo span { color: var(--primary); }

        .login-subtitle {
            color: var(--text-tertiary);
            font-size: 0.875rem;
        }

        .login-body {
            padding: 0 2rem 2rem;
        }

        .login-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            padding: 4px;
        }

        .login-tab {
            flex: 1;
            padding: 0.625rem;
            text-align: center;
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--text-tertiary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .login-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(108, 99, 255, 0.3);
        }

        .login-form { display: none; }
        .login-form.active { display: block; animation: fadeInUp 0.3s ease; }

        .form-divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.25rem 0;
            color: var(--text-tertiary);
            font-size: 0.75rem;
        }

        .form-divider::before,
        .form-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-subtle);
        }

        .login-footer {
            padding: 1.25rem 2rem;
            border-top: 1px solid var(--border-subtle);
            text-align: center;
        }

        .login-footer a {
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .error-msg {
            background: var(--accent-light);
            color: var(--accent);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.8125rem;
            margin-bottom: 1rem;
            display: none;
        }

        .error-msg.show { display: block; animation: fadeIn 0.2s ease; }

        .success-msg {
            background: var(--secondary-light);
            color: var(--secondary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.8125rem;
            margin-bottom: 1rem;
            display: none;
        }

        .success-msg.show { display: block; }

        .password-toggle {
            position: relative;
        }

        .password-toggle .toggle-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-tertiary);
            font-size: 1.125rem;
            user-select: none;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-tertiary);
            font-size: 0.8125rem;
            margin-bottom: 1.5rem;
            transition: color var(--transition-fast);
        }

        .back-link:hover { color: var(--text-primary); }
    </style>
</head>
<body>
    <div class="login-page">
        <div class="login-container">
            <a href="/" class="back-link">‚Üê Back to Home</a>

            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">Simpatico<span>HR</span></div>
                    <p class="login-subtitle">Premium HR Automation Platform</p>
                </div>

                <div class="login-body">
                    <!-- Tabs -->
                    <div class="login-tabs">
                        <div class="login-tab active" data-tab="login">Sign In</div>
                        <div class="login-tab" data-tab="register">Register</div>
                    </div>

                    <!-- Error/Success Messages -->
                    <div id="error-msg" class="error-msg"></div>
                    <div id="success-msg" class="success-msg"></div>

                    <!-- LOGIN FORM -->
                    <form id="login-form" class="login-form active">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="login-email" 
                                   placeholder="you@company.com" required autocomplete="email">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <div class="password-toggle">
                                <input type="password" class="form-input" id="login-password" 
                                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
                                <span class="toggle-icon" onclick="togglePassword('login-password', this)">üëÅ</span>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block btn-lg" id="login-btn">
                            Sign In
                        </button>
                    </form>

                    <!-- REGISTER FORM -->
                    <form id="register-form" class="login-form">
                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-input" id="reg-company" 
                                   placeholder="Your Company Ltd." required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Your Full Name</label>
                            <input type="text" class="form-input" id="reg-name" 
                                   placeholder="John Doe" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="reg-email" 
                                   placeholder="you@company.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone (optional)</label>
                            <input type="tel" class="form-input" id="reg-phone" 
                                   placeholder="+91 98765 43210">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Industry</label>
                            <select class="form-select" id="reg-industry">
                                <option value="">Select industry...</option>
                                <option value="Technology">Technology & IT</option>
                                <option value="Healthcare">Healthcare & Pharma</option>
                                <option value="Finance">Finance & Banking</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Retail">Retail & E-commerce</option>
                                <option value="Education">Education</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Hospitality">Hospitality</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password (min 8 characters)</label>
                            <div class="password-toggle">
                                <input type="password" class="form-input" id="reg-password" 
                                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
                                <span class="toggle-icon" onclick="togglePassword('reg-password', this)">üëÅ</span>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block btn-lg" id="register-btn">
                            Create Account ‚Äî Free
                        </button>

                        <p style="font-size:0.7rem;color:var(--text-tertiary);margin-top:0.75rem;text-align:center;">
                            By registering, you agree to our Terms of Service & Privacy Policy
                        </p>
                    </form>
                </div>

                <div class="login-footer">
                    <a href="/">‚Üê Back to SimpaticoHR.in</a>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // Check if already logged in
        if (API.auth.isAuthenticated) {
            redirectToDashboard();
        }

        // Check for expired session
        const params = new URLSearchParams(window.location.search);
        if (params.get('expired') === 'true') {
            showError('Session expired. Please login again.');
        }

        // Tab switching
        document.querySelectorAll('.login-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + '-form').classList.add('active');
                hideMessages();
            });
        });

        // LOGIN
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessages();

            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const btn = document.getElementById('login-btn');

            if (!email || !password) return showError('Please fill in all fields');

            btn.classList.add('loading');
            btn.disabled = true;

            try {
                const result = await API.auth.login(email, password);
                showSuccess('Login successful! Redirecting...');
                setTimeout(() => redirectToDashboard(), 500);
            } catch (err) {
                showError(err.message || 'Login failed');
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        });

        // REGISTER
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessages();

            const company_name = document.getElementById('reg-company').value.trim();
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const phone = document.getElementById('reg-phone').value.trim();
            const industry = document.getElementById('reg-industry').value;
            const password = document.getElementById('reg-password').value;
            const btn = document.getElementById('register-btn');

            if (!company_name || !name || !email || !password) {
                return showError('Please fill in all required fields');
            }

            if (password.length < 8) {
                return showError('Password must be at least 8 characters');
            }

            btn.classList.add('loading');
            btn.disabled = true;

            try {
                const result = await API.auth.register({
                    company_name, name, email, password, phone, industry
                });
                showSuccess('Account created! Redirecting to dashboard...');
                setTimeout(() => redirectToDashboard(), 1000);
            } catch (err) {
                showError(err.message || 'Registration failed');
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        });

        function redirectToDashboard() {
            const redirect = params.get('redirect');
            if (redirect) {
                window.location.href = redirect;
                return;
            }

            const user = API.auth.user;
            if (user?.role === 'superadmin') {
                window.location.href = '/admin.html';
            } else {
                window.location.href = '/dashboard.html';
            }
        }

        function togglePassword(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅ';
            }
        }

        function showError(msg) {
            const el = document.getElementById('error-msg');
            el.textContent = msg;
            el.classList.add('show');
        }

        function showSuccess(msg) {
            const el = document.getElementById('success-msg');
            el.textContent = msg;
            el.classList.add('show');
        }

        function hideMessages() {
            document.getElementById('error-msg').classList.remove('show');
            document.getElementById('success-msg').classList.remove('show');
        }
    </script>
</body>
</html>
