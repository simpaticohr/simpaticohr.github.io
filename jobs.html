<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simpatico HR | Jobs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;
      background: #0a0f1e;
      color: #e2e8f0;
      min-height: 100vh;
    }

    .nav {
      backdrop-filter: blur(16px);
      background: rgba(10,15,30,0.9);
      padding: 1.2rem 6%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .logo { font-weight: 800; font-size: 1.1rem; color: #fff; text-decoration: none; }
    .logo span { color: #6366f1; }
    .nav-links { display: flex; gap: 16px; align-items: center; }
    .nav-link {
      color: #94a3b8; text-decoration: none; font-size: 13px; font-weight: 500;
      padding: 6px 14px; border-radius: 8px; transition: all 0.2s;
    }
    .nav-link:hover { color: #fff; background: rgba(255,255,255,0.05); }
    .nav-link.active { color: #fff; background: rgba(99,102,241,0.15); }

    .container { max-width: 900px; margin: 0 auto; padding: 50px 20px; }

    .page-header { text-align: center; margin-bottom: 50px; }
    .page-header h1 {
      font-size: clamp(2rem, 5vw, 3rem); font-weight: 800;
      background: linear-gradient(135deg, #fff, #94a3b8);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      margin-bottom: 12px;
    }
    .page-header p { color: #64748b; font-size: 1.05rem; max-width: 500px; margin: 0 auto; line-height: 1.6; }

    .stats-bar { display: flex; justify-content: center; gap: 32px; margin-bottom: 40px; flex-wrap: wrap; }
    .stat {
      text-align: center; background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 16px 28px;
    }
    .stat-num { font-size: 1.6rem; font-weight: 800; color: #6366f1; }
    .stat-label { font-size: 0.75rem; color: #64748b; margin-top: 2px; }

    .filters { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 30px; justify-content: center; }
    .filter-btn {
      padding: 8px 18px; border: 1px solid rgba(255,255,255,0.08); border-radius: 10px;
      background: transparent; color: #94a3b8; font-size: 0.82rem; font-weight: 600;
      cursor: pointer; transition: all 0.2s; font-family: inherit;
    }
    .filter-btn:hover { border-color: rgba(99,102,241,0.3); color: #fff; }
    .filter-btn.active { background: rgba(99,102,241,0.15); border-color: rgba(99,102,241,0.4); color: #a5b4fc; }

    .search-wrap { margin-bottom: 30px; position: relative; }
    .search-wrap i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #475569; }
    .search-input {
      width: 100%; padding: 14px 16px 14px 44px; background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; color: #e2e8f0;
      font-size: 0.95rem; outline: none; font-family: inherit; transition: border-color 0.2s;
    }
    .search-input:focus { border-color: rgba(99,102,241,0.4); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
    .search-input::placeholder { color: #475569; }

    .job-card {
      background: rgba(15,23,42,0.8); backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.06); border-radius: 24px;
      margin-bottom: 20px; overflow: hidden; transition: all 0.3s ease;
    }
    .job-card:hover {
      border-color: rgba(99,102,241,0.3); transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(99,102,241,0.08);
    }

    .job-header {
      background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(139,92,246,0.1));
      padding: 24px 28px 18px; border-bottom: 1px solid rgba(255,255,255,0.04);
      display: flex; justify-content: space-between; align-items: flex-start;
    }
    .job-header-left { flex: 1; }
    .job-header small { font-size: 0.72rem; color: #6366f1; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; }
    .job-header h2 { font-size: 1.4rem; font-weight: 700; margin-top: 6px; color: #f1f5f9; }

    /* â˜… Admin Buttons */
    .admin-actions {
      display: none;
      gap: 8px;
      flex-shrink: 0;
    }
    .admin-actions.visible { display: flex; }
    .admin-btn {
      width: 36px; height: 36px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05); color: #94a3b8; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.85rem; transition: all 0.2s;
    }
    .admin-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .admin-btn.edit-btn:hover { border-color: rgba(99,102,241,0.5); color: #a5b4fc; }
    .admin-btn.delete-btn:hover { border-color: rgba(239,68,68,0.5); color: #f87171; }

    .job-body { padding: 24px 28px; }
    .job-meta { display: flex; gap: 18px; flex-wrap: wrap; margin-bottom: 16px; }
    .job-meta-item { display: flex; align-items: center; gap: 6px; font-size: 0.82rem; color: #94a3b8; }
    .job-meta-item i { color: #6366f1; font-size: 0.8rem; }
    .job-desc { color: #94a3b8; font-size: 0.9rem; line-height: 1.7; margin-bottom: 18px; }
    .job-skills { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 20px; }
    .skill-tag { background: rgba(99,102,241,0.1); color: #a5b4fc; padding: 4px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 600; }
    .job-footer { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }

    .job-level { font-size: 0.78rem; font-weight: 600; padding: 4px 12px; border-radius: 8px; }
    .level-fresher { background: rgba(16,185,129,0.12); color: #34d399; }
    .level-junior { background: rgba(59,130,246,0.12); color: #60a5fa; }
    .level-mid { background: rgba(99,102,241,0.12); color: #a5b4fc; }
    .level-senior { background: rgba(245,158,11,0.12); color: #fbbf24; }
    .level-lead { background: rgba(239,68,68,0.12); color: #f87171; }

    .apply-btn {
      display: inline-flex; align-items: center; gap: 8px; background: #6366f1;
      color: #fff; padding: 12px 24px; border-radius: 14px; text-decoration: none;
      font-weight: 700; font-size: 0.9rem; transition: all 0.2s; border: none;
      cursor: pointer; font-family: inherit;
    }
    .apply-btn:hover { transform: scale(1.03); box-shadow: 0 8px 24px rgba(99,102,241,0.3); }

    .empty { text-align: center; padding: 60px 20px; color: #64748b; }
    .empty-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.3; }

    .loading-wrap { text-align: center; padding: 60px 20px; }
    .spinner {
      display: inline-block; width: 40px; height: 40px;
      border: 3px solid rgba(99,102,241,0.2); border-top-color: #6366f1;
      border-radius: 50%; animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { margin-top: 12px; color: #64748b; font-size: 0.9rem; }

    /* â˜… Admin Toggle */
    .admin-toggle {
      position: fixed; bottom: 24px; right: 24px; z-index: 200;
      background: rgba(15,23,42,0.95); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px; padding: 12px 20px; display: flex; align-items: center; gap: 10px;
      backdrop-filter: blur(12px); cursor: pointer; transition: all 0.2s;
    }
    .admin-toggle:hover { border-color: rgba(99,102,241,0.4); }
    .admin-toggle i { color: #6366f1; }
    .admin-toggle span { color: #94a3b8; font-size: 0.82rem; font-weight: 600; }
    .admin-toggle.active span { color: #a5b4fc; }
    .admin-toggle.active { border-color: rgba(99,102,241,0.4); background: rgba(99,102,241,0.1); }

    /* â˜… Modal */
    .modal-overlay {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px); z-index: 300; align-items: center; justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: #0f172a; border: 1px solid rgba(255,255,255,0.1);
      border-radius: 24px; padding: 32px; width: 90%; max-width: 500px;
      max-height: 90vh; overflow-y: auto;
    }
    .modal h3 { color: #f1f5f9; font-size: 1.3rem; margin-bottom: 24px; }
    .modal label { display: block; color: #94a3b8; font-size: 0.82rem; font-weight: 600; margin-bottom: 6px; margin-top: 16px; }
    .modal input, .modal textarea, .modal select {
      width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #e2e8f0;
      font-size: 0.9rem; font-family: inherit; outline: none;
    }
    .modal input:focus, .modal textarea:focus, .modal select:focus {
      border-color: rgba(99,102,241,0.4);
    }
    .modal textarea { min-height: 100px; resize: vertical; }
    .modal-btns { display: flex; gap: 12px; margin-top: 24px; }
    .modal-btn {
      flex: 1; padding: 12px; border-radius: 12px; font-weight: 700; font-size: 0.9rem;
      cursor: pointer; border: none; font-family: inherit; transition: all 0.2s;
    }
    .modal-btn.save { background: #6366f1; color: #fff; }
    .modal-btn.save:hover { background: #4f46e5; }
    .modal-btn.cancel { background: rgba(255,255,255,0.05); color: #94a3b8; border: 1px solid rgba(255,255,255,0.1); }
    .modal-btn.cancel:hover { background: rgba(255,255,255,0.1); color: #fff; }

    /* â˜… Delete Confirm */
    .delete-modal .modal { max-width: 400px; text-align: center; }
    .delete-modal p { color: #94a3b8; margin-bottom: 8px; line-height: 1.6; }
    .delete-modal .job-title { color: #f87171; font-weight: 700; font-size: 1.1rem; }
    .modal-btn.delete { background: #dc2626; color: #fff; }
    .modal-btn.delete:hover { background: #b91c1c; }

    /* â˜… Toast */
    .toast {
      position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
      background: #1e293b; border: 1px solid rgba(255,255,255,0.1);
      padding: 14px 28px; border-radius: 14px; color: #e2e8f0;
      font-size: 0.9rem; font-weight: 600; z-index: 400;
      opacity: 0; transition: opacity 0.3s; pointer-events: none;
    }
    .toast.success { border-color: rgba(16,185,129,0.4); }
    .toast.error { border-color: rgba(239,68,68,0.4); }
    .toast.show { opacity: 1; }

    .footer {
      text-align: center; padding: 40px 0; margin-top: 60px;
      border-top: 1px solid rgba(255,255,255,0.04); font-size: 12px; color: #475569;
    }
    .footer a { color: #6366f1; text-decoration: none; }

    @media (max-width: 600px) {
      .container { padding: 30px 14px; }
      .job-header { padding: 18px 20px; }
      .job-body { padding: 18px 20px; }
      .job-header h2 { font-size: 1.2rem; }
      .stats-bar { gap: 12px; }
      .stat { padding: 12px 18px; }
      .nav { padding: 1rem 4%; }
      .nav-links { gap: 8px; }
      .nav-link { font-size: 12px; padding: 5px 10px; }
      .admin-toggle { bottom: 16px; right: 16px; padding: 10px 16px; }
    }
  </style>
</head>

<body>

<nav class="nav">
  <a class="logo" href="index.html">SIMPATICO <span>HR</span></a>
  <div class="nav-links">
    <a class="nav-link active" href="jobs.html">ğŸ’¼ Jobs</a>
    <a class="nav-link" href="career-lab.html">ğŸ§  Career Lab</a>
    <a class="nav-link" href="evalis-platform.html">ğŸ¤ Interview</a>
    <a class="nav-link" href="index.html">Home</a>
  </div>
</nav>

<div class="container">
  <div class="page-header">
    <h1>Current Openings</h1>
    <p>Find your next opportunity. Apply and get AI-screened instantly.</p>
  </div>

  <div class="stats-bar">
    <div class="stat"><div class="stat-num" id="totalJobs">-</div><div class="stat-label">Open Positions</div></div>
    <div class="stat"><div class="stat-num" id="totalDepts">-</div><div class="stat-label">Departments</div></div>
    <div class="stat"><div class="stat-num">AI</div><div class="stat-label">ATS Screening</div></div>
  </div>

  <div class="search-wrap">
    <i class="fa fa-search"></i>
    <input class="search-input" id="searchInput" type="text" placeholder="Search by title, skill, location...">
  </div>

  <div class="filters" id="filterWrap">
    <button class="filter-btn active" onclick="filterJobs('all', this)">All</button>
    <button class="filter-btn" onclick="filterJobs('IT/Software', this)">ğŸ’» IT/Software</button>
    <button class="filter-btn" onclick="filterJobs('Accounting', this)">ğŸ“Š Accounting</button>
    <button class="filter-btn" onclick="filterJobs('Sales/Marketing', this)">ğŸ“ˆ Sales/Marketing</button>
    <button class="filter-btn" onclick="filterJobs('Management', this)">ğŸ‘” Management</button>
  </div>

  <div id="jobsList">
    <div class="loading-wrap">
      <div class="spinner"></div>
      <div class="loading-text">Loading openings...</div>
    </div>
  </div>
</div>

<!-- â˜… ADMIN TOGGLE -->
<div class="admin-toggle" id="adminToggle" onclick="toggleAdmin()">
  <i class="fa fa-shield-halved"></i>
  <span id="adminLabel">Admin</span>
</div>

<!-- â˜… EDIT MODAL -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <h3>âœï¸ Edit Job</h3>
    <input type="hidden" id="editJobId">

    <label>Title</label>
    <input type="text" id="editTitle">

    <label>Category</label>
    <select id="editCategory">
      <option>IT/Software</option>
      <option>Accounting</option>
      <option>Sales/Marketing</option>
      <option>Management</option>
      <option>HR</option>
      <option>Design</option>
      <option>Other</option>
    </select>

    <label>Department</label>
    <input type="text" id="editDepartment">

    <label>Company</label>
    <input type="text" id="editCompany">

    <label>Location</label>
    <input type="text" id="editLocation">

    <label>Level</label>
    <select id="editLevel">
      <option>Fresher</option>
      <option>Junior</option>
      <option>Mid-Level</option>
      <option>Senior</option>
      <option>Lead</option>
    </select>

    <label>Description</label>
    <textarea id="editDescription"></textarea>

    <label>Skills (comma separated)</label>
    <input type="text" id="editSkills">

    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeEditModal()">Cancel</button>
      <button class="modal-btn save" onclick="saveEdit()">ğŸ’¾ Save Changes</button>
    </div>
  </div>
</div>

<!-- â˜… DELETE MODAL -->
<div class="modal-overlay delete-modal" id="deleteModal">
  <div class="modal">
    <h3>ğŸ—‘ï¸ Delete Job</h3>
    <p>Are you sure you want to delete this job?</p>
    <p class="job-title" id="deleteJobTitle"></p>
    <p style="color:#64748b; font-size:0.82rem; margin-top:12px;">This action cannot be undone.</p>
    <input type="hidden" id="deleteJobId">
    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="modal-btn delete" onclick="confirmDelete()">ğŸ—‘ï¸ Delete</button>
    </div>
  </div>
</div>

<!-- â˜… TOAST -->
<div class="toast" id="toast"></div>

<div class="footer">
  Â© 2025 <a href="index.html">Simpatico HR Consultancy</a> â€¢ AI-Powered Recruitment
</div>

<script>
  const SUPABASE_URL = "https://cvkxtsvgnynxexmemfuy.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3h0c3ZnbnlueGV4bWVtZnV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0MjE2NTEsImV4cCI6MjA4Mjk5NzY1MX0.2mys8Cc-ucJ1uLThEGJubeDEg1TvfIAkW-xFsR4ecq4";
  const WORKER_URL = "https://evalis-ai.simpaticohrconsultancy.workers.dev";
  const ADMIN_PASSWORD = "simpatico2025";

  let allJobs = [];
  let currentFilter = 'all';
  let isAdmin = false;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Supabase Helper
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async function supabaseGet(table, filters = {}) {
    let url = `${SUPABASE_URL}/rest/v1/${table}?`;
    for (const [key, val] of Object.entries(filters)) {
      url += `${key}=eq.${val}&`;
    }
    url += `order=created_at.desc`;
    const res = await fetch(url, {
      headers: { "apikey": SUPABASE_KEY, "Authorization": "Bearer " + SUPABASE_KEY }
    });
    return await res.json();
  }

  async function workerDB(action, table, data = null, filters = null) {
    const res = await fetch(WORKER_URL + "/db", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action, table, data, filters })
    });
    return await res.json();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Admin Toggle
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function toggleAdmin() {
    if (!isAdmin) {
      const pw = prompt("Enter admin password:");
      if (pw !== ADMIN_PASSWORD) {
        showToast("âŒ Wrong password", "error");
        return;
      }
      isAdmin = true;
      document.getElementById('adminToggle').classList.add('active');
      document.getElementById('adminLabel').textContent = 'Admin âœ“';
      showToast("ğŸ”“ Admin mode enabled", "success");
    } else {
      isAdmin = false;
      document.getElementById('adminToggle').classList.remove('active');
      document.getElementById('adminLabel').textContent = 'Admin';
      showToast("ğŸ”’ Admin mode disabled", "success");
    }
    renderJobs(getFilteredJobs());
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Toast
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function showToast(msg, type = "success") {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = `toast ${type} show`;
    setTimeout(() => t.classList.remove('show'), 3000);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Load Jobs
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async function loadJobs() {
    const el = document.getElementById("jobsList");
    try {
      const data = await supabaseGet('jobs', { is_active: true });

      if (!data || data.error || !Array.isArray(data) || data.length === 0) {
        el.innerHTML = `
          <div class="empty">
            <div class="empty-icon">ğŸ“­</div>
            <h3 style="margin-bottom:8px;">No openings right now</h3>
            <p>Check back soon â€” new positions are added regularly.</p>
          </div>`;
        document.getElementById('totalJobs').textContent = '0';
        document.getElementById('totalDepts').textContent = '0';
        return;
      }

      allJobs = data;
      renderJobs(allJobs);
      document.getElementById('totalJobs').textContent = data.length;
      const depts = [...new Set(data.map(j => j.department || j.category || 'General'))];
      document.getElementById('totalDepts').textContent = depts.length;

    } catch (err) {
      console.error(err);
      el.innerHTML = `
        <div class="empty">
          <div class="empty-icon">âš ï¸</div>
          <h3>Error loading jobs</h3>
          <p style="color:#f87171;">${err.message}</p>
          <button class="apply-btn" style="margin-top:16px;" onclick="loadJobs()">ğŸ”„ Retry</button>
        </div>`;
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Render Jobs
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function renderJobs(jobs) {
    const el = document.getElementById("jobsList");

    if (!jobs.length) {
      el.innerHTML = `
        <div class="empty">
          <div class="empty-icon">ğŸ”</div>
          <h3>No matching jobs found</h3>
          <p>Try a different search or filter.</p>
        </div>`;
      return;
    }

    el.innerHTML = jobs.map(job => {
      const levelClass = {
        'Fresher': 'level-fresher', 'Junior': 'level-junior',
        'Mid-Level': 'level-mid', 'Senior': 'level-senior', 'Lead': 'level-lead'
      }[job.level] || 'level-mid';

      const skills = job.skills || [];
      const company = job.company_name || job.company || "Simpatico HR";
      const location = job.location || "Remote";
      const dept = job.department || job.category || "General";
      const level = job.level || "Mid-Level";
      const desc = job.description || "Role details will be shared during the interview process.";
      const atsThreshold = job.ats_threshold || 0;

      return `
        <div class="job-card" id="job-${job.id}">
          <div class="job-header">
            <div class="job-header-left">
              <small>NOW HIRING</small>
              <h2>${job.title || 'Untitled Position'}</h2>
            </div>
            <div class="admin-actions ${isAdmin ? 'visible' : ''}">
              <button class="admin-btn edit-btn" onclick="openEditModal('${job.id}')" title="Edit">
                <i class="fa fa-pen"></i>
              </button>
              <button class="admin-btn delete-btn" onclick="openDeleteModal('${job.id}', '${(job.title || '').replace(/'/g, "\\'")}')" title="Delete">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
          <div class="job-body">
            <div class="job-meta">
              <div class="job-meta-item"><i class="fa fa-building"></i>${company}</div>
              <div class="job-meta-item"><i class="fa fa-briefcase"></i>${dept}</div>
              <div class="job-meta-item"><i class="fa fa-location-dot"></i>${location}</div>
              ${atsThreshold > 0 ? `<div class="job-meta-item"><i class="fa fa-robot"></i>AI Screening</div>` : ''}
            </div>
            <p class="job-desc">${desc.length > 250 ? desc.substring(0, 250) + '...' : desc}</p>
            ${skills.length ? `<div class="job-skills">${(Array.isArray(skills) ? skills : skills.split(',')).map(s => `<span class="skill-tag">${s.trim()}</span>`).join('')}</div>` : ''}
            <div class="job-footer">
              <span class="job-level ${levelClass}">${level}</span>
              <a class="apply-btn" href="career.html?job_id=${job.id}">
                Apply Now <i class="fa fa-arrow-right"></i>
              </a>
            </div>
          </div>
        </div>`;
    }).join('');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Edit Modal
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function openEditModal(jobId) {
    const job = allJobs.find(j => j.id === jobId);
    if (!job) return;

    document.getElementById('editJobId').value = job.id;
    document.getElementById('editTitle').value = job.title || '';
    document.getElementById('editCategory').value = job.category || 'IT/Software';
    document.getElementById('editDepartment').value = job.department || '';
    document.getElementById('editCompany').value = job.company_name || job.company || '';
    document.getElementById('editLocation').value = job.location || '';
    document.getElementById('editLevel').value = job.level || 'Mid-Level';
    document.getElementById('editDescription').value = job.description || '';
    document.getElementById('editSkills').value = Array.isArray(job.skills) ? job.skills.join(', ') : (job.skills || '');

    document.getElementById('editModal').classList.add('active');
  }

  function closeEditModal() {
    document.getElementById('editModal').classList.remove('active');
  }

  async function saveEdit() {
    const jobId = document.getElementById('editJobId').value;
    const skills = document.getElementById('editSkills').value;

    const data = {
      title: document.getElementById('editTitle').value,
      category: document.getElementById('editCategory').value,
      department: document.getElementById('editDepartment').value,
      company_name: document.getElementById('editCompany').value,
      location: document.getElementById('editLocation').value,
      level: document.getElementById('editLevel').value,
      description: document.getElementById('editDescription').value,
      skills: skills ? skills.split(',').map(s => s.trim()) : []
    };

    try {
      const result = await workerDB('update', 'jobs', data, { id: jobId });

      if (result.error) {
        showToast("âŒ " + result.error, "error");
        return;
      }

      showToast("âœ… Job updated successfully", "success");
      closeEditModal();
      await loadJobs();
      if (currentFilter !== 'all') {
        renderJobs(getFilteredJobs());
      }
    } catch (err) {
      showToast("âŒ " + err.message, "error");
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Delete Modal
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function openDeleteModal(jobId, jobTitle) {
    document.getElementById('deleteJobId').value = jobId;
    document.getElementById('deleteJobTitle').textContent = jobTitle;
    document.getElementById('deleteModal').classList.add('active');
  }

  function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('active');
  }

  async function confirmDelete() {
    const jobId = document.getElementById('deleteJobId').value;

    try {
      const result = await workerDB('delete', 'jobs', null, { id: jobId });

      if (result.error) {
        showToast("âŒ " + result.error, "error");
        return;
      }

      showToast("ğŸ—‘ï¸ Job deleted", "success");
      closeDeleteModal();

      // Remove from local array and re-render
      allJobs = allJobs.filter(j => j.id !== jobId);
      document.getElementById('totalJobs').textContent = allJobs.length;
      const depts = [...new Set(allJobs.map(j => j.department || j.category || 'General'))];
      document.getElementById('totalDepts').textContent = depts.length;
      renderJobs(getFilteredJobs());
    } catch (err) {
      showToast("âŒ " + err.message, "error");
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Filter & Search
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function getFilteredJobs() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    let filtered = allJobs;
    if (currentFilter !== 'all') {
      filtered = filtered.filter(j =>
        (j.category || '').toLowerCase() === currentFilter.toLowerCase() ||
        (j.department || '').toLowerCase() === currentFilter.toLowerCase()
      );
    }
    if (searchTerm) {
      filtered = filtered.filter(j => {
        const text = [j.title, j.description, j.department, j.category, j.location, j.level, ...(j.skills || [])]
          .filter(Boolean).join(' ').toLowerCase();
        return text.includes(searchTerm);
      });
    }
    return filtered;
  }

  function filterJobs(category, btn) {
    currentFilter = category;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderJobs(getFilteredJobs());
  }

  let searchTimeout;
  document.getElementById('searchInput').addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => renderJobs(getFilteredJobs()), 300);
  });

  // Close modals on overlay click
  document.getElementById('editModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('editModal')) closeEditModal();
  });
  document.getElementById('deleteModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('deleteModal')) closeDeleteModal();
  });

  // ESC to close modals
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') { closeEditModal(); closeDeleteModal(); }
  });

  // Init
  loadJobs();
</script>

</body>
</html>
