<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simpatico HR | Jobs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Plus Jakarta Sans',system-ui,-apple-system,sans-serif;background:#0a0f1e;color:#e2e8f0;min-height:100vh}
    .nav{backdrop-filter:blur(16px);background:rgba(10,15,30,.9);padding:1.2rem 6%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.06);position:sticky;top:0;z-index:100}
    .logo{font-weight:800;font-size:1.1rem;color:#fff;text-decoration:none}.logo span{color:#6366f1}
    .nav-links{display:flex;gap:16px;align-items:center}
    .nav-link{color:#94a3b8;text-decoration:none;font-size:13px;font-weight:500;padding:6px 14px;border-radius:8px;transition:all .2s}
    .nav-link:hover{color:#fff;background:rgba(255,255,255,.05)}
    .nav-link.active{color:#fff;background:rgba(99,102,241,.15)}
    .container{max-width:900px;margin:0 auto;padding:50px 20px}
    .page-header{text-align:center;margin-bottom:50px}
    .page-header h1{font-size:clamp(2rem,5vw,3rem);font-weight:800;background:linear-gradient(135deg,#fff,#94a3b8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px}
    .page-header p{color:#64748b;font-size:1.05rem;max-width:500px;margin:0 auto;line-height:1.6}
    .stats-bar{display:flex;justify-content:center;gap:32px;margin-bottom:40px;flex-wrap:wrap}
    .stat{text-align:center;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px 28px}
    .stat-num{font-size:1.6rem;font-weight:800;color:#6366f1}
    .stat-label{font-size:.75rem;color:#64748b;margin-top:2px}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:30px;justify-content:center}
    .filter-btn{padding:8px 18px;border:1px solid rgba(255,255,255,.08);border-radius:10px;background:transparent;color:#94a3b8;font-size:.82rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit}
    .filter-btn:hover{border-color:rgba(99,102,241,.3);color:#fff}
    .filter-btn.active{background:rgba(99,102,241,.15);border-color:rgba(99,102,241,.4);color:#a5b4fc}
    .search-wrap{margin-bottom:30px;position:relative}
    .search-wrap i{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#475569}
    .search-input{width:100%;padding:14px 16px 14px 44px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;color:#e2e8f0;font-size:.95rem;outline:none;font-family:inherit;transition:border-color .2s}
    .search-input:focus{border-color:rgba(99,102,241,.4);box-shadow:0 0 0 3px rgba(99,102,241,.1)}
    .search-input::placeholder{color:#475569}
    .job-card{background:rgba(15,23,42,.8);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.06);border-radius:24px;margin-bottom:20px;overflow:hidden;transition:all .3s ease}
    .job-card:hover{border-color:rgba(99,102,241,.3);transform:translateY(-4px);box-shadow:0 12px 40px rgba(99,102,241,.08)}
    .job-header{background:linear-gradient(135deg,rgba(99,102,241,.15),rgba(139,92,246,.1));padding:24px 28px 18px;border-bottom:1px solid rgba(255,255,255,.04);display:flex;justify-content:space-between;align-items:flex-start}
    .job-header-left{flex:1}
    .job-header small{font-size:.72rem;color:#6366f1;font-weight:700;letter-spacing:1.5px;text-transform:uppercase}
    .job-header h2{font-size:1.4rem;font-weight:700;margin-top:6px;color:#f1f5f9}
    .admin-actions{display:none;gap:8px;flex-shrink:0}
    .admin-actions.visible{display:flex}
    .admin-btn{width:36px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);color:#94a3b8;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.85rem;transition:all .2s}
    .admin-btn:hover{background:rgba(255,255,255,.1);color:#fff}
    .admin-btn.edit-btn:hover{border-color:rgba(99,102,241,.5);color:#a5b4fc}
    .admin-btn.delete-btn:hover{border-color:rgba(239,68,68,.5);color:#f87171}
    .admin-btn.toggle-btn:hover{border-color:rgba(245,158,11,.5);color:#fbbf24}
    .job-body{padding:24px 28px}
    .job-meta{display:flex;gap:18px;flex-wrap:wrap;margin-bottom:16px}
    .job-meta-item{display:flex;align-items:center;gap:6px;font-size:.82rem;color:#94a3b8}
    .job-meta-item i{color:#6366f1;font-size:.8rem}
    .job-desc{color:#94a3b8;font-size:.9rem;line-height:1.7;margin-bottom:18px}
    .job-skills{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:20px}
    .skill-tag{background:rgba(99,102,241,.1);color:#a5b4fc;padding:4px 12px;border-radius:8px;font-size:.75rem;font-weight:600}
    .job-footer{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
    .job-level{font-size:.78rem;font-weight:600;padding:4px 12px;border-radius:8px}
    .level-fresher{background:rgba(16,185,129,.12);color:#34d399}
    .level-junior{background:rgba(59,130,246,.12);color:#60a5fa}
    .level-mid{background:rgba(99,102,241,.12);color:#a5b4fc}
    .level-senior{background:rgba(245,158,11,.12);color:#fbbf24}
    .level-lead{background:rgba(239,68,68,.12);color:#f87171}
    .apply-btn{display:inline-flex;align-items:center;gap:8px;background:#6366f1;color:#fff;padding:12px 24px;border-radius:14px;text-decoration:none;font-weight:700;font-size:.9rem;transition:all .2s;border:none;cursor:pointer;font-family:inherit}
    .apply-btn:hover{transform:scale(1.03);box-shadow:0 8px 24px rgba(99,102,241,.3)}
    .empty{text-align:center;padding:60px 20px;color:#64748b}
    .empty-icon{font-size:3rem;margin-bottom:16px;opacity:.3}
    .loading-wrap{text-align:center;padding:60px 20px}
    .spinner{display:inline-block;width:40px;height:40px;border:3px solid rgba(99,102,241,.2);border-top-color:#6366f1;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{margin-top:12px;color:#64748b;font-size:.9rem}
    .admin-toggle{position:fixed;bottom:24px;right:24px;z-index:200;background:rgba(15,23,42,.95);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:12px 20px;display:flex;align-items:center;gap:10px;backdrop-filter:blur(12px);cursor:pointer;transition:all .2s}
    .admin-toggle:hover{border-color:rgba(99,102,241,.4)}
    .admin-toggle i{color:#6366f1}
    .admin-toggle span{color:#94a3b8;font-size:.82rem;font-weight:600}
    .admin-toggle.active span{color:#a5b4fc}
    .admin-toggle.active{border-color:rgba(99,102,241,.4);background:rgba(99,102,241,.1)}
    .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:300;align-items:center;justify-content:center}
    .modal-overlay.active{display:flex}
    .modal{background:#0f172a;border:1px solid rgba(255,255,255,.1);border-radius:24px;padding:32px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto}
    .modal h3{color:#f1f5f9;font-size:1.3rem;margin-bottom:24px}
    .modal label{display:block;color:#94a3b8;font-size:.82rem;font-weight:600;margin-bottom:6px;margin-top:16px}
    .modal input,.modal textarea,.modal select{width:100%;padding:12px 16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#e2e8f0;font-size:.9rem;font-family:inherit;outline:none}
    .modal input:focus,.modal textarea:focus,.modal select:focus{border-color:rgba(99,102,241,.4)}
    .modal select option{background:#1e293b}
    .modal textarea{min-height:100px;resize:vertical}
    .modal-btns{display:flex;gap:12px;margin-top:24px}
    .modal-btn{flex:1;padding:12px;border-radius:12px;font-weight:700;font-size:.9rem;cursor:pointer;border:none;font-family:inherit;transition:all .2s}
    .modal-btn:disabled{opacity:.5;cursor:not-allowed}
    .modal-btn.save{background:#6366f1;color:#fff}
    .modal-btn.save:hover:not(:disabled){background:#4f46e5}
    .modal-btn.cancel{background:rgba(255,255,255,.05);color:#94a3b8;border:1px solid rgba(255,255,255,.1)}
    .modal-btn.cancel:hover{background:rgba(255,255,255,.1);color:#fff}
    .delete-modal .modal{max-width:400px;text-align:center}
    .delete-modal p{color:#94a3b8;margin-bottom:8px;line-height:1.6}
    .delete-modal .job-title{color:#f87171;font-weight:700;font-size:1.1rem}
    .modal-btn.delete{background:#dc2626;color:#fff}
    .modal-btn.delete:hover:not(:disabled){background:#b91c1c}
    .login-modal .modal{max-width:400px;text-align:center}
    .login-modal .modal h3{margin-bottom:16px}
    .login-modal .modal p{color:#94a3b8;font-size:.88rem;margin-bottom:20px}
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#1e293b;border:1px solid rgba(255,255,255,.1);padding:14px 28px;border-radius:14px;color:#e2e8f0;font-size:.9rem;font-weight:600;z-index:400;opacity:0;transition:opacity .3s;pointer-events:none}
    .toast.success{border-color:rgba(16,185,129,.4)}
    .toast.error{border-color:rgba(239,68,68,.4)}
    .toast.show{opacity:1}
    .connection-badge{display:inline-flex;align-items:center;gap:4px;font-size:.7rem;padding:2px 8px;border-radius:8px;margin-left:8px}
    .conn-ok{background:rgba(16,185,129,.1);color:#10b981}
    .conn-err{background:rgba(239,68,68,.1);color:#ef4444}
    .footer{text-align:center;padding:40px 0;margin-top:60px;border-top:1px solid rgba(255,255,255,.04);font-size:12px;color:#475569}
    .footer a{color:#6366f1;text-decoration:none}
    @media(max-width:600px){
      .container{padding:30px 14px}
      .job-header,.job-body{padding:18px 20px}
      .job-header h2{font-size:1.2rem}
      .stats-bar{gap:12px}.stat{padding:12px 18px}
      .nav{padding:1rem 4%}.nav-links{gap:8px}.nav-link{font-size:12px;padding:5px 10px}
      .admin-toggle{bottom:16px;right:16px;padding:10px 16px}
    }
  </style>
</head>
<body>

<nav class="nav">
  <a class="logo" href="/">SIMPATICO <span>HR</span></a>
  <div class="nav-links">
    <a class="nav-link active" href="jobs.html">ğŸ’¼ Jobs</a>
    <a class="nav-link" href="career-lab.html">ğŸ§  Career Lab</a>
    <a class="nav-link" href="evalis-platform.html">ğŸ¤ Interview</a>
    <a class="nav-link" href="/">Home</a>
  </div>
</nav>

<div class="container">
  <div class="page-header">
    <h1>Current Openings</h1>
    <p>Find your next opportunity. Apply and get AI-screened instantly.</p>
  </div>

  <div class="stats-bar">
    <div class="stat"><div class="stat-num" id="totalJobs">-</div><div class="stat-label">Open Positions</div></div>
    <div class="stat"><div class="stat-num" id="totalCompanies">-</div><div class="stat-label">Companies</div></div>
    <div class="stat"><div class="stat-num">AI</div><div class="stat-label">ATS Screening</div></div>
  </div>

  <div class="search-wrap">
    <i class="fa fa-search"></i>
    <input class="search-input" id="searchInput" type="text" placeholder="Search by title, skill, company, location...">
  </div>

  <div class="filters" id="filterWrap">
    <button class="filter-btn active" onclick="filterJobs('all',this)">All</button>
    <button class="filter-btn" onclick="filterJobs('full-time',this)">ğŸ’¼ Full-Time</button>
    <button class="filter-btn" onclick="filterJobs('part-time',this)">â° Part-Time</button>
    <button class="filter-btn" onclick="filterJobs('contract',this)">ğŸ“‹ Contract</button>
    <button class="filter-btn" onclick="filterJobs('remote',this)">ğŸŒ Remote</button>
  </div>

  <div id="jobsList">
    <div class="loading-wrap">
      <div class="spinner"></div>
      <div class="loading-text">Loading openings...</div>
    </div>
  </div>
</div>

<!-- ADMIN TOGGLE -->
<div class="admin-toggle" id="adminToggle" onclick="toggleAdmin()">
  <i class="fa fa-shield-halved"></i>
  <span id="adminLabel">Admin</span>
</div>

<!-- HR LOGIN MODAL -->
<div class="modal-overlay login-modal" id="loginModal">
  <div class="modal">
    <h3>ğŸ” HR Login</h3>
    <p>Login with your HR credentials to manage jobs</p>
    <label style="text-align:left;">Email</label>
    <input type="email" id="adminEmail" placeholder="hr@company.com">
    <label style="text-align:left;margin-top:12px;">Password</label>
    <input type="password" id="adminPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doAdminLogin()">
    <div id="adminLoginError" style="color:#f87171;font-size:.85rem;margin-top:8px;display:none;"></div>
    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeLoginModal()">Cancel</button>
      <button class="modal-btn save" id="adminLoginBtn" onclick="doAdminLogin()">ğŸ”“ Login</button>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <h3>âœï¸ Edit Job</h3>
    <input type="hidden" id="editJobId">
    <label>Title</label>
    <input type="text" id="editTitle">
    <label>Job Type</label>
    <select id="editJobType">
      <option value="full-time">Full-Time</option>
      <option value="part-time">Part-Time</option>
      <option value="contract">Contract</option>
      <option value="remote">Remote</option>
      <option value="hybrid">Hybrid</option>
    </select>
    <label>Department</label>
    <input type="text" id="editDepartment">
    <label>Location</label>
    <input type="text" id="editLocation">
    <label>Description</label>
    <textarea id="editDescription"></textarea>
    <label>Skills (comma separated)</label>
    <input type="text" id="editSkills">
    <label>Min Salary</label>
    <input type="number" id="editSalaryMin" placeholder="0">
    <label>Max Salary</label>
    <input type="number" id="editSalaryMax" placeholder="0">
    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeEditModal()">Cancel</button>
      <button class="modal-btn save" id="editSaveBtn" onclick="saveEdit()">ğŸ’¾ Save</button>
    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal-overlay delete-modal" id="deleteModal">
  <div class="modal">
    <h3>ğŸ—‘ï¸ Delete Job</h3>
    <p>Are you sure you want to delete this job?</p>
    <p class="job-title" id="deleteJobTitle"></p>
    <p style="color:#64748b;font-size:.82rem;margin-top:12px;">This cannot be undone. All applications will also be deleted.</p>
    <input type="hidden" id="deleteJobId">
    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="modal-btn delete" id="deleteConfirmBtn" onclick="confirmDelete()">ğŸ—‘ï¸ Delete</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<div class="footer">
  Â© 2025 <a href="/">Simpatico HR Consultancy</a> â€¢ AI-Powered Recruitment
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG â€” NO EXPOSED CREDENTIALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WORKER_URL = localStorage.getItem('workerUrl') || "https://evalis-ai.simpaticohrconsultancy.workers.dev";

let allJobs = [];
let currentFilter = 'all';
let isAdmin = false;
let HR_TOKEN = null;
let HR_USER = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API HELPER â€” All calls go through the worker
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function api(method, path, body = null, auth = false) {
  const opts = {
    method,
    headers: { 'Content-Type': 'application/json' }
  };
  if (auth && HR_TOKEN) {
    opts.headers['Authorization'] = 'Bearer ' + HR_TOKEN;
  }
  if (body) opts.body = JSON.stringify(body);

  const res = await fetch(WORKER_URL + path, opts);
  const data = await res.json();
  if (!res.ok) throw new Error(data.error || 'HTTP ' + res.status);
  return data;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg, type = "success") {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.classList.remove('show'), 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOAD JOBS â€” Public endpoint GET /jobs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadJobs() {
  const el = document.getElementById("jobsList");
  try {
    // Build query params
    const params = new URLSearchParams();
    const search = document.getElementById('searchInput')?.value?.trim();
    if (search) params.set('search', search);
    if (currentFilter !== 'all') params.set('type', currentFilter);

    const queryStr = params.toString();
    const data = await api('GET', '/jobs' + (queryStr ? '?' + queryStr : ''));
    const jobs = data.jobs || [];

    if (!jobs.length) {
      el.innerHTML = `<div class="empty">
        <div class="empty-icon">ğŸ“­</div>
        <h3 style="margin-bottom:8px;">No openings found</h3>
        <p>Try a different search or check back soon.</p>
      </div>`;
      document.getElementById('totalJobs').textContent = '0';
      document.getElementById('totalCompanies').textContent = '0';
      allJobs = [];
      return;
    }

    allJobs = jobs;
    renderJobs(jobs);

    document.getElementById('totalJobs').textContent = jobs.length;
    const companies = [...new Set(jobs.map(j => j.company_name || 'Unknown'))];
    document.getElementById('totalCompanies').textContent = companies.length;

  } catch (err) {
    console.error('[Jobs]', err);
    el.innerHTML = `<div class="empty">
      <div class="empty-icon">âš ï¸</div>
      <h3>Error loading jobs</h3>
      <p style="color:#f87171;">${err.message}</p>
      <button class="apply-btn" style="margin-top:16px;" onclick="loadJobs()">ğŸ”„ Retry</button>
    </div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER JOBS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderJobs(jobs) {
  const el = document.getElementById("jobsList");

  if (!jobs.length) {
    el.innerHTML = `<div class="empty">
      <div class="empty-icon">ğŸ”</div>
      <h3>No matching jobs</h3>
      <p>Try different keywords.</p>
    </div>`;
    return;
  }

  el.innerHTML = jobs.map(job => {
    const levelMap = {
      'Fresher': 'level-fresher', 'Junior': 'level-junior',
      'Mid-Level': 'level-mid', 'Senior': 'level-senior', 'Lead': 'level-lead'
    };
    const levelClass = levelMap[job.level] || 'level-mid';

    // Handle skills â€” could be string or array
    let skills = [];
    if (Array.isArray(job.skills)) {
      skills = job.skills;
    } else if (typeof job.skills === 'string' && job.skills) {
      skills = job.skills.split(',').map(s => s.trim()).filter(Boolean);
    }

    const company = job.company_name || 'Company';
    const location = job.location || 'Remote';
    const jobType = job.job_type || 'full-time';
    const level = job.level || 'Mid-Level';
    const desc = job.description || 'Details shared during interview.';
    const salary = job.salary_max ? (job.salary_min ? `â‚¹${(job.salary_min/100000).toFixed(0)}â€“${(job.salary_max/100000).toFixed(0)} LPA` : `Up to â‚¹${(job.salary_max/100000).toFixed(0)} LPA`) : '';
    const appsCount = job.applications_count || 0;

    // Apply URL â€” goes to evalis-platform.html with job_id
    const applyUrl = `evalis-platform.html?apply=${job.id}`;

    return `<div class="job-card" id="job-${job.id}">
      <div class="job-header">
        <div class="job-header-left">
          <small>${company.toUpperCase()} â€” NOW HIRING</small>
          <h2>${job.title || 'Untitled'}</h2>
        </div>
        <div class="admin-actions ${isAdmin ? 'visible' : ''}">
          <button class="admin-btn edit-btn" onclick="openEditModal('${job.id}')" title="Edit"><i class="fa fa-pen"></i></button>
          <button class="admin-btn delete-btn" onclick="openDeleteModal('${job.id}','${(job.title||'').replace(/'/g,"\\'")}')" title="Delete"><i class="fa fa-trash"></i></button>
        </div>
      </div>
      <div class="job-body">
        <div class="job-meta">
          <div class="job-meta-item"><i class="fa fa-building"></i>${company}</div>
          <div class="job-meta-item"><i class="fa fa-briefcase"></i>${jobType}</div>
          <div class="job-meta-item"><i class="fa fa-location-dot"></i>${location}</div>
          ${salary ? `<div class="job-meta-item"><i class="fa fa-indian-rupee-sign"></i>${salary}</div>` : ''}
          ${appsCount > 0 ? `<div class="job-meta-item"><i class="fa fa-users"></i>${appsCount} applied</div>` : ''}
        </div>
        <p class="job-desc">${desc.length > 300 ? desc.substring(0, 300) + '...' : desc}</p>
        ${skills.length ? `<div class="job-skills">${skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}</div>` : ''}
        <div class="job-footer">
          <span class="job-level ${levelClass}">${level}</span>
          <a class="apply-btn" href="${applyUrl}">Apply Now <i class="fa fa-arrow-right"></i></a>
        </div>
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER & SEARCH â€” Server-side via GET /jobs?search=&type=
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function filterJobs(type, btn) {
  currentFilter = type;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadJobs(); // Reload from API with new filter
}

let searchTimeout;
document.getElementById('searchInput').addEventListener('input', () => {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => loadJobs(), 400);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN AUTH â€” Uses POST /auth/login (proper API auth)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleAdmin() {
  if (!isAdmin) {
    // Check if already have saved session
    const savedToken = localStorage.getItem('hr_token');
    const savedUser = localStorage.getItem('hr_user');
    if (savedToken && savedUser) {
      try {
        const decoded = JSON.parse(atob(savedToken));
        if (decoded.exp && decoded.exp > Date.now()) {
          HR_TOKEN = savedToken;
          HR_USER = JSON.parse(savedUser);
          enableAdmin();
          return;
        }
      } catch {}
    }
    // Show login modal
    document.getElementById('loginModal').classList.add('active');
    document.getElementById('adminEmail').focus();
  } else {
    disableAdmin();
  }
}

async function doAdminLogin() {
  const email = document.getElementById('adminEmail').value.trim();
  const pass = document.getElementById('adminPass').value.trim();
  if (!email || !pass) { showToast('âŒ Enter credentials', 'error'); return; }

  const btn = document.getElementById('adminLoginBtn');
  btn.disabled = true; btn.textContent = 'â³...';
  document.getElementById('adminLoginError').style.display = 'none';

  try {
    const data = await api('POST', '/auth/login', { email, password: pass });
    if (!data.success || !data.token) throw new Error(data.error || 'Login failed');

    // Must be client_admin or hr role
    if (!['client_admin', 'hr', 'superadmin'].includes(data.user.role)) {
      throw new Error('Admin or HR role required');
    }

    HR_TOKEN = data.token;
    HR_USER = data.user;
    localStorage.setItem('hr_token', HR_TOKEN);
    localStorage.setItem('hr_user', JSON.stringify(HR_USER));

    closeLoginModal();
    enableAdmin();
    showToast('âœ… Admin mode â€” ' + (data.user.name || 'HR'), 'success');
  } catch (e) {
    document.getElementById('adminLoginError').textContent = 'âŒ ' + e.message;
    document.getElementById('adminLoginError').style.display = 'block';
  }
  btn.disabled = false; btn.textContent = 'ğŸ”“ Login';
}

function enableAdmin() {
  isAdmin = true;
  document.getElementById('adminToggle').classList.add('active');
  document.getElementById('adminLabel').textContent = (HR_USER?.name || 'Admin') + ' âœ“';
  // Re-render to show admin buttons
  renderJobs(allJobs);
}

function disableAdmin() {
  isAdmin = false;
  HR_TOKEN = null;
  HR_USER = null;
  localStorage.removeItem('hr_token');
  localStorage.removeItem('hr_user');
  document.getElementById('adminToggle').classList.remove('active');
  document.getElementById('adminLabel').textContent = 'Admin';
  showToast('ğŸ”’ Admin mode off', 'success');
  renderJobs(allJobs);
}

function closeLoginModal() {
  document.getElementById('loginModal').classList.remove('active');
  document.getElementById('adminPass').value = '';
  document.getElementById('adminLoginError').style.display = 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EDIT JOB â€” Uses authenticated API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openEditModal(jobId) {
  const job = allJobs.find(j => j.id === jobId);
  if (!job) return;

  document.getElementById('editJobId').value = job.id;
  document.getElementById('editTitle').value = job.title || '';
  document.getElementById('editJobType').value = job.job_type || 'full-time';
  document.getElementById('editDepartment').value = job.department || '';
  document.getElementById('editLocation').value = job.location || '';
  document.getElementById('editDescription').value = job.description || '';
  document.getElementById('editSalaryMin').value = job.salary_min || '';
  document.getElementById('editSalaryMax').value = job.salary_max || '';

  // Handle skills
  if (Array.isArray(job.skills)) {
    document.getElementById('editSkills').value = job.skills.join(', ');
  } else {
    document.getElementById('editSkills').value = job.skills || '';
  }

  document.getElementById('editModal').classList.add('active');
}

function closeEditModal() {
  document.getElementById('editModal').classList.remove('active');
}

async function saveEdit() {
  const jobId = document.getElementById('editJobId').value;
  const btn = document.getElementById('editSaveBtn');
  btn.disabled = true; btn.textContent = 'â³...';

  const updateData = {
    title: document.getElementById('editTitle').value.trim(),
    job_type: document.getElementById('editJobType').value,
    department: document.getElementById('editDepartment').value.trim(),
    location: document.getElementById('editLocation').value.trim(),
    description: document.getElementById('editDescription').value.trim(),
    skills: document.getElementById('editSkills').value.trim(),
    salary_min: parseInt(document.getElementById('editSalaryMin').value) || 0,
    salary_max: parseInt(document.getElementById('editSalaryMax').value) || 0
  };

  try {
    // Use authenticated /db proxy for updates (worker validates auth via token)
    // Alternatively, if you add PUT /client/jobs/:id to the worker, use that
    await api('POST', '/db', {
      action: 'update',
      table: 'jobs',
      data: updateData,
      filters: { id: jobId }
    }, true);

    showToast("âœ… Job updated!", "success");
    closeEditModal();
    await loadJobs();
  } catch (err) {
    showToast("âŒ " + err.message, "error");
  }
  btn.disabled = false; btn.textContent = 'ğŸ’¾ Save';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELETE JOB â€” Uses authenticated API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openDeleteModal(jobId, jobTitle) {
  document.getElementById('deleteJobId').value = jobId;
  document.getElementById('deleteJobTitle').textContent = jobTitle;
  document.getElementById('deleteModal').classList.add('active');
}

function closeDeleteModal() {
  document.getElementById('deleteModal').classList.remove('active');
}

async function confirmDelete() {
  const jobId = document.getElementById('deleteJobId').value;
  const btn = document.getElementById('deleteConfirmBtn');
  btn.disabled = true; btn.textContent = 'â³...';

  try {
    // Use the proper client endpoint if available, otherwise /db proxy
    try {
      await api('DELETE', '/client/jobs/' + jobId, null, true);
    } catch {
      // Fallback to /db proxy
      await api('POST', '/db', {
        action: 'delete', table: 'jobs', filters: { id: jobId }
      }, true);
    }

    showToast("ğŸ—‘ï¸ Job deleted", "success");
    closeDeleteModal();

    allJobs = allJobs.filter(j => j.id !== jobId);
    document.getElementById('totalJobs').textContent = allJobs.length;
    renderJobs(allJobs);
  } catch (err) {
    showToast("âŒ " + err.message, "error");
  }
  btn.disabled = false; btn.textContent = 'ğŸ—‘ï¸ Delete';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL CONTROLS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
['editModal', 'deleteModal', 'loginModal'].forEach(id => {
  document.getElementById(id).addEventListener('click', e => {
    if (e.target === document.getElementById(id)) {
      document.getElementById(id).classList.remove('active');
    }
  });
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    closeEditModal();
    closeDeleteModal();
    closeLoginModal();
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HANDLE ?apply=JOB_ID from URL (redirect to platform)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkApplyParam() {
  const params = new URLSearchParams(location.search);
  const applyId = params.get('apply');
  if (applyId) {
    // Redirect to the platform's apply page
    window.location.href = `evalis-platform.html?apply=${applyId}`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
checkApplyParam();
loadJobs();
</script>

</body>
</html>
